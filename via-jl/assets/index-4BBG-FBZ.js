var z=Object.defineProperty;var X=(e,t,o)=>t in e?z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var E=(e,t,o)=>X(e,typeof t!="symbol"?t+"":t,o);import{u as useSelector,a as useDispatch,r as reactExports,d as distExports,b as defaultsDeep,c as createSlice,e as current,C as Color,p as partition,f as createSelector,g as del,h as update,s as setMany,i as entries,j as styled,k as jsxRuntimeExports,l as useCombobox,R as React,S as StateManagedSelect$1,m as distExports$1,F as FontAwesomeIcon,n as faLightbulb,o as faHeadphones,q as faDisplay,t as faMicrochip,v as createListenerMiddleware,w as configureStore,x as faBook,y as faUndo,z as faSave,A as faTrash,B as faCompress,D as faExpand,E as faMagicWandSparkles,G as faStopwatch,H as faSquare,I as faCircle,J as faXmarkCircle,K as ReactTextareaAutocomplete,L as faClapperboard,M as faCode,N as faFloppyDisk,O as stringify,P as faAngleDown,Q as faPlus,T as faUpload,U as faXmark,V as faToolbox,W as useProgress,X as faCircleQuestion,Y as faWarning,Z as faComputer,_ as useLocation,$ as Link$1,a0 as faCancel,a1 as faDownload,a2 as faKeyboard,a3 as faStethoscope,a4 as faBrush,a5 as faGear,a6 as faBug,a7 as faDiscord,a8 as faGithub,a9 as useResizeObserver,aa as Shape,ab as shallowEqual,ac as useSpring,ad as animated,ae as Html,af as useGLTF,ag as Segments,ah as Segment,ai as PresentationControls,aj as useThree,ak as useFrame,al as PerspectiveCamera,am as BufferAttribute,an as Canvas,ao as OrbitControls,ap as faUnlock,aq as faSpinner,ar as Object3D,as as SpotLight,at as config,au as createGlobalStyle,av as Route,aw as Provider_default,ax as clientExports}from"./vendor-CuJnSHbf.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function o(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=o(s);fetch(s.href,r)}})();var TestKeyState=(e=>(e[e.Initial=0]="Initial",e[e.KeyDown=1]="KeyDown",e[e.KeyUp=2]="KeyUp",e))(TestKeyState||{});let globalAudioContext,globalAmp,globalAmpGain=1;const ampGain=.25,ampAttack=.05,ampDecay=.05,ampSustain=1,ampRelease=.05;function getAudioContext(){return globalAudioContext===void 0&&(globalAudioContext=new AudioContext),globalAudioContext}function getGlobalAmp(){if(globalAmp===void 0){const e=getAudioContext();globalAmp=e.createGain(),globalAmp.gain.value=globalAmpGain,globalAmp.connect(e.destination)}return globalAmp}function setGlobalAmpGain(e){globalAmpGain=e,globalAmp!==void 0&&(globalAmp.gain.setValueAtTime(globalAmp.gain.value,getAudioContext().currentTime),globalAmp.gain.linearRampToValueAtTime(globalAmpGain,getAudioContext().currentTime+.2))}function midiNoteToFrequency(e){return Math.pow(2,(e-69)/12)*440}class Note{constructor(t,o){E(this,"audioContext");E(this,"osc");E(this,"amp");E(this,"ampSustainTime");E(this,"midiNote");this.midiNote=t,this.audioContext=getAudioContext(),this.osc=new OscillatorNode(this.audioContext,{type:o,frequency:midiNoteToFrequency(this.midiNote)}),this.ampSustainTime=0,this.amp=this.audioContext.createGain(),this.amp.gain.value=0,this.amp.connect(getGlobalAmp()),this.osc.connect(this.amp)}noteOn(){const t=this.audioContext.currentTime;this.osc.start(t),this.ampSustainTime=t+ampAttack+ampDecay,this.amp.gain.linearRampToValueAtTime(ampGain,t+ampAttack),this.amp.gain.linearRampToValueAtTime(ampGain*ampSustain,this.ampSustainTime)}noteOff(){this.audioContext.currentTime>=this.ampSustainTime&&this.amp.gain.setValueAtTime(ampGain*ampSustain,this.audioContext.currentTime);const t=Math.max(this.audioContext.currentTime,this.ampSustainTime)+ampRelease;this.osc.stop(t),this.amp.gain.linearRampToValueAtTime(0,t)}}const useAppSelector=useSelector,useAppDispatch=useDispatch;var TestKeyboardSoundsMode=(e=>(e[e.Random=0]="Random",e[e.WickiHayden=1]="WickiHayden",e[e.Chromatic=2]="Chromatic",e))(TestKeyboardSoundsMode||{});let lastPressedKeys=[],notes={};const baseSeed=Math.floor(Math.random()*1e3),seededRandom=e=>((baseSeed+e)*9301+49297)%233280/233280,calculateMidiNote=(e,t,o,n,s)=>{const r=Math.min(4,o-n-1)+Math.max(0,5-o);switch(e){case 1:return[-18,-19,-14,-9,-4][r]+72+t+s*2;case 2:return[-15,-12,-7,-1,4][r]+72+t+s;case 0:default:return 72+t+Math.floor(seededRandom(n*1e3+s)*24)-12}},turnOffAllTheNotes=()=>{Object.values(notes).forEach(e=>e==null?void 0:e.noteOff())},TestKeyboardSounds=({pressedKeys:e})=>{const{waveform:t,volume:o,mode:n,transpose:s}=useAppSelector(getTestKeyboardSoundsSettings);return reactExports.useEffect(()=>{setGlobalAmpGain(o/100)},[o]),reactExports.useEffect(()=>{if(e.length===0)turnOffAllTheNotes();else{const r=e.length;lastPressedKeys=e.reduce((a,i,c)=>[...a,i.reduce((l,d,u)=>{var C,m;const _=`${c},${u}`,p=((C=lastPressedKeys==null?void 0:lastPressedKeys.at(c))==null?void 0:C.at(u))??TestKeyState.KeyUp,x=d??TestKeyState.KeyUp;if(x!=p)if(x==TestKeyState.KeyDown){const h=calculateMidiNote(n,s,r,c,u);notes[_]=new Note(h,t),notes[_].noteOn()}else x==TestKeyState.KeyUp&&((m=notes[_])==null||m.noteOff());return[...l,d]},[])],[])}},[e]),reactExports.useEffect(()=>()=>{turnOffAllTheNotes()},[]),null},THEMES={OLIVIA_DARK:{alpha:{c:"#363434",t:"#E8C4B8"},mod:{c:"#363434",t:"#E8C4B8"},accent:{c:"#E8C4B8",t:"#363434"}},OLIVE:{alpha:{t:"#66665A",c:"#D9D7C4"},mod:{c:"#66665A",t:"#9DA183"},accent:{c:"#9DA183",t:"#66665A"}},OLIVE_DARK:{alpha:{c:"#66665A",t:"#9DA183"},mod:{c:"#66665A",t:"#9DA183"},accent:{c:"#9DA183",t:"#66665A"}},OLNY:{alpha:{c:"#c20018",t:"#cfa174"},mod:{c:"#c20018",t:"#cfa174"},accent:{t:"#c20018",c:"#cfa174"}},GREG:{alpha:{c:"#f8c200",t:"#393b3b"},mod:{c:"#f7f2ea",t:"#393b3b"},accent:{c:"#171718",t:"#393b3b"}},CARBON_BLACK_A:{alpha:{c:"#788194",t:"#f3f3f3"},mod:{c:"#3b3b3e",t:"#f3f3f3"},accent:{c:"#e66b67",t:"#f3f3f3"}},CARBON_BLACK_B:{alpha:{c:"#3b3b3e",t:"#f3f3f3"},mod:{c:"#788194",t:"#f3f3f3"},accent:{c:"#e66b67",t:"#f3f3f3"}},SILVER_GREY_A:{alpha:{c:"#b2b3b8",t:"#f3f3f3"},mod:{c:"#838589",t:"#f3f3f3"},accent:{c:"#e8db5d",t:"#3d3125"}},SILVER_GREY_B:{alpha:{c:"#838589",t:"#f3f3f3"},mod:{c:"#b2b3b8",t:"#f3f3f3"},accent:{c:"#e8db5d",t:"#3d3125"}},NAVY_BLUE_A:{alpha:{c:"#547be8",t:"#f3f3f3"},mod:{c:"#49599f",t:"#f3f3f3"},accent:{c:"#4dcfe0",t:"#f3f3f3"}},NAVY_BLUE_B:{alpha:{c:"#49599f",t:"#f3f3f3"},mod:{c:"#547be8",t:"#f3f3f3"},accent:{c:"#4dcfe0",t:"#f3f3f3"}},FENDAI:{alpha:{c:"#f0ebec",t:"#07010f"},mod:{c:"#f0ebec",t:"#56395c"},accent:{c:"#fc5d75",t:"#56395c"}},HONEY_MILK:{alpha:{c:"#fffff8",t:"#07010f"},mod:{c:"#fffff8",t:"#07010f"},accent:{c:"#f8b140",t:"#07010f"}},MATCHA:{alpha:{c:"#e8e8df",t:"#4e475c"},mod:{c:"#828572",t:"#4e475c"},accent:{c:"#828572",t:"#4e475c"}},BLACK_GREY:{alpha:{c:"#7e8293",t:"#a5cbe6"},mod:{c:"#364352",t:"#eff3f2"},accent:{c:"#364352",t:"#eff3f2"}},WHITE_GREEN:{alpha:{c:"#fefefe",t:"#272727"},mod:{c:"#275c65",t:"#d0eae8"},accent:{c:"#275c65",t:"#d0eae8"}},WHITE:{alpha:{c:"#fefefe",t:"#272727"},mod:{c:"#fefefe",t:"#272727"},accent:{c:"#fefefe",t:"#272727"}},BLACK:{alpha:{c:"#272727",t:"#fefefe"},mod:{c:"#272727",t:"#fefefe"},accent:{c:"#272727",t:"#fefefe"}},BLACK_AND_WHITE:{alpha:{c:"#fefefe",t:"#272727"},mod:{c:"#272727",t:"#fefefe"},accent:{c:"#272727",t:"#fefefe"}},CLASSIC_GREY:{alpha:{c:"#fcfcfc",t:"#1a1a1a"},mod:{c:"#a0a0a0",t:"#1a1a1a"},accent:{c:"#a0a0a0",t:"#1a1a1a"}},...distExports.THEMES};class Store{constructor(t){E(this,"store");const o=localStorage.getItem("via-app-store");this.store=o?defaultsDeep(JSON.parse(o),t):t}get(t){return this.store[t]}set(t,o){const n={...this.store,[t]:{...o}};this.store=n,setTimeout(()=>{localStorage.setItem("via-app-store",JSON.stringify(n))},0)}}const entryLog=[],logCommand=(e,t,o)=>{entryLog.push({kbAddr:e,request:t,response:o,ts:Date.now()})},getLog=window.__getLogs=()=>entryLog;window.addEventListener("message",e=>{e.data.command==="fetchLogs"&&window.postMessage({command:"getLogs",payload:getLog()},"*")});const globalBuffer={},eventWaitBuffer={},filterHIDDevices=e=>e.filter(t=>{var o;return(o=t.collections)==null?void 0:o.some(n=>n.usage===97&&n.usagePage===65376)}),getVIAPathIdentifier=()=>self.crypto&&self.crypto.randomUUID&&self.crypto.randomUUID()||`via-path:${Math.random()}`,tagDevice=e=>{const t=e.__path||getVIAPathIdentifier();e.__path=t;const o={_device:e,usage:97,usagePage:65376,interface:1,vendorId:e.vendorId??-1,productId:e.productId??-1,path:t,productName:e.productName};return ExtendedHID._cache[t]=o},tryForgetDevice=e=>{const t=ExtendedHID._cache[e.path];if(t)return t._device.forget()},ExtendedHID={_cache:{},requestDevice:async()=>{const e=await navigator.hid.requestDevice({filters:[{usagePage:65376,usage:97}]});return e.forEach(tagDevice),e[0]},getFilteredDevices:async()=>{try{return filterHIDDevices(await navigator.hid.getDevices())}catch{return[]}},devices:async(e=!1)=>{let t=await ExtendedHID.getFilteredDevices();if(t.length===0||e){try{await ExtendedHID.requestDevice()}catch{return[]}t=await ExtendedHID.getFilteredDevices()}return t.map(tagDevice)},HID:class{constructor(t){E(this,"_hidDevice");E(this,"interface",-1);E(this,"vendorId",-1);E(this,"productId",-1);E(this,"productName","");E(this,"path","");E(this,"openPromise",Promise.resolve());E(this,"readP",promisify(t=>this.read(t)));if(this._hidDevice=ExtendedHID._cache[t],this._hidDevice)this.vendorId=this._hidDevice.vendorId,this.productId=this._hidDevice.productId,this.path=this._hidDevice.path,this.interface=this._hidDevice.interface,this.productName=this._hidDevice.productName,globalBuffer[this.path]=globalBuffer[this.path]||[],eventWaitBuffer[this.path]=eventWaitBuffer[this.path]||[],this._hidDevice._device.opened||this.open();else throw new Error("Missing hid device in cache")}async open(){return this._hidDevice&&!this._hidDevice._device.opened&&(this.openPromise=this._hidDevice._device.open(),this.setupListeners(),await this.openPromise),Promise.resolve()}setupListeners(){this._hidDevice&&this._hidDevice._device.addEventListener("inputreport",t=>{eventWaitBuffer[this.path].length!==0?eventWaitBuffer[this.path].shift()(new Uint8Array(t.data.buffer)):globalBuffer[this.path].push({currTime:Date.now(),message:new Uint8Array(t.data.buffer)})})}read(t){var o;this.fastForwardGlobalBuffer(Date.now()),globalBuffer[this.path].length>0?t(void 0,(o=globalBuffer[this.path].shift())==null?void 0:o.message):eventWaitBuffer[this.path].push(n=>t(void 0,n))}fastForwardGlobalBuffer(t){let o=globalBuffer[this.path].length;for(;o&&(o--,globalBuffer[this.path][0].currTime<t);)globalBuffer[this.path].shift()}async write(t){var n;await this.openPromise;const o=new Uint8Array(t.slice(1));await((n=this._hidDevice)==null?void 0:n._device.sendReport(0,o))}}},promisify=e=>()=>new Promise((t,o)=>{e((n,s)=>{n?o(n):t(s)})}),HID=ExtendedHID,v=class v{static startMonitoring(){this.shouldMonitor=!0,!this.hasMonitored&&navigator.hid&&(navigator.hid.addEventListener("connect",v.onConnect),navigator.hid.addEventListener("disconnect",v.onDisconnect))}static stopMonitoring(){this.shouldMonitor=!1}static on(t,o){this._listeners[t]=[...this._listeners[t],o]}static off(t,o){this._listeners[t]=this._listeners[t].filter(n=>n!==o)}};E(v,"_listeners",{change:[],remove:[]}),E(v,"shouldMonitor",!1),E(v,"hasMonitored",!1),E(v,"onConnect",({device:t})=>{console.log("Detected Connection"),v.shouldMonitor&&v._listeners.change.forEach(o=>o(t))}),E(v,"onDisconnect",({device:t})=>{console.log("Detected Disconnection"),v.shouldMonitor&&(v._listeners.change.forEach(o=>o(t)),v._listeners.remove.forEach(o=>o(t)))});let usbDetect=v;async function scanDevices(e){return HID.devices(e)}function initAndConnectDevice({path:e}){return new HID.HID(e)}function startMonitoring(){usbDetect.startMonitoring()}const extractDeviceInfo=e=>({productId:e.productId,vendorId:e.vendorId,productName:e.productName,protocol:e.protocol}),initialState$7={appErrors:[]},getErrorTimestamp=()=>{const e=new Date;return`${e.toLocaleTimeString([],{hour12:!1})}.${e.getMilliseconds().toString().padStart(3,"0")}`},extractMessageFromKeyboardAPIError=e=>`Command Name: ${e.commandName}
Command: ${formatBytes(e.commandBytes)}
Response: ${formatBytes(e.responseBytes)}`,getMessageFromError=e=>e.stack||e.message,formatBytes=e=>e.join(" "),errorsSlice=createSlice({name:"errors",initialState:initialState$7,reducers:{logAppError:(e,t)=>{e.appErrors.push({...t.payload,timestamp:getErrorTimestamp()})},logKeyboardAPIError:(e,t)=>{const{deviceInfo:o}=t.payload;e.appErrors.push({timestamp:getErrorTimestamp(),message:extractMessageFromKeyboardAPIError(t.payload),deviceInfo:o})},clearAppErrors:e=>{e.appErrors=[]}}}),{logKeyboardAPIError,logAppError,clearAppErrors}=errorsSlice.actions,errorsReducer=errorsSlice.reducer,getAppErrors=e=>e.errors.appErrors,COMMAND_START=0,PER_KEY_RGB_CHANNEL_COMMAND=[0,1];var APICommand=(e=>(e[e.GET_PROTOCOL_VERSION=1]="GET_PROTOCOL_VERSION",e[e.GET_KEYBOARD_VALUE=2]="GET_KEYBOARD_VALUE",e[e.SET_KEYBOARD_VALUE=3]="SET_KEYBOARD_VALUE",e[e.DYNAMIC_KEYMAP_GET_KEYCODE=4]="DYNAMIC_KEYMAP_GET_KEYCODE",e[e.DYNAMIC_KEYMAP_SET_KEYCODE=5]="DYNAMIC_KEYMAP_SET_KEYCODE",e[e.CUSTOM_MENU_SET_VALUE=7]="CUSTOM_MENU_SET_VALUE",e[e.CUSTOM_MENU_GET_VALUE=8]="CUSTOM_MENU_GET_VALUE",e[e.CUSTOM_MENU_SAVE=9]="CUSTOM_MENU_SAVE",e[e.EEPROM_RESET=10]="EEPROM_RESET",e[e.BOOTLOADER_JUMP=11]="BOOTLOADER_JUMP",e[e.DYNAMIC_KEYMAP_MACRO_GET_COUNT=12]="DYNAMIC_KEYMAP_MACRO_GET_COUNT",e[e.DYNAMIC_KEYMAP_MACRO_GET_BUFFER_SIZE=13]="DYNAMIC_KEYMAP_MACRO_GET_BUFFER_SIZE",e[e.DYNAMIC_KEYMAP_MACRO_GET_BUFFER=14]="DYNAMIC_KEYMAP_MACRO_GET_BUFFER",e[e.DYNAMIC_KEYMAP_MACRO_SET_BUFFER=15]="DYNAMIC_KEYMAP_MACRO_SET_BUFFER",e[e.DYNAMIC_KEYMAP_MACRO_RESET=16]="DYNAMIC_KEYMAP_MACRO_RESET",e[e.DYNAMIC_KEYMAP_GET_LAYER_COUNT=17]="DYNAMIC_KEYMAP_GET_LAYER_COUNT",e[e.DYNAMIC_KEYMAP_GET_BUFFER=18]="DYNAMIC_KEYMAP_GET_BUFFER",e[e.DYNAMIC_KEYMAP_SET_BUFFER=19]="DYNAMIC_KEYMAP_SET_BUFFER",e[e.DYNAMIC_KEYMAP_GET_ENCODER=20]="DYNAMIC_KEYMAP_GET_ENCODER",e[e.DYNAMIC_KEYMAP_SET_ENCODER=21]="DYNAMIC_KEYMAP_SET_ENCODER",e[e.BACKLIGHT_CONFIG_SET_VALUE=7]="BACKLIGHT_CONFIG_SET_VALUE",e[e.BACKLIGHT_CONFIG_GET_VALUE=8]="BACKLIGHT_CONFIG_GET_VALUE",e[e.BACKLIGHT_CONFIG_SAVE=9]="BACKLIGHT_CONFIG_SAVE",e))(APICommand||{});const APICommandValueToName=Object.entries(APICommand).reduce((e,[t,o])=>({...e,[o]:t}),{});var KeyboardValue=(e=>(e[e.UPTIME=1]="UPTIME",e[e.LAYOUT_OPTIONS=2]="LAYOUT_OPTIONS",e[e.SWITCH_MATRIX_STATE=3]="SWITCH_MATRIX_STATE",e[e.FIRMWARE_VERSION=4]="FIRMWARE_VERSION",e[e.DEVICE_INDICATION=5]="DEVICE_INDICATION",e))(KeyboardValue||{});const BACKLIGHT_BRIGHTNESS=9,BACKLIGHT_EFFECT=10,BACKLIGHT_COLOR_1=12,BACKLIGHT_COLOR_2=13,BACKLIGHT_CUSTOM_COLOR=23,PROTOCOL_ALPHA=7,PROTOCOL_BETA=8,PROTOCOL_GAMMA=9,cache={},eqArr=(e,t)=>e.length!==t.length?!1:e.every((o,n)=>t[n]===o),shiftTo16Bit=([e,t])=>e<<8|t,shiftFrom16Bit=e=>[e>>8,e&255],shiftBufferTo16Bit=e=>{const t=[];for(let o=0;o<e.length;o+=2)t.push(shiftTo16Bit([e[o],e[o+1]]));return t},shiftBufferFrom16Bit=e=>e.map(shiftFrom16Bit).flatMap(t=>t),globalCommandQueue={},canConnect=e=>{try{return new KeyboardAPI(e.path),!0}catch(t){return console.error("Skipped ",e,t),!1}};class KeyboardAPI{constructor(t){E(this,"kbAddr");if(this.kbAddr=t,!cache[t]){const o=initAndConnectDevice({path:t});cache[t]={hid:o}}}refresh(t){this.kbAddr=t,cache[t]={...cache[t],hid:initAndConnectDevice({path:t})}}async getByteBuffer(){return this.getHID().readP()}async getProtocolVersion(){try{const[,t,o]=await this.hidCommand(1);return shiftTo16Bit([t,o])}catch{return-1}}async getKey(t,o,n){const s=await this.hidCommand(4,[t,o,n]);return shiftTo16Bit([s[4],s[5]])}async getLayerCount(){if(await this.getProtocolVersion()>=PROTOCOL_BETA){const[,o]=await this.hidCommand(17);return o}return 4}async readRawMatrix(t,o){const n=await this.getProtocolVersion();if(n>=PROTOCOL_BETA)return this.fastReadRawMatrix(t,o);if(n===PROTOCOL_ALPHA)return this.slowReadRawMatrix(t,o);throw new Error("Unsupported protocol version")}async getKeymapBuffer(t,o){if(o>28)throw new Error("Max data length is 28");return[...await this.hidCommand(18,[...shiftFrom16Bit(t),o])].slice(4,o+4)}async fastReadRawMatrix({rows:t,cols:o},n){const s=t*o,r=14,a=new Array(Math.ceil(s/r)).fill(0),{res:i}=a.reduce(({res:l,remaining:d})=>d<r?{res:[...l,this.getKeymapBuffer(n*s*2+2*(s-d),d*2)],remaining:0}:{res:[...l,this.getKeymapBuffer(n*s*2+2*(s-d),r*2)],remaining:d-r},{res:[],remaining:s});return(await Promise.all(i)).flatMap(shiftBufferTo16Bit)}async slowReadRawMatrix({rows:t,cols:o},n){const s=t*o,r=new Array(s).fill(0).map((a,i)=>this.getKey(n,~~(i/o),i%o));return Promise.all(r)}async writeRawMatrix(t,o){const n=await this.getProtocolVersion();if(n>=PROTOCOL_BETA)return this.fastWriteRawMatrix(o);if(n===PROTOCOL_ALPHA)return this.slowWriteRawMatrix(t,o)}async slowWriteRawMatrix({cols:t},o){o.forEach(async(n,s)=>n.forEach(async(r,a)=>{await this.setKey(s,~~(a/t),a%t,r)}))}async fastWriteRawMatrix(t){const o=t.flatMap(r=>r.map(a=>a)),n=shiftBufferFrom16Bit(o),s=28;for(let r=0;r<n.length;r+=s){const a=n.slice(r,r+s);await this.hidCommand(19,[...shiftFrom16Bit(r),a.length,...a])}}async getKeyboardValue(t,o,n=1){const s=[t,...o];return(await this.hidCommand(2,s)).slice(1+s.length,1+s.length+n)}async setKeyboardValue(t,...o){const n=[t,...o];await this.hidCommand(3,n)}async getEncoderValue(t,o,n){const s=[t,o,+n],r=await this.hidCommand(20,s);return shiftTo16Bit([r[4],r[5]])}async setEncoderValue(t,o,n,s){const r=[t,o,+n,...shiftFrom16Bit(s)];await this.hidCommand(21,r)}async getCustomMenuValue(t){return(await this.hidCommand(8,t)).slice(0+t.length)}async setCustomMenuValue(...t){await this.hidCommand(7,t)}async getPerKeyRGBMatrix(t){return(await Promise.all(t.map(n=>this.hidCommand(8,[...PER_KEY_RGB_CHANNEL_COMMAND,n,1])))).map(n=>[...n.slice(5,7)])}async setPerKeyRGBMatrix(t,o,n){await this.hidCommand(7,[...PER_KEY_RGB_CHANNEL_COMMAND,t,1,o,n])}async getBacklightValue(t,o=1){const n=[t];return(await this.hidCommand(8,n)).slice(2,2+o)}async setBacklightValue(t,...o){const n=[t,...o];await this.hidCommand(7,n)}async getRGBMode(){const t=[BACKLIGHT_EFFECT],[,,o]=await this.hidCommand(8,t);return o}async getBrightness(){const t=[BACKLIGHT_BRIGHTNESS],[,,o]=await this.hidCommand(8,t);return o}async getColor(t){const o=[t===1?BACKLIGHT_COLOR_1:BACKLIGHT_COLOR_2],[,,n,s]=await this.hidCommand(8,o);return{hue:n,sat:s}}async setColor(t,o,n){const s=[t===1?BACKLIGHT_COLOR_1:BACKLIGHT_COLOR_2,o,n];await this.hidCommand(7,s)}async getCustomColor(t){const o=[BACKLIGHT_CUSTOM_COLOR,t],[,,,n,s]=await this.hidCommand(8,o);return{hue:n,sat:s}}async setCustomColor(t,o,n){const s=[BACKLIGHT_CUSTOM_COLOR,t,o,n];await this.hidCommand(7,s)}async setRGBMode(t){const o=[BACKLIGHT_EFFECT,t];await this.hidCommand(7,o)}async commitCustomMenu(t){await this.hidCommand(9,[t])}async saveLighting(){await this.hidCommand(9)}async resetEEPROM(){await this.hidCommand(10)}async jumpToBootloader(){await this.hidCommand(11)}async setKey(t,o,n,s){const r=await this.hidCommand(5,[t,o,n,...shiftFrom16Bit(s)]);return shiftTo16Bit([r[4],r[5]])}async getMacroCount(){const[,t]=await this.hidCommand(12);return t}async getMacroBufferSize(){const[,t,o]=await this.hidCommand(13);return shiftTo16Bit([t,o])}async getMacroBytes(){const t=await this.getMacroBufferSize(),o=28,n=[];for(let r=0;r<t;r+=28)n.push(this.hidCommand(14,[...shiftFrom16Bit(r),o]));return(await Promise.all(n)).flatMap(r=>r.slice(4))}async setMacroBytes(t){const o=await this.getMacroBufferSize(),n=t.length;if(n>o)throw new Error(`Macro size (${n}) exceeds buffer size (${o})`);const s=o-1,r=shiftFrom16Bit(s);await this.resetMacros();try{await this.hidCommand(15,[...shiftFrom16Bit(s),1,255]);const a=28;for(let i=0;i<t.length;i+=a){const c=t.slice(i,i+a);await this.hidCommand(15,[...shiftFrom16Bit(i),c.length,...c])}}finally{await this.hidCommand(15,[...r,1,0])}}async resetMacros(){await this.hidCommand(16)}get commandQueueWrapper(){return globalCommandQueue[this.kbAddr]?globalCommandQueue[this.kbAddr]:(globalCommandQueue[this.kbAddr]={isFlushing:!1,commandQueue:[]},globalCommandQueue[this.kbAddr])}async timeout(t){return new Promise((o,n)=>{this.commandQueueWrapper.commandQueue.push({res:o,rej:n,args:()=>new Promise(s=>setTimeout(()=>{s(),o(void 0)},t))}),this.commandQueueWrapper.isFlushing||this.flushQueue()})}async hidCommand(t,o=[]){return new Promise((n,s)=>{this.commandQueueWrapper.commandQueue.push({res:n,rej:s,args:[t,o]}),this.commandQueueWrapper.isFlushing||this.flushQueue()})}async flushQueue(){if(this.commandQueueWrapper.isFlushing!==!0){for(this.commandQueueWrapper.isFlushing=!0;this.commandQueueWrapper.commandQueue.length!==0;){const{res:t,rej:o,args:n}=this.commandQueueWrapper.commandQueue.shift();if(typeof n=="function")await n(),t();else try{const s=await this._hidCommand(...n);t(s)}catch(s){const r=extractDeviceInfo(this.getHID());store.dispatch(logAppError({message:getMessageFromError(s),deviceInfo:r})),o(s)}}this.commandQueueWrapper.isFlushing=!1}}getHID(){return cache[this.kbAddr].hid}async _hidCommand(t,o=[]){const n=[COMMAND_START,t,...o],s=new Array(33).fill(0);n.forEach((i,c)=>{s[c]=i}),await this.getHID().write(s);const r=Array.from(await this.getByteBuffer()),a=r.slice(0,n.length-1);if(logCommand(this.kbAddr,n,r),!eqArr(n.slice(1),a)){console.error(`Command for ${this.kbAddr}:`,n,"Bad Resp:",r);const i=extractDeviceInfo(this.getHID()),c=APICommandValueToName[t];throw store.dispatch(logKeyboardAPIError({commandName:c,commandBytes:n.slice(1),responseBytes:r,deviceInfo:i})),new Error("Receiving incorrect response for command")}return console.debug(`Command for ${this.kbAddr}`,n,"Correct Resp:",r),r}}function getVendorProductId(e,t){return e*65536+t}const idExists=({productId:e,vendorId:t},o)=>o[getVendorProductId(t,e)],getRecognisedDevices=async(e,t=!1)=>(await scanDevices(t)).filter(n=>idExists(n,e)&&canConnect(n));let deviceStore;const defaultStoreData={definitionIndex:{generatedAt:-1,hash:"",version:"2.0.0",theme:distExports.getTheme(),accentColor:"#ad7070",supportedVendorProductIdMap:{}},definitions:{},settings:{showDesignTab:!1,disableFastRemap:!1,renderMode:"2D",themeMode:"dark",designDefinitionVersion:"v3",themeName:"OLIVIA_DARK",macroEditor:{smartOptimizeEnabled:!0,recordDelaysEnabled:!1,tapEnterAtEOMEnabled:!1},testKeyboardSoundsSettings:{isEnabled:!0,volume:100,waveform:"sine",mode:TestKeyboardSoundsMode.WickiHayden,transpose:0}}};function initDeviceStore(){deviceStore=new Store(defaultStoreData)}initDeviceStore();async function syncStore(){var t;const e=deviceStore.get("definitionIndex");try{const o=((t=document.getElementById("definition_hash"))==null?void 0:t.dataset.hash)||"";if(o===e.hash)return e;const s=await(await fetch("/via-jl/definitions/supported_kbs.json",{cache:"reload"})).json(),r=s.vendorProductIds.v2.reduce((c,l)=>(c[l]=c[l]||{},c[l].v2=c[l].v3=!0,c),{}),a=s.vendorProductIds.v3.reduce((c,l)=>(c[l]=c[l]||{},c[l].v3=!0,c),r),i={...s,hash:o,supportedVendorProductIdMap:a};return deviceStore.set("definitionIndex",i),deviceStore.set("definitions",{}),i}catch(o){console.warn(o)}return e}const getMissingDefinition=async(e,t)=>{const o=getVendorProductId(e.vendorId,e.productId),n=`/via-jl/definitions/${t}/${o}.json`,r=await(await fetch(n)).json();let a=deviceStore.get("definitions");const i={...a,[o]:{...a[o],[t]:r}};try{deviceStore.set("definitions",i)}catch{localStorage.clear(),initDeviceStore(),a=deviceStore.get("definitions"),deviceStore.set("definitions",{...a,[o]:{...a[o],[t]:r}})}return[r,t]},getSupportedIdsFromStore=()=>{var e;return(e=deviceStore.get("definitionIndex"))==null?void 0:e.supportedVendorProductIdMap},getDefinitionsFromStore=()=>deviceStore.get("definitions"),getThemeModeFromStore=()=>{var e;return(e=deviceStore.get("settings"))==null?void 0:e.themeMode},getThemeNameFromStore=()=>{var e;return(e=deviceStore.get("settings"))==null?void 0:e.themeName},getSettings=()=>deviceStore.get("settings"),setSettings=e=>{deviceStore.set("settings",current(e))},quantumRangesKeys=["_QK_MODS","_QK_MODS_MAX","_QK_MOD_TAP","_QK_MOD_TAP_MAX","_QK_LAYER_TAP","_QK_LAYER_TAP_MAX","_QK_LAYER_MOD","_QK_LAYER_MOD_MAX","_QK_TO","_QK_TO_MAX","_QK_MOMENTARY","_QK_MOMENTARY_MAX","_QK_DEF_LAYER","_QK_DEF_LAYER_MAX","_QK_TOGGLE_LAYER","_QK_TOGGLE_LAYER_MAX","_QK_ONE_SHOT_LAYER","_QK_ONE_SHOT_LAYER_MAX","_QK_ONE_SHOT_MOD","_QK_ONE_SHOT_MOD_MAX","_QK_LAYER_TAP_TOGGLE","_QK_LAYER_TAP_TOGGLE_MAX","_QK_KB","_QK_KB_MAX","_QK_MACRO","_QK_MACRO_MAX"],quantumRanges=e=>Object.keys(e).reduce((t,o)=>quantumRangesKeys.includes(o)?{...t,[o]:e[o]}:t,{}),modCodes={QK_LCTL:256,QK_LSFT:512,QK_LALT:1024,QK_LGUI:2048,QK_RMODS_MIN:4096,QK_RCTL:4352,QK_RSFT:4608,QK_RALT:5120,QK_RGUI:6144},modMasks={MOD_LCTL:1,MOD_LSFT:2,MOD_LALT:4,MOD_LGUI:8,MOD_RCTL:17,MOD_RSFT:18,MOD_RALT:20,MOD_RGUI:24,MOD_HYPR:15,MOD_MEH:7},topLevelMacroToValue={MT:"_QK_MOD_TAP",LT:"_QK_LAYER_TAP",LM:"_QK_LAYER_MOD",TO:"_QK_TO",MO:"_QK_MOMENTARY",DF:"_QK_DEF_LAYER",TG:"_QK_TOGGLE_LAYER",OSL:"_QK_ONE_SHOT_LAYER",OSM:"_QK_ONE_SHOT_MOD",TT:"_QK_LAYER_TAP_TOGGLE",CUSTOM:"_QK_KB",MACRO:"_QK_MACRO"},modifierKeyToValue={LCTL:modCodes.QK_LCTL,C:modCodes.QK_LCTL,LSFT:modCodes.QK_LSFT,S:modCodes.QK_LSFT,LALT:modCodes.QK_LALT,A:modCodes.QK_LALT,LGUI:modCodes.QK_LGUI,LCMD:modCodes.QK_LGUI,LWIN:modCodes.QK_LGUI,G:modCodes.QK_LGUI,RCTL:modCodes.QK_RCTL,RSFT:modCodes.QK_RSFT,ALGR:modCodes.QK_RALT,RALT:modCodes.QK_RALT,RCMD:modCodes.QK_RGUI,RWIN:modCodes.QK_RGUI,RGUI:modCodes.QK_RGUI,SCMD:modCodes.QK_LSFT|modCodes.QK_LGUI,SWIN:modCodes.QK_LSFT|modCodes.QK_LGUI,SGUI:modCodes.QK_LSFT|modCodes.QK_LGUI,LSG:modCodes.QK_LSFT|modCodes.QK_LGUI,LAG:modCodes.QK_LALT|modCodes.QK_LGUI,RSG:modCodes.QK_RSFT|modCodes.QK_RGUI,RAG:modCodes.QK_RALT|modCodes.QK_RGUI,LCA:modCodes.QK_LCTL|modCodes.QK_LALT,LSA:modCodes.QK_LSFT|modCodes.QK_LALT,SAGR:modCodes.QK_RSFT|modCodes.QK_RALT,RSA:modCodes.QK_RSFT|modCodes.QK_RALT,RCS:modCodes.QK_RCTL|modCodes.QK_RSFT,LCAG:modCodes.QK_LCTL|modCodes.QK_LALT|modCodes.QK_LGUI,MEH:modCodes.QK_LCTL|modCodes.QK_LALT|modCodes.QK_LSFT,HYPR:modCodes.QK_LCTL|modCodes.QK_LALT|modCodes.QK_LSFT|modCodes.QK_LGUI},modifierValueToKey=Object.entries(modifierKeyToValue).reduce((e,[t,o])=>({...e,[o]:t}),{}),leftModifierValueToKey=Object.entries(modifierKeyToValue).filter(([e,t])=>Object.values(modCodes).includes(t)&&t<modCodes.QK_RMODS_MIN).reduce((e,[t,o])=>({...e,[o]:t}),{}),rightModifierValueToKey=Object.entries(modifierKeyToValue).filter(([e,t])=>Object.values(modCodes).includes(t)&&t>=modCodes.QK_RMODS_MIN).reduce((e,[t,o])=>({...e,[o]:t}),{}),topLevelValueToMacro=e=>Object.entries(topLevelMacroToValue).reduce((t,[o,n])=>({...t,[e[n]]:o}),{}),advancedStringToKeycode=(e,t)=>{const n=e.toUpperCase().split(/\(|\)/).map(s=>s.trim());return Object.keys(topLevelMacroToValue).includes(n[0])?parseTopLevelMacro(n,t):Object.keys(modifierKeyToValue).includes(n[0])?parseModifierCode(n,t):0},advancedKeycodeToString=(e,t,o)=>{let n=Object.entries(quantumRanges(t)).map(([_,p])=>[p,_]),s=null,r=-1;for(let _=0;_<n.length;_+=2)e>=n[_][0]&&e<=n[_+1][0]&&(s=n[_][1],r=+n[_][0]);if(["_QK_MODS"].includes(s))return topLevelModToString(e,o);let i=topLevelValueToMacro(t)[r]+"(",c=e&~r,l=0,d="",u=0;switch(s){case"_QK_KB":case"_QK_MACRO":i+=e-r+")";break;case"_QK_MOMENTARY":case"_QK_DEF_LAYER":case"_QK_TOGGLE_LAYER":case"_QK_ONE_SHOT_LAYER":case"_QK_LAYER_TAP_TOGGLE":case"_QK_TO":i+=c+")";break;case"_QK_LAYER_TAP":l=c>>8,d=o[c&255],i+=l+","+d+")";break;case"_QK_ONE_SHOT_MOD":i+=modValueToString(c)+")";break;case"_QK_LAYER_MOD":let _=t._QK_LAYER_MOD_MASK,p=Math.log2(_+1);l=c>>p,u=c&_,i+=l+","+modValueToString(u)+")";break;case"_QK_MOD_TAP":u=c>>8&31,d=o[c&255],i+=modValueToString(u)+","+d+")";break;default:i=null}return i},modValueToString=e=>{const t=["MOD_HYPR","MOD_MEH"];return Object.entries(modMasks).filter(n=>!t.includes(n[0])&&(n[1]&e)===n[1]).map(n=>n[0]).join(" | ")},topLevelModToString=(e,t)=>{const o=t[e&255],n=e&7936,s=modifierValueToKey[n];if(s!=null)return s+"("+o+")";const r=Object.entries(n&modCodes.QK_RMODS_MIN?rightModifierValueToKey:leftModifierValueToKey).filter(a=>{const i=Number.parseInt(a[0]);return(i&n)===i}).map(a=>a[1]);return r.join("(")+"("+o+")".repeat(r.length)},parseTopLevelMacro=(e,t)=>{const o=e[0],n=e[1]??"";let[s,r]=["",""],a=0,i=0;switch(o){case"MO":case"DF":case"TG":case"OSL":case"TT":case"TO":return a=Number.parseInt(n),a<0?0:t[topLevelMacroToValue[o]]|a&255;case"OSM":return i=parseMods(n),i===0?0:t[topLevelMacroToValue[o]]|i&255;case"LM":[s,r]=n.split(",").map(d=>d.trim());let c=t._QK_LAYER_MOD_MASK,l=Math.log2(c+1);return a=Number.parseInt(s),i=parseMods(r),a<0||i===0?0:t[topLevelMacroToValue[o]]|(a&15)<<l|i&c;case"LT":return[s,r]=n.split(",").map(d=>d.trim()),a=Number.parseInt(s),a<0||!t.hasOwnProperty(r)?0:t[topLevelMacroToValue[o]]|(a&15)<<8|t[r];case"MT":return[s,r]=n.split(",").map(d=>d.trim()),i=parseMods(s),i===0||!t.hasOwnProperty(r)?0:t[topLevelMacroToValue[o]]|(i&31)<<8|t[r]&255;case"CUSTOM":{const d=Number.parseInt(n),u=t._QK_KB_MAX-t._QK_KB;return d>=0&&d<=u?t[topLevelMacroToValue[o]]+d:0}case"MACRO":{const d=Number.parseInt(n),u=t._QK_MACRO_MAX-t._QK_MACRO;return d>=0&&d<=u?t[topLevelMacroToValue[o]]+d:0}default:return 0}},parseMods=(e="")=>{const t=e.split("|").map(o=>o.trim());return t.reduce((o,n)=>o&&modMasks.hasOwnProperty(n),!0)?t.reduce((o,n)=>o|modMasks[n],0):0},parseModifierCode=(e,t)=>{const o=e.filter(s=>s.length!==0),n=o.map((s,r)=>r===o.length-1?t.hasOwnProperty(s)?t[s]:null:modifierKeyToValue.hasOwnProperty(s)?modifierKeyToValue[s]:null);return n.find(s=>s===null)?0:n.reduce((s,r)=>s|r,0)},anyKeycodeToString=(e,t,o)=>{let n="";const s=advancedKeycodeToString(e,t,o);return o[e]&&!o[e].startsWith("_QK")?n=o[e]:s!==null&&(n=s),n};function isAlpha(e){return/[A-Za-z]/.test(e)&&e.length===1}function isNumpadNumber(e){return/['0-9]/.test(e)&&e.length===1}function isArrowKey(e){return/[🠗🠕🠖🠔←↑→↓]$/.test(e)}function isNumpadSymbol(e){const t="-+.÷×".split("");return e.length===1&&t.includes(e[0])}function isMultiLegend(e){const t='~!@#$%^&*()_+|{}:"<>?'.split("");return e.length!==1&&t.includes(e[0])}function getByteForCode(e,t){const o=t[e];if(o!==void 0)return o;if(isLayerCode(e))return getByteForLayerCode(e,t);if(advancedStringToKeycode(e,t)!==null)return advancedStringToKeycode(e,t);throw`Could not find byte for ${e}`}function isLayerCode(e){return/([A-Za-z]+)\((\d+)\)/.test(e)}function getByteForLayerCode(e,t){const o=e.match(/([A-Za-z]+)\((\d+)\)/);if(o){const[,n,s]=o,r=parseInt(s);switch(n){case"TO":return Math.min(t._QK_TO+r,t._QK_TO_MAX);case"MO":return Math.min(t._QK_MOMENTARY+r,t._QK_MOMENTARY_MAX);case"DF":return Math.min(t._QK_DEF_LAYER+r,t._QK_DEF_LAYER_MAX);case"TG":return Math.min(t._QK_TOGGLE_LAYER+r,t._QK_TOGGLE_LAYER_MAX);case"OSL":return Math.min(t._QK_ONE_SHOT_LAYER+r,t._QK_ONE_SHOT_LAYER_MAX);case"TT":return Math.min(t._QK_LAYER_TAP_TOGGLE+r,t._QK_LAYER_TAP_TOGGLE_MAX);case"CUSTOM":return Math.min(t._QK_KB+r,t._QK_KB_MAX);case"MACRO":return Math.min(t._QK_MACRO+r,t._QK_MACRO_MAX);default:throw new Error("Incorrect code")}}throw new Error("No match found")}function getCodeForLayerByte(e,t){if(t._QK_TO<=e&&t._QK_TO_MAX>=e)return`TO(${e-t._QK_TO})`;if(t._QK_MOMENTARY<=e&&t._QK_MOMENTARY_MAX>=e)return`MO(${e-t._QK_MOMENTARY})`;if(t._QK_DEF_LAYER<=e&&t._QK_DEF_LAYER_MAX>=e)return`DF(${e-t._QK_DEF_LAYER})`;if(t._QK_TOGGLE_LAYER<=e&&t._QK_TOGGLE_LAYER_MAX>=e)return`TG(${e-t._QK_TOGGLE_LAYER})`;if(t._QK_ONE_SHOT_LAYER<=e&&t._QK_ONE_SHOT_LAYER_MAX>=e)return`OSL(${e-t._QK_ONE_SHOT_LAYER})`;if(t._QK_LAYER_TAP_TOGGLE<=e&&t._QK_LAYER_TAP_TOGGLE_MAX>=e)return`TT(${e-t._QK_LAYER_TAP_TOGGLE})`;if(t._QK_KB<=e&&t._QK_KB_MAX>=e)return`CUSTOM(${e-t._QK_KB})`;if(t._QK_MACRO<=e&&t._QK_MACRO_MAX>=e)return`MACRO(${e-t._QK_MACRO})`}const keycodesList=getKeycodes().reduce((e,t)=>e.concat(t.keycodes),[]),getByteToKey=e=>Object.keys(e).reduce((t,o)=>{const n=e[o];if(n in t){const s=keycodesList.find(({code:r})=>r===o);return s?{...t,[n]:s.code}:t}return{...t,[n]:o}},{});function isLayerKey(e,t){return[[t._QK_TO,t._QK_TO_MAX],[t._QK_MOMENTARY,t._QK_MOMENTARY_MAX],[t._QK_DEF_LAYER,t._QK_DEF_LAYER_MAX],[t._QK_TOGGLE_LAYER,t._QK_TOGGLE_LAYER_MAX],[t._QK_ONE_SHOT_LAYER,t._QK_ONE_SHOT_LAYER_MAX],[t._QK_LAYER_TAP_TOGGLE,t._QK_LAYER_TAP_TOGGLE_MAX],[t._QK_KB,t._QK_KB_MAX],[t._QK_MACRO,t._QK_MACRO_MAX]].some(o=>e>=o[0]&&e<=o[1])}function getCodeForByte(e,t,o){const n=o[e];return n&&!n.startsWith("_QK")?n:isLayerKey(e,t)?getCodeForLayerByte(e,t):advancedKeycodeToString(e,t,o)!==null?advancedKeycodeToString(e,t,o):"0x"+Number(e).toString(16)}function keycodeInMaster(e,t){return e in t||isLayerCode(e)||advancedStringToKeycode(e,t)!==null}function shorten(e){return e.split(" ").map(t=>t.slice(0,1)+t.slice(1).replace(/[aeiou ]/gi,"")).join("")}function isCustomKeycodeByte(e,t){return e>=t._QK_KB&&e<=t._QK_KB_MAX}function getCustomKeycodeIndex(e,t){return e-t._QK_KB}function isMacroKeycodeByte(e,t){return e>=t._QK_MACRO&&e<=t._QK_MACRO_MAX}function getMacroKeycodeIndex(e,t){return e-t._QK_MACRO}function getLabelForByte(e,t=100,o,n){const s=getCodeForByte(e,o,n),r=keycodesList.find(({code:a})=>a===s);return r?getShortNameForKeycode(r,t):s}function getShortNameForKeycode(e,t=100){const{code:o,name:n,shortName:s}=e;if(t<=150&&s)return s;if(t===100&&n.length>5){const r=shorten(n);if(o){const a=o.replace("KC_","").replace("_"," ");return r.length>4&&a.length<r.length?a:r}return r}return n}function getOtherMenu(e){return{id:"other",label:"Other",keycodes:Object.keys(e).filter(o=>!o.startsWith("_QK")).filter(o=>!keycodesList.map(({code:n})=>n).includes(o)).map(o=>({name:o.replace("KC_","").replace(/_/g," "),code:o}))}}function buildLayerMenu(){const e=[{name:`Fn1
(Fn3)`,code:"FN_MO13",title:"Hold = Layer 1, Hold with Fn2 = Layer 3",shortName:"Fn1(3)"},{name:`Fn2
(Fn3)`,code:"FN_MO23",title:"Hold = Layer 2, Hold with Fn1 = Layer 3",shortName:"Fn2(3)"},{name:"Space Fn1",code:"LT(1,KC_SPC)",title:"Hold = Layer 1, Tap = Space",shortName:"Spc Fn1"},{name:"Space Fn2",code:"LT(2,KC_SPC)",title:"Hold = Layer 2, Tap = Space",shortName:"Spc Fn2"},{name:"Space Fn3",code:"LT(3,KC_SPC)",title:"Hold = Layer 3, Tap = Space",shortName:"Spc Fn3"}],t={id:"layers",label:"换层",width:"label",keycodes:[{name:"MO",code:"MO(layer)",type:"layer",layer:0,title:"Momentary turn layer on"},{name:"TG",code:"TG(layer)",type:"layer",layer:0,title:"Toggle layer on/off"},{name:"TT",code:"TT(layer)",type:"layer",layer:0,title:"Normally acts like MO unless it's tapped multple times which toggles layer on"},{name:"OSL",code:"OSL(layer)",type:"layer",layer:0,title:"Switch to layer for one keypress"},{name:"TO",code:"TO(layer)",type:"layer",layer:0,title:"Turn on layer when pressed"},{name:"DF",code:"DF(layer)",type:"layer",layer:0,title:"Sets the default layer"}]};return{...t,keycodes:[...e,...t.keycodes.flatMap(o=>{let n=[];for(let s=0;s<10;s++){const r=(o.title||"").replace("layer",`layer ${s}`),a=o.code.replace("layer",`${s}`),i=o.name+`(${s})`;n=[...n,{...o,name:i,title:r,code:a}]}return n})]}}function generateMacros(e=16){let t=[];for(let o=0;o<e;o++){const n=`M${o}`,s=`MACRO(${o})`,r=`Macro ${o}`;t=[...t,{name:n,title:r,code:s}]}return t}function getKeycodes(e=16){return[{id:"basic",label:"基础",keycodes:[{name:"无",code:"KC_NO",title:"Nothing"},{name:"▽",code:"KC_TRNS",title:"Pass-through"},{name:"Esc",code:"KC_ESC",keys:"esc"},{name:"A",code:"KC_A",keys:"a"},{name:"B",code:"KC_B",keys:"b"},{name:"C",code:"KC_C",keys:"c"},{name:"D",code:"KC_D",keys:"d"},{name:"E",code:"KC_E",keys:"e"},{name:"F",code:"KC_F",keys:"f"},{name:"G",code:"KC_G",keys:"g"},{name:"H",code:"KC_H",keys:"h"},{name:"I",code:"KC_I",keys:"i"},{name:"J",code:"KC_J",keys:"j"},{name:"K",code:"KC_K",keys:"k"},{name:"L",code:"KC_L",keys:"l"},{name:"M",code:"KC_M",keys:"m"},{name:"N",code:"KC_N",keys:"n"},{name:"O",code:"KC_O",keys:"o"},{name:"P",code:"KC_P",keys:"p"},{name:"Q",code:"KC_Q",keys:"q"},{name:"R",code:"KC_R",keys:"r"},{name:"S",code:"KC_S",keys:"s"},{name:"T",code:"KC_T",keys:"t"},{name:"U",code:"KC_U",keys:"u"},{name:"V",code:"KC_V",keys:"v"},{name:"W",code:"KC_W",keys:"w"},{name:"X",code:"KC_X",keys:"x"},{name:"Y",code:"KC_Y",keys:"y"},{name:"Z",code:"KC_Z",keys:"z"},{name:`!
1`,code:"KC_1",keys:"1"},{name:`@
2`,code:"KC_2",keys:"2"},{name:`#
3`,code:"KC_3",keys:"3"},{name:`$
4`,code:"KC_4",keys:"4"},{name:`%
5`,code:"KC_5",keys:"5"},{name:`^
6`,code:"KC_6",keys:"6"},{name:`&
7`,code:"KC_7",keys:"7"},{name:`*
8`,code:"KC_8",keys:"8"},{name:`(
9`,code:"KC_9",keys:"9"},{name:`)
0`,code:"KC_0",keys:"0"},{name:`_
-`,code:"KC_MINS",keys:"-"},{name:`+
=`,code:"KC_EQL",keys:"="},{name:"~\n`",code:"KC_GRV",keys:"`"},{name:`{
[`,code:"KC_LBRC",keys:"["},{name:`}
]`,code:"KC_RBRC",keys:"]"},{name:`|
\\`,code:"KC_BSLS",keys:"\\",width:1500},{name:`:
;`,code:"KC_SCLN",keys:";"},{name:`"
'`,code:"KC_QUOT",keys:"'"},{name:`<
,`,code:"KC_COMM",keys:","},{name:`>
.`,code:"KC_DOT",keys:"."},{name:`?
/`,code:"KC_SLSH",keys:"/"},{name:"=",code:"KC_PEQL"},{name:",",code:"KC_PCMM"},{name:"F1",code:"KC_F1"},{name:"F2",code:"KC_F2"},{name:"F3",code:"KC_F3"},{name:"F4",code:"KC_F4"},{name:"F5",code:"KC_F5"},{name:"F6",code:"KC_F6"},{name:"F7",code:"KC_F7"},{name:"F8",code:"KC_F8"},{name:"F9",code:"KC_F9"},{name:"F10",code:"KC_F10"},{name:"F11",code:"KC_F11"},{name:"F12",code:"KC_F12"},{name:"Print Screen",code:"KC_PSCR",shortName:"Print"},{name:"Scroll Lock",code:"KC_SLCK",shortName:"Scroll"},{name:"Pause",code:"KC_PAUS"},{name:"Tab",code:"KC_TAB",keys:"tab",width:1500},{name:"Backspace",code:"KC_BSPC",keys:"backspace",width:2e3,shortName:"Bksp"},{name:"Insert",code:"KC_INS",keys:"insert",shortName:"Ins"},{name:"Del",code:"KC_DEL",keys:"delete"},{name:"Home",code:"KC_HOME",keys:"home"},{name:"End",code:"KC_END",keys:"end"},{name:"Page Up",code:"KC_PGUP",keys:"pageup",shortName:"PgUp"},{name:"Page Down",code:"KC_PGDN",keys:"pagedown",shortName:"PgDn"},{name:`Num
Lock`,code:"KC_NLCK",keys:"num",shortName:"N.Lck"},{name:"Caps Lock",code:"KC_CAPS",keys:"caps_lock",width:1750},{name:"Enter",code:"KC_ENT",keys:"enter",width:2250},{name:"1",code:"KC_P1",keys:"num_1",title:"Numpad 1"},{name:"2",code:"KC_P2",keys:"num_2",title:"Numpad 2"},{name:"3",code:"KC_P3",keys:"num_3",title:"Numpad 3"},{name:"4",code:"KC_P4",keys:"num_4",title:"Numpad 4"},{name:"5",code:"KC_P5",keys:"num_5",title:"Numpad 5"},{name:"6",code:"KC_P6",keys:"num_6",title:"Numpad 6"},{name:"7",code:"KC_P7",keys:"num_7",title:"Numpad 7"},{name:"8",code:"KC_P8",keys:"num_8",title:"Numpad 8"},{name:"9",code:"KC_P9",keys:"num_9",title:"Numpad 9"},{name:"0",code:"KC_P0",width:2e3,keys:"num_0",title:"Numpad 0"},{name:"÷",code:"KC_PSLS",keys:"num_divide",title:"Numpad ÷"},{name:"×",code:"KC_PAST",keys:"num_multiply",title:"Numpad ×"},{name:"-",code:"KC_PMNS",keys:"num_subtract",title:"Numpad -"},{name:"+",code:"KC_PPLS",keys:"num_add",title:"Numpad +"},{name:".",code:"KC_PDOT",keys:"num_decimal",title:"Numpad ."},{name:`Num
Enter`,code:"KC_PENT",shortName:"N.Ent",title:"Numpad Enter"},{name:"Left Shift",code:"KC_LSFT",keys:"shift",width:2250,shortName:"LShft"},{name:"Right Shift",code:"KC_RSFT",width:2750,shortName:"RShft"},{name:"Left Ctrl",code:"KC_LCTL",keys:"ctrl",width:1250},{name:"Right Ctrl",code:"KC_RCTL",width:1250,shortName:"RCtl"},{name:"Left Win",code:"KC_LGUI",keys:"cmd",width:1250,shortName:"LWin"},{name:"Right Win",code:"KC_RGUI",width:1250,shortName:"RWin"},{name:"Left Alt",code:"KC_LALT",keys:"alt",width:1250,shortName:"LAlt"},{name:"Right Alt",code:"KC_RALT",width:1250,shortName:"RAlt"},{name:"Space",code:"KC_SPC",keys:"space",width:6250},{name:"Menu",code:"KC_APP",width:1250,shortName:"RApp"},{name:"Left",code:"KC_LEFT",keys:"left",shortName:"←"},{name:"Down",code:"KC_DOWN",keys:"down",shortName:"↓"},{name:"Up",code:"KC_UP",keys:"up",shortName:"↑"},{name:"Right",code:"KC_RGHT",keys:"right",shortName:"→"}]},{id:"wt_lighting",label:"灯光",width:"label",keycodes:[{name:"Bright -",code:"BR_DEC",title:"Brightness -",shortName:"BR -"},{name:"Bright +",code:"BR_INC",title:"Brightness +",shortName:"BR +"},{name:"Effect -",code:"EF_DEC",title:"Effect -",shortName:"EF -"},{name:"Effect +",code:"EF_INC",title:"Effect +",shortName:"EF +"},{name:"Effect Speed -",code:"ES_DEC",title:"Effect Speed -",shortName:"ES -"},{name:"Effect Speed +",code:"ES_INC",title:"Effect Speed +",shortName:"ES +"},{name:"Color1 Hue -",code:"H1_DEC",title:"Color1 Hue -",shortName:"H1 -"},{name:"Color1 Hue +",code:"H1_INC",title:"Color1 Hue +",shortName:"H1 +"},{name:"Color2 Hue -",code:"H2_DEC",title:"Color2 Hue -",shortName:"H2 -"},{name:"Color2 Hue +",code:"H2_INC",title:"Color2 Hue +",shortName:"H2 +"},{name:"Color1 Sat -",code:"S1_DEC",title:"Color1 Sat -",shortName:"S1 -"},{name:"Color1 Sat +",code:"S1_INC",title:"Color1 Sat +",shortName:"S1 +"},{name:"Color2 Sat -",code:"S2_DEC",title:"Color2 Sat -",shortName:"S2 -"},{name:"Color2 Sat +",code:"S2_INC",title:"Color2 Sat +",shortName:"S2 +"}]},{id:"media",label:"媒体",width:"label",keycodes:[{name:"Vol -",code:"KC_VOLD",title:"Volume Down"},{name:"Vol +",code:"KC_VOLU",title:"Volume Up"},{name:"Mute",code:"KC_MUTE",title:"Mute Audio"},{name:"Play",code:"KC_MPLY",title:"Play/Pause"},{name:"Media Stop",code:"KC_MSTP",title:"Media Stop"},{name:"Previous",code:"KC_MPRV",title:"Media Previous"},{name:"Next",code:"KC_MNXT",title:"Media Next"},{name:"Rewind",code:"KC_MRWD",title:"Rewind"},{name:"Fast Forward",code:"KC_MFFD",title:"Fast Forward"},{name:"Select",code:"KC_MSEL",title:"Media Select"},{name:"Eject",code:"KC_EJCT",title:"Media Eject"}]},{id:"macro",label:"宏",width:"label",keycodes:generateMacros(e)},buildLayerMenu(),{id:"special",label:"特殊",width:"label",keycodes:[{name:"~",code:"S(KC_GRV)",keys:"`",title:"Shift + `"},{name:"!",code:"S(KC_1)",keys:"!",title:"Shift + 1"},{name:"@",code:"S(KC_2)",keys:"@",title:"Shift + 2"},{name:"#",code:"S(KC_3)",keys:"#",title:"Shift + 3"},{name:"$",code:"S(KC_4)",keys:"$",title:"Shift + 4"},{name:"%",code:"S(KC_5)",keys:"%",title:"Shift + 5"},{name:"^",code:"S(KC_6)",keys:"^",title:"Shift + 6"},{name:"&",code:"S(KC_7)",keys:"&",title:"Shift + 7"},{name:"*",code:"S(KC_8)",keys:"*",title:"Shift + 8"},{name:"(",code:"S(KC_9)",keys:"(",title:"Shift + 9"},{name:")",code:"S(KC_0)",keys:")",title:"Shift + 0"},{name:"_",code:"S(KC_MINS)",keys:"_",title:"Shift + -"},{name:"+",code:"S(KC_EQL)",keys:"+",title:"Shift + ="},{name:"{",code:"S(KC_LBRC)",keys:"{",title:"Shift + ["},{name:"}",code:"S(KC_RBRC)",keys:"}",title:"Shift + ]"},{name:"|",code:"S(KC_BSLS)",keys:"|",title:"Shift + \\"},{name:":",code:"S(KC_SCLN)",keys:":",title:"Shift + /"},{name:'"',code:"S(KC_QUOT)",keys:'"',title:"Shift + '"},{name:"<",code:"S(KC_COMM)",keys:"<",title:"Shift + ,"},{name:">",code:"S(KC_DOT)",keys:">",title:"Shift + ."},{name:"?",code:"S(KC_SLSH)",keys:"?",title:"Shift + /"},{name:"NUHS",code:"KC_NUHS",title:"Non-US # and ~"},{name:"NUBS",code:"KC_NUBS",title:"Non-US \\ and |"},{name:"Ro",code:"KC_RO",title:"JIS \\ and |"},{name:"¥",code:"KC_JYEN",title:"JPN Yen"},{name:"無変換",code:"KC_MHEN",title:"JIS Muhenkan"},{name:"漢字",code:"KC_HANJ",title:"Hanja"},{name:"한영",code:"KC_HAEN",title:"HanYeong"},{name:"変換",code:"KC_HENK",title:"JIS Henkan"},{name:"かな",code:"KC_KANA",title:"JIS Katakana/Hiragana"},{name:"Esc `",code:"KC_GESC",title:"Esc normally, but ` when Shift or Win is pressed"},{name:"LS (",code:"KC_LSPO",title:"Left Shift when held, ( when tapped"},{name:"RS )",code:"KC_RSPC",title:"Right Shift when held, ) when tapped"},{name:"LC (",code:"KC_LCPO",title:"Left Control when held, ( when tapped"},{name:"RC )",code:"KC_RCPC",title:"Right Control when held, ) when tapped"},{name:"LA (",code:"KC_LAPO",title:"Left Alt when held, ( when tapped"},{name:"RA )",code:"KC_RAPC",title:"Right Alt when held, ) when tapped"},{name:"SftEnt",code:"KC_SFTENT",title:"Right Shift when held, Enter when tapped"},{name:"Reset",code:"RESET",title:"Reset the keyboard"},{name:"Debug",code:"DEBUG",title:"Toggle debug mode"},{name:"Toggle NKRO",code:"MAGIC_TOGGLE_NKRO",shortName:"NKRO",title:"Toggle NKRO"},{name:"Locking Num Lock",code:"KC_LNUM"},{name:"Locking Caps Lock",code:"KC_LCAP"},{name:"Locking Scroll Lock",code:"KC_LSCR"},{name:"Power",code:"KC_PWR"},{name:"Power OSX",code:"KC_POWER"},{name:"Sleep",code:"KC_SLEP"},{name:"Wake",code:"KC_WAKE"},{name:"Calc",code:"KC_CALC"},{name:"Mail",code:"KC_MAIL"},{name:"Help",code:"KC_HELP"},{name:"Stop",code:"KC_STOP"},{name:"Alt Erase",code:"KC_ERAS"},{name:"Again",code:"KC_AGAIN"},{name:"Menu",code:"KC_MENU"},{name:"Undo",code:"KC_UNDO"},{name:"Select",code:"KC_SELECT"},{name:"Exec",code:"KC_EXECUTE"},{name:"Cut",code:"KC_CUT"},{name:"Copy",code:"KC_COPY"},{name:"Paste",code:"KC_PASTE"},{name:"Find",code:"KC_FIND"},{name:"My Comp",code:"KC_MYCM"},{name:"Home",code:"KC_WWW_HOME"},{name:"Back",code:"KC_WWW_BACK"},{name:"Forward",code:"KC_WWW_FORWARD"},{name:"Stop",code:"KC_WWW_STOP"},{name:"Refresh",code:"KC_WWW_REFRESH"},{name:"Favorites",code:"KC_WWW_FAVORITES"},{name:"Search",code:"KC_WWW_SEARCH"},{name:"Screen +",code:"KC_BRIU",shortName:"Scr +",title:"Screen Brightness Up"},{name:"Screen -",code:"KC_BRID",shortName:"Scr -",title:"Screen Brightness Down"},{name:"F13",code:"KC_F13"},{name:"F14",code:"KC_F14"},{name:"F15",code:"KC_F15"},{name:"F16",code:"KC_F16"},{name:"F17",code:"KC_F17"},{name:"F18",code:"KC_F18"},{name:"F19",code:"KC_F19"},{name:"F20",code:"KC_F20"},{name:"F21",code:"KC_F21"},{name:"F22",code:"KC_F22"},{name:"F23",code:"KC_F23"},{name:"F24",code:"KC_F24"},{name:"Mouse ↑",code:"KC_MS_UP"},{name:"Mouse ↓",code:"KC_MS_DOWN"},{name:"Mouse ←",code:"KC_MS_LEFT"},{name:"Mouse →",code:"KC_MS_RIGHT"},{name:"Mouse Btn1",code:"KC_MS_BTN1"},{name:"Mouse Btn2",code:"KC_MS_BTN2"},{name:"Mouse Btn3",code:"KC_MS_BTN3"},{name:"Mouse Btn4",code:"KC_MS_BTN4"},{name:"Mouse Btn5",code:"KC_MS_BTN5"},{name:"Mouse Btn6",code:"KC_MS_BTN6"},{name:"Mouse Btn7",code:"KC_MS_BTN7"},{name:"Mouse Btn8",code:"KC_MS_BTN8"},{name:"Mouse Wh ↑",code:"KC_MS_WH_UP"},{name:"Mouse Wh ↓",code:"KC_MS_WH_DOWN"},{name:"Mouse Wh ←",code:"KC_MS_WH_LEFT"},{name:"Mouse Wh →",code:"KC_MS_WH_RIGHT"},{name:"Mouse Acc0",code:"KC_MS_ACCEL0"},{name:"Mouse Acc1",code:"KC_MS_ACCEL1"},{name:"Mouse Acc2",code:"KC_MS_ACCEL2"},{name:"Audio On",code:"AU_ON"},{name:"Audio Off",code:"AU_OFF"},{name:"Audio Toggle",code:"AU_TOG"},{name:"Clicky Toggle",code:"CLICKY_TOGGLE"},{name:"Clicky Enable",code:"CLICKY_ENABLE"},{name:"Clicky Disable",code:"CLICKY_DISABLE"},{name:"Clicky Up",code:"CLICKY_UP"},{name:"Clicky Down",code:"CLICKY_DOWN"},{name:"Clicky Reset",code:"CLICKY_RESET"},{name:"Music On",code:"MU_ON"},{name:"Music Off",code:"MU_OFF"},{name:"Music Toggle",code:"MU_TOG"},{name:"Music Mode",code:"MU_MOD"}]},{id:"dial",label:"滚轮",width:"label",keycodes:[{name:"滚轮   反转",code:"DIAL_L"},{name:"滚轮   按下",code:"DIAL_BUT"},{name:"滚轮   顺转",code:"DIAL_R"},{name:"滚轮   LC",code:"DIAL_LC"},{name:"滚轮   RC",code:"DIAL_RC"}]},{id:"qmk_lighting",label:"灯光",width:"label",keycodes:[{name:"BL Toggle",code:"BL_TOGG"},{name:"BL On",code:"BL_ON"},{name:"BL Off",code:"BL_OFF",shortName:"BL Off"},{name:"BL -",code:"BL_DEC"},{name:"BL +",code:"BL_INC"},{name:"BL Cycle",code:"BL_STEP"},{name:"BR Toggle",code:"BL_BRTG"},{name:"RGB Toggle",code:"RGB_TOG"},{name:"RGB Mode -",code:"RGB_RMOD"},{name:"RGB Mode +",code:"RGB_MOD"},{name:"Hue -",code:"RGB_HUD"},{name:"Hue +",code:"RGB_HUI"},{name:"Sat -",code:"RGB_SAD"},{name:"Sat +",code:"RGB_SAI"},{name:"Bright -",code:"RGB_VAD"},{name:"Bright +",code:"RGB_VAI"},{name:"Effect Speed-",code:"RGB_SPD"},{name:"Effect Speed+",code:"RGB_SPI"},{name:"RGB Mode P",code:"RGB_M_P",title:"Plain"},{name:"RGB Mode B",code:"RGB_M_B",title:"Breathe"},{name:"RGB Mode R",code:"RGB_M_R",title:"Rainbow"},{name:"RGB Mode SW",code:"RGB_M_SW",title:"Swirl"},{name:"RGB Mode SN",code:"RGB_M_SN",title:"Snake"},{name:"RGB Mode K",code:"RGB_M_K",title:"Knight"},{name:"RGB Mode X",code:"RGB_M_X",title:"Xmas"},{name:"RGB Mode G",code:"RGB_M_G",title:"Gradient"}]},{id:"custom",label:"自定义",width:"label",keycodes:[{name:"CUSTOM(0)",code:"CUSTOM(0)",title:"Custom Keycode 0"},{name:"CUSTOM(1)",code:"CUSTOM(1)",title:"Custom Keycode 1"},{name:"CUSTOM(2)",code:"CUSTOM(2)",title:"Custom Keycode 2"},{name:"CUSTOM(3)",code:"CUSTOM(3)",title:"Custom Keycode 3"},{name:"CUSTOM(4)",code:"CUSTOM(4)",title:"Custom Keycode 4"},{name:"CUSTOM(5)",code:"CUSTOM(5)",title:"Custom Keycode 5"},{name:"CUSTOM(6)",code:"CUSTOM(6)",title:"Custom Keycode 6"},{name:"CUSTOM(7)",code:"CUSTOM(7)",title:"Custom Keycode 7"},{name:"CUSTOM(8)",code:"CUSTOM(8)",title:"Custom Keycode 8"},{name:"CUSTOM(9)",code:"CUSTOM(9)",title:"Custom Keycode 9"},{name:"CUSTOM(10)",code:"CUSTOM(10)",title:"Custom Keycode 10"},{name:"CUSTOM(11)",code:"CUSTOM(11)",title:"Custom Keycode 11"},{name:"CUSTOM(12)",code:"CUSTOM(12)",title:"Custom Keycode 12"},{name:"CUSTOM(13)",code:"CUSTOM(13)",title:"Custom Keycode 13"},{name:"CUSTOM(14)",code:"CUSTOM(14)",title:"Custom Keycode 14"},{name:"CUSTOM(15)",code:"CUSTOM(15)",title:"Custom Keycode 15"}]}]}const categoriesForKeycodeModule=e=>({default:["basic","media","macro","layers","special","dial"],[distExports.BuiltInKeycodeModule.WTLighting]:["wt_lighting"],[distExports.BuiltInKeycodeModule.QMKLighting]:["qmk_lighting"]})[e],getKeycodesForKeyboard=e=>{let t=[];if("lighting"in e){const{keycodes:o}=distExports.getLightingDefinition(e.lighting);t=categoriesForKeycodeModule("default").concat(o===distExports.KeycodeType.None?[]:o===distExports.KeycodeType.QMK?categoriesForKeycodeModule(distExports.BuiltInKeycodeModule.QMKLighting):categoriesForKeycodeModule(distExports.BuiltInKeycodeModule.WTLighting))}else{const{keycodes:o}=e;t=o.flatMap(categoriesForKeycodeModule)}return getKeycodes().flatMap(o=>t.includes(o.id)?o.keycodes:[]).sort((o,n)=>o.code<=n.code?-1:1)},CSSVarObject={keyWidth:52,keyXSpacing:2,keyHeight:54,keyYSpacing:2,keyXPos:54,keyYPos:56,faceXPadding:[6,6],faceYPadding:[2,10],insideBorder:10},KeycapMetric={keyWidth:18.1,keyXSpacing:1.05,keyHeight:18.1,keyYSpacing:1.05,keyXPos:19.15,keyYPos:19.15},getComboKeyProps=e=>{if(e.w2===void 0||e.h2===void 0)return{clipPath:null,normalizedRects:null};const{x:t,y:o,x2:n=0,y2:s=0,w:r,w2:a,h:i,h2:c}=e,l=Math.max(e.w,e.w2),d=Math.max(e.h,e.h2),u=Math.min(t,t+n),_=Math.min(o,o+s),[p,x,C,m,h,K,y,g]=r===l?[t+n-u,t-u,o+s-_,o-_,a,r,c,i]:[t-u,t+n-u,o-_,o+s-_,r,a,i,c],R=f=>`polygon(${f.map(M=>`${100*M[0]}% ${100*M[1]}%`).join(",")})`,b=[[x/l,m/d],[p/l,m/d],[p/l,C/d],[(p+h)/l,C/d],[(p+h)/l,m/d],[(x+K)/l,m/d],[(x+K)/l,(m+g)/d],[(p+h)/l,(m+g)/d],[(p+h)/l,(C+y)/d],[p/l,(C+y)/d],[p/l,(m+g)/d],[x/l,(m+g)/d]];return{clipPath:R(b),normalizedRects:[[p,C,h,y],[x,m,K,g]]}};function calculatePointPosition({x:e=0,x2:t=0,y:o=0,r:n=0,rx:s=0,ry:r=0,w:a=0,w2:i=0,h:c=0}){const l=n*(2*Math.PI)/360,d=Math.cos(l),u=Math.sin(l),_=CSSVarObject.keyXPos*s,p=CSSVarObject.keyYPos*r,x=CSSVarObject.keyXPos*(e+t)+Math.max(i,a)*CSSVarObject.keyWidth/2+(Math.max(i,a)-1)*CSSVarObject.keyXSpacing/2,C=CSSVarObject.keyYPos*o+c*CSSVarObject.keyHeight/2+(c-1)*CSSVarObject.keyYSpacing/2,m=x*d-C*u-_*d+p*u+_,h=x*u+C*d-_*u-p*d+p;return[m,h]}const sortByX=(e,t)=>{const o=calculatePointPosition(e),n=calculatePointPosition(t);return o[0]-n[0]},sortByYX=(e,t)=>{const o=calculatePointPosition(e),n=calculatePointPosition(t);return o[1]-n[1]===0?o[0]-n[0]:o[1]-n[1]},withinChain=(e,t)=>{const o=calculatePointPosition(e),n=calculatePointPosition(t);return Math.abs(o[1]-n[1])<CSSVarObject.keyYPos*.9},getTraversalOrder=e=>{const[t,...o]=[...e].sort(sortByYX);if(t===void 0)return o;{const[n,s]=partition([...e],r=>withinChain(t,r));return[...n.sort(sortByX),...getTraversalOrder(s)]}},widthProfiles={1:[1,2,3,4],1.25:[4],1.5:[2,4],1.75:[3,4],2:[1,4],2.25:[3,4],2.75:[4],3:[4],6.25:[4],7:[4]},getRowForKey=(e,t)=>e.h!==1?t:widthProfiles[e.w]?widthProfiles[e.w].includes(t)?t:widthProfiles[e.w][0]:4,getRowProfiles=e=>{switch(!e.some(o=>o.some(n=>n.w!==1||n.h!==1))||e.length){case 8:return[1,1,1,1,2,3,4,4];case 7:return[1,1,1,2,3,4,4];case 6:return[1,1,2,3,4,4];case 5:return[1,2,3,4,4];case 4:return[2,3,4,4];case 3:return[2,3,4];default:return Array(e.length).fill(1)}},getKeyId=e=>`${e.w}-${e.h}-${e.col}-${e.row}-${e.w2}-${e.h2}`,getKeyboardRowPartitions=e=>{const{partitionedKeys:t}=getTraversalOrder(e).reduce(({prevX:n,partitionedKeys:s},r)=>{const[a]=calculatePointPosition(r);return n>=a&&s.push([]),s[s.length-1].push(r),{partitionedKeys:s,prevX:a}},{partitionedKeys:[],prevX:1/0}),o=getRowProfiles(t);return{rowMap:t.reduce((n,s,r)=>s.reduce((a,i)=>({...a,[getKeyId(i)]:getRowForKey(i,o[r])}),n),{}),partitionedKeys:t}},getNextKey=(e,t)=>{const o=t.filter(a=>!a.d),n=t[e],s=getTraversalOrder([...o]),r=s.indexOf(n);return r===s.length-1?null:t.indexOf(s[(r+1)%s.length])},makeSRGBTheme=e=>Object.entries(e).reduce((t,[o,n])=>{const s=`#${new Color(n.c).convertSRGBToLinear().getHexString()}`,r=`#${new Color(n.t).convertSRGBToLinear().getHexString()}`;return{...t,[o]:{c:s,t:r}}},{}),calculateKeyboardFrameDimensions=e=>{const t=e.map(distExports.getBoundingBox),o=Math.min(...t.map(a=>a.xStart)),n=Math.min(...t.map(a=>a.yStart)),s=Math.max(...t.map(a=>a.xEnd))-o,r=Math.max(...t.map(a=>a.yEnd))-n;return{width:s,height:r}},getMeshName=(e,t,o)=>{if(e.ei!==void 0)return"E-100";if(e.h===2&&e.w===1)return`K-R${t}V-200`;if(e.w===1.25&&e.w2===1.5)return"K-R2-ISO";if(e.w===1.5&&e.w2===2.25)return"K-R2-BAE";if(e.h>1)return o?"K-R4C-100":"K-R4-100";switch(e.w){case 1.25:case 1.5:case 1.75:case 1:case 2:case 2.25:case 2.75:return`K-R${t}-${e.w*100}`;case 3:case 6:case 6.25:case 6.5:case 7:return`K-R4C-${e.w*100}`;default:return"K-R4C-100"}switch(e.w){case 1:case 1.25:case 1.5:case 1.75:return`K-R${t}-${e.w*100}`;case 2:case 2.25:case 2.75:case 3:case 6:case 6.25:case 6.5:case 7:return`K-R4C-${e.w*100}`;default:return"K-R4C-100"}},getScale=(e,t)=>{if(e.ei!==void 0)return t;if(e.h===2&&e.w===1)return[1,1,1];if(e.w===1.25&&e.w2===1.5)return[1,1,1];if(e.w===1.5&&e.w2===2.25)return[1,1,1];if(e.h>1)return t;if(e.h==1)switch(e.w){case 1.25:case 1.5:case 1.75:case 2:case 2.25:case 2.75:case 3:case 6:case 6.25:case 6.5:case 7:return[1,1,1];case 1:return[1,1,1];default:return t}return t},getLabelOffsets=(e,t)=>{let o=0,n=0;return e.length==1&&'^*"'.split("").includes(e[0])&&(o=.2),t.length==1&&(",.".split("").includes(t[0])?n=.4:"/\\;'[]".split("").includes(t[0])?n=.3:"-".split("").includes(t[0])&&(n=.1)),[o,n]},getLabel=(e,t,o,n,s,r)=>{let a="",i=1,c=[0,0],l="";if(isCustomKeycodeByte(e,s)&&(n!=null&&n.customKeycodes)&&n.customKeycodes[getCustomKeycodeIndex(e,s)]!==void 0){const u=getCustomKeycodeIndex(e,s);a=getShortNameForKeycode(n.customKeycodes[u]),l=getShortNameForKeycode(n.customKeycodes[u],700)}else e&&(a=getLabelForByte(e,t*100,s,r)??"",l=getLabelForByte(e,700,s,r)??"");let d;if(isMacroKeycodeByte(e,s)){const u=getMacroKeycodeIndex(e,s);d=o[u],l=d||""}if(isAlpha(a)||isNumpadNumber(a))return a&&{label:a.toUpperCase(),macroExpression:d,key:(a||"")+(d||""),size:i,offset:c};if(isMultiLegend(a)){const u=a[0],_=a[a.length-1];return _&&{topLabel:u,bottomLabel:_,macroExpression:d,key:(a||"")+(d||""),size:i,offset:getLabelOffsets(u,_)}}else return isNumpadSymbol(a)&&(i=2),isArrowKey(a)&&(i=1.5),{label:a,centerLabel:a,tooltipLabel:l,macroExpression:d,key:(a||"")+(d||""),size:i,offset:c}},updateCSSVariables=e=>{const t=THEMES[e]||THEMES.OLIVIA_DARK;document.documentElement.style.setProperty("--color_accent",t.accent.c),document.documentElement.style.setProperty("--color_inside-accent",t.accent.t)};function getRGBPrime(e,t,o){if(e>=0&&e<60)return[t,o,0];if(e>=60&&e<120)return[o,t,0];if(e>=120&&e<180)return[0,t,o];if(e>=180&&e<240)return[0,o,t];if(e>=240&&e<300)return[o,0,t];if(e>=300&&e<360)return[t,0,o];if(e===360)return[t,o,0];throw new Error("Invalid hue")}const getColorByte=e=>{const t=e.replace("#",""),o=parseInt(t[0],16)*16+parseInt(t[1],16),n=parseInt(t[2],16)*16+parseInt(t[3],16),s=parseInt(t[4],16)*16+parseInt(t[5],16);return[o,n,s]},getDarkenedColor=(e,t=.8)=>{const[o,n,s]=getColorByte(e),r=Math.round(o*t).toString(16),a=Math.round(n*t).toString(16),i=Math.round(s*t).toString(16);return`#${r.padStart(2,"0")}${a.padStart(2,"0")}${i.padStart(2,"0")}`},getHSV=e=>{const[t,o,n]=getColorByte(e).map(d=>d/255),[s,r]=[Math.max(t,o,n),Math.min(t,o,n)],a=s-r;let i=60,c=0,l=s;return a===0?i=i*0:s===t?i=i*((o-n)/a%6):s===o?i=i*((n-t)/a+2):s===n&&(i=i*((t-o)/a+4)),s!==0&&(c=a/s),[(i+360)%360,c,l]},getHSVFrom256=e=>[Math.round(360*e[0]/255),Math.round(e[1]/255),1];function getRGB({hue:e,sat:t}){t=t/255,e=Math.round(360*e)/255;const o=t,n=o*(1-Math.abs(e/60%2-1)),s=1-o,[r,a,i]=getRGBPrime(e,o,n).map(c=>Math.round(255*(s+c)));return`rgba(${r},${a},${i},1)`}function toDegrees(e){return e*(180/Math.PI)}function calcRadialHue(e,t){if(e<200&&t<200){const o=200-e,n=200-t;return 2*Math.PI-Math.atan(o/n)}else if(e>200&&t<200){const o=e-200,n=200-t;return Math.atan(o/n)}else if(e<200&&t>200){const o=200-e,n=t-200;return Math.PI+Math.atan(o/n)}else if(e>200&&t>200){const o=e-200,n=t-200;return .5*Math.PI+Math.atan(n/o)}else{if(e===200)return t>200?Math.PI:0;if(t===200)return e>=200?.5*Math.PI:1.5*Math.PI}}function calcRadialMagnitude(e,t){if(e<200&&t<200){const o=200-e,n=200-t;return Math.sqrt(o*o+n*n)/200}else if(e>200&&t<200){const o=e-200,n=200-t;return Math.sqrt(o*o+n*n)/200}else if(e<200&&t>200){const o=200-e,n=t-200;return Math.sqrt(o*o+n*n)/200}else if(e>200&&t>200){const o=e-200,n=t-200;return Math.sqrt(o*o+n*n)/200}else{if(e===200)return t>200?(t-200)/200:(200-t)/200;if(t===200)return e>200?(e-200)/200:(200-e)/200}}function hsToRgb({hue:e,sat:t}){t=t/255,e=Math.round(360*e)/255;const o=t,n=o*(1-Math.abs(e/60%2-1)),s=1-o,[r,a,i]=getRGBPrime(e,o,n).map(c=>Math.round(255*(s+c)));return[r,a,i]}function getHex({hue:e,sat:t}){let[o,n,s]=hsToRgb({hue:e,sat:t}).map(r=>r.toString(16));return o.length==1&&(o="0"+o),n.length==1&&(n="0"+n),s.length==1&&(s="0"+s),"#"+o+n+s}function isWebGLAvailable(){try{const e=document.createElement("canvas");return!!(window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl")))}catch{return!1}}const webGLIsAvailable=isWebGLAvailable(),initialState$6={...getSettings(),isTestMatrixEnabled:!1,restartRequired:!1,allowGlobalHotKeys:!1},toggleBool=(e,t)=>{e[t]=!e[t],setSettings(e)},settingsSlice=createSlice({name:"settings",initialState:initialState$6,reducers:{toggleFastRemap:e=>{toggleBool(e,"disableFastRemap")},toggleCreatorMode:e=>{toggleBool(e,"showDesignTab")},toggleThemeMode:e=>{const t=e.themeMode==="light"?"dark":"light";document.documentElement.dataset.themeMode=t,e.themeMode=t,setSettings(e)},updateRenderMode:(e,t)=>{e.renderMode=t.payload,setSettings(e)},updateDesignDefinitionVersion:(e,t)=>{e.designDefinitionVersion=t.payload,setSettings(e)},updateThemeName:(e,t)=>{e.themeName=t.payload,updateCSSVariables(e.themeName),setSettings(e)},setTestMatrixEnabled:(e,t)=>{e.isTestMatrixEnabled=t.payload},setMacroEditorSettings:(e,t)=>{const o={...e.macroEditor,...t.payload};e.macroEditor=o,setSettings(e)},setTestKeyboardSoundsSettings:(e,t)=>{const o={...e.testKeyboardSoundsSettings,...t.payload};e.testKeyboardSoundsSettings=o,setSettings(e)},disableGlobalHotKeys:e=>{e.allowGlobalHotKeys=!1},enableGlobalHotKeys:e=>{e.allowGlobalHotKeys=!0}}}),{toggleFastRemap,toggleCreatorMode,setTestMatrixEnabled,setTestKeyboardSoundsSettings,setMacroEditorSettings,toggleThemeMode,disableGlobalHotKeys,enableGlobalHotKeys,updateRenderMode,updateThemeName,updateDesignDefinitionVersion}=settingsSlice.actions,settingsReducer=settingsSlice.reducer,getDesignDefinitionVersion=e=>e.settings.designDefinitionVersion,getDisableFastRemap=e=>e.settings.disableFastRemap,getShowDesignTab=e=>e.settings.showDesignTab,getIsTestMatrixEnabled=e=>e.settings.isTestMatrixEnabled,getMacroEditorSettings=e=>e.settings.macroEditor,getTestKeyboardSoundsSettings=e=>e.settings.testKeyboardSoundsSettings,getRenderMode=e=>webGLIsAvailable?e.settings.renderMode:"2D",getThemeMode=e=>e.settings.themeMode,getThemeName=e=>e.settings.themeName,getSelectedTheme=createSelector(getThemeName,e=>THEMES[e]),getSelectedSRGBTheme=createSelector(getSelectedTheme,e=>makeSRGBTheme(e)),basicKeyToByte={_QK_MODS:256,_QK_MODS_MAX:8191,_QK_MOD_TAP:24576,_QK_MOD_TAP_MAX:32767,_QK_LAYER_TAP:16384,_QK_LAYER_TAP_MAX:20479,_QK_LAYER_MOD:22784,_QK_LAYER_MOD_MAX:23039,_QK_TO:20496,_QK_TO_MAX:20511,_QK_MOMENTARY:20736,_QK_MOMENTARY_MAX:20767,_QK_DEF_LAYER:20992,_QK_DEF_LAYER_MAX:21023,_QK_TOGGLE_LAYER:21248,_QK_TOGGLE_LAYER_MAX:21279,_QK_ONE_SHOT_LAYER:21504,_QK_ONE_SHOT_LAYER_MAX:21535,_QK_ONE_SHOT_MOD:21760,_QK_ONE_SHOT_MOD_MAX:22015,_QK_LAYER_TAP_TOGGLE:22528,_QK_LAYER_TAP_TOGGLE_MAX:22559,_QK_LAYER_MOD_MASK:15,_QK_MACRO:24338,_QK_MACRO_MAX:24353,_QK_KB:24448,_QK_KB_MAX:24463,KC_NO:0,KC_TRNS:1,KC_A:4,KC_B:5,KC_C:6,KC_D:7,KC_E:8,KC_F:9,KC_G:10,KC_H:11,KC_I:12,KC_J:13,KC_K:14,KC_L:15,KC_M:16,KC_N:17,KC_O:18,KC_P:19,KC_Q:20,KC_R:21,KC_S:22,KC_T:23,KC_U:24,KC_V:25,KC_W:26,KC_X:27,KC_Y:28,KC_Z:29,KC_1:30,KC_2:31,KC_3:32,KC_4:33,KC_5:34,KC_6:35,KC_7:36,KC_8:37,KC_9:38,KC_0:39,KC_ENT:40,KC_ESC:41,KC_BSPC:42,KC_TAB:43,KC_SPC:44,KC_MINS:45,KC_EQL:46,KC_LBRC:47,KC_RBRC:48,KC_BSLS:49,KC_NUHS:50,KC_SCLN:51,KC_QUOT:52,KC_GRV:53,KC_COMM:54,KC_DOT:55,KC_SLSH:56,KC_CAPS:57,KC_F1:58,KC_F2:59,KC_F3:60,KC_F4:61,KC_F5:62,KC_F6:63,KC_F7:64,KC_F8:65,KC_F9:66,KC_F10:67,KC_F11:68,KC_F12:69,KC_PSCR:70,KC_SLCK:71,KC_PAUS:72,KC_INS:73,KC_HOME:74,KC_PGUP:75,KC_DEL:76,KC_END:77,KC_PGDN:78,KC_RGHT:79,KC_LEFT:80,KC_DOWN:81,KC_UP:82,KC_NLCK:83,KC_PSLS:84,KC_PAST:85,KC_PMNS:86,KC_PPLS:87,KC_PENT:88,KC_P1:89,KC_P2:90,KC_P3:91,KC_P4:92,KC_P5:93,KC_P6:94,KC_P7:95,KC_P8:96,KC_P9:97,KC_P0:98,KC_PDOT:99,KC_NUBS:100,KC_APP:101,KC_POWER:102,KC_PEQL:103,KC_F13:104,KC_F14:105,KC_F15:106,KC_F16:107,KC_F17:108,KC_F18:109,KC_F19:110,KC_F20:111,KC_F21:112,KC_F22:113,KC_F23:114,KC_F24:115,KC_EXECUTE:116,KC_HELP:117,KC_MENU:118,KC_SELECT:119,KC_STOP:120,KC_AGAIN:121,KC_UNDO:122,KC_CUT:123,KC_COPY:124,KC_PASTE:125,KC_FIND:126,KC_LCAP:130,KC_LNUM:131,KC_LSCR:132,KC_PCMM:133,KC_KP_EQUAL_AS400:134,KC_RO:135,KC_KANA:136,KC_JYEN:137,KC_HENK:138,KC_MHEN:139,KC_INT6:140,KC_INT7:141,KC_INT8:142,KC_INT9:143,KC_HAEN:144,KC_HANJ:145,KC_LANG3:146,KC_LANG4:147,KC_LANG5:148,KC_LANG6:149,KC_LANG7:150,KC_LANG8:151,KC_LANG9:152,KC_ERAS:153,KC_SYSREQ:154,KC_CANCEL:155,KC_CLR:156,KC_CLEAR:156,KC_PRIOR:157,KC_OUT:160,KC_OPER:161,KC_CLEAR_AGAIN:162,KC_CRSEL:163,KC_EXSEL:164,KC_PWR:165,KC_SLEP:166,KC_WAKE:167,KC_MUTE:168,KC_VOLU:169,KC_VOLD:170,KC_MNXT:171,KC_MPRV:172,KC_MSTP:173,KC_MPLY:174,KC_MSEL:175,KC_EJCT:176,KC_MAIL:177,KC_CALC:178,KC_MYCM:179,KC_WWW_SEARCH:180,KC_WWW_HOME:181,KC_WWW_BACK:182,KC_WWW_FORWARD:183,KC_WWW_STOP:184,KC_WWW_REFRESH:185,KC_WWW_FAVORITES:186,KC_MFFD:187,KC_MRWD:188,KC_BRIU:189,KC_BRID:190,KC_LCTL:224,KC_LSFT:225,KC_LALT:226,KC_LGUI:227,KC_RCTL:228,KC_RSFT:229,KC_RALT:230,KC_RGUI:231,KC_MS_UP:240,KC_MS_DOWN:241,KC_MS_LEFT:242,KC_MS_RIGHT:243,KC_MS_BTN1:244,KC_MS_BTN2:245,KC_MS_BTN3:246,KC_MS_BTN4:247,KC_MS_BTN5:248,KC_MS_WH_UP:249,KC_MS_WH_DOWN:250,KC_MS_WH_LEFT:251,KC_MS_WH_RIGHT:252,KC_MS_ACCEL0:253,KC_MS_ACCEL1:254,KC_MS_ACCEL2:255,RESET:23552,DEBUG:23553,MAGIC_TOGGLE_NKRO:23572,KC_GESC:23574,AU_ON:23581,AU_OFF:23582,AU_TOG:23583,CLICKY_TOGGLE:23584,CLICKY_ENABLE:23585,CLICKY_DISABLE:23586,CLICKY_UP:23587,CLICKY_DOWN:23588,CLICKY_RESET:23589,MU_ON:23590,MU_OFF:23591,MU_TOG:23592,MU_MOD:23593,BL_ON:23739,BL_OFF:23740,BL_DEC:23741,BL_INC:23742,BL_TOGG:23743,BL_STEP:23744,BL_BRTG:23745,RGB_TOG:23746,RGB_MOD:23747,RGB_RMOD:23748,RGB_HUI:23749,RGB_HUD:23750,RGB_SAI:23751,RGB_SAD:23752,RGB_VAI:23753,RGB_VAD:23754,RGB_SPI:23755,RGB_SPD:23756,RGB_M_P:23757,RGB_M_B:23758,RGB_M_R:23759,RGB_M_SW:23760,RGB_M_SN:23761,RGB_M_K:23762,RGB_M_X:23763,RGB_M_G:23764,KC_LSPO:23767,KC_RSPC:23768,KC_SFTENT:23769,KC_LCPO:23795,KC_RCPC:23796,KC_LAPO:23797,KC_RAPC:23798,BR_INC:24320,BR_DEC:24321,EF_INC:24322,EF_DEC:24323,ES_INC:24324,ES_DEC:24325,H1_INC:24326,H1_DEC:24327,S1_INC:24328,S1_DEC:24329,H2_INC:24330,H2_DEC:24331,S2_INC:24332,S2_DEC:24333,FN_MO13:24336,FN_MO23:24337,DIAL_L:32690,DIAL_BUT:32689,DIAL_R:32691,DIAL_LC:32692,DIAL_RC:32693},v10BasicKeyToByte={_QK_MODS:256,_QK_MODS_MAX:8191,_QK_MOD_TAP:24576,_QK_MOD_TAP_MAX:32767,_QK_LAYER_TAP:16384,_QK_LAYER_TAP_MAX:20479,_QK_LAYER_MOD:22784,_QK_LAYER_MOD_MAX:23039,_QK_TO:20480,_QK_TO_MAX:20511,_QK_MOMENTARY:20736,_QK_MOMENTARY_MAX:20767,_QK_DEF_LAYER:20992,_QK_DEF_LAYER_MAX:21023,_QK_TOGGLE_LAYER:21248,_QK_TOGGLE_LAYER_MAX:21279,_QK_ONE_SHOT_LAYER:21504,_QK_ONE_SHOT_LAYER_MAX:21535,_QK_ONE_SHOT_MOD:21760,_QK_ONE_SHOT_MOD_MAX:22015,_QK_LAYER_TAP_TOGGLE:22528,_QK_LAYER_TAP_TOGGLE_MAX:22559,_QK_LAYER_MOD_MASK:15,_QK_MACRO:24338,_QK_MACRO_MAX:24353,_QK_KB:24448,_QK_KB_MAX:24463,KC_NO:0,KC_TRNS:1,KC_A:4,KC_B:5,KC_C:6,KC_D:7,KC_E:8,KC_F:9,KC_G:10,KC_H:11,KC_I:12,KC_J:13,KC_K:14,KC_L:15,KC_M:16,KC_N:17,KC_O:18,KC_P:19,KC_Q:20,KC_R:21,KC_S:22,KC_T:23,KC_U:24,KC_V:25,KC_W:26,KC_X:27,KC_Y:28,KC_Z:29,KC_1:30,KC_2:31,KC_3:32,KC_4:33,KC_5:34,KC_6:35,KC_7:36,KC_8:37,KC_9:38,KC_0:39,KC_ENT:40,KC_ESC:41,KC_BSPC:42,KC_TAB:43,KC_SPC:44,KC_MINS:45,KC_EQL:46,KC_LBRC:47,KC_RBRC:48,KC_BSLS:49,KC_NUHS:50,KC_SCLN:51,KC_QUOT:52,KC_GRV:53,KC_COMM:54,KC_DOT:55,KC_SLSH:56,KC_CAPS:57,KC_F1:58,KC_F2:59,KC_F3:60,KC_F4:61,KC_F5:62,KC_F6:63,KC_F7:64,KC_F8:65,KC_F9:66,KC_F10:67,KC_F11:68,KC_F12:69,KC_PSCR:70,KC_SLCK:71,KC_PAUS:72,KC_INS:73,KC_HOME:74,KC_PGUP:75,KC_DEL:76,KC_END:77,KC_PGDN:78,KC_RGHT:79,KC_LEFT:80,KC_DOWN:81,KC_UP:82,KC_NLCK:83,KC_PSLS:84,KC_PAST:85,KC_PMNS:86,KC_PPLS:87,KC_PENT:88,KC_P1:89,KC_P2:90,KC_P3:91,KC_P4:92,KC_P5:93,KC_P6:94,KC_P7:95,KC_P8:96,KC_P9:97,KC_P0:98,KC_PDOT:99,KC_NUBS:100,KC_APP:101,KC_POWER:102,KC_PEQL:103,KC_F13:104,KC_F14:105,KC_F15:106,KC_F16:107,KC_F17:108,KC_F18:109,KC_F19:110,KC_F20:111,KC_F21:112,KC_F22:113,KC_F23:114,KC_F24:115,KC_EXECUTE:116,KC_HELP:117,KC_MENU:118,KC_SELECT:119,KC_STOP:120,KC_AGAIN:121,KC_UNDO:122,KC_CUT:123,KC_COPY:124,KC_PASTE:125,KC_FIND:126,KC_LCAP:130,KC_LNUM:131,KC_LSCR:132,KC_PCMM:133,KC_KP_EQUAL_AS400:134,KC_RO:135,KC_KANA:136,KC_JYEN:137,KC_HENK:138,KC_MHEN:139,KC_INT6:140,KC_INT7:141,KC_INT8:142,KC_INT9:143,KC_HAEN:144,KC_HANJ:145,KC_LANG3:146,KC_LANG4:147,KC_LANG5:148,KC_LANG6:149,KC_LANG7:150,KC_LANG8:151,KC_LANG9:152,KC_ERAS:153,KC_SYSREQ:154,KC_CANCEL:155,KC_CLR:156,KC_CLEAR:156,KC_PRIOR:157,KC_OUT:160,KC_OPER:161,KC_CLEAR_AGAIN:162,KC_CRSEL:163,KC_EXSEL:164,KC_PWR:165,KC_SLEP:166,KC_WAKE:167,KC_MUTE:168,KC_VOLU:169,KC_VOLD:170,KC_MNXT:171,KC_MPRV:172,KC_MSTP:173,KC_MPLY:174,KC_MSEL:175,KC_EJCT:176,KC_MAIL:177,KC_CALC:178,KC_MYCM:179,KC_WWW_SEARCH:180,KC_WWW_HOME:181,KC_WWW_BACK:182,KC_WWW_FORWARD:183,KC_WWW_STOP:184,KC_WWW_REFRESH:185,KC_WWW_FAVORITES:186,KC_MFFD:187,KC_MRWD:188,KC_BRIU:189,KC_BRID:190,KC_LCTL:224,KC_LSFT:225,KC_LALT:226,KC_LGUI:227,KC_RCTL:228,KC_RSFT:229,KC_RALT:230,KC_RGUI:231,KC_MS_UP:240,KC_MS_DOWN:241,KC_MS_LEFT:242,KC_MS_RIGHT:243,KC_MS_BTN1:244,KC_MS_BTN2:245,KC_MS_BTN3:246,KC_MS_BTN4:247,KC_MS_BTN5:248,KC_MS_WH_UP:249,KC_MS_WH_DOWN:250,KC_MS_WH_LEFT:251,KC_MS_WH_RIGHT:252,KC_MS_ACCEL0:253,KC_MS_ACCEL1:254,KC_MS_ACCEL2:255,RESET:23552,DEBUG:23553,MAGIC_TOGGLE_NKRO:23572,KC_GESC:23574,AU_ON:23581,AU_OFF:23582,AU_TOG:23583,CLICKY_TOGGLE:23584,CLICKY_ENABLE:23585,CLICKY_DISABLE:23586,CLICKY_UP:23587,CLICKY_DOWN:23588,CLICKY_RESET:23589,MU_ON:23590,MU_OFF:23591,MU_TOG:23592,MU_MOD:23593,BL_ON:23739,BL_OFF:23740,BL_DEC:23741,BL_INC:23742,BL_TOGG:23743,BL_STEP:23744,BL_BRTG:23745,RGB_TOG:23746,RGB_MOD:23747,RGB_RMOD:23748,RGB_HUI:23749,RGB_HUD:23750,RGB_SAI:23751,RGB_SAD:23752,RGB_VAI:23753,RGB_VAD:23754,RGB_SPI:23755,RGB_SPD:23756,RGB_M_P:23757,RGB_M_B:23758,RGB_M_R:23759,RGB_M_SW:23760,RGB_M_SN:23761,RGB_M_K:23762,RGB_M_X:23763,RGB_M_G:23764,KC_LSPO:23767,KC_RSPC:23768,KC_SFTENT:23769,KC_LCPO:23795,KC_RCPC:23796,KC_LAPO:23797,KC_RAPC:23798,BR_INC:24320,BR_DEC:24321,EF_INC:24322,EF_DEC:24323,ES_INC:24324,ES_DEC:24325,H1_INC:24326,H1_DEC:24327,S1_INC:24328,S1_DEC:24329,H2_INC:24330,H2_DEC:24331,S2_INC:24332,S2_DEC:24333,FN_MO13:24336,FN_MO23:24337,DIAL_L:32690,DIAL_BUT:32689,DIAL_R:32691,DIAL_LC:32692,DIAL_RC:32693},v11BasicKeyToByte={_QK_MODS:256,_QK_MODS_MAX:8191,_QK_MOD_TAP:8192,_QK_MOD_TAP_MAX:16383,_QK_LAYER_TAP:16384,_QK_LAYER_TAP_MAX:20479,_QK_LAYER_MOD:20480,_QK_LAYER_MOD_MAX:20991,_QK_TO:20992,_QK_TO_MAX:21023,_QK_MOMENTARY:21024,_QK_MOMENTARY_MAX:21055,_QK_DEF_LAYER:21056,_QK_DEF_LAYER_MAX:21087,_QK_TOGGLE_LAYER:21088,_QK_TOGGLE_LAYER_MAX:21119,_QK_ONE_SHOT_LAYER:21120,_QK_ONE_SHOT_LAYER_MAX:21151,_QK_ONE_SHOT_MOD:21152,_QK_ONE_SHOT_MOD_MAX:21183,_QK_LAYER_TAP_TOGGLE:21184,_QK_LAYER_TAP_TOGGLE_MAX:21215,_QK_LAYER_MOD_MASK:31,_QK_MACRO:30466,_QK_MACRO_MAX:30481,_QK_KB:32512,_QK_KB_MAX:32767,KC_NO:0,KC_TRNS:1,KC_A:4,KC_B:5,KC_C:6,KC_D:7,KC_E:8,KC_F:9,KC_G:10,KC_H:11,KC_I:12,KC_J:13,KC_K:14,KC_L:15,KC_M:16,KC_N:17,KC_O:18,KC_P:19,KC_Q:20,KC_R:21,KC_S:22,KC_T:23,KC_U:24,KC_V:25,KC_W:26,KC_X:27,KC_Y:28,KC_Z:29,KC_1:30,KC_2:31,KC_3:32,KC_4:33,KC_5:34,KC_6:35,KC_7:36,KC_8:37,KC_9:38,KC_0:39,KC_ENT:40,KC_ESC:41,KC_BSPC:42,KC_TAB:43,KC_SPC:44,KC_MINS:45,KC_EQL:46,KC_LBRC:47,KC_RBRC:48,KC_BSLS:49,KC_NUHS:50,KC_SCLN:51,KC_QUOT:52,KC_GRV:53,KC_COMM:54,KC_DOT:55,KC_SLSH:56,KC_CAPS:57,KC_F1:58,KC_F2:59,KC_F3:60,KC_F4:61,KC_F5:62,KC_F6:63,KC_F7:64,KC_F8:65,KC_F9:66,KC_F10:67,KC_F11:68,KC_F12:69,KC_PSCR:70,KC_SLCK:71,KC_PAUS:72,KC_INS:73,KC_HOME:74,KC_PGUP:75,KC_DEL:76,KC_END:77,KC_PGDN:78,KC_RGHT:79,KC_LEFT:80,KC_DOWN:81,KC_UP:82,KC_NLCK:83,KC_PSLS:84,KC_PAST:85,KC_PMNS:86,KC_PPLS:87,KC_PENT:88,KC_P1:89,KC_P2:90,KC_P3:91,KC_P4:92,KC_P5:93,KC_P6:94,KC_P7:95,KC_P8:96,KC_P9:97,KC_P0:98,KC_PDOT:99,KC_NUBS:100,KC_APP:101,KC_POWER:102,KC_PEQL:103,KC_F13:104,KC_F14:105,KC_F15:106,KC_F16:107,KC_F17:108,KC_F18:109,KC_F19:110,KC_F20:111,KC_F21:112,KC_F22:113,KC_F23:114,KC_F24:115,KC_EXECUTE:116,KC_HELP:117,KC_MENU:118,KC_SELECT:119,KC_STOP:120,KC_AGAIN:121,KC_UNDO:122,KC_CUT:123,KC_COPY:124,KC_PASTE:125,KC_FIND:126,KC_LCAP:130,KC_LNUM:131,KC_LSCR:132,KC_PCMM:133,KC_KP_EQUAL_AS400:134,KC_RO:135,KC_KANA:136,KC_JYEN:137,KC_HENK:138,KC_MHEN:139,KC_INT6:140,KC_INT7:141,KC_INT8:142,KC_INT9:143,KC_HAEN:144,KC_HANJ:145,KC_LANG3:146,KC_LANG4:147,KC_LANG5:148,KC_LANG6:149,KC_LANG7:150,KC_LANG8:151,KC_LANG9:152,KC_ERAS:153,KC_SYSREQ:154,KC_CANCEL:155,KC_CLR:156,KC_CLEAR:156,KC_PRIOR:157,KC_OUT:160,KC_OPER:161,KC_CLEAR_AGAIN:162,KC_CRSEL:163,KC_EXSEL:164,KC_PWR:165,KC_SLEP:166,KC_WAKE:167,KC_MUTE:168,KC_VOLU:169,KC_VOLD:170,KC_MNXT:171,KC_MPRV:172,KC_MSTP:173,KC_MPLY:174,KC_MSEL:175,KC_EJCT:176,KC_MAIL:177,KC_CALC:178,KC_MYCM:179,KC_WWW_SEARCH:180,KC_WWW_HOME:181,KC_WWW_BACK:182,KC_WWW_FORWARD:183,KC_WWW_STOP:184,KC_WWW_REFRESH:185,KC_WWW_FAVORITES:186,KC_MFFD:187,KC_MRWD:188,KC_BRIU:189,KC_BRID:190,KC_MS_UP:205,KC_MS_DOWN:206,KC_MS_LEFT:207,KC_MS_RIGHT:208,KC_MS_BTN1:209,KC_MS_BTN2:210,KC_MS_BTN3:211,KC_MS_BTN4:212,KC_MS_BTN5:213,KC_MS_BTN6:214,KC_MS_BTN7:215,KC_MS_BTN8:216,KC_MS_WH_UP:217,KC_MS_WH_DOWN:218,KC_MS_WH_LEFT:219,KC_MS_WH_RIGHT:220,KC_MS_ACCEL0:221,KC_MS_ACCEL1:222,KC_MS_ACCEL2:223,KC_LCTL:224,KC_LSFT:225,KC_LALT:226,KC_LGUI:227,KC_RCTL:228,KC_RSFT:229,KC_RALT:230,KC_RGUI:231,RESET:31744,DEBUG:31746,MAGIC_TOGGLE_NKRO:28691,KC_GESC:31766,KC_ASUP:31761,KC_ASDN:31760,KC_ASRP:31762,KC_ASTG:31765,KC_ASON:31763,KC_ASOFF:31764,AU_ON:29824,AU_OFF:29825,AU_TOG:29826,CLICKY_TOGGLE:29834,CLICKY_ENABLE:29835,CLICKY_DISABLE:29836,CLICKY_UP:29837,CLICKY_DOWN:29838,CLICKY_RESET:29839,MU_ON:29840,MU_OFF:29841,MU_TOG:29842,MU_MOD:29843,MI_ON:28928,MI_OFF:28929,MI_TOG:28930,MI_C:28944,MI_Cs:28945,MI_D:28946,MI_Ds:28947,MI_E:28948,MI_F:28949,MI_Fs:28950,MI_G:28951,MI_Gs:28952,MI_A:28953,MI_As:28954,MI_B:28955,MI_C_1:28960,MI_Cs_1:28961,MI_D_1:28962,MI_Ds_1:28963,MI_E_1:28964,MI_F_1:28965,MI_Fs_1:28966,MI_G_1:28967,MI_Gs_1:28968,MI_A_1:28969,MI_As_1:28970,MI_B_1:28971,MI_C_2:28976,MI_Cs_2:28977,MI_D_2:28978,MI_Ds_2:28979,MI_E_2:28980,MI_F_2:28981,MI_Fs_2:28982,MI_G_2:28983,MI_Gs_2:28984,MI_A_2:28985,MI_As_2:28986,MI_B_2:28987,MI_C_3:28992,MI_Cs_3:28993,MI_D_3:28994,MI_Ds_3:28995,MI_E_3:28996,MI_F_3:28997,MI_Fs_3:28998,MI_G_3:28999,MI_Gs_3:29e3,MI_A_3:29001,MI_As_3:29002,MI_B_3:29003,MI_C_4:29008,MI_Cs_4:29009,MI_D_4:29010,MI_Ds_4:29011,MI_E_4:29012,MI_F_4:29013,MI_Fs_4:29014,MI_G_4:29015,MI_Gs_4:29016,MI_A_4:29017,MI_As_4:29018,MI_B_4:29019,MI_C_5:29024,MI_Cs_5:29025,MI_D_5:29026,MI_Ds_5:29027,MI_E_5:29028,MI_F_5:29029,MI_Fs_5:29030,MI_G_5:29031,MI_Gs_5:29032,MI_A_5:29033,MI_As_5:29034,MI_B_5:29035,MI_OCT_N2:29040,MI_OCT_N1:29041,MI_OCT_0:29042,MI_OCT_1:29043,MI_OCT_2:29044,MI_OCT_3:29045,MI_OCT_4:29046,MI_OCT_5:29047,MI_OCT_6:29048,MI_OCT_7:29049,MI_OCTD:29050,MI_OCTU:29051,MI_TRNS_N6:29056,MI_TRNS_N5:29057,MI_TRNS_N4:29058,MI_TRNS_N3:29059,MI_TRNS_N2:29060,MI_TRNS_N1:29061,MI_TRNS_0:29062,MI_TRNS_1:29063,MI_TRNS_2:29064,MI_TRNS_3:29065,MI_TRNS_4:29066,MI_TRNS_5:29067,MI_TRNS_6:29068,MI_TRNSD:29069,MI_TRNSU:29070,MI_VEL_0:29072,MI_VEL_1:29073,MI_VEL_2:29074,MI_VEL_3:29075,MI_VEL_4:29076,MI_VEL_5:29077,MI_VEL_6:29078,MI_VEL_7:29079,MI_VEL_8:29080,MI_VEL_9:29081,MI_VEL_10:29082,MI_VELD:29083,MI_VELU:29084,MI_CH1:29088,MI_CH2:29089,MI_CH3:29090,MI_CH4:29091,MI_CH5:29092,MI_CH6:29093,MI_CH7:29094,MI_CH8:29095,MI_CH9:29096,MI_CH10:29097,MI_CH11:29098,MI_CH12:29099,MI_CH13:29100,MI_CH14:29101,MI_CH15:29102,MI_CH16:29103,MI_CHD:29104,MI_CHU:29105,MI_ALLOFF:29120,MI_SUST:29121,MI_PORT:29122,MI_SOST:29123,MI_SOFT:29124,MI_LEG:29125,MI_MOD:29126,MI_MODSD:29127,MI_MODSU:29128,MI_BENDD:29129,MI_BENDU:29130,BL_ON:30720,BL_OFF:30721,BL_DEC:30723,BL_INC:30724,BL_TOGG:30722,BL_STEP:30725,BL_BRTG:30726,RGB_TOG:30752,RGB_MOD:30753,RGB_RMOD:30754,RGB_HUI:30755,RGB_HUD:30756,RGB_SAI:30757,RGB_SAD:30758,RGB_VAI:30759,RGB_VAD:30760,RGB_SPI:30761,RGB_SPD:30762,RGB_M_P:30763,RGB_M_B:30764,RGB_M_R:30765,RGB_M_SW:30766,RGB_M_SN:30767,RGB_M_K:30768,RGB_M_X:30769,RGB_M_G:30770,RGB_MODE_RGBTEST:30771,VLK_TOG:31767,KC_LSPO:31770,KC_RSPC:31771,KC_SFTENT:31774,OUT_AUTO:31776,OUT_USB:31777,QK_CLEAR_EEPROM:31747,HPT_ON:31808,HPT_OFF:31809,HPT_TOG:31810,HPT_RST:31811,HPT_FBK:31812,HPT_BUZ:31813,HPT_MODI:31814,HPT_MODD:31815,HPT_CONT:31816,HPT_CONI:31817,HPT_COND:31818,HPT_DWLI:31819,HPT_DWLD:31820,KC_LCPO:31768,KC_RCPC:31769,KC_LAPO:31772,KC_RAPC:31773,CMB_ON:31824,CMB_OFF:31825,CMB_TOG:31826,MAGIC_SWAP_LCTL_LGUI:28695,MAGIC_SWAP_RCTL_RGUI:28697,MAGIC_UNSWAP_LCTL_LGUI:28696,MAGIC_UNSWAP_RCTL_RGUI:28698,MAGIC_SWAP_CTL_GUI:28699,MAGIC_UNSWAP_CTL_GUI:28700,MAGIC_TOGGLE_CTL_GUI:28701,MAGIC_EE_HANDS_LEFT:28702,MAGIC_EE_HANDS_RIGHT:28703,DYN_REC_START1:31827,DYN_REC_START2:31828,DYN_REC_STOP:31829,DYN_MACRO_PLAY1:31830,DYN_MACRO_PLAY2:31831,FN_MO13:30464,FN_MO23:30465,DIAL_L:32690,DIAL_BUT:32689,DIAL_R:32691,DIAL_LC:32692,DIAL_RC:32693},v12BasicKeyToByte={_QK_MODS:256,_QK_MODS_MAX:8191,_QK_MOD_TAP:8192,_QK_MOD_TAP_MAX:16383,_QK_LAYER_TAP:16384,_QK_LAYER_TAP_MAX:20479,_QK_LAYER_MOD:20480,_QK_LAYER_MOD_MAX:20991,_QK_TO:20992,_QK_TO_MAX:21023,_QK_MOMENTARY:21024,_QK_MOMENTARY_MAX:21055,_QK_DEF_LAYER:21056,_QK_DEF_LAYER_MAX:21087,_QK_TOGGLE_LAYER:21088,_QK_TOGGLE_LAYER_MAX:21119,_QK_ONE_SHOT_LAYER:21120,_QK_ONE_SHOT_LAYER_MAX:21151,_QK_ONE_SHOT_MOD:21152,_QK_ONE_SHOT_MOD_MAX:21183,_QK_LAYER_TAP_TOGGLE:21184,_QK_LAYER_TAP_TOGGLE_MAX:21215,_QK_LAYER_MOD_MASK:31,_QK_MACRO:30464,_QK_MACRO_MAX:30591,_QK_KB:32256,_QK_KB_MAX:32511,KC_NO:0,KC_TRNS:1,KC_A:4,KC_B:5,KC_C:6,KC_D:7,KC_E:8,KC_F:9,KC_G:10,KC_H:11,KC_I:12,KC_J:13,KC_K:14,KC_L:15,KC_M:16,KC_N:17,KC_O:18,KC_P:19,KC_Q:20,KC_R:21,KC_S:22,KC_T:23,KC_U:24,KC_V:25,KC_W:26,KC_X:27,KC_Y:28,KC_Z:29,KC_1:30,KC_2:31,KC_3:32,KC_4:33,KC_5:34,KC_6:35,KC_7:36,KC_8:37,KC_9:38,KC_0:39,KC_ENT:40,KC_ESC:41,KC_BSPC:42,KC_TAB:43,KC_SPC:44,KC_MINS:45,KC_EQL:46,KC_LBRC:47,KC_RBRC:48,KC_BSLS:49,KC_NUHS:50,KC_SCLN:51,KC_QUOT:52,KC_GRV:53,KC_COMM:54,KC_DOT:55,KC_SLSH:56,KC_CAPS:57,KC_F1:58,KC_F2:59,KC_F3:60,KC_F4:61,KC_F5:62,KC_F6:63,KC_F7:64,KC_F8:65,KC_F9:66,KC_F10:67,KC_F11:68,KC_F12:69,KC_PSCR:70,KC_SLCK:71,KC_PAUS:72,KC_INS:73,KC_HOME:74,KC_PGUP:75,KC_DEL:76,KC_END:77,KC_PGDN:78,KC_RGHT:79,KC_LEFT:80,KC_DOWN:81,KC_UP:82,KC_NLCK:83,KC_PSLS:84,KC_PAST:85,KC_PMNS:86,KC_PPLS:87,KC_PENT:88,KC_P1:89,KC_P2:90,KC_P3:91,KC_P4:92,KC_P5:93,KC_P6:94,KC_P7:95,KC_P8:96,KC_P9:97,KC_P0:98,KC_PDOT:99,KC_NUBS:100,KC_APP:101,KC_POWER:102,KC_PEQL:103,KC_F13:104,KC_F14:105,KC_F15:106,KC_F16:107,KC_F17:108,KC_F18:109,KC_F19:110,KC_F20:111,KC_F21:112,KC_F22:113,KC_F23:114,KC_F24:115,KC_EXECUTE:116,KC_HELP:117,KC_MENU:118,KC_SELECT:119,KC_STOP:120,KC_AGAIN:121,KC_UNDO:122,KC_CUT:123,KC_COPY:124,KC_PASTE:125,KC_FIND:126,KC_LCAP:130,KC_LNUM:131,KC_LSCR:132,KC_PCMM:133,KC_KP_EQUAL_AS400:134,KC_RO:135,KC_KANA:136,KC_JYEN:137,KC_HENK:138,KC_MHEN:139,KC_INT6:140,KC_INT7:141,KC_INT8:142,KC_INT9:143,KC_HAEN:144,KC_HANJ:145,KC_LANG3:146,KC_LANG4:147,KC_LANG5:148,KC_LANG6:149,KC_LANG7:150,KC_LANG8:151,KC_LANG9:152,KC_ERAS:153,KC_SYSREQ:154,KC_CANCEL:155,KC_CLR:156,KC_CLEAR:156,KC_PRIOR:157,KC_OUT:160,KC_OPER:161,KC_CLEAR_AGAIN:162,KC_CRSEL:163,KC_EXSEL:164,KC_PWR:165,KC_SLEP:166,KC_WAKE:167,KC_MUTE:168,KC_VOLU:169,KC_VOLD:170,KC_MNXT:171,KC_MPRV:172,KC_MSTP:173,KC_MPLY:174,KC_MSEL:175,KC_EJCT:176,KC_MAIL:177,KC_CALC:178,KC_MYCM:179,KC_WWW_SEARCH:180,KC_WWW_HOME:181,KC_WWW_BACK:182,KC_WWW_FORWARD:183,KC_WWW_STOP:184,KC_WWW_REFRESH:185,KC_WWW_FAVORITES:186,KC_MFFD:187,KC_MRWD:188,KC_BRIU:189,KC_BRID:190,KC_MS_UP:205,KC_MS_DOWN:206,KC_MS_LEFT:207,KC_MS_RIGHT:208,KC_MS_BTN1:209,KC_MS_BTN2:210,KC_MS_BTN3:211,KC_MS_BTN4:212,KC_MS_BTN5:213,KC_MS_BTN6:214,KC_MS_BTN7:215,KC_MS_BTN8:216,KC_MS_WH_UP:217,KC_MS_WH_DOWN:218,KC_MS_WH_LEFT:219,KC_MS_WH_RIGHT:220,KC_MS_ACCEL0:221,KC_MS_ACCEL1:222,KC_MS_ACCEL2:223,KC_LCTL:224,KC_LSFT:225,KC_LALT:226,KC_LGUI:227,KC_RCTL:228,KC_RSFT:229,KC_RALT:230,KC_RGUI:231,RESET:31744,DEBUG:31746,MAGIC_TOGGLE_NKRO:28691,KC_GESC:31766,KC_ASUP:31761,KC_ASDN:31760,KC_ASRP:31762,KC_ASTG:31765,KC_ASON:31763,KC_ASOFF:31764,AU_ON:29824,AU_OFF:29825,AU_TOG:29826,CLICKY_TOGGLE:29834,CLICKY_ENABLE:29835,CLICKY_DISABLE:29836,CLICKY_UP:29837,CLICKY_DOWN:29838,CLICKY_RESET:29839,MU_ON:29840,MU_OFF:29841,MU_TOG:29842,MU_MOD:29843,MI_ON:28928,MI_OFF:28929,MI_TOG:28930,MI_C:28944,MI_Cs:28945,MI_D:28946,MI_Ds:28947,MI_E:28948,MI_F:28949,MI_Fs:28950,MI_G:28951,MI_Gs:28952,MI_A:28953,MI_As:28954,MI_B:28955,MI_C_1:28960,MI_Cs_1:28961,MI_D_1:28962,MI_Ds_1:28963,MI_E_1:28964,MI_F_1:28965,MI_Fs_1:28966,MI_G_1:28967,MI_Gs_1:28968,MI_A_1:28969,MI_As_1:28970,MI_B_1:28971,MI_C_2:28976,MI_Cs_2:28977,MI_D_2:28978,MI_Ds_2:28979,MI_E_2:28980,MI_F_2:28981,MI_Fs_2:28982,MI_G_2:28983,MI_Gs_2:28984,MI_A_2:28985,MI_As_2:28986,MI_B_2:28987,MI_C_3:28992,MI_Cs_3:28993,MI_D_3:28994,MI_Ds_3:28995,MI_E_3:28996,MI_F_3:28997,MI_Fs_3:28998,MI_G_3:28999,MI_Gs_3:29e3,MI_A_3:29001,MI_As_3:29002,MI_B_3:29003,MI_C_4:29008,MI_Cs_4:29009,MI_D_4:29010,MI_Ds_4:29011,MI_E_4:29012,MI_F_4:29013,MI_Fs_4:29014,MI_G_4:29015,MI_Gs_4:29016,MI_A_4:29017,MI_As_4:29018,MI_B_4:29019,MI_C_5:29024,MI_Cs_5:29025,MI_D_5:29026,MI_Ds_5:29027,MI_E_5:29028,MI_F_5:29029,MI_Fs_5:29030,MI_G_5:29031,MI_Gs_5:29032,MI_A_5:29033,MI_As_5:29034,MI_B_5:29035,MI_OCT_N2:29040,MI_OCT_N1:29041,MI_OCT_0:29042,MI_OCT_1:29043,MI_OCT_2:29044,MI_OCT_3:29045,MI_OCT_4:29046,MI_OCT_5:29047,MI_OCT_6:29048,MI_OCT_7:29049,MI_OCTD:29050,MI_OCTU:29051,MI_TRNS_N6:29056,MI_TRNS_N5:29057,MI_TRNS_N4:29058,MI_TRNS_N3:29059,MI_TRNS_N2:29060,MI_TRNS_N1:29061,MI_TRNS_0:29062,MI_TRNS_1:29063,MI_TRNS_2:29064,MI_TRNS_3:29065,MI_TRNS_4:29066,MI_TRNS_5:29067,MI_TRNS_6:29068,MI_TRNSD:29069,MI_TRNSU:29070,MI_VEL_0:29072,MI_VEL_1:29073,MI_VEL_2:29074,MI_VEL_3:29075,MI_VEL_4:29076,MI_VEL_5:29077,MI_VEL_6:29078,MI_VEL_7:29079,MI_VEL_8:29080,MI_VEL_9:29081,MI_VEL_10:29082,MI_VELD:29083,MI_VELU:29084,MI_CH1:29088,MI_CH2:29089,MI_CH3:29090,MI_CH4:29091,MI_CH5:29092,MI_CH6:29093,MI_CH7:29094,MI_CH8:29095,MI_CH9:29096,MI_CH10:29097,MI_CH11:29098,MI_CH12:29099,MI_CH13:29100,MI_CH14:29101,MI_CH15:29102,MI_CH16:29103,MI_CHD:29104,MI_CHU:29105,MI_ALLOFF:29120,MI_SUST:29121,MI_PORT:29122,MI_SOST:29123,MI_SOFT:29124,MI_LEG:29125,MI_MOD:29126,MI_MODSD:29127,MI_MODSU:29128,MI_BENDD:29129,MI_BENDU:29130,BL_ON:30720,BL_OFF:30721,BL_DEC:30723,BL_INC:30724,BL_TOGG:30722,BL_STEP:30725,BL_BRTG:30726,RGB_TOG:30752,RGB_MOD:30753,RGB_RMOD:30754,RGB_HUI:30755,RGB_HUD:30756,RGB_SAI:30757,RGB_SAD:30758,RGB_VAI:30759,RGB_VAD:30760,RGB_SPI:30761,RGB_SPD:30762,RGB_M_P:30763,RGB_M_B:30764,RGB_M_R:30765,RGB_M_SW:30766,RGB_M_SN:30767,RGB_M_K:30768,RGB_M_X:30769,RGB_M_G:30770,RGB_MODE_RGBTEST:30771,VLK_TOG:31767,KC_LSPO:31770,KC_RSPC:31771,KC_SFTENT:31774,OUT_AUTO:31776,OUT_USB:31777,QK_CLEAR_EEPROM:31747,HPT_ON:31808,HPT_OFF:31809,HPT_TOG:31810,HPT_RST:31811,HPT_FBK:31812,HPT_BUZ:31813,HPT_MODI:31814,HPT_MODD:31815,HPT_CONT:31816,HPT_CONI:31817,HPT_COND:31818,HPT_DWLI:31819,HPT_DWLD:31820,KC_LCPO:31768,KC_RCPC:31769,KC_LAPO:31772,KC_RAPC:31773,CMB_ON:31824,CMB_OFF:31825,CMB_TOG:31826,MAGIC_SWAP_LCTL_LGUI:28695,MAGIC_SWAP_RCTL_RGUI:28697,MAGIC_UNSWAP_LCTL_LGUI:28696,MAGIC_UNSWAP_RCTL_RGUI:28698,MAGIC_SWAP_CTL_GUI:28699,MAGIC_UNSWAP_CTL_GUI:28700,MAGIC_TOGGLE_CTL_GUI:28701,MAGIC_EE_HANDS_LEFT:28702,MAGIC_EE_HANDS_RIGHT:28703,DYN_REC_START1:31827,DYN_REC_START2:31828,DYN_REC_STOP:31829,DYN_MACRO_PLAY1:31830,DYN_MACRO_PLAY2:31831,FN_MO13:31863,FN_MO23:31864,DIAL_L:32690,DIAL_BUT:32689,DIAL_R:32691,DIAL_LC:32692,DIAL_RC:32693};function getBasicKeyDict(e){switch(e){case 13:case 12:return v12BasicKeyToByte;case 11:return v11BasicKeyToByte;case 10:return v10BasicKeyToByte;default:return basicKeyToByte}}const autocompleteKeycodes={KC_NO:!0,KC_A:!0,KC_B:!0,KC_C:!0,KC_D:!0,KC_E:!0,KC_F:!0,KC_G:!0,KC_H:!0,KC_I:!0,KC_J:!0,KC_K:!0,KC_L:!0,KC_M:!0,KC_N:!0,KC_O:!0,KC_P:!0,KC_Q:!0,KC_R:!0,KC_S:!0,KC_T:!0,KC_U:!0,KC_V:!0,KC_W:!0,KC_X:!0,KC_Y:!0,KC_Z:!0,KC_1:!0,KC_2:!0,KC_3:!0,KC_4:!0,KC_5:!0,KC_6:!0,KC_7:!0,KC_8:!0,KC_9:!0,KC_0:!0,KC_ENT:!0,KC_ESC:!0,KC_BSPC:!0,KC_TAB:!0,KC_SPC:!0,KC_MINS:!0,KC_EQL:!0,KC_LBRC:!0,KC_RBRC:!0,KC_BSLS:!0,KC_NUHS:!0,KC_SCLN:!0,KC_QUOT:!0,KC_GRV:!0,KC_COMM:!0,KC_DOT:!0,KC_SLSH:!0,KC_CAPS:!0,KC_F1:!0,KC_F2:!0,KC_F3:!0,KC_F4:!0,KC_F5:!0,KC_F6:!0,KC_F7:!0,KC_F8:!0,KC_F9:!0,KC_F10:!0,KC_F11:!0,KC_F12:!0,KC_PSCR:!0,KC_SLCK:!0,KC_PAUS:!0,KC_INS:!0,KC_HOME:!0,KC_PGUP:!0,KC_DEL:!0,KC_END:!0,KC_PGDN:!0,KC_RGHT:!0,KC_LEFT:!0,KC_DOWN:!0,KC_UP:!0,KC_NLCK:!0,KC_PSLS:!0,KC_KP_ASTERISK:!0,KC_PAST:!0,KC_PPLS:!0,KC_PMNS:!0,KC_PENT:!0,KC_P1:!0,KC_P2:!0,KC_P3:!0,KC_P4:!0,KC_P5:!0,KC_P6:!0,KC_P7:!0,KC_P8:!0,KC_P9:!0,KC_P0:!0,KC_PDOT:!0,KC_NUBS:!0,KC_APP:!0,KC_POWER:!0,KC_PEQL:!0,KC_F13:!0,KC_F14:!0,KC_F15:!0,KC_F16:!0,KC_F17:!0,KC_F18:!0,KC_F19:!0,KC_F20:!0,KC_F21:!0,KC_F22:!0,KC_F23:!0,KC_F24:!0,KC_EXECUTE:!0,KC_HELP:!0,KC_MENU:!0,KC_SELECT:!0,KC_STOP:!0,KC_AGAIN:!0,KC_UNDO:!0,KC_CUT:!0,KC_COPY:!0,KC_PASTE:!0,KC_FIND:!0,KC_LCAP:!0,KC_LNUM:!0,KC_LSCR:!0,KC_PCMM:!0,KC_KP_EQUAL_AS400:!0,KC_RO:!0,KC_KANA:!0,KC_JYEN:!0,KC_HENK:!0,KC_MHEN:!0,KC_INT6:!0,KC_INT7:!0,KC_INT8:!0,KC_INT9:!0,KC_HAEN:!0,KC_HANJ:!0,KC_LANG3:!0,KC_LANG4:!0,KC_LANG5:!0,KC_LANG6:!0,KC_LANG7:!0,KC_LANG8:!0,KC_LANG9:!0,KC_SYSREQ:!0,KC_CANCEL:!0,KC_CLEAR:!0,KC_PRIOR:!0,KC_OUT:!0,KC_OPER:!0,KC_CLEAR_AGAIN:!0,KC_CRSEL:!0,KC_EXSEL:!0,KC_LCTL:!0,KC_LSFT:!0,KC_LALT:!0,KC_LGUI:!0,KC_RCTL:!0,KC_RSFT:!0,KC_RALT:!0,KC_RGUI:!0,KC_PWR:!0,KC_SLEP:!0,KC_WAKE:!0,KC_MUTE:!0,KC_VOLU:!0,KC_VOLD:!0,KC_MNXT:!0,KC_MPRV:!0,KC_MSTP:!0,KC_MPLY:!0,KC_MSEL:!0,KC_EJCT:!0,KC_MAIL:!0,KC_CALC:!0,KC_MYCM:!0,KC_WWW_SEARCH:!0,KC_WWW_HOME:!0,KC_WWW_BACK:!0,KC_WWW_FORWARD:!0,KC_WWW_STOP:!0,KC_WWW_REFRESH:!0,KC_WWW_FAVORITES:!0,KC_MFFD:!0,KC_MRWD:!0},getAutocompleteKeycodes=()=>keycodesList.filter(e=>!!autocompleteKeycodes[e.code]);function isAutocompleteKeycode(e){const t=e.toUpperCase();return!!autocompleteKeycodes[t]}var RawKeycodeSequenceAction=(e=>(e[e.Tap=1]="Tap",e[e.Down=2]="Down",e[e.Up=3]="Up",e[e.Delay=4]="Delay",e[e.CharacterStream=5]="CharacterStream",e))(RawKeycodeSequenceAction||{}),GroupedKeycodeSequenceAction=(e=>(e[e.Chord=6]="Chord",e))(GroupedKeycodeSequenceAction||{}),KeyAction=(e=>(e[e.Tap=1]="Tap",e[e.Down=2]="Down",e[e.Up=3]="Up",e[e.Delay=4]="Delay",e))(KeyAction||{});const KeyActionPrefix=1,DelayTerminator=124,MacroTerminator=0;function splitExpression(expression){let regex;try{return regex=eval("/(?<!\\\\)({.*?})/g"),expression.split(regex).filter(e=>e.length)}catch(e){return console.error("Lookbehind is not supported in this browser."),[]}}function optimizedSequenceToRawSequence(e){return e.flatMap(t=>{if(t[0]==GroupedKeycodeSequenceAction.Chord){const o=n=>s=>[n,s];return[...t[1]].map(o(RawKeycodeSequenceAction.Down)).concat([...t[1]].reverse().map(o(RawKeycodeSequenceAction.Up)))}else return[t]})}function rawSequenceToOptimizedSequence(e){let t=[];return t=convertToTapsAndChords(e),t}function convertToTapsAndChords(e){let t=[],o=[],n=0;const s=e.reduce((i,c)=>c[0]===RawKeycodeSequenceAction.Tap?[...i,[RawKeycodeSequenceAction.Down,c[1]],[RawKeycodeSequenceAction.Up,c[1]]]:[...i,c],[]);let r=[];s.forEach((i,c)=>{let l=!1;if(t.push(i),i[0]===RawKeycodeSequenceAction.Down)n==o.length&&(o.push(i[1]),n++,l=!0);else if(i[0]===RawKeycodeSequenceAction.Up){const d=i[1];o.length>0&&d===o[n-1]&&(n--,n==0?(o.length===1?r.push([RawKeycodeSequenceAction.Tap,o[0]]):r.push([GroupedKeycodeSequenceAction.Chord,o]),t=[]):l=!0)}c===s.length-1&&(l=!1),l||(r.push(...t),t=[],o=[],n=0)});let a=[];for(let i=0;i<r.length;i++)i+1<r.length&&r[i][0]==RawKeycodeSequenceAction.Down&&r[i+1][0]==RawKeycodeSequenceAction.Up&&r[i][1]===r[i+1][1]?(a.push([RawKeycodeSequenceAction.Tap,r[i][1]]),i++):a.push(r[i]);return a}const mapKeycodeToCharacterStream={KC_A:["a","A"],KC_B:["b","B"],KC_C:["c","C"],KC_D:["d","D"],KC_E:["e","E"],KC_F:["f","F"],KC_G:["g","G"],KC_H:["h","H"],KC_I:["i","I"],KC_J:["j","J"],KC_K:["k","K"],KC_L:["l","L"],KC_M:["m","M"],KC_N:["n","N"],KC_O:["o","O"],KC_P:["p","P"],KC_Q:["q","Q"],KC_R:["r","R"],KC_S:["s","S"],KC_T:["t","T"],KC_U:["u","U"],KC_V:["v","V"],KC_W:["w","W"],KC_X:["x","X"],KC_Y:["y","Y"],KC_Z:["z","Z"],KC_1:["1","!"],KC_2:["2","@"],KC_3:["3","#"],KC_4:["4","$"],KC_5:["5","%"],KC_6:["6","^"],KC_7:["7","&"],KC_8:["8","*"],KC_9:["9","("],KC_0:["0",")"],KC_SPC:[" "," "],KC_MINS:["-","_"],KC_EQL:["=","+"],KC_LBRC:["[","{"],KC_RBRC:["]","}"],KC_BSLS:["\\","|"],KC_SCLN:[";",":"],KC_QUOT:["'",'"'],KC_GRV:["`","~"],KC_COMM:[",","<"],KC_DOT:[".",">"],KC_SLSH:["/","?"]},mapCharToShiftedChar=Object.values(mapKeycodeToCharacterStream).reduce((e,[t,o])=>({...e,[t]:o}),{});function convertCharacterTaps(e){return e.reduce((o,n)=>n[0]==RawKeycodeSequenceAction.Down&&n[1]in mapKeycodeToCharacterStream?[...o,[RawKeycodeSequenceAction.Tap,n[1]]]:n[0]==RawKeycodeSequenceAction.Up&&n[1]in mapKeycodeToCharacterStream?o:[...o,n],[])}function trimLastWait(e){return e[e.length-1]&&e[e.length-1][0]===RawKeycodeSequenceAction.Delay?e.slice(0,-1):e}function mergeConsecutiveWaits(e){return e.reduce((t,o)=>(t[t.length-1]&&t[t.length-1][0]===RawKeycodeSequenceAction.Delay&&o[0]===RawKeycodeSequenceAction.Delay?t.splice(-1,1,[RawKeycodeSequenceAction.Delay,Number(t[t.length-1][1])+Number(o[1])]):t.push(o),t),[])}function foldKeydownKeyupKeys(e){return e.reduce((t,o)=>(t[t.length-1]&&t[t.length-1][0]===RawKeycodeSequenceAction.Down&&o[0]===RawKeycodeSequenceAction.Up&&t[t.length-1][1]===o[1]?t.splice(-1,1,[RawKeycodeSequenceAction.Tap,o[1]]):t.push(o),t),[])}function convertToCharacterStreams(e){let t=e.reduce((s,r)=>{if(r[0]==RawKeycodeSequenceAction.Tap&&r[1]in mapKeycodeToCharacterStream){const a=mapKeycodeToCharacterStream[r[1]][0];return s[s.length-1]!==void 0&&s[s.length-1][0]===RawKeycodeSequenceAction.CharacterStream?[...s.slice(0,-1),[RawKeycodeSequenceAction.CharacterStream,s[s.length-1][1]+a]]:[...s,[RawKeycodeSequenceAction.CharacterStream,a]]}else return[...s,r]},[]),o=[];for(let s=0;s<t.length;s++)if(s+2<t.length&&t[s][0]===RawKeycodeSequenceAction.Down&&t[s+1][0]===RawKeycodeSequenceAction.CharacterStream&&t[s+2][0]===RawKeycodeSequenceAction.Up&&t[s][1]===t[s+2][1]&&(t[s][1]==="KC_LSFT"||t[s][1]==="KC_RSFT")){const r=t[s+1][1].split("").map(a=>mapCharToShiftedChar[a]).join("");o.push([RawKeycodeSequenceAction.CharacterStream,r]),s+=2}else o.push(t[s]);return o.reduce((s,r)=>r[0]===RawKeycodeSequenceAction.CharacterStream&&s[s.length-1]!==void 0&&s[s.length-1][0]===RawKeycodeSequenceAction.CharacterStream?(s[s.length-1][1]=s[s.length-1][1].concat(r[1]),s):[...s,r],[])}function sequenceToExpression(e){let t=[];return e.forEach(o=>{switch(o[0]){case RawKeycodeSequenceAction.Tap:t.push("{"+o[1]+"}");break;case RawKeycodeSequenceAction.Down:t.push("{+"+o[1]+"}");break;case RawKeycodeSequenceAction.Up:t.push("{-"+o[1]+"}");break;case RawKeycodeSequenceAction.Delay:t.push("{"+o[1]+"}");break;case GroupedKeycodeSequenceAction.Chord:t.push("{"+o[1].join(",")+"}");break;case RawKeycodeSequenceAction.CharacterStream:t.push(o[1].replace(/{/g,"\\{"))}}),t.join("")}function expressionToSequence(e){let t=splitExpression(e),o=[];return t.forEach(n=>{if(/^{.*}$/.test(n))if(n=n.slice(1,-1),/^\d+$/.test(n))o.push([RawKeycodeSequenceAction.Delay,parseInt(n)]);else{const s=/^[+-]/.test(n)?n.slice(0,1):null,r=n.replace(/^[+-]/,"").split(",").map(a=>a.trim().toUpperCase()).filter(a=>a.length);if(r.length>0)if(s==null)r.length==1?o.push([RawKeycodeSequenceAction.Tap,r[0]]):o.push([GroupedKeycodeSequenceAction.Chord,r]);else{const a=s=="+"?RawKeycodeSequenceAction.Down:RawKeycodeSequenceAction.Up;o.push([a,r[0]])}}else n=n.replace(/\\{/g,"{"),o.push([RawKeycodeSequenceAction.CharacterStream,n])}),o}function validateMacroExpression(expression){let unclosedBlockRegex,keycodeBlockRegex;try{unclosedBlockRegex=eval("/(?<!\\\\){(?![^{]*})/"),keycodeBlockRegex=eval("/(?<!\\\\){(.*?)}/g")}catch(e){return console.error("Lookbehind is not supported in this browser."),{isValid:!1,errorMessage:"Lookbehind is not supported in this browser."}}if(expression.match(unclosedBlockRegex))return{isValid:!1,errorMessage:"Looks like a keycode block - {} - is unclosed! Are you missing an '}'?"};let groups=null;for(;groups=keycodeBlockRegex.exec(expression);){const e=groups[1].replace(/\s+/g,"");if(!e.length)return{isValid:!1,errorMessage:"Sorry, I can't handle empty {}. Fill them up with keycodes or use \\{} to tell the macro to literally type {}"};const t=e.split(",").filter(o=>o.trim().length&&!isAutocompleteKeycode(o));if(t.length)return{isValid:!1,errorMessage:`Whoops! Invalid keycodes detected inside {}: ${t.join(", ")}`}}return{isValid:!0,errorMessage:void 0}}class MacroAPI{constructor(t,o,n){this.keyboardApi=t,this.basicKeyToByte=o,this.byteToKey=n}async readRawKeycodeSequences(){const t=await this.keyboardApi.getMacroBytes(),o=await this.keyboardApi.getMacroCount();let n=0,s=0;const r=[];let a=[];if(o===0)throw Error("Macros are disabled");for(;s<t.length&&n<o;){let i=t[s];switch(i){case MacroTerminator:r[n]=a,n++,a=[];break;case KeyAction.Tap:i=t[++s],a.push([RawKeycodeSequenceAction.Tap,this.byteToKey[i]]);break;case KeyAction.Down:i=t[++s],a.push([RawKeycodeSequenceAction.Down,this.byteToKey[i]]);break;case KeyAction.Up:i=t[++s],a.push([RawKeycodeSequenceAction.Up,this.byteToKey[i]]);break;default:{const c=String.fromCharCode(i);a.length&&a[a.length-1][0]===RawKeycodeSequenceAction.CharacterStream?a[a.length-1]=[RawKeycodeSequenceAction.CharacterStream,a[a.length-1][1]+c]:a.push([RawKeycodeSequenceAction.CharacterStream,c]);break}}s++}return r}rawKeycodeSequencesToMacroBytes(t){return t.flatMap(o=>{const n=[];return o.forEach(s=>{switch(s[0]){case RawKeycodeSequenceAction.Tap:n.push(KeyAction.Tap,this.basicKeyToByte[s[1]]);break;case RawKeycodeSequenceAction.Up:n.push(KeyAction.Up,this.basicKeyToByte[s[1]]);break;case RawKeycodeSequenceAction.Down:n.push(KeyAction.Down,this.basicKeyToByte[s[1]]);break;case RawKeycodeSequenceAction.Delay:break;case RawKeycodeSequenceAction.CharacterStream:n.push(...s[1].split("").map(r=>r.charCodeAt(0)));break}}),n.push(MacroTerminator),n})}async writeRawKeycodeSequences(t){const o=this.rawKeycodeSequencesToMacroBytes(t);await this.keyboardApi.setMacroBytes(o)}}function validateMacroExpressionV11(expression){let unclosedBlockRegex,keycodeBlockRegex;try{unclosedBlockRegex=eval("/(?<!\\\\){(?![^{]*})/"),keycodeBlockRegex=eval("/(?<!\\\\){(.*?)}/g")}catch(e){return console.error("Lookbehind is not supported in this browser."),{isValid:!1,errorMessage:"Lookbehind is not supported in this browser."}}if(expression.match(unclosedBlockRegex))return{isValid:!1,errorMessage:"Looks like a keycode block - {} - is unclosed! Are you missing an '}'?"};let groups=null;for(;groups=keycodeBlockRegex.exec(expression);){const e=groups[1].replace(/\s+/g,"");if(!e.length)return{isValid:!1,errorMessage:"Sorry, I can't handle empty {}. Fill them up with keycodes or use \\{} to tell the macro to literally type {}"};if(/^\d+$/.test(e)){if(/\d{5,}/.test(e))return{isValid:!1,errorMessage:`Invalid delay: ${e}. Please use a delay value of 9999 or less.`}}else{const t=e.replace(/^[-+]/,"").split(",").filter(o=>o.trim().length&&!isAutocompleteKeycode(o));if(t.length)return{isValid:!1,errorMessage:`Whoops! Invalid keycodes detected inside {}: ${t.join(", ")}`}}}return{isValid:!0,errorMessage:void 0}}class MacroAPIV11{constructor(t,o,n){this.keyboardApi=t,this.basicKeyToByte=o,this.byteToKey=n}async readRawKeycodeSequences(){const t=await this.keyboardApi.getMacroBytes(),o=await this.keyboardApi.getMacroCount();let n=0,s=0;const r=[];let a=[];if(o===0)throw Error("Macros are disabled");for(;s<t.length&&n<o;){let i=t[s];switch(i){case MacroTerminator:r[n]=a,n++,a=[];break;case KeyActionPrefix:switch(i=t[++s],i){case KeyAction.Tap:i=t[++s],a.push([RawKeycodeSequenceAction.Tap,this.byteToKey[i]]);break;case KeyAction.Down:i=t[++s],a.push([RawKeycodeSequenceAction.Down,this.byteToKey[i]]);break;case KeyAction.Up:i=t[++s],a.push([RawKeycodeSequenceAction.Up,this.byteToKey[i]]);break;case KeyAction.Delay:let c=[];for(i=t[++s];i!==DelayTerminator&&s<t.length;)c.push(i),i=t[++s];const l=c.reduce((d,u)=>(d+=String.fromCharCode(u),d),"");a.push([RawKeycodeSequenceAction.Delay,parseInt(l)]);break;default:throw`Expected a KeyAction to follow the KeyActionPrefix. Received ${i} instead.`}break;default:{const c=String.fromCharCode(i);a.length&&a[a.length-1][0]===RawKeycodeSequenceAction.CharacterStream?a[a.length-1]=[RawKeycodeSequenceAction.CharacterStream,a[a.length-1][1]+c]:a.push([RawKeycodeSequenceAction.CharacterStream,c]);break}}s++}return r}rawKeycodeSequencesToMacroBytes(t){return t.flatMap(o=>{const n=[];return o.forEach(s=>{switch(s[0]){case RawKeycodeSequenceAction.Tap:n.push(KeyActionPrefix,KeyAction.Tap,this.basicKeyToByte[s[1]]);break;case RawKeycodeSequenceAction.Down:n.push(KeyActionPrefix,KeyAction.Down,this.basicKeyToByte[s[1]]);break;case RawKeycodeSequenceAction.Up:n.push(KeyActionPrefix,KeyAction.Up,this.basicKeyToByte[s[1]]);break;case RawKeycodeSequenceAction.Delay:let r=`${s[1]}`;n.push(KeyActionPrefix,KeyAction.Delay,...r.split("").map(a=>a.charCodeAt(0)),DelayTerminator);break;case RawKeycodeSequenceAction.CharacterStream:n.push(...s[1].split("").map(a=>a.charCodeAt(0)));break}}),n.push(MacroTerminator),n})}async writeRawKeycodeSequences(t){const o=this.rawKeycodeSequencesToMacroBytes(t);await this.keyboardApi.setMacroBytes(o)}}const getMacroAPI=(e,t)=>{const o=getBasicKeyDict(e),n=getByteToKey(getBasicKeyDict(e));return e>=11?new MacroAPIV11(t,o,n):new MacroAPI(t,o,n)},getMacroValidator=e=>e>=11?validateMacroExpressionV11:validateMacroExpression,isDelaySupported=e=>e>=11,initialState$5={selectedDevicePath:null,connectedDevicePaths:{},supportedIds:{},forceAuthorize:!1},deviceSlice=createSlice({name:"devices",initialState:initialState$5,reducers:{selectDevice:(e,t)=>{t.payload?e.selectedDevicePath=t.payload.path:e.selectedDevicePath=null},setForceAuthorize:(e,t)=>{e.forceAuthorize=t.payload},updateConnectedDevices:(e,t)=>{e.connectedDevicePaths=t.payload},clearAllDevices:e=>{e.selectedDevicePath=null,e.connectedDevicePaths={}},updateSupportedIds:(e,t)=>{e.supportedIds=t.payload},ensureSupportedIds:(e,t)=>{const{productIds:o,version:n}=t.payload;o.forEach(s=>{e.supportedIds[s]=e.supportedIds[s]??{},e.supportedIds[s][n]=!0})}}}),{clearAllDevices,selectDevice,updateConnectedDevices,updateSupportedIds,ensureSupportedIds,setForceAuthorize}=deviceSlice.actions,devicesReducer=deviceSlice.reducer,getForceAuthorize=e=>e.devices.forceAuthorize,getConnectedDevices=e=>e.devices.connectedDevicePaths,getSelectedDevicePath=e=>e.devices.selectedDevicePath,getSupportedIds=e=>e.devices.supportedIds,getSelectedConnectedDevice=createSelector(getConnectedDevices,getSelectedDevicePath,(e,t)=>t&&e[t]),getSelectedKeyboardAPI=createSelector(getSelectedDevicePath,e=>e&&new KeyboardAPI(e)),macrosInitialState={ast:[],macroBufferSize:0,macroCount:0,isFeatureSupported:!0},macrosSlice=createSlice({name:"macros",initialState:macrosInitialState,reducers:{loadMacrosSuccess:(e,t)=>{e.ast=t.payload.ast,e.macroBufferSize=t.payload.macroBufferSize,e.macroCount=t.payload.macroCount},saveMacrosSuccess:(e,t)=>{e.ast=t.payload.ast},setMacrosNotSupported:e=>{e.isFeatureSupported=!1}}}),{loadMacrosSuccess,saveMacrosSuccess,setMacrosNotSupported}=macrosSlice.actions,macrosReducer=macrosSlice.reducer,loadMacros=e=>async(t,o)=>{const{protocol:n}=e;if(n<8)t(setMacrosNotSupported());else try{const s=o(),r=getSelectedKeyboardAPI(s),a=getMacroAPI(n,r);if(a){const i=await a.readRawKeycodeSequences(),c=await r.getMacroBufferSize(),l=await r.getMacroCount();t(loadMacrosSuccess({ast:i,macroBufferSize:c,macroCount:l}))}}catch{t(setMacrosNotSupported())}},saveMacros=(e,t)=>async(o,n)=>{const s=n(),r=getSelectedKeyboardAPI(s),{protocol:a}=e,i=getMacroAPI(a,r);if(i){const c=t.map(l=>{const d=expressionToSequence(l);return optimizedSequenceToRawSequence(d)});await i.writeRawKeycodeSequences(c),o(saveMacrosSuccess({ast:c}))}},getIsMacroFeatureSupported=e=>e.macros.isFeatureSupported,getAST=e=>e.macros.ast,getMacroBufferSize=e=>e.macros.macroBufferSize,getMacroCount=e=>e.macros.macroCount,getExpressions=createSelector(getAST,e=>e.map(t=>{const o=rawSequenceToOptimizedSequence(t);return sequenceToExpression(o)})),getIsDelaySupported=createSelector(getSelectedConnectedDevice,e=>!!e&&isDelaySupported(e.protocol)),maxBitSize=5,packBits=e=>e.reduce((t,[o,n])=>t<<minBitSize(n)|o,0)>>>0,numIntoBytes=e=>[e>>24,e>>16,e>>8,e].map(t=>t&255),bytesIntoNum=e=>(e[0]<<24|e[1]<<16|e[2]<<8|e[3])>>>0,unpackBits=(e,t)=>t.reverse().reduce(({res:o,bits:n},s)=>({bits:n>>minBitSize(s),res:[n&(1<<minBitSize(s))-1,...o]}),{bits:e,res:[]}).res,minBitSize=e=>1+Array(maxBitSize).fill(0).findIndex((t,o)=>2<<o>=e);function isFulfilledPromise(e){return e.status==="fulfilled"}function isAuthorizedDeviceConnected(e,t){return t&&t[e.vendorProductId]&&t[e.vendorProductId][e.requiredDefinitionVersion]}const initialState$4={definitions:{},customDefinitions:{},layoutOptionsMap:{}},definitionsSlice=createSlice({name:"definitions",initialState:initialState$4,reducers:{updateDefinitions:(e,t)=>{e.definitions={...e.definitions,...t.payload}},loadInitialCustomDefinitions:(e,t)=>{e.customDefinitions=t.payload},unloadCustomDefinition:(e,t)=>{const{version:o,id:n}=t.payload,s=e.customDefinitions[n];Object.keys(s).length===1?(delete e.customDefinitions[n],del(n)):(delete s[o],update(n,r=>(delete r[o],r))),e.customDefinitions={...e.customDefinitions}},loadCustomDefinitions:(e,t)=>{const{version:o,definitions:n}=t.payload;n.forEach(s=>{const r=e.customDefinitions[s.vendorProductId]??{};r[o]=s,e.customDefinitions[s.vendorProductId]=r})},updateLayoutOptions:(e,t)=>{e.layoutOptionsMap={...e.layoutOptionsMap,...t.payload}}}}),{loadCustomDefinitions,loadInitialCustomDefinitions,updateDefinitions,unloadCustomDefinition,updateLayoutOptions}=definitionsSlice.actions,definitionsReducer=definitionsSlice.reducer,getBaseDefinitions=e=>e.definitions.definitions,getCustomDefinitions=e=>e.definitions.customDefinitions,getLayoutOptionsMap=e=>e.definitions.layoutOptionsMap,getDefinitions=createSelector(getBaseDefinitions,getCustomDefinitions,(e,t)=>Object.entries(t).reduce((o,[n,s])=>({...o,[n]:{...o[n],...s}}),e)),getSelectedDefinition=createSelector(getDefinitions,getSelectedConnectedDevice,(e,t)=>t&&e&&e[t.vendorProductId]&&e[t.vendorProductId][t.requiredDefinitionVersion]),getBasicKeyToByte=createSelector(getSelectedConnectedDevice,e=>{const t=getBasicKeyDict(e?e.protocol:0);return{basicKeyToByte:t,byteToKey:getByteToKey(t)}}),getSelectedLayoutOptions=createSelector(getSelectedDefinition,getLayoutOptionsMap,getSelectedDevicePath,(e,t,o)=>o&&t[o]||e&&e.layouts.labels&&e.layouts.labels.map(n=>0)||[]),getSelectedOptionKeys=createSelector(getSelectedLayoutOptions,getSelectedDefinition,(e,t)=>t?e.flatMap((o,n)=>t.layouts.optionKeys[n]&&t.layouts.optionKeys[n][o]||[]):[]),getSelectedKeyDefinitions=createSelector(getSelectedDefinition,getSelectedOptionKeys,(e,t)=>e&&t?e.layouts.keys.concat(t):[]),updateLayoutOption=(e,t)=>async(o,n)=>{const s=n(),r=getSelectedDefinition(s),a=getSelectedKeyboardAPI(s),i=getSelectedDevicePath(s);if(!r||!a||!i||!r.layouts.labels)return;const c=r.layouts.labels.map(u=>Array.isArray(u)?u.slice(1).length:2),l=[...getSelectedLayoutOptions(s)];l[e]=t;const d=numIntoBytes(packBits(l.map((u,_)=>[u,c[_]])));try{await a.setKeyboardValue(KeyboardValue.LAYOUT_OPTIONS,...d)}catch{console.warn("Setting layout option command not working")}o(updateLayoutOptions({[i]:l}))},storeCustomDefinitions=({definitions:e,version:t})=>async(o,n)=>{try{const s=getCustomDefinitions(n()),r=e.map(a=>[a.vendorProductId,{...s[a.vendorProductId],[t]:a}]);return setMany(r)}catch(s){throw console.error(s),s}},loadStoredCustomDefinitions=()=>async(e,t)=>{try{const o=await entries(),n=o.filter(([a])=>["string","number"].includes(typeof a)).reduce((a,i)=>({...a,[i[0]]:i[1]}),{});e(loadInitialCustomDefinitions(n));const[s,r]=o.reduce(([a,i],[c,l])=>[l.v2?[...a,Number(c)]:a,l.v3?[...i,Number(c)]:i],[[],[]]);e(ensureSupportedIds({productIds:s,version:"v2"})),e(ensureSupportedIds({productIds:r,version:"v3"}))}catch(o){console.error(o)}},loadLayoutOptions=()=>async(e,t)=>{const o=t(),n=getSelectedDefinition(o),s=getSelectedConnectedDevice(o),r=getSelectedKeyboardAPI(o);if(!s||!n||!n.layouts.labels||!r)return;const{path:a}=s;try{const i=await r.getKeyboardValue(KeyboardValue.LAYOUT_OPTIONS,[],4),c=unpackBits(bytesIntoNum(i),n.layouts.labels.map(l=>Array.isArray(l)?l.slice(1).length:2));e(updateLayoutOptions({[a]:c}))}catch{console.warn("Getting layout options command not working")}},reloadDefinitions=e=>async(t,o)=>{const n=o(),s=getBaseDefinitions(n),r=getDefinitions(n),a=e.filter(({vendorProductId:l,requiredDefinitionVersion:d})=>!r||!r[l]||!r[l][d]),i=await Promise.allSettled(a.map(l=>getMissingDefinition(l,l.requiredDefinitionVersion)));i.forEach((l,d)=>{const u=a[d];if(l.status==="rejected"){const _=extractDeviceInfo(u);t(logAppError({message:`Fetching ${u.requiredDefinitionVersion} definition failed`,deviceInfo:_}))}});const c=i.filter(isFulfilledPromise).map(l=>l.value);c.length&&t(updateDefinitions(c.reduce((l,[d,u])=>({...l,[d.vendorProductId]:{...l[d.vendorProductId],[u]:d}}),s)))},initialState$3={rawDeviceMap:{},numberOfLayers:4,selectedLayerIndex:0,selectedKey:null,configureKeyboardIsSelectable:!1,selectedPaletteColor:[0,0]},keymapSlice=createSlice({name:"keymap",initialState:initialState$3,reducers:{setSelectedPaletteColor:(e,t)=>{e.selectedPaletteColor=t.payload},setNumberOfLayers:(e,t)=>{e.numberOfLayers=t.payload},setConfigureKeyboardIsSelectable:(e,t)=>{e.configureKeyboardIsSelectable=t.payload},loadLayerSuccess:(e,t)=>{const{layerIndex:o,keymap:n,devicePath:s}=t.payload;e.rawDeviceMap[s]=e.rawDeviceMap[s]||Array(e.numberOfLayers).fill({keymap:[],isLoaded:!1}),e.rawDeviceMap[s][o]={keymap:n,isLoaded:!0}},setLayer:(e,t)=>{e.selectedLayerIndex=t.payload},clearSelectedKey:e=>{e.selectedKey=null},updateSelectedKey:(e,t)=>{e.selectedKey=t.payload},saveKeymapSuccess:(e,t)=>{const{layers:o,devicePath:n}=t.payload;e.rawDeviceMap[n]=o},setKey:(e,t)=>{const{keymapIndex:o,value:n,devicePath:s}=t.payload,{selectedLayerIndex:r}=e;e.rawDeviceMap[s][r].keymap[o]=n}},extraReducers:e=>{e.addCase(selectDevice,t=>{t.selectedKey=null})}}),{setNumberOfLayers,setLayer,loadLayerSuccess,clearSelectedKey,setKey,updateSelectedKey,saveKeymapSuccess,setConfigureKeyboardIsSelectable,setSelectedPaletteColor}=keymapSlice.actions,keymapReducer=keymapSlice.reducer,loadKeymapFromDevice=e=>async(t,o)=>{const n=o();if(getLoadProgress(n)===1)return;const{path:s,vendorProductId:r,requiredDefinitionVersion:a}=e,i=getSelectedKeyboardAPI(n),c=await i.getLayerCount();t(setNumberOfLayers(c));const{matrix:l}=getDefinitions(n)[r][a];for(var d=0;d<c;d++){const u=await i.readRawMatrix(l,d);t(loadLayerSuccess({layerIndex:d,keymap:u,devicePath:s}))}},saveRawKeymapToDevice=(e,t)=>async(o,n)=>{const s=n(),{path:r}=t,a=getSelectedKeyboardAPI(s),i=getSelectedDefinition(s);if(!r||!i||!a)return;const{matrix:c}=i;await a.writeRawMatrix(c,e);const l=e.map(d=>({keymap:d,isLoaded:!0}));o(saveKeymapSuccess({layers:l,devicePath:r}))},updateKey=(e,t)=>async(o,n)=>{const s=n(),r=getSelectedKeyDefinitions(s),a=getSelectedConnectedDevice(s),i=getSelectedKeyboardAPI(s),c=getSelectedDefinition(s);if(!a||!r||!c||!i)return;const l=getSelectedLayerIndex(s),{path:d}=a,{row:u,col:_}=r[e];await i.setKey(l,u,_,t);const{matrix:p}=c,x=u*p.cols+_;o(setKey({keymapIndex:x,value:t,devicePath:d}))},getConfigureKeyboardIsSelectable=e=>e.keymap.configureKeyboardIsSelectable,getSelectedKey=e=>e.keymap.selectedKey,getRawDeviceMap=e=>e.keymap.rawDeviceMap,getNumberOfLayers=e=>e.keymap.numberOfLayers,getSelectedLayerIndex=e=>e.keymap.selectedLayerIndex,getSelected256PaletteColor=e=>e.keymap.selectedPaletteColor,getSelectedPaletteColor=createSelector(getSelected256PaletteColor,([e,t])=>[360*e/255,t/255]),getSelectedRawLayers=createSelector(getRawDeviceMap,getSelectedDevicePath,(e,t)=>t&&e[t]||[]),getLoadProgress=createSelector(getSelectedRawLayers,getNumberOfLayers,(e,t)=>e&&e.filter(o=>o.isLoaded).length/t);createSelector(getSelectedRawLayers,getSelectedLayerIndex,(e,t)=>e&&e[t]);const getSelectedKeymaps=createSelector(getSelectedKeyDefinitions,getSelectedDefinition,getSelectedRawLayers,(e,t,o)=>{if(t&&o){const n=o.map(r=>r.keymap),{matrix:{cols:s}}=t;return n.map(r=>e.map(({row:a,col:i})=>r[a*s+i]))}}),getSelectedKeymap=createSelector(getSelectedKeymaps,getSelectedLayerIndex,(e,t)=>e&&e[t]),commandParamLengths={[distExports.LightingValue.BACKLIGHT_COLOR_1]:2,[distExports.LightingValue.BACKLIGHT_COLOR_2]:2,[distExports.LightingValue.QMK_RGBLIGHT_COLOR]:2,[distExports.LightingValue.BACKLIGHT_CUSTOM_COLOR]:2,[distExports.LightingValue.BACKLIGHT_CAPS_LOCK_INDICATOR_COLOR]:2,[distExports.LightingValue.BACKLIGHT_CAPS_LOCK_INDICATOR_ROW_COL]:2,[distExports.LightingValue.BACKLIGHT_LAYER_1_INDICATOR_COLOR]:2,[distExports.LightingValue.BACKLIGHT_LAYER_2_INDICATOR_COLOR]:2,[distExports.LightingValue.BACKLIGHT_LAYER_3_INDICATOR_COLOR]:2,[distExports.LightingValue.BACKLIGHT_LAYER_1_INDICATOR_ROW_COL]:2,[distExports.LightingValue.BACKLIGHT_LAYER_2_INDICATOR_ROW_COL]:2,[distExports.LightingValue.BACKLIGHT_LAYER_3_INDICATOR_ROW_COL]:2,[distExports.LightingValue.BACKLIGHT_EFFECT_SPEED]:1,[distExports.LightingValue.BACKLIGHT_USE_7U_SPACEBAR]:1,[distExports.LightingValue.BACKLIGHT_USE_ISO_ENTER]:1,[distExports.LightingValue.BACKLIGHT_USE_SPLIT_BACKSPACE]:1,[distExports.LightingValue.BACKLIGHT_USE_SPLIT_LEFT_SHIFT]:1,[distExports.LightingValue.BACKLIGHT_USE_SPLIT_RIGHT_SHIFT]:1,[distExports.LightingValue.BACKLIGHT_DISABLE_AFTER_TIMEOUT]:1,[distExports.LightingValue.BACKLIGHT_DISABLE_HHKB_BLOCKER_LEDS]:1,[distExports.LightingValue.BACKLIGHT_DISABLE_WHEN_USB_SUSPENDED]:1},initialState$2={lightingMap:{}},lightingSlice=createSlice({name:"lighting",initialState:initialState$2,reducers:{updateSelectedLightingData:(e,t)=>{const{lightingData:o,devicePath:n}=t.payload;e.lightingMap[n]=o},updateLighting:(e,t)=>{e.lightingMap={...e.lightingMap,...t.payload}}}}),{updateLighting,updateSelectedLightingData}=lightingSlice.actions,lightingReducer=lightingSlice.reducer,updateBacklightValue=(e,...t)=>async(o,n)=>{const s=n(),r=getSelectedConnectedDevice(s);if(!r)return;const i={...getSelectedLightingData(s),[e]:[...t]},{path:c}=r;o(updateSelectedLightingData({lightingData:i,devicePath:c}));const l=getSelectedKeyboardAPI(s);await l.setBacklightValue(e,...t),await l.saveLighting()},updateCustomColor=(e,t,o)=>async(n,s)=>{const r=s(),a=getSelectedConnectedDevice(r),i=getSelectedKeyboardAPI(r),c=getSelectedLightingData(r);if(!a||!c||!i)return;const l=[...c.customColors||[]];l[e]={hue:t,sat:o};const d={...c,customColors:l},{path:u}=a;n(updateSelectedLightingData({lightingData:d,devicePath:u})),i.setCustomColor(e,t,o),await i.saveLighting()},updateLightingData=e=>async(t,o)=>{const n=o(),s=getSelectedDefinition(n),r=getSelectedKeyboardAPI(n);if(!s||!r)return;const{path:a}=e;if(!distExports.isVIADefinitionV2(s))throw new Error("This method is only compatible with v2 definitions");const{lighting:i}=s,{supportedLightingValues:c,effects:l}=distExports.getLightingDefinition(i);if(c.length!==0){let d={};if(c.indexOf(distExports.LightingValue.BACKLIGHT_CUSTOM_COLOR)!==-1){const p=await Array(Math.max(...l.map(([C,m])=>m))).fill(0).map((C,m)=>r.getCustomColor(m));d={customColors:await Promise.all(p)}}const u=c.map(p=>({command:p,promise:r.getBacklightValue(+p,commandParamLengths[p])})),_=await Promise.all(u.map(p=>p.promise));d=u.reduce(({res:p,ref:x},C,m)=>({ref:x,res:{...p,[C.command]:x[m]}}),{res:d,ref:_}).res,t(updateLighting({[a]:{...d}}))}},getLightingMap=e=>e.lighting.lightingMap,getSelectedLightingData=createSelector(getLightingMap,getSelectedDevicePath,(e,t)=>t&&e[t]);function getIconColor(e){return{style:{color:e?"var(--bg_icon-highlighted)":"var(--bg_control)"}}}const Grid=styled.div`
  height: 100%;
  width: 100%;
  display: grid;
  grid-template-columns: min-content min-content minmax(0, 1fr);
  > div {
    pointer-events: all;
  }
`,Cell=styled.div`
  border-right: 1px solid var(--border_color_cell);
`,MenuCell=styled(Cell)`
  background: var(--bg_menu);
  border-top: 1px solid var(--border_color_cell);
`,OverflowCell=styled(Cell)`
  border-top: 1px solid var(--border_color_cell);
  overflow: auto;
`,SpanOverflowCell=styled(Cell)`
  border-top: 1px solid var(--border_color_cell);
  overflow: auto;
  grid-column: span 2;
`,SubmenuCell=styled(Cell)`
  border-top: 1px solid var(--border_color_cell);
  background: var(--bg_control);
`,SubmenuOverflowCell=styled(SubmenuCell)`
  min-width: 80px;
  overflow: auto;
`,SinglePaneFlexCell=styled(Cell)`
  display: flex;
  overflow: hidden;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  position: relative;
`,ConfigureFlexCell=styled(SinglePaneFlexCell)`
  pointer-events: none;
  height: 500px;
`,CategoryIconContainer=styled.span`
  position: relative;
  color: var(--color_inside-accent);
  height: 35px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  background: ${e=>e.$selected?"var(--color_accent)":"transparent"};
  border-radius: 10px;
  width: 40px;
  &:hover {
    color: ${e=>e.$selected?"var(--color_inside-accent)":"var(--color_accent)"};
    & .tooltip {
      transform: scale(1) translateX(0px);
      opacity: 1;
    }
  }
  .tooltip {
    transform: translateX(-5px) scale(0.6);
    opacity: 0;
  }
`,IconContainer=styled.span`
  display: inline-block;
  text-align: center;
  width: 35px;
  position: relative;
  &:hover > span > div {
    background-color: red;
  }
`,ControlRow=styled.div`
  position: relative;
  width: 100%;
  max-width: 960px;
  border-bottom: 1px solid var(--border_color_cell);
  font-size: 20px;
  justify-content: space-between;
  display: flex;
  line-height: 50px;
  min-height: 50px;
  box-sizing: border-box;
  padding-left: 5px;
  padding-right: 5px;
`,IndentedControlRow=styled(ControlRow)`
  padding-left: 17px;
`,Label$1=styled.label`
  color: var(--color_label);
  font-weight: 400;
`,SubLabel=styled(Label$1)`
  font-size: 18px;
  font-style: italic;
  font-weight: 400;
`,Detail=styled.span`
  color: var(--color_accent);
  display: flex;
  align-items: center;
`,Row=styled.div`
  cursor: pointer;
  white-space: nowrap;
  margin-bottom: 15px;
  font-size: 20px;
  line-height: 20px;
  text-transform: uppercase;
  color: ${e=>getIconColor(e.$selected).style.color};
  border-left: 2px solid transparent;

  svg {
    height: 20px;
    vertical-align: middle;
  }

  &:hover {
    color: var(--color_label-highlighted);
    & .tooltip {
      transform: scale(1) translateX(0px);
      opacity: 1;
    }
  }
  .tooltip {
    transform: translateX(-5px) scale(0.6);
    opacity: 0;
  }
`,SubmenuRow=styled(Row)`
  background: ${e=>e.$selected?"var(--bg_icon)":"inherit"};
  padding: 4px 8px;
  font-weight: 400;
  min-width: min-content;
  border-color: transparent;
  margin-bottom: 11px;
  color: ${e=>e.$selected?"var(--color_label-highlighted)":"var(--color_label)"};
  border-radius: 12px;
`,Pane$9=styled.div`
  background: var(--gradient);
  display: flex;
  flex: 1;
  flex-direction: column;
  height: 100%;
  overflow: hidden;
  background: var(--gradient);
`,CenterPane=styled(Pane$9)`
  overflow: auto;
  display: block;
`,ConfigureBasePane=styled(Pane$9)`
  flex-direction: column;
  align-items: center;
  justify-content: space-evenly;
  background: transparent;
  pointer-events: none;
  z-index: 3;
`,SvgIcLightbulbOutline24Px=e=>jsxRuntimeExports.jsx("svg",{width:11.9,height:17,...e,children:jsxRuntimeExports.jsx("path",{d:"M3.4 16.15a.853.853 0 00.85.85h3.4a.852.852 0 00.85-.85v-.85H3.4zM5.95 0a5.947 5.947 0 00-3.4 10.829v1.921a.852.852 0 00.85.85h5.1a.852.852 0 00.85-.85v-1.921A5.947 5.947 0 005.95 0zm2.422 9.435l-.722.51V11.9h-3.4V9.945l-.722-.51a4.25 4.25 0 114.845 0z",fill:"currentColor"})}),title$4="灯光",component$4=SvgIcLightbulbOutline24Px,AccentButtonBase=styled.button`
  height: 40px;
  padding: 0 15px;
  line-height: 40px;
  min-width: 100px;
  text-align: center;
  outline: none;
  font-size: 20px;
  border-radius: 5px;
  color: var(--color_accent);
  border: 1px solid var(--color_accent);
  display: inline-block;
  box-sizing: border-box;
  pointer-events: ${e=>e.disabled?"none":"auto"};
  cursor: ${e=>e.disabled?"not-allowed":"pointer"};

  &:hover {
    border: 1px solid var(--color_accent);
  }
`,AccentButton=styled(AccentButtonBase)`
  background-color: ${e=>e.disabled?"var(--bg_control-disabled)":"var(--bg_outside-accent)"};
  color: ${e=>e.disabled?"var(--bg_control)":"var(--color_accent)"};
  border-color: ${e=>e.disabled?"var(--bg_control)":"var(--color_accent)"};

  &:hover {
    filter: brightness(0.7);
  }
`,AccentButtonLarge=styled(AccentButton)`
  font-size: 24px;
  line-height: 60px;
  height: 60px;
`,PrimaryAccentButton=styled(AccentButtonBase)`
  color: ${e=>e.disabled?"var(--bg_control)":"var(--color_inside-accent)"};
  border-color: ${e=>e.disabled?"var(--bg_control)":"var(--color_accent)"};
  background-color: ${e=>e.disabled?"transparent":"var(--color_accent)"};
  &:hover {
    filter: brightness(0.7);
  }
`,Keycode$2=styled.span`
  color: var(--color_accent);
  display: flex;
  padding-left: 10px;
`,KeycodeLabel=styled.span`
  color: var(--color_label);
  display: flex;
`,Item=styled.div`
  box-sizing: border-box;
  min-width: 200px;
  padding: 5px 10px;
  display: flex;
  justify-content: space-between;
  background-color: ${e=>e.$selected?"var(--bg_control)":"var(--bg_menu)"};

  &:hover {
    background-color: var(--bg_control);
  }
`,AutocompleteItem=({selected:e,entity:{label:t,code:o}})=>jsxRuntimeExports.jsxs(Item,{$selected:e,children:[jsxRuntimeExports.jsx(KeycodeLabel,{children:t})," ",jsxRuntimeExports.jsx(Keycode$2,{children:o})]}),AutocompleteLoading=()=>jsxRuntimeExports.jsx("div",{children:"Loading"}),findKeycodes=e=>{const t=e.toUpperCase();return getAutocompleteKeycodes().filter(({name:o,title:n,code:s})=>n?n.toUpperCase().indexOf(t)>-1:o.toUpperCase().indexOf(t)>-1||s.toUpperCase().indexOf(t)>-1).slice(0,10).map(({name:o,code:n,title:s})=>({label:s||o,code:n}))},TextInput=styled.input`
  background: none;
  border: none;
  border-bottom: 1px solid var(--color_accent);
  filter: brightness(0.7);
  color: var(--color_accent);
  font-size: 1.2rem;
  margin-bottom: 1.5rem;
  padding: 0.5rem;
  transition: all 0.2s ease-out;

  &:focus {
    filter: brightness(1);
    color: var(--color_accent);
    outline: none;
  }

  &::placeholder {
    color: var(--color_control);
  }
`,ModalBackground=styled.div`
  position: fixed;
  top: 0;
  left: 0;
  background: rgba(0, 0, 0, 0.75);
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 2;
`,ModalContainer=styled.div`
  border: 2px solid var(--color_accent);
  min-width: 460px;
  max-width: 550px;
  min-height: 170px;
  gap: 20px;
  background-color: var(--bg_menu);
  border-radius: 6px;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  padding: 20px;
  box-sizing: border-box;
`,PromptText=styled.div`
  font-weight: 500;
  user-select: none;
  color: var(--color_label);
  font-size: 20px;
  text-align: center;
`,RowDiv$1=styled.div`
  display: flex;
  justify-content: center;
  align-items: center;
  width: 220px;
  gap: 20px;
`,AutocompleteContainer=styled.ul`
  position: fixed;
  background-color: var(--bg_menu);
  max-height: 210px;
  overflow: auto;
  border: 1px solid var(--bg_control);
  margin: 0;
  padding: 0;
  width: auto;
  margin-top: -24px;
  line-height: normal;
`,AutocompleteItemRow=styled.li`
  &:not(:last-child) {
    border-bottom: 1px solid var(--bg_control);
  }
`;function isHex(e){const t=e.toLowerCase();return`0x${parseInt(t,16).toString(16).toLowerCase()}`===t}function inputIsBasicByte(e,t){return e.trim().toUpperCase()in t}function basicByteFromInput(e,t){const o=e.trim().toUpperCase();return t[o]}function inputIsAdvancedKeyCode(e,t){const o=e.trim().toUpperCase();return advancedStringToKeycode(o,t)!==0}function advancedKeyCodeFromInput(e,t){const o=e.trim().toUpperCase();return advancedStringToKeycode(o,t)}function inputIsHex(e){return isHex(e.trim())}function hexFromInput(e){const t=e.toLowerCase();return parseInt(t,16)}function inputIsValid(e,t){return inputIsBasicByte(e,t)||inputIsAdvancedKeyCode(e,t)||inputIsHex(e)}function keycodeFromInput(e,t){return inputIsBasicByte(e,t)?basicByteFromInput(e,t):inputIsAdvancedKeyCode(e,t)?advancedKeyCodeFromInput(e,t):inputIsHex(e)?hexFromInput(e):null}const getInputItems=e=>e.map(t=>({code:t.code,label:t.title??t.name})),KeycodeModal=e=>{const t=useAppSelector(getSelectedDefinition),{basicKeyToByte:o,byteToKey:n}=useAppSelector(getBasicKeyToByte);if(!t)return null;const s=getInputItems(getKeycodesForKeyboard(t)),[r,a]=reactExports.useState(s),i=anyKeycodeToString(e.defaultValue,o,n),{getMenuProps:c,getInputProps:l,highlightedIndex:d,inputValue:u,getItemProps:_,isOpen:p}=useCombobox({items:r,initialIsOpen:i==="",defaultInputValue:i,itemToString:C=>(C==null?void 0:C.code)??"",onInputValueChange:({inputValue:C})=>{a(s.filter(({label:m,code:h})=>[m,h].flatMap(K=>K.split(/\s+/)).map(K=>K.toLowerCase()).some(K=>K.startsWith((C??"").toLowerCase()))))}}),x=inputIsValid(u,o);return jsxRuntimeExports.jsx(ModalBackground,{children:jsxRuntimeExports.jsxs(ModalContainer,{children:[jsxRuntimeExports.jsx(PromptText,{children:"请输入您所需的QMK键码或十六进制代码："}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx(TextInput,{...l(),type:"text",placeholder:i||"KC_NO, 0xFF, etc."})}),jsxRuntimeExports.jsx(AutocompleteContainer,{...c(),style:{display:p&&r.length?"block":"none"},children:p&&r.map((C,m)=>reactExports.createElement(AutocompleteItemRow,{..._({item:C,index:m}),key:C.code},jsxRuntimeExports.jsx(AutocompleteItem,{selected:d===m,entity:C},C.code)))})]}),jsxRuntimeExports.jsxs(RowDiv$1,{children:[jsxRuntimeExports.jsx(AccentButton,{onClick:e.onExit,children:"取消"}),jsxRuntimeExports.jsx(PrimaryAccentButton,{disabled:!x,onClick:()=>{e.onConfirm(keycodeFromInput(u,o))},children:"确认"})]})]})})},PelpiKeycodeInput=e=>{const[t,o]=React.useState(!1),{basicKeyToByte:n,byteToKey:s}=useAppSelector(getBasicKeyToByte);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(AccentButton,{onClick:()=>o(!0),children:anyKeycodeToString(e.value,n,s)}),t&&jsxRuntimeExports.jsx(KeycodeModal,{defaultValue:e.value,onChange:e.setValue,onConfirm:r=>{e.setValue(r),o(!1)},onExit:()=>o(!1)})]})},HiddenInput=styled.input`
  opacity: 0;
  width: 0;
  height: 0;
`,Switch=styled.label`
  position: relative;
  display: inline-block;
  width: 60px;
  height: 34px;
`,Slider=styled.span`
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: ${e=>e.$ischecked?"var(--color_accent)":"var(--bg_control)"};
  -webkit-transition: 0.4s;
  transition: 0.4s;
  border-radius: 4px;
  &:before {
    position: absolute;
    content: '';
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    border-radius: 4px;
    background-color: ${e=>e.$ischecked?"var(--color_inside-accent)":"var(--bg_icon)"};
    -webkit-transition: 0.4s;
    transition: 0.4s;
    ${e=>e.$ischecked?"transform: translateX(26px)":""};
  }
`;function AccentSlider(e){const{isChecked:t,onChange:o}=e,[n,s]=React.useState(t),r=reactExports.useRef(null);React.useEffect(()=>{s(t)},[t]);const a=()=>{const i=!t;s(i),o(i),r.current&&r.current.blur()};return jsxRuntimeExports.jsxs(Switch,{children:[jsxRuntimeExports.jsx(HiddenInput,{ref:r,type:"checkbox",checked:n,onChange:a}),jsxRuntimeExports.jsx(Slider,{$ischecked:n})]})}const customStyles={option:(e,t)=>({...e,"&:hover":{backgroundColor:t.isSelected?"var(--color_accent)":"var(--bg_control)"},":active":{backgroundColor:"var(--bg_control)"},background:t.isSelected?"var(--color_accent)":t.isFocused?"var(--bg_control)":"var(--bg_menu)",color:t.isSelected?"var(--color_inside-accent)":(t.isFocused,"var(--color_accent)")}),container:e=>({...e,lineHeight:"initial",flex:1}),input:e=>({...e,color:"var(--color_accent)",opacity:.5}),singleValue:e=>({...e,color:"var(--color_accent)"}),dropdownIndicator:e=>({...e,color:"var(--color_accent)"}),indicatorSeparator:e=>({...e,backgroundColor:"var(--color_accent)"}),menuList:e=>({...e,borderColor:"var(--color_accent)",backgroundColor:"var(--bg_menu)"}),placeholder:e=>({...e,color:"var(--color_accent)"}),valueContainer:e=>({...e,":active":{backgroundColor:"var(--bg_control)",borderColor:"var(--color_accent)"},"&:hover":{borderColor:"var(--color_accent)"},color:"var(--color_accent)",background:"var(--bg_menu)"}),control:(e,t)=>({...e,boxShadow:"none",":active":{backgroundColor:"transparent",borderColor:"var(--color_accent)"},"&:hover":{borderColor:"var(--color_accent)"},color:"var(--color_accent)",borderColor:"1px solid var(--color_accent)",background:"var(--bg_menu)",overflow:"hidden",width:t.selectProps.width||250})},AccentSelect=e=>jsxRuntimeExports.jsx(StateManagedSelect$1,{...e,styles:customStyles}),Container$f=styled.span`
  display: inline-block;
  line-height: initial;
  width: 200px;
`,SliderInput=styled.input.attrs({type:"range"})`
  accent-color: var(--color_accent);
  width: 100%;
`,AccentRange=e=>jsxRuntimeExports.jsx(Container$f,{children:jsxRuntimeExports.jsx(SliderInput,{...e,onChange:t=>{e.onChange&&e.onChange(+t.target.value)}})}),ColorPickerContainer=styled.div`
  display: flex;
  align-items: center;
`,ColorLens=styled.div`
  position: absolute;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  border: 2px solid black;
  opacity: 0.7;
  background: rgba(255, 255, 255, 0.2);
  pointer-events: none;
  box-sizing: border-box;
  transform: translate3d(195px, 195px, 0);
`,ColorInner=styled.div`
  width: 100%;
  height: 100%;
  background: linear-gradient(to top, white, rgba(0, 0, 0, 0));
`,ColorOuter=styled.div`
  width: 100%;
  height: 100%;
  background: linear-gradient(
    to right,
    red,
    yellow,
    lime,
    aqua,
    blue,
    magenta,
    red
  );
`,ColorThumbnail=styled.div`
  display: inline-block;
  height: 25px;
  width: 25px;
  border-radius: 50%;
  border: 4px solid var(--border_color_cell);
  cursor: pointer;
  &:hover {
    opacity: 0.8;
  }
`,Container$e=styled.div`
  border: 4px solid var(--border_color_cell);
  width: 180px;
  height: 180px;
  position: relative;
`,PickerContainer=styled.div`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  z-index: 1;
  box-shadow: rgba(0, 0, 0, 0.11) 0 1px 1px 1px;
  position: absolute;
  transform: translate3d(-205px, 50px, 0);

  &::after {
    content: '';
    position: absolute;
    width: 0px;
    height: 0px;
    border: 11px solid var(--border_color_cell);
    border-top-color: transparent;
    border-bottom-color: transparent;
    border-right-color: transparent;
    right: -22px;
    top: 66px;
  }
`,ColorPreview=styled.div`
  width: 180px;
  height: 24px;
  border: 4px solid var(--border_color_cell);
  border-bottom: none;
`,ColorHexContainer=styled.div`
  border: 4px solid var(--border_color_cell);
  border-bottom: none;
  width: 180px;
  height: 32px;
  line-height: 32px;
  text-align: center;
  background: var(--bg_menu);
`,ColorHexInput=styled.input`
  text-align: center;
  border: none;
  color: var(--color_accent);
  background: var(--bg_menu);
  font-size: 20px;
  font-weight: 300;
  padding: 0;
  width: 100%;
  &:focus {
    outline: none;
    color: var(--color_accent);
    border-color: var(--color_accent);
  }
`;class ColorPicker extends reactExports.Component{constructor(){super(...arguments);E(this,"ref",null);E(this,"refWidth",0);E(this,"refHeight",0);E(this,"mouseDown",!1);E(this,"state",{lensTransform:"",showPicker:!1,offset:[5,5],hexColorCode:getHex(this.props.color)});E(this,"onMouseMove",o=>{if(this.mouseDown){const{offsetX:n,offsetY:s}=o.nativeEvent,r=`translate3d(${n-5}px, ${s-5}px, 0)`,a=[n,s],{hue:i,sat:c}=this.getLinearHueSat(a),l=getHex(this.props.color);this.props.setColor(Math.round(255*(i/360)),Math.round(255*c)),this.setState({lensTransform:r,offset:a,hexColorCode:l})}});E(this,"onMouseDown",o=>{this.mouseDown=!0,this.onMouseMove(o),this.ref&&(this.ref.style.cursor="pointer")});E(this,"onMouseUp",()=>{if(this.mouseDown=!1,this.ref&&(this.ref.style.cursor="auto"),this.props.onMouseUp){const{hue:o,sat:n}=this.getLinearHueSat(this.state.offset);this.props.onMouseUp(o,n)}});E(this,"onThumbnailClick",()=>{this.props.onOpen&&this.props.onOpen(),this.setState({showPicker:!0})});E(this,"pickerContainer",React.createRef());E(this,"colorThumbnail",React.createRef());E(this,"onDocumentClick",o=>{if(this.state.showPicker&&this.pickerContainer.current&&!this.pickerContainer.current.contains(o.target)&&this.colorThumbnail.current&&!this.colorThumbnail.current.contains(o.target)&&!this.mouseDown){if(this.props.onClose){const{hue:n,sat:s}=this.getLinearHueSat(this.state.offset);this.props.onClose(n,s)}this.mouseDown=!1,this.setState({showPicker:!1,hexColorCode:getHex(this.props.color)})}else this.mouseDown&&this.state.showPicker&&this.pickerContainer.current&&!this.pickerContainer.current.contains(o.target)&&this.colorThumbnail.current&&!this.colorThumbnail.current.contains(o.target)&&this.onMouseUp()});E(this,"handleHexChange",o=>{let n=o.target.value;n=n.replace(/[^A-Fa-f0-9]/g,""),n.length>0&&n[0]!=="#"&&(n=`#${n}`),n.length>7&&(n=n.substring(0,7)),this.setState({hexColorCode:n})});E(this,"handleHexBlur",o=>{this.setState({hexColorCode:getHex(this.props.color)})});E(this,"handleHexSubmit",o=>{if(o.key==="Enter"){if(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(this.state.hexColorCode)){var n=this.state.hexColorCode.replace("#","");n.length==3&&(n=`${n.split("").map(i=>i+i).join("")}`);const[r,a]=getHSV(n);this.props.setColor(Math.round(255*(r/360)),Math.round(255*a))}this.setState({hexColorCode:getHex(this.props.color)})}})}componentWillUnmount(){document.removeEventListener("mousedown",this.onDocumentClick),document.removeEventListener("click",this.onDocumentClick)}componentDidUpdate({color:o},n){if(this.ref&&this.state.showPicker&&(!n.showPicker||o!==this.props.color)){const{width:s,height:r}=this.ref.getBoundingClientRect();this.refWidth=s,this.refHeight=r;const{hue:a,sat:i}=this.props.color,c=s*a/255,l=r*(1-i/255),d=`translate3d(${c-5}px, ${l-5}px, 0)`;this.setState({lensTransform:d,offset:[c,l]})}}componentDidMount(){document.addEventListener("click",this.onDocumentClick),document.addEventListener("mousedown",this.onDocumentClick)}getRadialHueSat(o){const{offsetX:n,offsetY:s}=o.nativeEvent,r=toDegrees(calcRadialHue(n,s)??0),a=Math.min(1,calcRadialMagnitude(n,s)??0);return{hue:r,sat:a}}getLinearHueSat([o,n]){const s=this.refWidth,r=this.refHeight,[a,i]=[Math.max(0,o),Math.max(0,n)],c=360*Math.min(1,a/s),l=1-Math.min(1,i/r);return{hue:c,sat:l}}render(){const o=getRGB(this.props.color),{isSelected:n=!1}=this.props,{offset:s}=this.state,r=`translate3d(${s[0]-5}px, ${s[1]-5}px, 0)`;return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsxs(ColorPickerContainer,{children:[jsxRuntimeExports.jsx(ColorThumbnail,{ref:this.colorThumbnail,onClick:this.onThumbnailClick,style:{background:o,borderColor:n?"var(--color_accent)":"var(--border_color_cell)"}}),this.state.showPicker&&jsxRuntimeExports.jsxs(PickerContainer,{ref:this.pickerContainer,onMouseUp:this.onMouseUp,children:[jsxRuntimeExports.jsx(ColorHexContainer,{children:jsxRuntimeExports.jsx(ColorHexInput,{type:"text",value:this.state.hexColorCode,onChange:this.handleHexChange,onBlur:this.handleHexBlur,onKeyDown:this.handleHexSubmit})}),jsxRuntimeExports.jsx(ColorPreview,{style:{background:getRGB(this.props.color)}}),jsxRuntimeExports.jsx(Container$e,{children:jsxRuntimeExports.jsx(ColorOuter,{onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,ref:a=>this.ref=a,children:jsxRuntimeExports.jsx(ColorInner,{children:jsxRuntimeExports.jsx(ColorLens,{style:{transform:r}})})})})]})]})})}}const ArrayColorPicker=e=>{const{color:t,setColor:o}=e;return jsxRuntimeExports.jsx(ColorPicker,{color:{hue:t[0],sat:t[1]},setColor:o})},ColorPalettePickerContainer=styled.div`
  display: flex;
  align-items: center;
  column-gap: 10px;
`,PreviousColorContainer=styled.div`
  display: flex;
  background: var(--bg_control);
  border-radius: 15px;
`,PreviousColorOption=styled.div`
  display: inline-block;
  height: 25px;
  width: 25px;
  border-radius: 50%;
  border: 4px solid var(--border_color_cell);
  cursor: pointer;
  transition: transform 0.2s ease-out;
  &:hover {
    opacity: 0.8;
  }
  transform: ${e=>e.$selected?"scale(0.8)":"scale(0.6)"};
  border-color: ${e=>e.$selected?"var(--color_accent)":"var(--border_color_cell)"};
`,ConnectedColorPalettePicker=()=>{const e=useDispatch(),t=reactExports.useCallback((o,n)=>e(setSelectedPaletteColor([o,n])),[e]);return reactExports.useEffect(()=>(e(updateShowKeyPainter(!0)),()=>{e(updateShowKeyPainter(!1))})),jsxRuntimeExports.jsx(ColorPalettePicker,{color:[0,0],setColor:t})},ColorPalettePicker=e=>{const{color:t,setColor:o}=e,[n,s]=reactExports.useState(t),[r,a]=reactExports.useState(t),i=reactExports.useMemo(()=>Array(9).fill(0).map((c,l)=>[Math.round(l*255/10),255,255]),[]);return jsxRuntimeExports.jsxs(ColorPalettePickerContainer,{children:[jsxRuntimeExports.jsx(PreviousColorContainer,{children:i.map((c,l)=>{const d=n[0]===c[0]&&n[1]===c[1];return jsxRuntimeExports.jsx(PreviousColorOption,{$selected:d,style:{background:getRGB({hue:c[0]??0,sat:c[1]??0})},onClick:()=>{s(c),o(c[0],c[1])}},l)})}),jsxRuntimeExports.jsx(ColorPicker,{isSelected:r[0]===n[0]&&r[1]===n[1],color:{hue:r[0],sat:r[1]},setColor:(c,l)=>{s([c,l]),a([c,l])},onOpen:()=>{s([r[0],r[1]]),o(r[0],r[1])},onMouseUp:()=>{s([r[0],r[1]]),o(r[0],r[1])}})]})},VIACustomItem=React.memo(e=>jsxRuntimeExports.jsxs(ControlRow,{id:e._id,children:[jsxRuntimeExports.jsx(Label$1,{children:e.label}),jsxRuntimeExports.jsx(Detail,{children:"type"in e?jsxRuntimeExports.jsx(VIACustomControl,{...e,value:e.value&&Array.from(e.value)}):e.content})]})),boxOrArr=e=>Array.isArray(e)?e:[e],valueIsChecked=(e,t)=>boxOrArr(e).every((o,n)=>o==t[n]),getRangeValue=(e,t)=>t>255?shiftTo16Bit([e[0],e[1]]):e[0],getRangeBytes=(e,t)=>t>255?shiftFrom16Bit(e):[e],VIACustomControl=e=>{const{content:t,type:o,options:n,value:s}=e,[r,...a]=t;switch(o){case"button":{const i=n||[1];return jsxRuntimeExports.jsx(AccentButton,{onClick:()=>e.updateValue(r,...a,i[0]),children:"Click"})}case"range":return jsxRuntimeExports.jsx(AccentRange,{min:n[0],max:n[1],defaultValue:getRangeValue(e.value,n[1]),onChange:i=>e.updateValue(r,...a,...getRangeBytes(i,n[1]))});case"keycode":return jsxRuntimeExports.jsx(PelpiKeycodeInput,{value:shiftTo16Bit([e.value[0],e.value[1]]),meta:{},setValue:i=>e.updateValue(r,...a,...shiftFrom16Bit(i))});case"toggle":{const i=n||[0,1];return jsxRuntimeExports.jsx(AccentSlider,{isChecked:valueIsChecked(i[1],e.value),onChange:c=>e.updateValue(r,...a,...boxOrArr(i[+c]))})}case"dropdown":{const i=n.map((c,l)=>{const[d,u]=typeof c=="string"?[c,l]:c;return{value:u||l,label:d}});return jsxRuntimeExports.jsx(AccentSelect,{onChange:c=>c&&e.updateValue(r,...a,+c.value),options:i,defaultValue:i.find(c=>s[0]===c.value)})}case"color":return jsxRuntimeExports.jsx(ArrayColorPicker,{color:e.value,setColor:(i,c)=>e.updateValue(r,...a,i,c)});case"color-palette":return jsxRuntimeExports.jsx(ConnectedColorPalettePicker,{})}return null},CustomPane=styled(CenterPane)`
  height: 100%;
  background: var(--color_dark_grey);
`,Container$d=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`;function categoryGenerator(e){return e.viaMenu.content.flatMap(t=>submenuGenerator(t,e))}function itemGenerator(e,t){return"showIf"in e&&!distExports$1.evalExpr(e.showIf,t.selectedCustomMenuData)?[]:"label"in e?{...e,key:e._id}:e.content.flatMap(o=>itemGenerator(o,t))}const MenuComponent=React.memo(e=>jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:e.elem.content.flatMap(t=>itemGenerator(t,e)).map(t=>jsxRuntimeExports.jsx(VIACustomItem,{...t,updateValue:e.updateCustomMenuValue,value:e.selectedCustomMenuData[t.content[0]]}))})),MenuBuilder=e=>t=>reactExports.createElement(MenuComponent,{...t,key:e._id,elem:e});function submenuGenerator(e,t){return"showIf"in e&&!distExports$1.evalExpr(e.showIf,t.selectedCustomMenuData)?[]:"label"in e?{label:e.label,Menu:MenuBuilder(e)}:e.content.flatMap(o=>submenuGenerator(o,t))}const Pane$8=e=>{const t=useAppDispatch(),o=categoryGenerator(e),[n,s]=reactExports.useState(o[0]||{label:"",Menu:()=>jsxRuntimeExports.jsx("div",{})}),r=n.Menu,a=useAppSelector(getSelectedDefinition),i=useAppSelector(getSelectedCustomMenuData),c={...e,selectedDefinition:a,selectedCustomMenuData:i,updateCustomMenuValue:(l,...d)=>t(updateCustomMenuValue(l,...d))};return!a||!i?null:jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(SubmenuCell,{children:jsxRuntimeExports.jsx(MenuContainer$5,{children:o.map(l=>jsxRuntimeExports.jsx(SubmenuRow,{$selected:n.label===l.label,onClick:()=>s(l),children:l.label},l.label))})}),jsxRuntimeExports.jsx(OverflowCell,{children:jsxRuntimeExports.jsx(CustomPane,{children:jsxRuntimeExports.jsx(Container$d,{children:r(c)})})})]})},MenuContainer$5=styled.div`
  padding: 15px 10px 20px 10px;
`,iconKeywords=[{icon:faLightbulb,keywords:["light","rgb"]},{icon:faHeadphones,keywords:["audio","sound"]},{icon:faDisplay,keywords:["display","oled","lcd"]}],getIconFromLabel=e=>{const t=e.label.toLowerCase(),o={icon:faMicrochip};return(iconKeywords.find(n=>n.keywords.some(s=>t.includes(s)))||o).icon},makeCustomMenu=(e,t)=>({Title:e.label,Icon:()=>jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:getIconFromLabel(e)}),Pane:o=>reactExports.createElement(Pane$8,{...o,key:`${e.label}-${t}`,viaMenu:e})}),makeCustomMenus=e=>e.map(makeCustomMenu),initialState$1={customMenuDataMap:{},commonMenusMap:{},showKeyPainter:!1},menusSlice=createSlice({name:"menus",initialState:initialState$1,reducers:{updateShowKeyPainter:(e,t)=>{e.showKeyPainter=t.payload},updateSelectedCustomMenuData:(e,t)=>{const{devicePath:o,menuData:n}=t.payload;e.customMenuDataMap[o]=n},updateCommonMenus:(e,t)=>{const{commonMenuMap:o}=t.payload;e.commonMenusMap=o},updateCustomMenuData:(e,t)=>{e.customMenuDataMap={...e.customMenuDataMap,...t.payload}}}}),{updateShowKeyPainter,updateSelectedCustomMenuData,updateCustomMenuData}=menusSlice.actions,menusReducer=menusSlice.reducer,updateCustomMenuValue=(e,...t)=>async(o,n)=>{const s=n(),r=getSelectedConnectedDevice(s);if(!r)return;const a=getSelectedCustomMenuData(s),i=getCustomCommands(s),c={...a,[e]:[...t.slice(i[e].length)]},{path:l}=r;o(updateSelectedCustomMenuData({menuData:c,devicePath:l}));const d=getSelectedKeyboardAPI(s);d.setCustomMenuValue(...t.slice(0));const u=t[0];d.commitCustomMenu(u)},tryResolveCommonMenu=e=>typeof e=="string"?distExports.commonMenus[e]:e,updateV3MenuData=e=>async(t,o)=>{const n=o(),s=getSelectedDefinition(n),r=getSelectedKeyboardAPI(n);if(!distExports.isVIADefinitionV3(s))throw new Error("V3 menus are only compatible with V3 VIA definitions.");const i=getV3Menus(n).flatMap(extractCommands),{protocol:c,path:l}=e;if(i.length!==0&&c>=11){let d={};const u=i.map(([x,C,...m])=>({command:x,promise:r.getCustomMenuValue([C].concat(m))})),_=await Promise.all(u.map(x=>x.promise));d=u.reduce(({res:x,ref:C},m,h)=>({ref:C,res:{...x,[m.command]:C[h].slice(1)}}),{res:d,ref:_}).res;const p=Math.max(...s.layouts.keys.map(x=>x.li??-1));if(console.debug(p,"maxLedIndex"),p>=0){const x=await r.getPerKeyRGBMatrix(Array(p+1).fill(0).map((C,m)=>m));d.__perKeyRGB=x}t(updateSelectedCustomMenuData({devicePath:l,menuData:{...d}}))}},extractCommands=e=>typeof e=="string"?[]:"type"in e?[e.content]:"content"in e&&typeof e.content!="string"?e.content.flatMap(extractCommands):[],getShowKeyPainter=e=>e.menus.showKeyPainter,getCustomMenuDataMap=e=>e.menus.customMenuDataMap,getSelectedCustomMenuData=createSelector(getCustomMenuDataMap,getSelectedDevicePath,(e,t)=>t&&e[t]),getV3Menus=createSelector(getSelectedDefinition,e=>!e||!distExports.isVIADefinitionV3(e)?[]:(e.menus||[]).flatMap(tryResolveCommonMenu).map((t,o)=>distExports.isVIAMenu(t)?compileMenu("custom_menu",3,t,o):t)),getV3MenuComponents=createSelector(getSelectedDefinition,e=>!e||!distExports.isVIADefinitionV3(e)?[]:(e.menus||[]).flatMap(tryResolveCommonMenu).map((t,o)=>distExports.isVIAMenu(t)?makeCustomMenu(compileMenu("custom_menu",3,t,o),o):t)),getCustomCommands=createSelector(getSelectedDefinition,getV3Menus,(e,t)=>{if(!e)return[];const o=distExports.isVIADefinitionV2(e)?e.customMenus:t;return o===void 0?[]:o.flatMap(extractCommands).reduce((n,s)=>({...n,[s[0]]:s.slice(1)}),{})}),compileMenu=(e,t=0,o,n)=>t===0?o:{...o,_id:`${e}_${n}`,content:o.label!==void 0?typeof o.content=="string"?o.content:o.content.map((s,r)=>compileMenu(`${e}_${r}`,t-1,s,n)):o.content.map((s,r)=>compileMenu(`${e}_${r}`,t,s,n))},initialState={showMatrix:!1,selectedOptionKeys:[],selectedDefinitionIndex:0},designSlice=createSlice({name:"design",initialState,reducers:{updateSelectedDefinitionIndex:(e,t)=>{e.selectedDefinitionIndex=t.payload},updateSelectedOptionKeys:(e,t)=>{e.selectedOptionKeys=t.payload},updateShowMatrix:(e,t)=>{e.showMatrix=t.payload}}}),{updateSelectedDefinitionIndex,updateSelectedOptionKeys,updateShowMatrix}=designSlice.actions,designReducer=designSlice.reducer,getSelectedDefinitionIndex=e=>e.design.selectedDefinitionIndex,getDesignSelectedOptionKeys=e=>e.design.selectedOptionKeys,getShowMatrix=e=>e.design.showMatrix,formatNumberAsHex=(e,t)=>`0x${e.toString(16).padStart(t,"0").toUpperCase()}`,errorsListenerMiddleware=createListenerMiddleware(),captureError=(e,t)=>{console.error("Error captured:",{message:e,deviceInfo:{productName:t.productName,vendorId:formatNumberAsHex(t.vendorId,4),protocol:t.protocol}})};errorsListenerMiddleware.startListening({actionCreator:logAppError,effect:async({payload:{message:e,deviceInfo:t}},o)=>{captureError(e,t)}});errorsListenerMiddleware.startListening({actionCreator:logKeyboardAPIError,effect:async({payload:e},t)=>{captureError(extractMessageFromKeyboardAPIError(e),e.deviceInfo)}});const store=configureStore({reducer:{settings:settingsReducer,macros:macrosReducer,devices:devicesReducer,keymap:keymapReducer,definitions:definitionsReducer,lighting:lightingReducer,menus:menusReducer,design:designReducer,errors:errorsReducer},middleware:e=>e().prepend(errorsListenerMiddleware.middleware)}),defaultChippy={width:450,height:450},LoaderContainer=styled.div`
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
`,CircleContainer=styled.div`
  border-radius: 50%;
  background-color: #70707000;
  height: 450px;
  width: 450px;
  position: relative;
  overflow: hidden;
  box-sizing: border-box;
  display: flex;
  align-items: center;
  justify-content: center;

  animation-duration: 1.5s;
  animation-name: roll;
  animation-iteration-count: infinite;
  animation-direction: alternate;
  animation-timing-function: ease-in-out;

  &::after {
    height: ${e=>e.$containerHeight}px;
    width: ${e=>e.$containerWidth}px;
    position: absolute;
    content: '';
    background-color: ${e=>e.$progressColor};
    top: ${e=>e.$containerHeight+1}px;
    left: 0;
    right: 0;
    transition: transform 0.4s ease-out;
    transform: translate3d(
      0,
      ${e=>-(e.$progress||0)*e.$containerHeight}px,
      0
    );
  }
`,SvgComponent=e=>{const{theme:t}=e,o=getDarkenedColor(t.accent.c,.8),n={"upper-body":t.mod.t,"lower-body":t.mod.c,accent:o,bowtie:o};return jsxRuntimeExports.jsxs("svg",{id:"Layer_1",xmlns:"http://www.w3.org/2000/svg",x:0,y:0,viewBox:"0 0 600 600",style:{enableBackground:"new 0 0 600 600"},xmlSpace:"preserve",...e,children:[jsxRuntimeExports.jsx("style",{children:`.st3{fill:#fdfefe}.st4{fill:${n.bowtie}}.st5{fill-rule:evenodd;clip-rule:evenodd;fill:${n.accent}}.st7,.st9{fill-rule:evenodd;clip-rule:evenodd}.st10,.st9{fill:#fff}`}),jsxRuntimeExports.jsx("rect",{x:"0",y:"0",width:"601.77",height:"601.77",rx:"300.88",ry:"300.88",display:"none",fill:"#f5a917"}),jsxRuntimeExports.jsx("polygon",{points:"560.89 381.9 593.5 374.07 600.89 332.19 572.91 313.68 572.21 313.56 572.21 288.21 572.91 288.09 600.89 269.57 593.5 227.7 560.89 219.87 559.84 220.05 551.21 196.35 552.13 195.82 572.09 168.85 550.83 132.03 517.5 135.83 516.28 136.53 500.14 117.3 501.05 116.22 510.57 84.06 478 56.73 447.98 71.7 446.89 72.99 425.24 60.49 425.82 58.9 423.77 25.42 383.81 10.87 360.72 35.21 360.08 36.98 335.98 32.73 335.98 30.76 335.52 30.76 322.14 0 279.62 0 266.25 30.76 266.25 32.73 241.72 37.05 241.04 35.21 217.95 10.87 178 25.42 175.95 58.9 176.61 60.71 155.02 73.17 153.79 71.7 123.77 56.73 91.19 84.06 100.72 116.22 101.86 117.58 85.8 136.71 84.27 135.83 50.94 132.03 29.68 168.85 49.63 195.82 50.94 196.57 42.37 220.13 40.88 219.87 8.26 227.7 .88 269.57 28.85 288.09 30.02 288.29 30.02 313.47 28.85 313.68 .88 332.19 8.26 374.07 40.88 381.9 41.7 381.76 50.35 405.53 49.63 405.95 29.68 432.91 50.94 469.74 84.27 465.94 84.69 465.7 101.03 485.17 100.72 485.54 91.19 517.71 123.77 545.04 153.79 530.07 153.92 529.92 176.02 542.68 175.95 542.87 178 576.35 217.95 590.89 241.04 566.56 241.05 566.55 266.25 571 266.25 571 266.25 572.96 267.1 572.96 279.62 601.77 322.14 601.77 334.67 572.96 335.98 572.96 335.98 571 360.78 566.62 383.81 590.89 423.77 576.35 425.82 542.9 448.01 530.09 478 545.04 510.57 517.71 501.05 485.54 500.97 485.45 517.39 465.88 517.5 465.94 550.83 469.74 572.09 432.91 552.13 405.95 551.8 405.75 560.51 381.83 560.89 381.9",fill:"#f5a917"}),jsxRuntimeExports.jsxs("g",{children:[jsxRuntimeExports.jsx("path",{d:"M410.37,440.82c10.27-.6,19.31-6.38,24.15,6.08,8.24,21.16-24.99,23.34-38.55,21.98-2.57-.26-15.41-3.28-16.14-5.39-1.19-14.81,7.14-28.3,11.71-41.9,13.06-38.9,12.3-67.73-1.04-106.24-4.19-12.1-13.25-28.26-11.39-41.18,2.29-15.86,24.15-26.53,37.31-32.24,25.89-11.25,48.79-9.08,38.87-46.03-2.34-8.72-6.33-16.95-10.18-25.04-6.49,1.24-14.39,1.14-21.12.86-32.12-1.32-44.82-11.28-72.83-20.75-69.72-23.58-118.79,76.29-66.6,111.32,17.66,11.86,35.58,6.06,40.13-15.2,1.12-5.23,1.34-23.75,6.16-26.14,4.28-2.11,8.91,2.64,10.14,6.44,2.71,8.38-1.11,25.88-4.1,34.38-18.49,52.59-79.7,29.15-90.92-15.55-9.44-37.62,14.36-81.42,45.36-102.05,42.43-28.22,67.4,3.47,108.63,6.02,6.73.42,15.66.32,22.43,0,3.51-.17,14.56-.86,17.2-1.85,1.01-.38,3.87-4.86,6.92-6.33,11.08-5.35,22.74,4.38,22.71,16.02-.04,15.32,2.03,17.47,5.66,31.53,15.36,59.59-16.42,56.84-58.7,76.14-4.47,2.04-21.1,10.71-22.26,15.06-1.06,3.95,13.03,33.34,15.4,39.77,5.25,14.23,10.81,32.7,11.79,47.83,1.59,24.36-4.36,49.17-10.76,72.44h.01Z",fill:"#003235"}),jsxRuntimeExports.jsx("path",{d:"M299.12,311.37c-3.19,3.24-12.5,3.53-17.11,4.83-36.62,10.35-62.26,45.39-72.63,80.57-4.29,14.55-7.31,31.02-3.55,45.95.67,1.29,6.18,1.93,7.98,2.16,17.91,2.28,57.92,1.22,74.84-4.44,16.68-5.58,21.56-31.58,10.35-44.32-5.63-6.39-15.46-7.18-18.43-16.15,10.68-10.83,29.1,4.43,36.21,13.28,11.92,14.85,9.89,30.15,5.82,47.6,8.13-1.17,19.84-5.05,24.86,3.71,5.88,10.25.03,19.71-10.78,22.39-16.3,4.05-38.71,1.21-55.94,1.2-31.77-.03-65.8,2.22-97.67.03-8.64-.59-19.46-3.19-27.47-6.48-47.27-19.43-34.96-75.86-14.34-111.09l1.65.41c.34,11.19-2.76,22.21-4.02,33.24-2.39,20.83-3.11,38.75,13.95,53.72,31.34,27.5,31.34-25.14,36.03-43.49,10.07-39.43,51.9-88.06,94.42-91.9,5.2-.47,25.18-.64,15.85,8.81h0Z",fill:"#003235"}),jsxRuntimeExports.jsx("path",{d:"M365.36,168.69c17.86-.75,17.6,26.3.72,26.59-17.13.3-17.77-25.88-.72-26.59Z",fill:"#003235"})]})]})};function ChippyLoader(e){const t=e.width||defaultChippy.width,o=e.width||defaultChippy.height,n=t*.25,[s,r]=[o+n*2,t+n*2],a=useAppSelector(getSelectedTheme);return jsxRuntimeExports.jsx(LoaderContainer,{children:jsxRuntimeExports.jsx(CircleContainer,{$progress:e.progress,$progressColor:getDarkenedColor(a.accent.c,.9),$containerHeight:s,$containerWidth:r,children:jsxRuntimeExports.jsx("div",{style:{zIndex:1,width:t},children:jsxRuntimeExports.jsx(SvgComponent,{theme:e.theme})})})})}const LoadingText=styled.div`
  font-size: 30px;
  color: var(--color_label-highlighted);
`;function LoadingText$1(e){return jsxRuntimeExports.jsx(LoadingText,{"data-tid":"loading-message",children:e.isSearching?"Searching for devices...":"Loading..."})}const Button=styled.div`
  display: flex;
  transition: transform 0.2s ease-out;
  user-select: none;
  color: #717070;
  border: 1px #717070 solid;
  width: 45px;
  height: 45px;
  padding: 2px;
  margin: 2px;
  text-overflow: ellipsis;
  overflow: hidden;
  cursor: pointer;
  font-size: 12px;
  text-align: center;
  border-radius: 4px;
  justify-content: center;
  align-items: center;
  white-space: pre-wrap;
  box-shadow: #8c8c8c 0 1px 0 0;
  &:hover {
    transform: translate3d(0, -2px, 0);
  }
`,title$3="按键",component$3=e=>jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faBook}),Message$1=styled.span`
  font-size: 18px;
  margin: 8px;
  text-align: center;
`,ErrorMessage=styled(Message$1)`
  color: #d15e5e;
`,SuccessMessage=styled(Message$1)`
  color: #9ab46a;
`,Encoder=styled(CenterPane)`
  height: 100%;
  background: var(--color_dark_grey);
`,Container$c=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`,renderEncoderError=()=>jsxRuntimeExports.jsx(ErrorMessage,{children:"您当前的固件不支持旋钮。更新您的设备的固件来支持。"}),Pane$7=()=>{const[e,t]=reactExports.useState(),[o,n]=reactExports.useState(),s=useAppSelector(getSelectedKey),r=useAppDispatch(),a=useAppSelector(getSelectedKeyDefinitions),i=useAppSelector(m=>getSelectedKeymap(m)||[]),c=useAppSelector(getSelectedLayerIndex),l=useAppSelector(getSelectedConnectedDevice),d=useAppSelector(getSelectedKeyboardAPI),u=i[s??-1],_=a[s??-1],p=!!_&&_.col!==-1&&_.row!==-1,x=(m,h)=>{if(d&&s!==null&&_&&_.ei!==void 0){const K=+_.ei;switch(m){case"ccw":{d.setEncoderValue(c,K,!1,h),n(h);break}case"cw":{d.setEncoderValue(c,K,!0,h),t(h);break}case"click":{r(updateKey(s,h));break}}}},C=async(m,h,K)=>{const y=await K.getEncoderValue(m,h,!0),g=await K.getEncoderValue(m,h,!1);t(y),n(g)};return reactExports.useEffect(()=>{if(l&&l.protocol>=10&&_!==void 0&&_.ei!==void 0&&d){const m=+_.ei;C(c,m,d)}},[_,l,c]),_===void 0||l&&l.protocol<10||o===void 0||e===void 0?jsxRuntimeExports.jsx(SpanOverflowCell,{children:renderEncoderError()}):jsxRuntimeExports.jsx(SpanOverflowCell,{children:jsxRuntimeExports.jsx(Encoder,{children:jsxRuntimeExports.jsxs(Container$c,{children:[jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"逆时针旋转"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(PelpiKeycodeInput,{value:o,meta:{},setValue:m=>x("ccw",m)})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"顺时针旋转"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(PelpiKeycodeInput,{value:e,meta:{},setValue:m=>x("cw",m)})})]}),p&&jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"按下"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(PelpiKeycodeInput,{value:u,meta:{},setValue:m=>x("click",m)})})]})]})})})},KeycodeList=styled.div`
  display: grid;
  grid-template-columns: repeat(auto-fill, 64px);
  grid-auto-rows: 64px;
  justify-content: center;
  grid-gap: 10px;
`,MenuContainer$4=styled.div`
  padding: 15px 20px 20px 10px;
`,Keycode=styled(Button)`
  width: 50px;
  height: 50px;
  line-height: 18px;
  border-radius: 64px;
  font-size: 14px;
  border: 4px solid var(--border_color_icon);
  background: var(--bg_control);
  color: var(--color_label-highlighted);
  margin: 0;
  box-shadow: none;
  position: relative;
  border-radius: 10px;
  &:hover {
    border-color: var(--color_accent);
    transform: translate3d(0, -2px, 0);
  }
  ${e=>e.disabled&&"cursor:not-allowed;filter:opacity(50%);"}
`,KeycodeContent=styled.div`
  text-overflow: ellipsis;
  overflow: hidden;
`,CustomKeycode=styled(Button)`
  width: 50px;
  height: 50px;
  line-height: 18px;
  border-radius: 10px;
  font-size: 14px;
  border: 4px solid var(--border_color_icon);
  background: var(--color_accent);
  border-color: var(--color_inside_accent);
  color: var(--color_inside_accent);
  margin: 0;
`,KeycodeContainer=styled.div`
  padding: 12px;
  padding-bottom: 30px;
`,KeycodeDesc=styled.div`
  position: fixed;
  bottom: 0;
  background: #d9d9d97a;
  box-sizing: border-box;
  transition: opacity 0.4s ease-out;
  height: 25px;
  width: 100%;
  line-height: 14px;
  padding: 5px;
  font-size: 14px;
  opacity: 1;
  pointer-events: none;
  &:empty {
    opacity: 0;
  }
`,generateKeycodeCategories=(e,t=16)=>getKeycodes(t).concat(getOtherMenu(e)),maybeFilter=(e,t)=>e?()=>!0:t,Pane$6=()=>{const e=useAppSelector(getSelectedKey),t=useAppDispatch(),o=useAppSelector(getSelectedKeyDefinitions);return reactExports.useEffect(()=>()=>{t(updateSelectedKey(null))},[]),e!==null&&o[e].ei!==void 0?jsxRuntimeExports.jsx(Pane$7,{}):jsxRuntimeExports.jsx(KeycodePane,{})},KeycodePane=()=>{var O;const e=useAppDispatch(),t=useAppSelector(S=>S.macros),o=useAppSelector(getSelectedDefinition),n=useAppSelector(getSelectedConnectedDevice),s=useAppSelector(getSelectedKeymap),r=useAppSelector(getSelectedKey),a=useAppSelector(getDisableFastRemap),i=useAppSelector(getSelectedKeyDefinitions),{basicKeyToByte:c}=useAppSelector(getBasicKeyToByte),l=useAppSelector(getMacroCount),d=reactExports.useMemo(()=>generateKeycodeCategories(c,l),[c,l]);if(!o||!n||!s)return null;const[u,_]=reactExports.useState(d[0].id),[p,x]=reactExports.useState(null),[C,m]=reactExports.useState(!1),h=()=>{if(distExports.isVIADefinitionV3(o))return K(o);const{lighting:S,customKeycodes:j}=o,{keycodes:A}=distExports.getLightingDefinition(S);return d.filter(maybeFilter(A===distExports.KeycodeType.QMK,({id:T})=>T!=="qmk_lighting")).filter(maybeFilter(A===distExports.KeycodeType.WT,({id:T})=>T!=="lighting")).filter(maybeFilter(typeof j<"u",({id:T})=>T!=="custom"))},K=S=>{const A=["default",...S.keycodes||[]].flatMap(T=>categoriesForKeycodeModule(T));return(o.customKeycodes||[]).length!==0&&A.push("custom"),d.filter(T=>A.includes(T.id))},y=()=>jsxRuntimeExports.jsx(ErrorMessage,{children:"您当前的固件不支持旋钮。更新您的设备的固件来支持。"}),g=()=>jsxRuntimeExports.jsx(MenuContainer$4,{children:h().map(({id:S,label:j})=>jsxRuntimeExports.jsx(SubmenuRow,{$selected:S===u,onClick:()=>_(S),children:j},S))}),R=()=>(e(disableGlobalHotKeys()),jsxRuntimeExports.jsx(KeycodeModal,{defaultValue:r!==null?s[r]:void 0,onExit:()=>{e(enableGlobalHotKeys()),m(!1)},onConfirm:S=>{e(enableGlobalHotKeys()),b(S),m(!1)}})),b=S=>{r!==null&&(e(updateKey(r,S)),e(updateSelectedKey(a||!i?null:getNextKey(r,i))))},f=(S,j)=>{if(S=="text")m(!0);else return keycodeInMaster(S,c)&&b(getByteForCode(S,c))},M=(S,j)=>{const{code:A,title:T,name:L}=S;return jsxRuntimeExports.jsx(Keycode,{disabled:!keycodeInMaster(A,c)&&A!="text",onClick:()=>f(A),onMouseOver:()=>x(T?`${A}: ${T}`:A),onMouseOut:()=>x(null),children:jsxRuntimeExports.jsx(KeycodeContent,{children:L})},A)},D=()=>jsxRuntimeExports.jsx(CustomKeycode,{onClick:()=>r!==null&&f("text"),onMouseOver:()=>x("Enter any QMK Keycode"),onMouseOut:()=>x(null),children:"Any"},"customKeycode"),w=(S,j)=>{const A=S.map((T,L)=>M(T));switch(j){case"macro":return t.isFeatureSupported?jsxRuntimeExports.jsx(KeycodeList,{children:A}):y();case"special":return jsxRuntimeExports.jsx(KeycodeList,{children:A.concat(D())});case"custom":return!distExports.isVIADefinitionV2(o)&&!distExports.isVIADefinitionV3(o)||!o.customKeycodes?null:jsxRuntimeExports.jsx(KeycodeList,{children:o.customKeycodes.map((T,L)=>M({...T,code:`CUSTOM(${L})`}))});default:return jsxRuntimeExports.jsx(KeycodeList,{children:A})}},I=(O=d.find(({id:S})=>S===u))==null?void 0:O.keycodes;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(SubmenuOverflowCell,{children:g()}),jsxRuntimeExports.jsxs(OverflowCell,{children:[jsxRuntimeExports.jsx(KeycodeContainer,{children:w(I,u)}),jsxRuntimeExports.jsx(KeycodeDesc,{children:p}),C&&R()]})]})},Icon$5=component$3,Title$5=title$3,Keycode$1=Object.freeze(Object.defineProperty({__proto__:null,Icon:Icon$5,KeycodePane,Pane:Pane$6,Title:Title$5},Symbol.toStringTag,{value:"Module"})),LightingControl=e=>{const t=useAppDispatch(),o=useAppSelector(getSelectedLightingData),n=useAppSelector(getSelectedDefinition),[s,r,a]=e.meta,i=o&&o[s];if(!i||!n)return null;const c=typeof r=="string"?r:r(e);switch(a.type){case"slider":return jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:c}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{isChecked:!!i[0],onChange:l=>t(updateBacklightValue(s,+l))})})]});case"range":return jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:c}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentRange,{max:a.max,min:a.min,defaultValue:i[0],onChange:l=>t(updateBacklightValue(s,l))})})]});case"color":return jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:c}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(ArrayColorPicker,{color:i,setColor:(l,d)=>t(updateBacklightValue(s,l,d))})})]});case"select":{const l=a.getOptions(n).map((d,u)=>({value:u,label:d}));return jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:c}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSelect,{onChange:d=>{d&&t(updateBacklightValue(s,+d.value))},options:l,defaultValue:l.find(d=>i[0]===d.value)})})]})}case"row_col":return jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:c}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{isChecked:i[0]!==255,onChange:l=>{t(updateBacklightValue(s,...l?[254,254]:[255,255]))}})})]})}return null},BacklightControls=[[distExports.LightingValue.BACKLIGHT_BRIGHTNESS,"Brightness",{type:"range",min:0,max:255}],[distExports.LightingValue.BACKLIGHT_EFFECT,"Effect",{type:"select",getOptions:e=>distExports.isVIADefinitionV2(e)&&distExports.getLightingDefinition(e.lighting).effects.map(([t])=>t)}],[distExports.LightingValue.BACKLIGHT_EFFECT_SPEED,"Effect Speed",{type:"range",min:0,max:3}]],UnderglowControls=[[distExports.LightingValue.QMK_RGBLIGHT_BRIGHTNESS,"Underglow Brightness",{type:"range",min:0,max:255}],[distExports.LightingValue.QMK_RGBLIGHT_EFFECT,"Underglow Effect",{type:"select",getOptions:e=>distExports.isVIADefinitionV2(e)&&distExports.getLightingDefinition(e.lighting).underglowEffects.map(([t])=>t)}],[distExports.LightingValue.QMK_RGBLIGHT_EFFECT_SPEED,"Underglow Effect Speed",{type:"range",min:0,max:3}]],GeneralPane=()=>{const e=useAppDispatch(),t=useAppSelector(getSelectedLightingData),o=useAppSelector(getSelectedDefinition);if(!t)return null;if(!distExports.isVIADefinitionV2(o))throw new Error("This lighting component is only compatible with v2 definitions");const n=distExports.getLightingDefinition(o.lighting),{supportedLightingValues:s}=n;if(n.supportedLightingValues.length!==0){const r=n.effects.map(([p,x])=>x),a=n.underglowEffects.map(([p,x])=>x),i=t[distExports.LightingValue.BACKLIGHT_EFFECT],c=t[distExports.LightingValue.QMK_RGBLIGHT_EFFECT],l=i&&r[i[0]]||0,d=c&&a[c[0]]===1,_=!!t.customColors&&l>2;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[BacklightControls.filter(p=>s.indexOf(p[0])!==-1).map(p=>jsxRuntimeExports.jsx(LightingControl,{meta:p})),UnderglowControls.filter(p=>s.indexOf(p[0])!==-1).map(p=>jsxRuntimeExports.jsx(LightingControl,{meta:p})),new Array(l).fill(1).map((p,x)=>p+x).map(p=>{let x,C;const m=p===1?distExports.LightingValue.BACKLIGHT_COLOR_1:distExports.LightingValue.BACKLIGHT_COLOR_2,h=t[m];if(_&&t.customColors)[x,C]=[t.customColors[p-1],(K,y)=>e(updateCustomColor(p-1,K,y))];else if(h)[x,C]=[{hue:h[0],sat:h[1]},(K,y)=>e(updateBacklightValue(m,K,y))];else return null;return jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsxs(Label$1,{children:["Color ",p]}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(ColorPicker,{color:x,setColor:C})})]},p)}),d&&jsxRuntimeExports.jsx(LightingControl,{meta:[distExports.LightingValue.QMK_RGBLIGHT_COLOR,"Underglow Color",{type:"color"}]})]})}return null},LayoutConfigValues=[distExports.LightingValue.BACKLIGHT_USE_7U_SPACEBAR,distExports.LightingValue.BACKLIGHT_USE_ISO_ENTER,distExports.LightingValue.BACKLIGHT_USE_SPLIT_BACKSPACE,distExports.LightingValue.BACKLIGHT_USE_SPLIT_LEFT_SHIFT,distExports.LightingValue.BACKLIGHT_USE_SPLIT_RIGHT_SHIFT,distExports.LightingValue.BACKLIGHT_DISABLE_HHKB_BLOCKER_LEDS],BooleanControls=[[distExports.LightingValue.BACKLIGHT_USE_7U_SPACEBAR,"Use 7U Spacebar LEDs"],[distExports.LightingValue.BACKLIGHT_USE_ISO_ENTER,"Use ISO Enter LEDs"],[distExports.LightingValue.BACKLIGHT_USE_SPLIT_BACKSPACE,"Use Split Backspace LEDs"],[distExports.LightingValue.BACKLIGHT_USE_SPLIT_LEFT_SHIFT,"Use Split Left Shift LEDs"],[distExports.LightingValue.BACKLIGHT_USE_SPLIT_RIGHT_SHIFT,"Use Split Right Shift LEDs"],[distExports.LightingValue.BACKLIGHT_DISABLE_HHKB_BLOCKER_LEDS,"Disable HHKB Blocker LEDs"]],Pane$5=()=>{const e=useAppDispatch(),t=useAppSelector(getSelectedLightingData),o=useAppSelector(getSelectedDefinition);if(!t)return null;if(!distExports.isVIADefinitionV2(o))throw new Error("This lighting component is only compatible with v2 definitions");const n=distExports.getLightingDefinition(o.lighting);if(n.supportedLightingValues.length!==0){const s=BooleanControls.filter(r=>n.supportedLightingValues.indexOf(r[0])!==-1);return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:s.map(([r,a])=>{const i=t&&t[r],c=i&&i[0];return jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:a}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{isChecked:!!c,onChange:l=>e(updateBacklightValue(r,+l))})})]},r)})})}return null},AdvancedLightingValues=[distExports.LightingValue.BACKLIGHT_DISABLE_WHEN_USB_SUSPENDED,distExports.LightingValue.BACKLIGHT_DISABLE_AFTER_TIMEOUT,distExports.LightingValue.BACKLIGHT_CAPS_LOCK_INDICATOR_COLOR,distExports.LightingValue.BACKLIGHT_CAPS_LOCK_INDICATOR_ROW_COL,distExports.LightingValue.BACKLIGHT_LAYER_1_INDICATOR_COLOR,distExports.LightingValue.BACKLIGHT_LAYER_1_INDICATOR_ROW_COL,distExports.LightingValue.BACKLIGHT_LAYER_2_INDICATOR_COLOR,distExports.LightingValue.BACKLIGHT_LAYER_2_INDICATOR_ROW_COL,distExports.LightingValue.BACKLIGHT_LAYER_3_INDICATOR_COLOR,distExports.LightingValue.BACKLIGHT_LAYER_3_INDICATOR_ROW_COL],AccentText=styled.span`
  color: var(--color_accent);
`,RGBControls=[[distExports.LightingValue.BACKLIGHT_DISABLE_WHEN_USB_SUSPENDED,"Disable LEDs when USB is suspended",{type:"slider"}],[distExports.LightingValue.BACKLIGHT_DISABLE_AFTER_TIMEOUT,()=>{const e=useAppSelector(getSelectedLightingData),t=e&&e[distExports.LightingValue.BACKLIGHT_DISABLE_AFTER_TIMEOUT];return t?jsxRuntimeExports.jsxs("span",{children:["LED Sleep Timeout:"," ",jsxRuntimeExports.jsx(AccentText,{children:t[0]?`After ${t[0]} mins`:"Never"})]}):null},{type:"range",min:0,max:255}],[distExports.LightingValue.BACKLIGHT_CAPS_LOCK_INDICATOR_COLOR,"Caps Lock indicator color",{type:"color"}],[distExports.LightingValue.BACKLIGHT_CAPS_LOCK_INDICATOR_ROW_COL,"Caps Lock indicator",{type:"row_col"}],[distExports.LightingValue.BACKLIGHT_LAYER_1_INDICATOR_COLOR,"Layer 1 indicator color",{type:"color"}],[distExports.LightingValue.BACKLIGHT_LAYER_1_INDICATOR_ROW_COL,"Layer 1 indicator",{type:"row_col"}],[distExports.LightingValue.BACKLIGHT_LAYER_2_INDICATOR_COLOR,"Layer 2 indicator color",{type:"color"}],[distExports.LightingValue.BACKLIGHT_LAYER_2_INDICATOR_ROW_COL,"Layer 2 indicator",{type:"row_col"}],[distExports.LightingValue.BACKLIGHT_LAYER_3_INDICATOR_COLOR,"Layer 3 indicator color",{type:"color"}],[distExports.LightingValue.BACKLIGHT_LAYER_3_INDICATOR_ROW_COL,"Layer 3 indicator",{type:"row_col"}]],AdvancedPane=()=>{const e=useAppSelector(getSelectedLightingData),t=useAppSelector(getSelectedDefinition);if(distExports.isVIADefinitionV2(t)&&e){const{supportedLightingValues:o}=distExports.getLightingDefinition(t.lighting);return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:RGBControls.filter(n=>o.indexOf(n[0])!==-1).map(n=>jsxRuntimeExports.jsx(LightingControl,{meta:n}))})}return null},Category={General:{label:"General",Menu:GeneralPane},Layout:{label:"Layout",Menu:Pane$5},Advanced:{label:"Advanced",Menu:AdvancedPane}},LightingPane=styled(CenterPane)`
  height: 100%;
  background: var(--color_dark_grey);
`,Container$b=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`,MenuContainer$3=styled.div`
  padding: 15px 20px 20px 10px;
`,Pane$4=()=>{const e=useAppSelector(getSelectedDefinition),[t,o]=reactExports.useState(Category.General),n=()=>{if(!distExports.isVIADefinitionV2(e))throw new Error("This lighting component is only compatible with v2 definitions");const s=LayoutConfigValues.some(a=>distExports.getLightingDefinition(e.lighting).supportedLightingValues.indexOf(a)!==-1),r=AdvancedLightingValues.some(a=>distExports.getLightingDefinition(e.lighting).supportedLightingValues.indexOf(a)!==-1);return[Category.General,...s?[Category.Layout]:[],...r?[Category.Advanced]:[]].filter(({Menu:a})=>!!a)};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(SubmenuCell,{children:jsxRuntimeExports.jsx(MenuContainer$3,{children:n().map(s=>jsxRuntimeExports.jsx(SubmenuRow,{$selected:t===s,onClick:()=>o(s),children:s.label},s.label))})}),jsxRuntimeExports.jsx(OverflowCell,{children:jsxRuntimeExports.jsx(LightingPane,{children:jsxRuntimeExports.jsx(Container$b,{children:jsxRuntimeExports.jsx(t.Menu,{})})})})]})},Icon$4=component$4,Title$4=title$4,Lighting=Object.freeze(Object.defineProperty({__proto__:null,Category,Icon:Icon$4,Pane:Pane$4,Title:Title$4},Symbol.toStringTag,{value:"Module"})),SvgIcAdjust24Px=e=>jsxRuntimeExports.jsx("svg",{width:16.571,height:16.571,...e,children:jsxRuntimeExports.jsx("path",{d:"M8.285 0a8.285 8.285 0 108.285 8.285A8.3 8.3 0 008.285 0zm0 14.914a6.628 6.628 0 116.628-6.628 6.637 6.637 0 01-6.628 6.628zm2.486-6.628A2.486 2.486 0 118.285 5.8a2.482 2.482 0 012.486 2.485z",fill:"currentColor"})}),title$2="宏",component$2=SvgIcAdjust24Px,matrixKeycodes=[basicKeyToByte.KC_ESC,basicKeyToByte.KC_F1,basicKeyToByte.KC_F2,basicKeyToByte.KC_F3,basicKeyToByte.KC_F4,basicKeyToByte.KC_F5,basicKeyToByte.KC_F6,basicKeyToByte.KC_F7,basicKeyToByte.KC_F8,basicKeyToByte.KC_F9,basicKeyToByte.KC_F10,basicKeyToByte.KC_F11,basicKeyToByte.KC_F12,basicKeyToByte.KC_PSCR,basicKeyToByte.KC_SLCK,basicKeyToByte.KC_PAUS,basicKeyToByte.KC_SLEP,basicKeyToByte.KC_MUTE,basicKeyToByte.KC_VOLD,basicKeyToByte.KC_VOLU,basicKeyToByte.KC_GRV,basicKeyToByte.KC_1,basicKeyToByte.KC_2,basicKeyToByte.KC_3,basicKeyToByte.KC_4,basicKeyToByte.KC_5,basicKeyToByte.KC_6,basicKeyToByte.KC_7,basicKeyToByte.KC_8,basicKeyToByte.KC_9,basicKeyToByte.KC_0,basicKeyToByte.KC_MINS,basicKeyToByte.KC_EQL,basicKeyToByte.KC_BSPC,basicKeyToByte.KC_INS,basicKeyToByte.KC_HOME,basicKeyToByte.KC_PGUP,basicKeyToByte.KC_NLCK,basicKeyToByte.KC_PSLS,basicKeyToByte.KC_PAST,basicKeyToByte.KC_PMNS,basicKeyToByte.KC_TAB,basicKeyToByte.KC_Q,basicKeyToByte.KC_W,basicKeyToByte.KC_E,basicKeyToByte.KC_R,basicKeyToByte.KC_T,basicKeyToByte.KC_Y,basicKeyToByte.KC_U,basicKeyToByte.KC_I,basicKeyToByte.KC_O,basicKeyToByte.KC_P,basicKeyToByte.KC_LBRC,basicKeyToByte.KC_RBRC,basicKeyToByte.KC_BSLS,basicKeyToByte.KC_DEL,basicKeyToByte.KC_END,basicKeyToByte.KC_PGDN,basicKeyToByte.KC_P7,basicKeyToByte.KC_P8,basicKeyToByte.KC_P9,basicKeyToByte.KC_PPLS,basicKeyToByte.KC_CAPS,basicKeyToByte.KC_A,basicKeyToByte.KC_S,basicKeyToByte.KC_D,basicKeyToByte.KC_F,basicKeyToByte.KC_G,basicKeyToByte.KC_H,basicKeyToByte.KC_J,basicKeyToByte.KC_K,basicKeyToByte.KC_L,basicKeyToByte.KC_SCLN,basicKeyToByte.KC_QUOT,basicKeyToByte.KC_ENT,basicKeyToByte.KC_P4,basicKeyToByte.KC_P5,basicKeyToByte.KC_P6,basicKeyToByte.KC_LSFT,basicKeyToByte.KC_Z,basicKeyToByte.KC_X,basicKeyToByte.KC_C,basicKeyToByte.KC_V,basicKeyToByte.KC_B,basicKeyToByte.KC_N,basicKeyToByte.KC_M,basicKeyToByte.KC_COMM,basicKeyToByte.KC_DOT,basicKeyToByte.KC_SLSH,basicKeyToByte.KC_RSFT,basicKeyToByte.KC_UP,basicKeyToByte.KC_P1,basicKeyToByte.KC_P2,basicKeyToByte.KC_P3,basicKeyToByte.KC_PENT,basicKeyToByte.KC_LCTL,basicKeyToByte.KC_LGUI,basicKeyToByte.KC_LALT,basicKeyToByte.KC_SPC,basicKeyToByte.KC_RALT,basicKeyToByte.KC_RGUI,basicKeyToByte.KC_MENU,basicKeyToByte.KC_RCTL,basicKeyToByte.KC_LEFT,basicKeyToByte.KC_DOWN,basicKeyToByte.KC_RGHT,basicKeyToByte.KC_P0,basicKeyToByte.KC_PDOT],evtToKeyByte={Digit1:basicKeyToByte.KC_1,Digit2:basicKeyToByte.KC_2,Digit3:basicKeyToByte.KC_3,Digit4:basicKeyToByte.KC_4,Digit5:basicKeyToByte.KC_5,Digit6:basicKeyToByte.KC_6,Digit7:basicKeyToByte.KC_7,Digit8:basicKeyToByte.KC_8,Digit9:basicKeyToByte.KC_9,Digit0:basicKeyToByte.KC_0,KeyA:basicKeyToByte.KC_A,KeyB:basicKeyToByte.KC_B,KeyC:basicKeyToByte.KC_C,KeyD:basicKeyToByte.KC_D,KeyE:basicKeyToByte.KC_E,KeyF:basicKeyToByte.KC_F,KeyG:basicKeyToByte.KC_G,KeyH:basicKeyToByte.KC_H,KeyI:basicKeyToByte.KC_I,KeyJ:basicKeyToByte.KC_J,KeyK:basicKeyToByte.KC_K,KeyL:basicKeyToByte.KC_L,KeyM:basicKeyToByte.KC_M,KeyN:basicKeyToByte.KC_N,KeyO:basicKeyToByte.KC_O,KeyP:basicKeyToByte.KC_P,KeyQ:basicKeyToByte.KC_Q,KeyR:basicKeyToByte.KC_R,KeyS:basicKeyToByte.KC_S,KeyT:basicKeyToByte.KC_T,KeyU:basicKeyToByte.KC_U,KeyV:basicKeyToByte.KC_V,KeyW:basicKeyToByte.KC_W,KeyX:basicKeyToByte.KC_X,KeyY:basicKeyToByte.KC_Y,KeyZ:basicKeyToByte.KC_Z,Comma:basicKeyToByte.KC_COMM,Period:basicKeyToByte.KC_DOT,Semicolon:basicKeyToByte.KC_SCLN,Quote:basicKeyToByte.KC_QUOT,BracketLeft:basicKeyToByte.KC_LBRC,BracketRight:basicKeyToByte.KC_RBRC,Backspace:basicKeyToByte.KC_BSPC,Backquote:basicKeyToByte.KC_GRV,Slash:basicKeyToByte.KC_SLSH,Backslash:basicKeyToByte.KC_BSLS,Minus:basicKeyToByte.KC_MINS,Equal:basicKeyToByte.KC_EQL,IntlRo:basicKeyToByte.KC_RO,IntlYen:basicKeyToByte.KC_JYEN,AltLeft:basicKeyToByte.KC_LALT,AltRight:basicKeyToByte.KC_RALT,CapsLock:basicKeyToByte.KC_CAPS,ControlLeft:basicKeyToByte.KC_LCTL,ControlRight:basicKeyToByte.KC_RCTL,MetaLeft:basicKeyToByte.KC_LGUI,MetaRight:basicKeyToByte.KC_RGUI,OSLeft:basicKeyToByte.KC_LGUI,OSRight:basicKeyToByte.KC_RGUI,ShiftLeft:basicKeyToByte.KC_LSFT,ShiftRight:basicKeyToByte.KC_RSFT,ContextMenu:basicKeyToByte.KC_APP,Enter:basicKeyToByte.KC_ENT,Space:basicKeyToByte.KC_SPC,Tab:basicKeyToByte.KC_TAB,Delete:basicKeyToByte.KC_DEL,End:basicKeyToByte.KC_END,Help:basicKeyToByte.KC_HELP,Home:basicKeyToByte.KC_HOME,Insert:basicKeyToByte.KC_INS,PageDown:basicKeyToByte.KC_PGDN,PageUp:basicKeyToByte.KC_PGUP,ArrowDown:basicKeyToByte.KC_DOWN,ArrowLeft:basicKeyToByte.KC_LEFT,ArrowRight:basicKeyToByte.KC_RGHT,ArrowUp:basicKeyToByte.KC_UP,Escape:basicKeyToByte.KC_ESC,PrintScreen:basicKeyToByte.KC_PSCR,ScrollLock:basicKeyToByte.KC_SLCK,AudioVolumeUp:basicKeyToByte.KC_VOLU,AudioVolumeDown:basicKeyToByte.KC_VOLD,AudioVolumeMute:basicKeyToByte.KC_MUTE,Pause:basicKeyToByte.KC_PAUS,F1:basicKeyToByte.KC_F1,F2:basicKeyToByte.KC_F2,F3:basicKeyToByte.KC_F3,F4:basicKeyToByte.KC_F4,F5:basicKeyToByte.KC_F5,F6:basicKeyToByte.KC_F6,F7:basicKeyToByte.KC_F7,F8:basicKeyToByte.KC_F8,F9:basicKeyToByte.KC_F9,F10:basicKeyToByte.KC_F10,F11:basicKeyToByte.KC_F11,F12:basicKeyToByte.KC_F12,F13:basicKeyToByte.KC_F13,F14:basicKeyToByte.KC_F14,F15:basicKeyToByte.KC_F15,F16:basicKeyToByte.KC_F16,F17:basicKeyToByte.KC_F17,F18:basicKeyToByte.KC_F18,F19:basicKeyToByte.KC_F19,F20:basicKeyToByte.KC_F20,F21:basicKeyToByte.KC_F21,F22:basicKeyToByte.KC_F22,F23:basicKeyToByte.KC_F23,F24:basicKeyToByte.KC_F24,NumLock:basicKeyToByte.KC_NLCK,Numpad0:basicKeyToByte.KC_P0,Numpad1:basicKeyToByte.KC_P1,Numpad2:basicKeyToByte.KC_P2,Numpad3:basicKeyToByte.KC_P3,Numpad4:basicKeyToByte.KC_P4,Numpad5:basicKeyToByte.KC_P5,Numpad6:basicKeyToByte.KC_P6,Numpad7:basicKeyToByte.KC_P7,Numpad8:basicKeyToByte.KC_P8,Numpad9:basicKeyToByte.KC_P9,NumpadAdd:basicKeyToByte.KC_PPLS,NumpadComma:basicKeyToByte.KC_COMM,NumpadDecimal:basicKeyToByte.KC_PDOT,NumpadDivide:basicKeyToByte.KC_PSLS,NumpadEnter:basicKeyToByte.KC_PENT,NumpadEqual:basicKeyToByte.KC_PEQL,NumpadMultiply:basicKeyToByte.KC_PAST,NumpadSubtract:basicKeyToByte.KC_PMNS};function getIndexByEvent(e){const t=e.code,o=evtToKeyByte[t]||evtToKeyByte[e.key];return o?matrixKeycodes.indexOf(o):-1}function mapEvtToKeycode(e){switch(e.code){case"Digit1":return"KC_1";case"Digit2":return"KC_2";case"Digit3":return"KC_3";case"Digit4":return"KC_4";case"Digit5":return"KC_5";case"Digit6":return"KC_6";case"Digit7":return"KC_7";case"Digit8":return"KC_8";case"Digit9":return"KC_9";case"Digit0":return"KC_0";case"KeyA":return"KC_A";case"KeyB":return"KC_B";case"KeyC":return"KC_C";case"KeyD":return"KC_D";case"KeyE":return"KC_E";case"KeyF":return"KC_F";case"KeyG":return"KC_G";case"KeyH":return"KC_H";case"KeyI":return"KC_I";case"KeyJ":return"KC_J";case"KeyK":return"KC_K";case"KeyL":return"KC_L";case"KeyM":return"KC_M";case"KeyN":return"KC_N";case"KeyO":return"KC_O";case"KeyP":return"KC_P";case"KeyQ":return"KC_Q";case"KeyR":return"KC_R";case"KeyS":return"KC_S";case"KeyT":return"KC_T";case"KeyU":return"KC_U";case"KeyV":return"KC_V";case"KeyW":return"KC_W";case"KeyX":return"KC_X";case"KeyY":return"KC_Y";case"KeyZ":return"KC_Z";case"Comma":return"KC_COMM";case"Period":return"KC_DOT";case"Semicolon":return"KC_SCLN";case"Quote":return"KC_QUOT";case"BracketLeft":return"KC_LBRC";case"BracketRight":return"KC_RBRC";case"Backquote":return"KC_GRV";case"Slash":return"KC_SLSH";case"Backspace":return"KC_BSPC";case"Backslash":return"KC_BSLS";case"Minus":return"KC_MINS";case"Equal":return"KC_EQL";case"IntlRo":return"KC_RO";case"IntlYen":return"KC_JYEN";case"AltLeft":return"KC_LALT";case"AltRight":return"KC_RALT";case"CapsLock":return"KC_CAPS";case"ControlLeft":return"KC_LCTL";case"ControlRight":return"KC_RCTL";case"MetaLeft":return"KC_LGUI";case"MetaRight":return"KC_RGUI";case"OSLeft":return"KC_LGUI";case"OSRight":return"KC_RGUI";case"ShiftLeft":return"KC_LSFT";case"ShiftRight":return"KC_RSFT";case"ContextMenu":return"KC_APP";case"Apps":return"KC_APP";case"Enter":return"KC_ENT";case"Space":return"KC_SPC";case"Tab":return"KC_TAB";case"Delete":return"KC_DEL";case"End":return"KC_END";case"Help":return"KC_HELP";case"Home":return"KC_HOME";case"Insert":return"KC_INS";case"PageDown":return"KC_PGDN";case"PageUp":return"KC_PGUP";case"ArrowDown":return"KC_DOWN";case"ArrowLeft":return"KC_LEFT";case"ArrowRight":return"KC_RGHT";case"ArrowUp":return"KC_UP";case"Escape":return"KC_ESC";case"PrintScreen":return"KC_PSCR";case"ScrollLock":return"KC_SLCK";case"Pause":return"KC_PAUS";case"F1":return"KC_F1";case"F2":return"KC_F2";case"F3":return"KC_F3";case"F4":return"KC_F4";case"F5":return"KC_F5";case"F6":return"KC_F6";case"F7":return"KC_F7";case"F8":return"KC_F8";case"F9":return"KC_F9";case"F10":return"KC_F10";case"F11":return"KC_F11";case"F12":return"KC_F12";case"F13":return"KC_F13";case"F14":return"KC_F14";case"F15":return"KC_F15";case"F16":return"KC_F16";case"F17":return"KC_F17";case"F18":return"KC_F18";case"F19":return"KC_F19";case"F20":return"KC_F20";case"F21":return"KC_F21";case"F22":return"KC_F22";case"F23":return"KC_F23";case"F24":return"KC_F24";case"NumLock":return"KC_NLCK";case"Numpad0":return"KC_P0";case"Numpad1":return"KC_P1";case"Numpad2":return"KC_P2";case"Numpad3":return"KC_P3";case"Numpad4":return"KC_P4";case"Numpad5":return"KC_P5";case"Numpad6":return"KC_P6";case"Numpad7":return"KC_P7";case"Numpad8":return"KC_P8";case"Numpad9":return"KC_P9";case"NumpadAdd":return"KC_PPLS";case"NumpadComma":return"KC_COMM";case"NumpadDecimal":return"KC_PDOT";case"NumpadDivide":return"KC_PSLS";case"NumpadEnter":return"KC_PENT";case"NumpadEqual":return"KC_PEQL";case"NumpadMultiply":return"KC_PAST";case"NumpadSubtract":return"KC_PMNS";case"AudioVolumeUp":return"KC_VOLU";case"AudioVolumeDown":return"KC_VOLD";case"AudioVolumeMute":return"KC_MUTE";default:console.error("Unreacheable keydown code",e)}}let heldKeys={},lastEvtTime=0;const useKeycodeRecorder=(e,t)=>{const o=reactExports.useState([]),[,n]=o,s=reactExports.useMemo(()=>getKeycodes().flatMap(c=>c.keycodes),[]),r=reactExports.useCallback((c,l)=>{c.preventDefault(),e&&!c.repeat&&n(d=>{const u=s.find(x=>x.code===mapEvtToKeycode(c)),_=Date.now(),p=u==null?void 0:u.code;return d.length&&t&&d.push([RawKeycodeSequenceAction.Delay,_-lastEvtTime]),p&&d.push([l,p]),lastEvtTime=_,[...d]})},[e,t]),a=reactExports.useCallback(c=>{c.repeat||(heldKeys[c.code]=!0,r(c,RawKeycodeSequenceAction.Down))},[e]),i=reactExports.useCallback(c=>{heldKeys[c.code]=!1,r(c,RawKeycodeSequenceAction.Up)},[e]);return reactExports.useEffect(()=>(heldKeys={},e&&(window.addEventListener("keydown",a),window.addEventListener("keyup",i)),()=>{heldKeys={},window.removeEventListener("keydown",a),window.removeEventListener("keyup",i)}),[e]),o};styled.div`
  border: 2px solid var(--bg_control);
  transition: border-color 0.2s ease-in-out;
  margin: 15px 0px;
  display: inline-block;
  &:focus-within {
    border-color: var(--color_accent);
  }
  border-radius: 4px;
  font-size: 16px;
`;const KeycodeSequenceLabel=styled.div`
  display: inline-flex;
  user-select: none;
  color: #717070;
  padding: 6px 4px;
  text-overflow: ellipsis;
  min-width: 30px;
  font-size: 12px;
  text-align: center;
  border-radius: 4px;
  justify-content: center;
  align-items: center;
  white-space: pre-wrap;
  font-size: 16px;
  border: 2px solid var(--border_color_icon);
  background: var(--bg_control);
  color: var(--color_label-highlighted);
  margin: 0;
  box-shadow: none;
  position: relative;
  border-radius: 2px;
  white-space: nowrap;
  position: relative;
  margin: 15px 0px;
`,KeycodeDownLabel=styled(KeycodeSequenceLabel)`
  &::after {
    border-style: solid;
    border-color: transparent;
    content: '';
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-top: 6px solid var(--color_accent);
    position: absolute;
    margin-top: 55px;
    width: 0;
  }
`,SequenceLabelSeparator=styled.div`
  width: 20px;
  display: inline-flex;
  vertical-align: middle;
  border: 1px solid var(--color_accent);
`,CharacterStreamLabel=styled(KeycodeSequenceLabel)`
  border-color: var(--border_color_cell);
  background: var(--bg_menu);
  white-space: pre-wrap;
  min-height: 1.25em;
  letter-spacing: 2px;
`,KeycodePressLabel=styled(KeycodeSequenceLabel)`
  border-color: var(--color_accent);
`,KeycodeUpLabel=styled(KeycodeSequenceLabel)`
  &::after {
    content: '';
    border-style: solid;
    margin-top: -55px;
    border-color: transparent;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 6px solid var(--color_accent);
    position: absolute;
    width: 0;
  }
`,KeycodeSequenceWait=styled.div`
  display: inline-flex;
  font-weight: bold;
  user-select: none;
  color: #717070;
  text-overflow: ellipsis;
  min-width: 30px;
  text-align: center;
  justify-content: center;
  align-items: center;
  white-space: pre-wrap;
  font-size: 16px;
  color: var(--color_label-highlighted);
  box-shadow: none;
  position: relative;
  white-space: nowrap;
  position: relative;
  margin: 15px 0px;
  box-sizing: border-box;
  border: 2px solid;
  padding: 4px 4px;
  border-color: var(--color_accent);
  border-radius: 2px;
`,NumberInput=styled.input.attrs({type:"number",placeholder:"XXXXX"})`
  appearance: none;
  background: none;
  border: none;
  border-bottom: 1px solid;
  color: var(--color_label);
  width: 45px;
  text-align: center;
  font-family: inherit;
  font-size: inherit;
  color: var(--color_label-highlighted);
  margin: 0 5px 0 0;
  &:focus {
    color: var(--color_accent);
  }
  &::-webkit-inner-spin-button {
    appearance: none;
    display: none;
  }
  &:invalid {
    color: red;
  }
  &:placeholder-shown {
    color: red;
  }
`,WaitInput=e=>{const t=reactExports.useRef(null),o=s=>{(!s.data||!/^\d$/.test(s.data))&&s.preventDefault()},n=s=>{+s.target.value>0&&+s.target.value<1e5&&e.updateValue(e.index,+s.target.value)};return jsxRuntimeExports.jsxs(KeycodeSequenceWait,{children:[jsxRuntimeExports.jsx(NumberInput,{ref:t,onBeforeInput:o,value:e.value,onChange:n}),"ms"]})},getSequenceItemComponent=e=>e===RawKeycodeSequenceAction.Down?KeycodeDownLabel:e===RawKeycodeSequenceAction.Up?KeycodeUpLabel:e===RawKeycodeSequenceAction.CharacterStream?CharacterStreamLabel:KeycodePressLabel;function capitalize(e){return e[0].toUpperCase()+e.slice(1)}const getSequenceLabel=e=>{const t=(e==null?void 0:e.keys)??(e==null?void 0:e.shortName)??(e==null?void 0:e.name)??"";return t.length>1?capitalize(t):t},IconButton=styled.button`
  appearance: none;
  width: 40px;
  position: relative;
  display: inline-block;
  background: transparent;
  border: none;
  cursor: pointer;
  padding: 10px 10px;
  line-height: initial;
  font-size: initial;
  color: ${e=>e.disabled?"var(--bg_control)":"var(--color_accent)"};
  border-color: ${e=>e.disabled?"var(--bg_control)":"var(--color_accent)"};
  &:disabled {
    cursor: not-allowed;
    border-right: 1px solid var(--border_color_icon);
    cursor: not-allowed;
    background: var(--bg_menu);
  }
  &:hover {
    color: ${e=>e.disabled?"var(--bg_control)":"var(--color_inside-accent)"};
    border-color: ${e=>e.disabled?"var(--bg_control)":"var(--color_accent)"};
    border-right: 1px solid var(--border_color_icon);
    background-color: ${e=>e.disabled?"var(--bg_menu)":"var(--color_accent)"};
  }

  svg {
    color: ${e=>e.disabled?"var(--bg_control)":"var(--color_accent)"};
  }
  &:hover {
    svg {
      color: ${e=>e.disabled?"var(--bg_control)":"var(--color_inside-accent)"};
    }

    color: var(--color_label-highlighted);
    & .tooltip {
      transform: scale(1) translateX(0px);
      opacity: 1;
    }
  }
  .tooltip {
    transform: translateX(-5px) scale(0.6);
    opacity: 0;
  }
`,IconButtonUnfilledContainer=styled(IconButton)`
  cursor: pointer;
  background: inherit;
  border: 1px solid var(--color_accent);
  width: 30px;
  height: 30px;
  justify-content: center;
  display: inline-flex;
  align-items: center;
`,IconButtonContainer=styled(IconButton)`
  cursor: pointer;
  background: var(--bg_control);
  border-right: 1px solid var(--border_color_icon);
`,IconToggleContainer=styled(IconButton)`
  cursor: pointer;
  transition: all 0.4s ease;
  background: ${e=>e.$selected?"var(--color_accent)":"var(--bg_menu)"};
  svg {
    color: ${e=>e.$selected?"var(--color_inside-accent)":"var(--bg_icon)"};
  }
  &:hover {
    background: ${e=>e.$selected?"var(--color_accent)":"var(--bg_menu)"};
    svg {
      color: ${e=>e.$selected?"var(--color_inside-accent)":"var(--bg_icon)"};
    }
  }
  border-right: 1px solid var(--border_color_icon);
`,Keycap2DTooltip=e=>{const t=reactExports.useMemo(()=>({containerStyles:{position:"absolute",left:"50%",transformOrigin:"left",transition:"all 0.1s ease-in-out",top:0,marginTop:-40,zIndex:4,pointerEvents:"none",filter:"drop-shadow(0px 0px 1px white)"},contentStyles:{padding:"5px 8px",borderRadius:10,background:"var(--color_accent)",color:"var(--color_inside-accent)",fontFamily:"'Fira Sans Condensed', Helvetica, Helvetica Neue, Arial, serif",fontSize:16,fontWeight:500,whiteSpace:"nowrap",display:"flex",justifyContent:"center",alignItems:"center",textTransform:"uppercase",zIndex:5,transform:"translateX(-50%)"},pointerStyles:{borderStyle:"solid",borderColor:"transparent",borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:"6px solid var(--color_accent)",position:"absolute",marginLeft:-6,width:0}}),[]);return jsxRuntimeExports.jsx(Tooltip,{...e,containerStyles:t.containerStyles,contentStyles:t.contentStyles,pointerStyles:t.pointerStyles})},KeycapTooltip=e=>{const t=reactExports.useMemo(()=>({containerStyles:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",marginTop:-800},contentStyles:{padding:"70px 70px",background:"var(--color_accent)",color:"var(--color_inside-accent)",borderRadius:100,fontSize:200,fontFamily:"'Fira Sans', Helvetica, Helvetica Neue, Arial, serif",whiteSpace:"nowrap",letterSpacing:1,display:"flex",justifyContent:"center",alignItems:"center",fontWeight:"bold"},pointerStyles:{height:150,width:150,marginTop:-100,transform:"rotate(45deg)",background:"var(--color_accent)"}}),[]);return jsxRuntimeExports.jsx(Tooltip,{...e,containerStyles:t.containerStyles,contentStyles:t.contentStyles,pointerStyles:t.pointerStyles})},CategoryMenuTooltip=e=>{const t=reactExports.useMemo(()=>({containerStyles:{position:"absolute",top:45,left:0,transformOrigin:"left",transition:"all 0.1s ease-in-out",marginTop:0,zIndex:4,pointerEvents:"none"},contentStyles:{padding:"5px 10px",borderRadius:10,background:"var(--color_accent)",color:"var(--color_inside-accent)",fontFamily:"'Fira Sans Condensed', Helvetica, Helvetica Neue, Arial, serif",fontSize:18,fontWeight:500,whiteSpace:"nowrap",display:"flex",justifyContent:"center",alignItems:"center",textTransform:"uppercase",zIndex:5,transform:"translateX(-50%)",marginLeft:18},pointerStyles:{borderStyle:"solid",borderColor:"transparent",borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderBottom:"6px solid var(--color_accent)",position:"absolute",marginLeft:15,marginTop:-41,width:0}}),[]);return jsxRuntimeExports.jsx(Tooltip,{...e,containerStyles:t.containerStyles,contentStyles:t.contentStyles,pointerStyles:t.pointerStyles})},ProgressBarTooltip=e=>{const t=reactExports.useMemo(()=>({containerStyles:{position:"absolute",left:"50%",transformOrigin:"left",transition:"all 0.1s ease-in-out",top:0,marginTop:-40,zIndex:4,pointerEvents:"none"},contentStyles:{padding:"5px 10px",borderRadius:10,background:"var(--color_inside-accent)",color:"var(--color_accent)",fontFamily:"'Fira Sans Condensed', Helvetica, Helvetica Neue, Arial, serif",fontSize:18,fontWeight:500,whiteSpace:"nowrap",display:"flex",justifyContent:"center",alignItems:"center",textTransform:"uppercase",zIndex:5,transform:"translateX(-50%)"},pointerStyles:{borderStyle:"solid",borderColor:"transparent",borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:"6px solid var(--color_inside-accent)",position:"absolute",marginLeft:-6,width:0}}),[]);return jsxRuntimeExports.jsx(Tooltip,{...e,containerStyles:t.containerStyles,contentStyles:t.contentStyles,pointerStyles:t.pointerStyles})},IconButtonTooltip=e=>{const t=reactExports.useMemo(()=>({containerStyles:{position:"absolute",top:50,left:0,transformOrigin:"left",transition:"all 0.1s ease-in-out",marginTop:0,zIndex:4,pointerEvents:"none"},contentStyles:{padding:"5px 10px",borderRadius:10,background:"var(--color_inside-accent)",color:"var(--color_accent)",fontFamily:"'Fira Sans Condensed', Helvetica, Helvetica Neue, Arial, serif",fontSize:18,fontWeight:500,whiteSpace:"nowrap",display:"flex",justifyContent:"center",alignItems:"center",textTransform:"uppercase",zIndex:5,transform:"translateX(-50%)",marginLeft:18},pointerStyles:{borderStyle:"solid",borderColor:"transparent",borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderBottom:"6px solid var(--color_inside-accent)",position:"absolute",marginLeft:15,marginTop:-41,width:0}}),[]);return jsxRuntimeExports.jsx(Tooltip,{...e,containerStyles:t.containerStyles,contentStyles:t.contentStyles,pointerStyles:t.pointerStyles})},MenuTooltip=e=>{const t=reactExports.useMemo(()=>({containerStyles:{position:"absolute",top:0,left:45,transformOrigin:"left",transition:"all 0.1s ease-in-out",marginTop:-5,zIndex:4,pointerEvents:"none"},contentStyles:{padding:"5px 5px",background:"var(--color_inside-accent)",color:"var(--color_accent)",borderRadius:10,fontFamily:"'Fira Sans Condensed', Helvetica, Helvetica Neue, Arial, serif",fontWeight:400,whiteSpace:"nowrap",display:"flex",justifyContent:"center",alignItems:"center",zIndex:5},pointerStyles:{borderStyle:"solid",borderColor:"transparent",borderTop:"6px solid transparent",borderBottom:"6px solid transparent",borderRight:"6px solid var(--color_inside-accent)",position:"absolute",marginLeft:-9,marginTop:-21,width:0}}),[]);return jsxRuntimeExports.jsx(Tooltip,{...e,containerStyles:t.containerStyles,contentStyles:t.contentStyles,pointerStyles:t.pointerStyles})},Tooltip=e=>{const{containerStyles:t,contentStyles:o,pointerStyles:n}=e;return jsxRuntimeExports.jsxs("div",{style:t,className:"tooltip",children:[jsxRuntimeExports.jsx("div",{style:o,children:e.children}),jsxRuntimeExports.jsx("div",{style:n})]})},MacroEditControlsContainer=styled.div`
  background: var(--bg_menu);
  display: inline-flex;
  align-items: center;
  padding: 0 10px;
`,MacroControlGroupContainer=styled.div`
  border-radius: 2px;
  border: 1px solid var(--border_color_icon);
  display: inline-flex;
  > button:last-child {
    border: none;
  }
`,MacroControlGroupDivider=styled.div`
  background: var(--border_color_icon);
  width: 1px;
  height: 80%;
  margin: 0 10px;
`,MacroEditControls=({isFullscreen:e,isRecording:t,recordingToggleChange:o,hasUnsavedChanges:n,undoChanges:s,saveChanges:r,recordDelays:a,toggleRecordDelays:i,optimizeRecording:c,toggleOptimizeRecording:l,isEmpty:d,deleteMacro:u,toggleFullscreen:_,isDelaySupported:p})=>{const x=jsxRuntimeExports.jsxs(IconButtonContainer,{onClick:()=>{o(!t)},disabled:!e,children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",color:"var(--color_label)",icon:t?faSquare:faCircle}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:e?t?"停止录制":"录制按键":"只能在全屏时录制"})]});return jsxRuntimeExports.jsxs(MacroEditControlsContainer,{children:[n?jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:t?null:jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(MacroControlGroupContainer,{children:[jsxRuntimeExports.jsxs(IconButtonContainer,{disabled:!n||t,onClick:s,children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",color:"var(--color_label)",icon:faUndo}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:"取消修改"})]}),jsxRuntimeExports.jsxs(IconButtonContainer,{disabled:!n||t,onClick:()=>r(),children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",color:"var(--color_label)",icon:faSave}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:"保存修改"})]})]}),jsxRuntimeExports.jsx(MacroControlGroupDivider,{})]})}):d?jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(MacroControlGroupContainer,{children:jsxRuntimeExports.jsxs(IconButtonContainer,{disabled:n||t,onClick:u,children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",color:"var(--color_label)",icon:faTrash}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:"删除宏"})]})}),jsxRuntimeExports.jsx(MacroControlGroupDivider,{})]}),jsxRuntimeExports.jsxs(MacroControlGroupContainer,{children:[x,jsxRuntimeExports.jsxs(IconButtonContainer,{onClick:_,children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",color:"var(--color_label)",icon:e?faCompress:faExpand}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:e?"退出全屏":"全屏"})]})]}),t?null:jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(MacroControlGroupDivider,{}),jsxRuntimeExports.jsxs(MacroControlGroupContainer,{children:[jsxRuntimeExports.jsxs(IconToggleContainer,{$selected:c,onClick:l,children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",icon:faMagicWandSparkles}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:c?"取消智能优选":"使用智能优化"})]}),jsxRuntimeExports.jsxs(IconToggleContainer,{disabled:!p,$selected:a,onClick:i,children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",icon:faStopwatch,className:"fa-stack-1x"}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:p?a?"跳过录制延迟":"录制延时":"升级固件以利用延迟"})]})]})]})]})},DeletableContainer=styled.div`
  display: inline-flex;
  vertical-align: middle;
  position: relative;
  svg {
    color: var(--bg_icon-highlighted);
    position: absolute;
    right: -5px;
    top: 6px;
    opacity: 0;
    cursor: pointer;
    transition: transform 0.2s ease-in-out;
    background: var(--bg_icon);
    border-radius: 50%;
    transform: scale(0.8);
  }
  &:hover svg {
    opacity: 1;
    transform: scale(1);
  }
`,Deletable=e=>jsxRuntimeExports.jsxs(DeletableContainer,{style:{pointerEvents:e.disabled?"none":"all"},children:[e.children,jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faXmarkCircle,size:"lg",onClick:()=>e.deleteItem(e.index)})]}),pipeline=(e,...t)=>t.reduce((o,n)=>n(o),e),NoMacroRecorded=styled.div`
  font-style: italic;
  color: var(--color_label-highlighted);
`,MacroSequenceContainer=styled.div`
  max-width: 960px;
  width: 100%;
  display: block;
  border: 1px solid var(--border_color_cell);
  border-style: ${e=>e.$isModified?"dashed":"solid"};
  padding: 30px 20px;
  border-radius: 15px;
  margin-top: 10px;
  box-sizing: border-box;
}
`,componentJoin=(e,t)=>e.reduce((o,n,s)=>(s&&o.push({...t,key:s.toString()}),o.push(n),o),[]),KeycodeMap=getKeycodes().flatMap(e=>e.keycodes).reduce((e,t)=>({...e,[t.code]:t}),{}),optimizeKeycodeSequence=e=>pipeline(e,convertCharacterTaps,trimLastWait,mergeConsecutiveWaits,foldKeydownKeyupKeys,convertToCharacterStreams),cleanKeycodeSequence=e=>pipeline(e,mergeConsecutiveWaits),MacroRecorder=({selectedMacro:e,setUnsavedMacro:t,saveMacro:o,undoMacro:n,isDelaySupported:s})=>{const[r,a]=reactExports.useState(!0),[i,c]=reactExports.useState(!1),[l,d]=reactExports.useState(!1),[u,_]=reactExports.useState(!!document.fullscreenElement),{smartOptimizeEnabled:p,recordDelaysEnabled:x}=useAppSelector(getMacroEditorSettings),C=useDispatch(),[m,h]=useKeycodeRecorder(i,x),K=reactExports.useRef(null),y=reactExports.useCallback(async S=>{c(S),S?(await navigator.keyboard.lock(),h([]),a(!1),d(!0)):(navigator.keyboard.unlock(),p&&h(optimizeKeycodeSequence(m)),d(!1))},[m,c]),g=reactExports.useCallback(()=>{o(""),a(!0),d(!1)},[h,o]),R=reactExports.useCallback(()=>{n(),h([]),a(!0),d(!1)},[n]);reactExports.useEffect(()=>{a(!0),d(!1),h([])},[e]);const b=()=>[...r?e??[]:m],f=reactExports.useMemo(()=>{let S,j=b();return r||!l||!p?S=j:S=optimizeKeycodeSequence(j),S},[m,r,p,l,e]);reactExports.useEffect(()=>{f&&t(sequenceToExpression(f))},[f]);const M=reactExports.useCallback(()=>{r&&a(!1)},[r]),D=reactExports.useCallback(S=>{const j=b();j.splice(S,1),h(cleanKeycodeSequence(j)),M()},[f,e,m,r]),w=reactExports.useCallback((S,j)=>{const A=b();A.splice(S,1,[RawKeycodeSequenceAction.Delay,j]),h(cleanKeycodeSequence(A)),M()},[f,e,m,r]),I=reactExports.useMemo(()=>componentJoin(f.map(([S,j],A)=>{const T=getSequenceItemComponent(S);return jsxRuntimeExports.jsx(Deletable,{index:A,deleteItem:D,disabled:i,children:RawKeycodeSequenceAction.Delay!==S?jsxRuntimeExports.jsx(T,{children:S===RawKeycodeSequenceAction.CharacterStream?componentJoin(String(j).split(" ").map((L,N)=>jsxRuntimeExports.jsx("span",{children:L},N)),jsxRuntimeExports.jsx("span",{style:{fontFamily:"fantasy, cursive, monospace"},children:"␣"})):Array.isArray(j)?j.map(L=>getSequenceLabel(KeycodeMap[L])??L).join(" + "):getSequenceLabel(KeycodeMap[j])}):jsxRuntimeExports.jsx(WaitInput,{index:A,value:Number(j),updateValue:w})},`${A}-${S}`)}),jsxRuntimeExports.jsx(SequenceLabelSeparator,{})),[f]);reactExports.useEffect(()=>{const S=()=>{_(!!document.fullscreenElement)};return document.documentElement.addEventListener("fullscreenchange",S),()=>{y(!1),document.documentElement.removeEventListener("fullscreenchange",S)}},[_]);const O=reactExports.useCallback(()=>{document.fullscreenElement?document.exitFullscreen&&(y(!1),document.exitFullscreen()):document.documentElement.requestFullscreen()},[y]);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(MacroSequenceContainer,{ref:K,$isModified:!r,children:I.length?I:jsxRuntimeExports.jsx(NoMacroRecorded,{children:"尚未录制宏..."})}),jsxRuntimeExports.jsx("div",{style:{border:"none",maxWidth:960,width:"100%",display:"flex",justifyContent:"center",transform:"translate(-0px, -21px)"},children:jsxRuntimeExports.jsx(MacroEditControls,{isFullscreen:u,isEmpty:!e||!e.length,optimizeRecording:p,recordDelays:x,isRecording:i,addText:()=>{},deleteMacro:g,toggleOptimizeRecording:()=>{C(setMacroEditorSettings({smartOptimizeEnabled:!p}))},toggleRecordDelays:()=>{C(setMacroEditorSettings({recordDelaysEnabled:!x}))},toggleFullscreen:O,undoChanges:R,saveChanges:()=>o(),hasUnsavedChanges:!r,recordingToggleChange:y,isDelaySupported:s})})]})},TextArea=styled.textarea`
  box-sizing: border-box;
  background: var(--bg_control);
  padding: 5px 10px;
  border-color: var(--border_color_icon);
  color: var(--color_label);
  width: 100%;
  height: 200px;
  font-size: 16px;
  line-height: 18px;
  resize: none;
  font-family: 'Source Code Pro';
  font-weight: 500;
  &::placeholder {
    color: var(--color_label);
  }
  &:focus {
    color: var(--color_accent);
    outline-color: var(--color_accent);
  }
`,ToastErrorMessage=styled(ErrorMessage)`
  margin: 0;
  width: 100%;
  font-size: 14px;
  display: block;
  &:empty {
    display: none;
  }
`,Message=styled.div`
  color: var(--color_accent);
`,Link=styled.a`
  font-size: 18x !important;
  color: var(--color_accent);
  text-decoration: underline;
`,DescriptionLabel=styled(Label$1)`
  margin: 1em 0;
  font-size: 14px;
  line-height: 18px;
  font-style: oblique;
  padding-left: 5px;
`,AutoHeightRow=styled(ControlRow)`
  height: auto;
`,ScriptMode=({macro:e,protocol:t,setUnsavedMacro:o,saveMacros:n,macroIndex:s,isDelaySupported:r})=>{const a=e.trimEnd(),[i,c]=React.useState(a),[l,d]=React.useState(void 0);reactExports.useEffect(()=>{o(i)},[i]);const u=()=>{const x=getMacroValidator(t)(i);x.isValid?(n(i),d(void 0)):d(x.errorMessage)},_=l!==void 0;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(AutoHeightRow,{children:jsxRuntimeExports.jsx(ReactTextareaAutocomplete,{value:i,onChange:p=>c(p.target.value),loadingComponent:AutocompleteLoading,style:{fontSize:"16px",lineHeight:"18px",width:"100%",height:"140px",fontFamily:"monospace",resize:"none",borderColor:_?"var(--color_error)":"var(--border_color_icon)"},containerStyle:{border:"none",lineHeight:"20px"},itemStyle:{borderColor:"var(--border_color_cell)",backgroundColor:"var(--bg_menu)"},dropdownStyle:{zIndex:999,backgroundColor:"var(--bg_menu)"},listStyle:{position:"fixed",backgroundColor:"var(--bg_menu)",maxHeight:"210px",overflow:"auto",border:"1px solid var(--border_color_cell)"},minChar:0,textAreaComponent:TextArea,movePopupAsYouType:!0,placeholder:`在这里输入你想要的宏 M${s} ...`,trigger:{"?":{dataProvider:findKeycodes,component:AutocompleteItem,output:p=>({text:p.code,caretPosition:"end"})},"{":{dataProvider:findKeycodes,component:AutocompleteItem,output:p=>({text:`{${p.code},`,caretPosition:"end"})},",":{dataProvider:findKeycodes,component:AutocompleteItem,output:p=>({text:`,${p.code},`,caretPosition:"end"})}}})}),jsxRuntimeExports.jsxs(AutoHeightRow,{children:[jsxRuntimeExports.jsxs(DescriptionLabel,{children:[jsxRuntimeExports.jsx(ToastErrorMessage,{children:l}),jsxRuntimeExports.jsxs(Message,{children:["直接输入文本，或者键码"," ",jsxRuntimeExports.jsx(Link,{href:"https://docs.qmk.fm/#/keycodes_basic",target:"_blank",children:"基础键码"})," ","in ","{}"]}),jsxRuntimeExports.jsxs(Message,{children:["单击: ","{KC_XXX}"]}),jsxRuntimeExports.jsxs(Message,{children:["组合键: ","{KC_XXX, KC_YYY, KC_ZZZ}"]}),jsxRuntimeExports.jsxs(Message,{children:["按下按键: ","{+KC_XXX}"]}),jsxRuntimeExports.jsxs(Message,{children:["释放按键: ","{-KC_XXX}"]}),r?jsxRuntimeExports.jsxs(Message,{children:["延时 (ms): ","{NNNN}"," "]}):"Upgrade firmware to use delays",jsxRuntimeExports.jsx(Message,{children:"输入 ? 搜索键码"})]}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentButton,{disabled:e===i,onClick:u,children:"保存"})})]})]})},ProgressBarContainer=styled.div`
  position: relative;
  margin-top: 10px;
  &:hover {
    & .tooltip {
      transform: scale(1) translateY(0px);
      opacity: 1;
    }
  }
  .tooltip {
    transform: translateY(5px) scale(0.6);
    opacity: 0;
  }
`,ProgressBar=styled.div`
  background: var(--bg_control);
  position: relative;
  padding: 5px;
  border-radius: 5px;
  overflow: hidden;
  margin-bottom: 10px;
  cursor: pointer;
  width: 250px;

  > span {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    background: var(--color_accent);
    height: 10px;
    width: 100%;
    transform: scaleX(0.1);
    transform-origin: left;
    transition: transform 0.4s ease-in-out;
  }
`,MacroTab=styled.span`
  display: inline-flex;
  border: 1px solid;
  line-height: initial;
  border-top: none;
  padding: 8px;
  border-bottom-left-radius: 6px;
  border-bottom-right-radius: 6px;
  min-width: 38px;
  justify-content: center;
  box-sizing: border-box;
  color: ${e=>e.$selected?"var(--color_accent)":"var(--bg_icon)"};
  cursor: pointer;
  &:hover {
    color: ${e=>e.$selected?"var(--color_accent)":"var(--bg_icon-highlighted)"};
  }
`,TabBar=styled.div`
  display: flex;
  column-gap: 10px;
`,TabContainer=styled.div`
  display: flex;
  margin-bottom: 10px;
  width: 100%;
  max-width: 960px;
`,CenterTabContainer=styled(TabContainer)`
  justify-content: center;
`,printBytesUsed=(e,t)=>{const o=["字节","kB","MB","GB"],n=Math.floor(Math.log10(t)/3),s=o[n],r=n===0?1:Math.pow(1e3,n),a=e/r,i=t/r;return`${a.toFixed(n)} / ${i.toFixed(n)} ${s} 已使用空间`},BufferSizeUsage=()=>{const e=useAppSelector(i=>i.macros.ast),t=useAppSelector(getMacroBufferSize),o=useAppSelector(getSelectedConnectedDevice),n=useAppSelector(getSelectedKeyboardAPI);if(!o||!n)return null;const{protocol:s}=o,a=getMacroAPI(s,n).rawKeycodeSequencesToMacroBytes(e).length;return jsxRuntimeExports.jsxs(ProgressBarContainer,{children:[jsxRuntimeExports.jsx(ProgressBar,{children:jsxRuntimeExports.jsx("span",{style:{transform:`scaleX(${a/t})`}})}),jsxRuntimeExports.jsx(ProgressBarTooltip,{children:printBytesUsed(a,t)})]})},MacroDetailPane=e=>{const t=e.macroExpressions[e.selectedMacro]||"",[o,n]=React.useState(!1),s=useAppSelector(d=>d.macros.ast),r=useAppSelector(getIsDelaySupported),[a,i]=reactExports.useState(t);reactExports.useEffect(()=>{i(t)},[t]);const c=reactExports.useCallback(()=>{i(t)},[t]),l=reactExports.useCallback(d=>{d!==void 0?(e.saveMacros(""),i("")):a!==t&&(e.saveMacros(a),i(a))},[a]);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(CenterTabContainer,{children:jsxRuntimeExports.jsxs(TabBar,{children:[jsxRuntimeExports.jsx(MacroTab,{$selected:!o,onClick:()=>n(!1),children:jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faClapperboard})}),jsxRuntimeExports.jsx(MacroTab,{$selected:o,onClick:()=>n(!0),children:jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faCode})})]})}),jsxRuntimeExports.jsx(BufferSizeUsage,{}),o?jsxRuntimeExports.jsx(ScriptMode,{macro:t,macroIndex:e.selectedMacro,protocol:e.protocol,isDelaySupported:r,setUnsavedMacro:i,saveMacros:e.saveMacros},e.selectedMacro):jsxRuntimeExports.jsx(MacroRecorder,{selectedMacro:s[e.selectedMacro],setUnsavedMacro:i,undoMacro:c,saveMacro:l,isDelaySupported:r})]})},MacroPane=styled(CenterPane)`
  height: 100%;
  background: var(--color_dark_grey);
`,Container$a=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 12px;
  padding-top: 0;
`,MenuContainer$2=styled.div`
  padding: 15px 10px 20px 10px;
`,Pane$3=()=>{const e=useAppDispatch(),t=useAppSelector(getSelectedConnectedDevice),o=useAppSelector(getExpressions),n=useAppSelector(getMacroCount),[s,r]=reactExports.useState(0),a=reactExports.useCallback(async c=>{if(!t)return;const l=o.map((d,u)=>u===s?c:d);e(saveMacros(t,l))},[o,saveMacros,e,t,s]),i=reactExports.useMemo(()=>Array(n).fill(0).map((c,l)=>l).map(c=>jsxRuntimeExports.jsx(SubmenuRow,{$selected:s===c,onClick:()=>r(c),style:{borderWidth:0,textAlign:"center"},children:`M${c}`},c)),[s,n]);return t?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(SubmenuOverflowCell,{children:jsxRuntimeExports.jsx(MenuContainer$2,{children:i})}),jsxRuntimeExports.jsx(OverflowCell,{children:jsxRuntimeExports.jsx(MacroPane,{children:jsxRuntimeExports.jsx(Container$a,{children:jsxRuntimeExports.jsx(MacroDetailPane,{macroExpressions:o,selectedMacro:s,saveMacros:a,protocol:t?t.protocol:-1})})})})]}):null},Icon$3=component$2,Title$3=title$2,Macros=Object.freeze(Object.defineProperty({__proto__:null,Icon:Icon$3,Pane:Pane$3,Title:Title$3},Symbol.toStringTag,{value:"Module"}));function AccentUploadButton(e){const t=e.inputRef||React.useRef();function o(n){e.onLoad(n.target.files),t.current.value=null}return jsxRuntimeExports.jsxs(AccentButton,{onClick:()=>t.current&&t.current.click(),children:[e.children,jsxRuntimeExports.jsx("input",{ref:t,type:"file",multiple:e.multiple,accept:"application/json",style:{display:"none"},onChange:o})]})}const deprecatedKeycodes={KC_TILD:"S(KC_GRV)",KC_EXLM:"S(KC_1)",KC_AT:"S(KC_2)",KC_HASH:"S(KC_3)",KC_DLR:"S(KC_4)",KC_PERC:"S(KC_5)",KC_CIRC:"S(KC_6)",KC_AMPR:"S(KC_7)",KC_ASTR:"S(KC_8)",KC_LPRN:"S(KC_9)",KC_RPRN:"S(KC_0)",KC_UNDS:"S(KC_MINS)",KC_PLUS:"S(KC_EQL)",KC_LCBR:"S(KC_LBRC)",KC_RCBR:"S(KC_RBRC)",KC_PIPE:"S(KC_BSLS)",KC_COLN:"S(KC_SCLN)",KC_DQUO:"S(KC_QUOT)",KC_LT:"S(KC_COMM)",KC_GT:"S(KC_DOT)",KC_QUES:"S(KC_SLSH)",SPC_FN1:"LT(1,KC_SPC)",SPC_FN2:"LT(2,KC_SPC)",SPC_FN3:"LT(3,KC_SPC)",MACRO00:"MACRO(0)",MACRO01:"MACRO(1)",MACRO02:"MACRO(2)",MACRO03:"MACRO(3)",MACRO04:"MACRO(4)",MACRO05:"MACRO(5)",MACRO06:"MACRO(6)",MACRO07:"MACRO(7)",MACRO08:"MACRO(8)",MACRO09:"MACRO(9)",MACRO10:"MACRO(10)",MACRO11:"MACRO(11)",MACRO12:"MACRO(12)",MACRO13:"MACRO(13)",MACRO14:"MACRO(14)",MACRO15:"MACRO(15)",USER00:"CUSTOM(0)",USER01:"CUSTOM(1)",USER02:"CUSTOM(2)",USER03:"CUSTOM(3)",USER04:"CUSTOM(4)",USER05:"CUSTOM(5)",USER06:"CUSTOM(6)",USER07:"CUSTOM(7)",USER08:"CUSTOM(8)",USER09:"CUSTOM(9)",USER10:"CUSTOM(10)",USER11:"CUSTOM(11)",USER12:"CUSTOM(12)",USER13:"CUSTOM(13)",USER14:"CUSTOM(14)",USER15:"CUSTOM(15)"},title$1="保存/加载",component$1=()=>jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faFloppyDisk}),isViaSaveFile=e=>e&&e.name&&e.layers&&e.vendorProductId,SaveLoadPane=styled(CenterPane)`
  height: 100%;
  background: var(--color_dark_grey);
`,Container$9=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`,Pane$2=()=>{const e=useAppDispatch(),t=useAppSelector(getSelectedDefinition),o=useAppSelector(getSelectedConnectedDevice),n=useAppSelector(getSelectedKeyboardAPI),s=useAppSelector(getSelectedRawLayers),r=useAppSelector(m=>m.macros),a=useAppSelector(getExpressions),{basicKeyToByte:i,byteToKey:c}=useAppSelector(getBasicKeyToByte);if(!t||!o||!n)return null;const[l,d]=reactExports.useState(null),[u,_]=reactExports.useState(null),p=async()=>{const{layouts:m}=t,{keys:h,optionKeys:K}=m,y=[...h,...Object.values(K).flatMap(g=>Object.values(g)).flat()].filter(g=>"ei"in g).map(g=>g.ei);if(y.length>0){const g=Math.max(...y)+1,R=s.length;return await Promise.all(Array(g).fill(0).map((f,M)=>Promise.all(Array(R).fill(0).map((D,w)=>Promise.all([n.getEncoderValue(w,M,!1),n.getEncoderValue(w,M,!0)]).then(I=>I.map(O=>getCodeForByte(O,i,c)||""))))))}else return[]},x=async()=>{const{name:m,vendorProductId:h}=t,K=m.replace(/[^a-zA-Z0-9]/g,"_").toLowerCase()+".layout.json";try{const y=await window.showSaveFilePicker({suggestedName:K}),g=await p(),R={name:m,vendorProductId:h,macros:[...a],layers:s.map(D=>D.keymap.map(w=>getCodeForByte(w,i,c)||"")),encoders:g},b=stringify(R),f=new Blob([b],{type:"application/json"}),M=await y.createWritable();await M.write(f),await M.close()}catch{console.log("User cancelled save file request")}},C=([m])=>{d(null),_(null);const h=new FileReader;h.onabort=()=>d("File reading was cancelled."),h.onerror=()=>d("Failed to read file."),h.onload=async()=>{const K=JSON.parse(h.result.toString());if(!isViaSaveFile(K)){d("Could not load file: invalid data.");return}if(K.vendorProductId!==t.vendorProductId){d(`Could not import layout. This file was created for a different keyboard: ${K.name}`);return}if(K.layers.findIndex((g,R)=>g.length!==s[R].keymap.length)>-1){d("Could not import layout: incorrect number of keys in one or more layers.");return}if(r.isFeatureSupported&&K.macros){if(K.macros.length!==a.length){d("Could not import layout: incorrect number of macros.");return}e(saveMacros(o,K.macros))}const y=K.layers.map(g=>g.map(R=>getByteForCode(`${deprecatedKeycodes[R]??R}`,i)));await e(saveRawKeymapToDevice(y,o)),K.encoders&&await Promise.all(K.encoders.map((g,R)=>Promise.all(g.map((b,f)=>Promise.all([n.setEncoderValue(f,R,!1,getByteForCode(`${deprecatedKeycodes[b[0]]??b[0]}`,i)),n.setEncoderValue(f,R,!0,getByteForCode(`${deprecatedKeycodes[b[1]]??b[1]}`,i))]))))),_("Successfully updated layout!")},h.readAsBinaryString(m)};return jsxRuntimeExports.jsx(SpanOverflowCell,{children:jsxRuntimeExports.jsx(SaveLoadPane,{children:jsxRuntimeExports.jsxs(Container$9,{children:[jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"保存当前布局"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentButton,{onClick:x,children:"保存"})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"加载布局设置"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentUploadButton,{onLoad:C,children:"加载"})})]}),l?jsxRuntimeExports.jsx(ErrorMessage,{children:l}):null,u?jsxRuntimeExports.jsx(SuccessMessage,{children:u}):null]})})})},Icon$2=component$1,Title$2=title$1,SaveLoad=Object.freeze(Object.defineProperty({__proto__:null,Icon:Icon$2,Pane:Pane$2,Title:Title$2},Symbol.toStringTag,{value:"Module"})),SvgIcKeyboard24Px=e=>jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("path",{d:"M0 0h24v24H0z",fill:"none"}),jsxRuntimeExports.jsx("path",{d:"M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z",fill:"currentColor"})]}),title="布局",component=SvgIcKeyboard24Px,LayoutControl=e=>{const{onChange:t,meta:o}=e,{labels:n,selectedOption:s}=o;if(Array.isArray(n)){const[r,...a]=n,i=a.map((c,l)=>({label:c,value:`${l}`}));return jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:r}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSelect,{defaultValue:i[s],options:i,onChange:c=>{c&&t(+c.value)}})})]})}else return jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:n}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{isChecked:!!s,onChange:r=>t(+r)})})]})},ContainerPane=styled(CenterPane)`
  height: 100%;
  background: var(--color_dark_grey);
`,Container$8=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`,Pane$1=()=>{const e=useAppDispatch(),t=useAppSelector(getSelectedDefinition),o=useAppSelector(getSelectedLayoutOptions);if(!t||!o)return null;const{layouts:n}=t,s=n.labels||[];return jsxRuntimeExports.jsx(SpanOverflowCell,{children:jsxRuntimeExports.jsx(ContainerPane,{children:jsxRuntimeExports.jsx(Container$8,{children:s.map((r,a)=>jsxRuntimeExports.jsx(LayoutControl,{onChange:i=>e(updateLayoutOption(a,i)),meta:{labels:r,selectedOption:o[a]}},a))})})})},Title$1=title,Icon$1=component,Layouts$1=Object.freeze(Object.defineProperty({__proto__:null,Icon:Icon$1,Pane:Pane$1,Title:Title$1},Symbol.toStringTag,{value:"Module"})),GET_KEYBOARD_VALUE=2,SET_KEYBOARD_VALUE=3,KB_VALUES={ENABLED_ENCODER_MODES:128,OLED_DEFAULT_MODE:129,ENCODER_CUSTOM:130,OLED_MODE:131},getEncoderModes=async e=>{const t=[KB_VALUES.ENABLED_ENCODER_MODES],[,,o]=await e.hidCommand(GET_KEYBOARD_VALUE,t);return o},setEncoderModes=async(e,t)=>{const o=[KB_VALUES.ENABLED_ENCODER_MODES,t];await e.hidCommand(SET_KEYBOARD_VALUE,o)},getDefaultOLED=async e=>{const t=[KB_VALUES.OLED_DEFAULT_MODE],[,,o]=await e.hidCommand(GET_KEYBOARD_VALUE,t);return o},setDefaultOLED=async(e,t)=>{const o=[KB_VALUES.OLED_DEFAULT_MODE,t];await e.hidCommand(SET_KEYBOARD_VALUE,o)},getOLEDMode=async e=>{const t=[KB_VALUES.OLED_MODE],[,,o]=await e.hidCommand(GET_KEYBOARD_VALUE,t);return o},setOLEDMode=async(e,t)=>{const o=[KB_VALUES.OLED_MODE,t];await e.hidCommand(SET_KEYBOARD_VALUE,o)},getCustomEncoderConfig=async(e,t)=>{const o=[KB_VALUES.ENCODER_CUSTOM,t],n=await e.hidCommand(GET_KEYBOARD_VALUE,o),[,,,s,r,a,i,c,l]=n;return[s<<8|r,a<<8|i,c<<8|l]},setCustomEncoderConfig=async(e,t,o,n)=>{const s=(n&65280)>>8,r=n&255,a=[KB_VALUES.ENCODER_CUSTOM,t,o,s,r];await e.hidCommand(SET_KEYBOARD_VALUE,a)},MODES={ENC_MODE_VOLUME:0,ENC_MODE_MEDIA:1,ENC_MODE_SCROLL:2,ENC_MODE_BRIGHTNESS:3,ENC_MODE_BACKLIGHT:4,ENC_MODE_CUSTOM0:5,ENC_MODE_CUSTOM1:6,ENC_MODE_CUSTOM2:7},MODE_LABELS={ENC_MODE_VOLUME:"Volume",ENC_MODE_MEDIA:"Media",ENC_MODE_SCROLL:"Scroll",ENC_MODE_BRIGHTNESS:"Brightness",ENC_MODE_BACKLIGHT:"Backlight",ENC_MODE_CUSTOM0:"Custom 0",ENC_MODE_CUSTOM1:"Custom 1",ENC_MODE_CUSTOM2:"Custom 2"},CenteredColumnDiv=styled.div`
  display: flex;
  flex-direction: column;
  align-items: center;
`,ColumnDiv=styled.div`
  display: flex;
  flex-direction: column;
`;class EncoderModeToggle extends React.Component{constructor(){super(...arguments);E(this,"handleInputChange",o=>{const{enabledModes:n,onChange:s}=this.props,{target:{checked:r,name:a}}=o,i=1<<MODES[a],c=r?n|i:n&~i;s(c)});E(this,"isChecked",o=>(1<<o&this.props.enabledModes)>0)}render(){return jsxRuntimeExports.jsxs(CenteredColumnDiv,{children:[jsxRuntimeExports.jsx("h3",{children:"Enabled Encoder Modes:"}),jsxRuntimeExports.jsx("p",{children:"Only the selected encoder modes will be available on the keyboard"}),jsxRuntimeExports.jsx(ColumnDiv,{children:Object.entries(MODES).map(([o,n])=>jsxRuntimeExports.jsxs("label",{htmlFor:MODE_LABELS[o],children:[jsxRuntimeExports.jsx("input",{name:o,id:MODE_LABELS[o],type:"checkbox",checked:this.isChecked(n),onChange:this.handleInputChange},n),MODE_LABELS[o]]},n))})]})}}const NormalInput=styled.input`
  border: none;
  border-bottom: 1px solid var(--bg_control);
  color: var(--color_accent);
  background: var(--bg_menu);
  transition: all 0.4s ease-out;
  font-size: 18px;
  margin-bottom: 25px;
  height: 30px;
  padding: 0 5px;
  &:focus {
    outline: none;
    color: var(--color_accent);
    border-color: var(--color_accent);
  }
  &::placeholder {
    color: var(--bg_control);
  }
`,ErrorInput=styled(NormalInput)`
  border-color: #d15e5e;
  color: #d15e5e;
`;class KeycodeTextInput extends React.Component{constructor(o){super(o);E(this,"handleChange",o=>{const n=o.target.value;this.setState({currentValue:n})});E(this,"handleBlur",o=>{const{onBlur:n,basicKeyToByte:s}=this.props,{lastDefault:r}=this.state,a=o.target.value.trim().toUpperCase(),i=advancedStringToKeycode(a,s);Object.keys(s).includes(a)?(r!==s[a]&&n(s[a]),this.setState({isError:!1})):i!==0?(r!==i&&n(i),this.setState({isError:!1})):new RegExp(/^0x[0-9A-Fa-f]{1,4}$/g).test(o.target.value.trim())?(n(parseInt(o.target.value.trim(),16)),this.setState({isError:!1})):this.setState({isError:!0})});const{defaultValue:n,basicKeyToByte:s,byteToKey:r}=o;let a=anyKeycodeToString(n,s,r);this.state={lastDefault:n,defaultValueAsString:a,currentParsed:n,currentValue:a,isError:!1}}static getDerivedStateFromProps(o,n){return n.lastDefault!==o.defaultValue&&n.currentParsed!==o.defaultValue?{...n,currentValue:anyKeycodeToString(o.defaultValue,o.basicKeyToByte,o.byteToKey),currentParsed:o.defaultValue,lastDefault:o.defaultValue}:n}render(){const{currentValue:o,isError:n}=this.state,s=n?ErrorInput:NormalInput;return jsxRuntimeExports.jsx(s,{type:"text",placeholder:this.props.defaultValue?this.state.defaultValueAsString:"KC_NO, 0xFF, etc.",value:o,onChange:this.handleChange,onBlur:this.handleBlur,className:this.props.className})}}const RowDiv=styled.div`
  display: flex;
  flex-direction: row;
  margin-top: 4px;
`,LabelText$1=styled.span`
  font-weight: 650;
  margin-right: 8px;
  width: 80px;
`,KeyInput=styled(KeycodeTextInput)`
  width: 64px;
  margin-right: 8px;
`,EncoderCustomConfig=e=>{const{encoderIdx:t,onChange:o,title:n,behaviors:[s,r,a]}=e,{basicKeyToByte:i,byteToKey:c}=useAppSelector(getBasicKeyToByte),l=(d,u)=>{o(t,u,d)};return jsxRuntimeExports.jsxs(RowDiv,{children:[jsxRuntimeExports.jsx(LabelText$1,{children:n}),jsxRuntimeExports.jsx(KeyInput,{defaultValue:s,basicKeyToByte:i,byteToKey:c,onBlur:d=>l(d,0)}),jsxRuntimeExports.jsx(KeyInput,{defaultValue:r,basicKeyToByte:i,byteToKey:c,onBlur:d=>l(d,1)}),jsxRuntimeExports.jsx(KeyInput,{defaultValue:a,basicKeyToByte:i,byteToKey:c,onBlur:d=>l(d,2)})]})},MenuContainer$1=styled.div`
  display: flex;
  color: #717070;
  padding: 24px;
  font-family: GothamRounded;
  h3 {
    margin: 4px 0;
  }
  p {
    margin: 4px 0 8px 0;
    width: 288px;
    font-size: 13px;
    text-align: center;
  }
`,SectionContainer=styled.div`
  display: flex;
  flex: 1;
  flex-direction: column;
  align-items: center;
`,OLEDSelectContainer=styled.div`
  width: 156px;
  margin-bottom: 12px;
`,CustomEncoderContainer=styled.div`
  padding-left: 112px;
  display: flex;
  flex-direction: row;
`,LabelText=styled.span`
  font-weight: 650;
  margin-right: 8px;
  width: 64px;
`,OLED_OPTIONS=[{value:0,label:"Default"},{value:1,label:"Time"},{value:2,label:"Off"}],SatisfactionMenu=()=>{const e=useAppSelector(getSelectedKeyboardAPI);return e?jsxRuntimeExports.jsx(BaseSatisfactionMenu,{api:e}):null};class BaseSatisfactionMenu extends reactExports.Component{constructor(){super(...arguments);E(this,"state",{enabledModes:31,defaultOLEDMode:0,currOLEDMode:0,encoderBehaviors:[[0,0,0],[0,0,0],[0,0,0]]});E(this,"fetchDataAndSet",async()=>{const{api:o}=this.props,n=[getEncoderModes(o),getDefaultOLED(o),getOLEDMode(o),getCustomEncoderConfig(o,0),getCustomEncoderConfig(o,1),getCustomEncoderConfig(o,2)],[s,r,a,i,c,l]=await Promise.all(n);this.setState({enabledModes:s,defaultOLEDMode:r,currOLEDMode:a,encoderBehaviors:[i,c,l]})});E(this,"onEncoderModeChange",o=>{const{api:n}=this.props,{enabledModes:s}=this.state;s!==o&&(this.setState({enabledModes:o}),setEncoderModes(n,o))});E(this,"onEncoderCustomConfigChange",(o,n,s)=>{const{api:r}=this.props,a=[...this.state.encoderBehaviors];a[o][n]=s,this.setState({encoderBehaviors:a}),setCustomEncoderConfig(r,o,n,s)});E(this,"onOLEDDefaultChange",o=>{const{value:n}=o,{api:s}=this.props,{defaultOLEDMode:r}=this.state;r!==n&&(this.setState({defaultOLEDMode:n}),setDefaultOLED(s,n))});E(this,"onOLEDChange",o=>{const{value:n}=o,{api:s}=this.props,{currOLEDMode:r}=this.state;r!==n&&(this.setState({currOLEDMode:n}),setOLEDMode(s,n))})}componentDidMount(){this.fetchDataAndSet()}render(){const{api:o}=this.props,{enabledModes:n,defaultOLEDMode:s,currOLEDMode:r,encoderBehaviors:a}=this.state;return o?jsxRuntimeExports.jsxs(MenuContainer$1,{children:[jsxRuntimeExports.jsx(SectionContainer,{children:jsxRuntimeExports.jsx(EncoderModeToggle,{onChange:this.onEncoderModeChange,enabledModes:n})}),jsxRuntimeExports.jsxs(SectionContainer,{children:[jsxRuntimeExports.jsx("h3",{children:"Default OLED Mode:"}),jsxRuntimeExports.jsx("p",{children:"This is the OLED mode that will be selected by default when you plug in your keyboard."}),jsxRuntimeExports.jsx(OLEDSelectContainer,{children:jsxRuntimeExports.jsx(StateManagedSelect$1,{value:OLED_OPTIONS.find(i=>i.value===s),onChange:this.onOLEDDefaultChange,options:OLED_OPTIONS})}),jsxRuntimeExports.jsx("h3",{children:"Current OLED Mode:"}),jsxRuntimeExports.jsxs("p",{children:["Change your ","keyboard's"," current OLED mode"]}),jsxRuntimeExports.jsx(OLEDSelectContainer,{children:jsxRuntimeExports.jsx(StateManagedSelect$1,{value:OLED_OPTIONS.find(i=>i.value===r),onChange:this.onOLEDChange,options:OLED_OPTIONS,menuPlacement:"top"})})]}),jsxRuntimeExports.jsxs(SectionContainer,{children:[jsxRuntimeExports.jsx("h3",{children:"Custom Encoder Configuration:"}),jsxRuntimeExports.jsx("p",{children:"Configure the behavior of encoder custom modes"}),jsxRuntimeExports.jsxs(CustomEncoderContainer,{children:[jsxRuntimeExports.jsx(LabelText,{children:"CW"}),jsxRuntimeExports.jsx(LabelText,{children:"CCW"}),jsxRuntimeExports.jsx(LabelText,{children:"Press"})]}),jsxRuntimeExports.jsx(EncoderCustomConfig,{title:"Custom 0",encoderIdx:0,behaviors:a[0],onChange:this.onEncoderCustomConfigChange}),jsxRuntimeExports.jsx(EncoderCustomConfig,{title:"Custom 1",encoderIdx:1,behaviors:a[1],onChange:this.onEncoderCustomConfigChange}),jsxRuntimeExports.jsx(EncoderCustomConfig,{title:"Custom 2",encoderIdx:2,behaviors:a[2],onChange:this.onEncoderCustomConfigChange})]})]}):null}}const size=16.187,SvgIcMemory24Px=e=>jsxRuntimeExports.jsx("svg",{width:size,height:size,...e,children:jsxRuntimeExports.jsx("path",{d:"M10.791 5.4H5.4v5.4h5.4zM8.991 9h-1.8V7.2h1.8zm7.194-1.8V5.4h-1.8V3.6a1.8 1.8 0 00-1.8-1.8h-1.8V0h-1.8v1.8h-1.8V0H5.4v1.8H3.6a1.8 1.8 0 00-1.8 1.8v1.8H0v1.8h1.8V9H0v1.8h1.8v1.8a1.8 1.8 0 001.8 1.8h1.8v1.8h1.8v-1.8H9v1.8h1.8v-1.8h1.8a1.8 1.8 0 001.8-1.8v-1.8h1.8V9h-1.8V7.2zm-3.6 5.4H3.6v-9h8.99z",fill:"currentColor"})}),Pane=SatisfactionMenu,Title="Custom Features",Icon=SvgIcMemory24Px,RotaryEncoder=Object.freeze(Object.defineProperty({__proto__:null,Icon,Pane,Title},Symbol.toStringTag,{value:"Module"})),Container$7=styled.div`
  position: absolute;
  left: 15px;
  font-weight: 400;
  top: 10px;
`,Label=styled.label`
  font-size: 20px;
  text-transform: uppercase;
  color: var(--color_label-highlighted);
  margin-right: 6px;
`,LayerButton=styled.button`
  outline: none;
  font-variant-numeric: tabular-nums;
  border: none;
  background: ${e=>e.$selected?"var(--color_accent)":"transparent"};
  color: ${e=>e.$selected?"var(--color_inside-accent)":"var(--color_label-highlighted)"};
  cursor: pointer;
  font-size: 20px;
  font-weight: 400;
  &:hover {
    border: none;
    background: ${e=>e.$selected?"auto":"var(--bg_menu)"};
    color: ${e=>e.$selected?"auto":"var(--color_label-highlighted)"};
  }
`,LayerControl=()=>{const e=useDispatch(),t=useAppSelector(getNumberOfLayers),o=useAppSelector(getSelectedLayerIndex),n=reactExports.useMemo(()=>new Array(t).fill(0).map((s,r)=>r).map(s=>jsxRuntimeExports.jsx(LayerButton,{$selected:s===o,onClick:()=>e(setLayer(s)),children:s},s)),[t,o]);return jsxRuntimeExports.jsxs(Container$7,{children:[jsxRuntimeExports.jsx(Label,{children:"层"}),n]})},createRetry=(e,t)=>{const o={retriesLeft:e,timeoutWait:t};return{retry:a=>{o.retriesLeft=o.retriesLeft-1,o.retriesLeft<=0?console.error("Exhausted all retries"):(console.log(`Retrying after waiting ${o.timeoutWait}`),setTimeout(a,o.timeoutWait),o.timeoutWait=o.timeoutWait*2)},clear:()=>{console.log("Clearing retries back to:",e),o.retriesLeft=e,o.timeoutWait=t},retriesLeft:()=>o.retriesLeft>=1}},selectConnectedDeviceRetry=createRetry(8,100),selectConnectedDeviceByPath=e=>async(t,o)=>{await t(reloadConnectedDevices());const n=getConnectedDevices(o())[e];n&&t(selectConnectedDevice(n))},selectConnectedDevice=e=>async t=>{const o=extractDeviceInfo(e);try{t(selectDevice(e)),await t(loadMacros(e)),await t(loadLayoutOptions());const{protocol:n}=e;try{n<11?await t(updateLightingData(e)):n>=11&&await t(updateV3MenuData(e))}catch{t(logAppError({message:"Loading lighting/menu data failed",deviceInfo:o}))}await t(loadKeymapFromDevice(e)),selectConnectedDeviceRetry.clear()}catch(n){selectConnectedDeviceRetry.retriesLeft()?(t(logAppError({message:"Loading device failed - retrying",deviceInfo:o})),selectConnectedDeviceRetry.retry(()=>{t(selectConnectedDevice(e))})):(t(logAppError({message:"All retries failed for attempting connection with device",deviceInfo:o})),console.log("Hard resetting device store:",n),t(clearAllDevices()))}},reloadConnectedDevices=()=>async(e,t)=>{const o=t(),n=getSelectedDevicePath(o),s=getForceAuthorize(o),r=getSupportedIds(o),a=await getRecognisedDevices(r,s),i=await Promise.all(a.map(p=>new KeyboardAPI(p.path).getProtocolVersion())),c=a.filter((p,x)=>i[x]===-1);c.length&&c.forEach(p=>{const x=extractDeviceInfo(p);e(logAppError({message:"Received invalid protocol version from device",deviceInfo:x}))});const l=a.filter((p,x)=>i[x]!==-1).map((p,x)=>{const{path:C,productId:m,vendorId:h,productName:K}=p,y=i[x];return{path:C,productId:m,vendorId:h,protocol:y,productName:K,hasResolvedDefinition:!1,requiredDefinitionVersion:y>=11?"v3":"v2",vendorProductId:getVendorProductId(p.vendorId,p.productId)}});await e(reloadDefinitions(l));const d=getDefinitions(t()),u=l.filter((p,x)=>isAuthorizedDeviceConnected(p,d)).reduce((p,x,C)=>(p[x.path]={...x,hasResolvedDefinition:!0},p),{});l.filter(p=>!isAuthorizedDeviceConnected(p,d)).forEach(tryForgetDevice);const _=Object.entries(u);if(_.forEach(([p,x])=>{console.info("Setting connected device:",x.protocol,p,x)}),e(updateConnectedDevices(u)),(!n||!u[n])&&_.length>0){const p=_[0][1];e(selectConnectedDevice(p))}else _.length===0&&(e(selectDevice(null)),e(setForceAuthorize(!0)))},loadSupportedIds=()=>async e=>{await syncStore(),e(updateSupportedIds(getSupportedIdsFromStore())),await e(updateDefinitions(getDefinitionsFromStore())),e(loadStoredCustomDefinitions()),e(reloadConnectedDevices())},isElectron=/Electron/.test(navigator.userAgent),Container$6=styled.div`
  position: absolute;
  right: 15px;
  top: 0px;
  font-size: 18px;
  pointer-events: none;
  font-weight: 400;
`,KeyboardTitle=styled.label`
  pointer-events: all;
  display: inline-block;
  background: var(--color_accent);
  border-bottom-left-radius: 6px;
  border-bottom-right-radius: 6px;
  font-size: 18px;
  text-transform: uppercase;
  color: var(--color_inside-accent);
  padding: 1px 10px;
  margin-right: 10px;
  border: solid 1px var(--bg_control);
  border-top: none;
  cursor: pointer;
  transition: all 0.1s ease-out;
  &:hover {
    filter: brightness(0.7);
  }
`,KeyboardList=styled.ul`
  padding: 0;
  border: 1px solid var(--bg_control);
  width: 160px;
  border-radius: 6px;
  background-color: var(--bg_menu);
  margin: 0;
  margin-top: 5px;
  right: 10px;
  position: absolute;
  pointer-events: ${e=>e.$show?"all":"none"};
  transition: all 0.2s ease-out;
  z-index: 11;
  opacity: ${e=>e.$show?1:0};
  overflow: hidden;
  transform: ${e=>e.$show?0:"translateY(-5px)"};
`,KeyboardButton=styled.button`
  display: block;
  text-align: center;
  outline: none;
  font-variant-numeric: tabular-nums;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  width: 100%;
  border: none;
  background: ${e=>e.$selected?"var(--bg_icon-highlighted)":"transparent"};
  color: ${e=>e.$selected?"var(--color_icon_highlighted)":"var(--color_label-highlighted)"};
  cursor: pointer;
  text-align: left;
  font-size: 14px;
  text-transform: uppercase;
  padding: 5px 10px;
  &:hover {
    border: none;
    background: ${e=>e.$selected?"var(--bg_icon-highlighted)":"var(--bg_control)"};
    color: ${e=>e.$selected?"var(--color_control-highlighted)":"var(--color_label-highlighted)"};
  }
`,ClickCover=styled.div`
  position: fixed;
  z-index: 10;
  pointer-events: all;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  opacity: 0.4;
  background: rgba(0, 0, 0, 0.75);
`,KeyboardSelectors=e=>{const t=async()=>{const o=await HID.requestDevice();o&&e.selectKeyboard(o.__path)};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[e.show&&jsxRuntimeExports.jsx(ClickCover,{onClick:e.onClickOut}),jsxRuntimeExports.jsxs(KeyboardList,{$show:e.show,children:[e.keyboards.map(([o,n])=>jsxRuntimeExports.jsx(KeyboardButton,{$selected:o===e.selectedPath,onClick:()=>e.selectKeyboard(o),children:n.name},o)),!isElectron&&jsxRuntimeExports.jsxs(KeyboardButton,{onClick:t,children:["连接新设备",jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faPlus,style:{marginLeft:"10px"}})]})]})]})},Badge=()=>{const e=useAppDispatch(),t=useAppSelector(getDefinitions),o=useAppSelector(getSelectedDefinition),n=useAppSelector(getConnectedDevices),s=useAppSelector(getSelectedDevicePath),[r,a]=reactExports.useState(!1),i=reactExports.useMemo(()=>Object.entries(n).map(([c,l])=>[c,t[l.vendorProductId]&&t[l.vendorProductId][l.requiredDefinitionVersion]]).filter(c=>c[1]),[n,t]);return!o||!s?null:jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsxs(Container$6,{children:[jsxRuntimeExports.jsxs(KeyboardTitle,{onClick:()=>a(!r),children:[o.name,jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faAngleDown,style:{transform:r?"rotate(180deg)":"",transition:"transform 0.2s ease-out",marginLeft:"5px"}})]}),jsxRuntimeExports.jsx(KeyboardSelectors,{show:r,selectedPath:s,keyboards:i,onClickOut:()=>a(!1),selectKeyboard:c=>{e(selectConnectedDeviceByPath(c)),a(!1)}})]})})},MenuContainer=styled.div`
  padding: 15px 10px 20px 10px;
`;[...makeCustomMenus([])];function getCustomPanes(e){return e.find(t=>t===distExports.CustomFeaturesV2.RotaryEncoder)?[RotaryEncoder]:[]}const getRowsForKeyboard=()=>{const e=useAppSelector(getIsMacroFeatureSupported),t=useAppSelector(getV3MenuComponents),o=useAppSelector(getSelectedDefinition),n=useAppSelector(getNumberOfLayers);return o?distExports.isVIADefinitionV2(o)?getRowsForKeyboardV2(o,e,n):distExports.isVIADefinitionV3(o)?[...filterInferredRows(o,e,n,[Keycode$1,Layouts$1,Macros,SaveLoad]),...t]:[]:[]},filterInferredRows=(e,t,o,n)=>{const{layouts:s}=e;let r=[];return s.optionKeys&&Object.entries(s.optionKeys).length!==0||(r=[...r,Layouts$1]),o===0&&(r=[...r,Keycode$1,SaveLoad]),t||(r=[...r,Macros]),n.filter(i=>!r.includes(i))},getRowsForKeyboardV2=(e,t,o)=>{let n=[Keycode$1,Layouts$1,Macros,SaveLoad];if(distExports.isVIADefinitionV2(e)){const{lighting:s,customFeatures:r}=e,{supportedLightingValues:a}=distExports.getLightingDefinition(s);a.length!==0&&(n=[...n,Lighting]),r&&(n=[...n,...getCustomPanes(r)])}return filterInferredRows(e,t,o,n)},Loader=e=>{const{loadProgress:t,selectedDefinition:o}=e,n=useAppDispatch(),s=useAppSelector(getSelectedTheme),r=useAppSelector(getConnectedDevices),a=useAppSelector(getSupportedIds),i=!Object.values(a).length,c=!Object.values(r).length,[l,d]=reactExports.useState(!1);return reactExports.useEffect(()=>{const u=setTimeout(()=>{o||d(!0)},3e3);return()=>clearTimeout(u)},[o]),jsxRuntimeExports.jsxs(LoaderPane,{children:[jsxRuntimeExports.jsx(ChippyLoader,{theme:s,progress:t||null}),(l||c)&&!i&&!isElectron?jsxRuntimeExports.jsxs(AccentButtonLarge,{onClick:()=>n(reloadConnectedDevices()),children:["连接JLKB设备",jsxRuntimeExports.jsx(FontAwesomeIcon,{style:{marginLeft:"10px"},icon:faPlus})]}):jsxRuntimeExports.jsx(LoadingText$1,{isSearching:!o})]})},LoaderPane=styled(CenterPane)`
  display: flex;
  align-items: center;
  justify-content: center;
  row-gap: 50px;
  position: absolute;
  bottom: 50px;
  top: 50px;
  left: 0;
  right: 0;
  z-index: 4;
`,ConfigurePane=()=>{const e=useAppSelector(getSelectedDefinition),t=useAppSelector(getLoadProgress),o=useAppSelector(getRenderMode);return!e||t!==1?o==="2D"?jsxRuntimeExports.jsx(Loader,{selectedDefinition:e||null,loadProgress:t}):null:jsxRuntimeExports.jsx(ConfigureBasePane,{children:jsxRuntimeExports.jsx(ConfigureGrid,{})})},ConfigureGrid=()=>{var a,i;const e=useDispatch(),[t,o]=reactExports.useState(0),n=getRowsForKeyboard(),s=(a=n[t])==null?void 0:a.Pane,r=(i=n[t])==null?void 0:i.Title;return reactExports.useEffect(()=>{e(setConfigureKeyboardIsSelectable(r==="按键"))},[r]),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(ConfigureFlexCell,{onClick:c=>{c.target.nodeName!=="CANVAS"&&e(clearSelectedKey())},style:{pointerEvents:"none",position:"absolute",top:50,left:0,right:0},children:jsxRuntimeExports.jsxs("div",{style:{pointerEvents:"all"},children:[jsxRuntimeExports.jsx(LayerControl,{}),jsxRuntimeExports.jsx(Badge,{})]})}),jsxRuntimeExports.jsxs(Grid,{style:{pointerEvents:"none"},children:[jsxRuntimeExports.jsx(MenuCell,{style:{pointerEvents:"all"},children:jsxRuntimeExports.jsx(MenuContainer,{children:(n||[]).map(({Icon:c,Title:l},d)=>jsxRuntimeExports.jsx(Row,{onClick:u=>o(d),$selected:t===d,children:jsxRuntimeExports.jsxs(IconContainer,{children:[jsxRuntimeExports.jsx(c,{}),jsxRuntimeExports.jsx(MenuTooltip,{children:l})]})},d))})}),s&&jsxRuntimeExports.jsx(s,{})]})]})};function Layouts({definition:e,onLayoutChange:t,RowComponent:o=IndentedControlRow}){const n=useAppSelector(getDesignSelectedOptionKeys),s=useDispatch();if(React.useEffect(()=>{s(updateSelectedOptionKeys([]))},[e]),React.useEffect(()=>{t(n)},[n]),!e.layouts.labels)return null;const r=e.layouts.labels.map((a,i)=>{const c=e.layouts.optionKeys[i];if(Array.isArray(a)){const l=a[0],d=a.slice(1),u=d.map((_,p)=>({label:_,value:c[p]}));return jsxRuntimeExports.jsxs(o,{children:[jsxRuntimeExports.jsx(Label$1,{children:l}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSelect,{onChange:_=>{if(_&&_.label){const p=d.indexOf(_.label),x=Array.from(n).map(C=>C||0);x[i]=p,s(updateSelectedOptionKeys(x))}},value:n[i]?u[n[i]]:u[0],options:u})})]},`${i}-${l}`)}return typeof a=="string"?jsxRuntimeExports.jsxs(o,{children:[jsxRuntimeExports.jsx(Label$1,{children:a}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{isChecked:!!n[i],onChange:l=>{const d=Array.from(n).map(u=>u||0);d[i]=Number(l),s(updateSelectedOptionKeys(d))}})})]},`${i}-${a}`):null});return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:r})}const Container$5=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`,ControlGroup=styled.div`
  margin-bottom: 0.75rem;
  padding-bottom: 0.75rem;
  width: 100%;

  max-width: 960px;
  &:last-child {
    padding-bottom: 0;
  }
`,ControlGroupHeader=styled.div`
  font-size: 1.5rem;
  font-weight: 600;
  margin: 0;
  margin-bottom: 0.5rem;
`,TestControls=()=>{const[e,t]=reactExports.useState(!0),[o,n]=reactExports.useState(0),[s,r]=reactExports.useState([0,0]),[a,i]=reactExports.useState(0),[c,l]=reactExports.useState(0),{basicKeyToByte:d,byteToKey:u}=useAppSelector(getBasicKeyToByte),_=useAppSelector(getSelected256PaletteColor),p=useDispatch(),x=[{label:"Option 1",value:"0"},{label:"Option 2",value:"1"}];return jsxRuntimeExports.jsxs(ControlGroup,{children:[jsxRuntimeExports.jsx(ControlGroupHeader,{children:"Controls"}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"Button"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentButton,{children:"Click"})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"Disabled Button"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentButton,{disabled:!0,children:"Disabled"})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"Text Input"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(TextInput,{})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsxs(Label$1,{children:[c," / ",anyKeycodeToString(c,d,u)]}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(PelpiKeycodeInput,{value:c,setValue:l,meta:{}})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsxs(Label$1,{children:[s[0],", ",s[1]]}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(ArrayColorPicker,{color:s,setColor:(C,m)=>r([C,m])})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsxs(Label$1,{children:[_[0],", ",_[1]]}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(ColorPalettePicker,{color:_,setColor:(C,m)=>p(setSelectedPaletteColor([C,m]))})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:o}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentRange,{max:100,min:0,defaultValue:o,onChange:n})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:+e}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{isChecked:e,onChange:t})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:+a}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSelect,{defaultValue:x[a],options:x,onChange:C=>{C&&i(+C.value)}})})]}),jsxRuntimeExports.jsx(MacroRecorder,{selectedMacro:[[RawKeycodeSequenceAction.Delay,4]],setUnsavedMacro:C=>C,undoMacro:()=>null,saveMacro:()=>null,isDelaySupported:!0}),jsxRuntimeExports.jsx(MacroRecorder,{setUnsavedMacro:C=>C,undoMacro:()=>null,saveMacro:()=>null,isDelaySupported:!0})]})},Debug=()=>{const e=useAppSelector(getSelectedKeyboardAPI),t=useAppSelector(getConnectedDevices),o=Object.entries(useAppSelector(getDefinitions)).flatMap(([C,m])=>[[C,m.v2],[C,m.v3]]).filter(([C,m])=>m!==void 0),n=Object.entries(useAppSelector(getBaseDefinitions)).flatMap(([C,m])=>[[C,m.v2],[C,m.v3]]).filter(([C,m])=>m!==void 0),s=Object.entries(useAppSelector(getCustomDefinitions)).flatMap(([C,m])=>[[C,m.v2],[C,m.v3]]).filter(([C,m])=>m!==void 0),[r,a]=reactExports.useState(0),[i,c]=reactExports.useState([]),[l,d]=reactExports.useState(0),[u,_]=reactExports.useState(!1),p=o.map(([,C],m)=>({label:C.name,value:`${m}`})),x=o[r];return jsxRuntimeExports.jsx(Pane$9,{children:jsxRuntimeExports.jsx(OverflowCell,{children:jsxRuntimeExports.jsxs(Container$5,{children:[jsxRuntimeExports.jsxs(ControlGroup,{children:[jsxRuntimeExports.jsx(ControlGroupHeader,{children:"Key Testing"}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"Show Matrix"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{isChecked:u,onChange:C=>_(C)})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"Set next key"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentButton,{onClick:()=>{const{keys:C,optionKeys:m}=x[1].layouts,h=m?Object.entries(m).flatMap(([y,g])=>g[0]):[],K=[...C,...h];l!==void 0&&d(getNextKey(l,K)||0)},children:"Next"})})]})]}),p&&jsxRuntimeExports.jsxs(ControlGroup,{children:[jsxRuntimeExports.jsx(ControlGroupHeader,{children:"Layout Testing"}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"Dummy Keyboard"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSelect,{onChange:C=>C&&a(+C.value),defaultValue:p[0],options:p})})]})]}),x&&jsxRuntimeExports.jsx(Layouts,{definition:x[1],onLayoutChange:C=>{c(C)}}),e&&jsxRuntimeExports.jsxs(ControlGroup,{children:[jsxRuntimeExports.jsx(ControlGroupHeader,{children:"Connected Device Debugging"}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"EEPROM Reset"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentButton,{onClick:()=>e.resetEEPROM(),children:"Reset"})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"Bootloader Jump"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentButton,{onClick:()=>e.jumpToBootloader(),children:"Jump"})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"Clear all macros"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentButton,{onClick:()=>e.resetMacros(),children:"Clear"})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"Benchmark Switch State Query Speed"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentButton,{onClick:async()=>{const C=performance.now();await Array(1e3).fill(0).map(m=>e.getKeyboardValue(KeyboardValue.SWITCH_MATRIX_STATE,[],20)),console.info("1000 commands in ",performance.now()-C,"ms")},children:"Benchmark"})})]})]}),jsxRuntimeExports.jsxs(ControlGroup,{children:[jsxRuntimeExports.jsx(ControlGroupHeader,{children:"Device IDs"}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"Connected Devices"}),jsxRuntimeExports.jsxs(Detail,{children:[Object.values(t).length," Devices"]})]}),Object.values(t).map(C=>{const m=o.find(([h])=>h===C.vendorProductId.toString());return m?jsxRuntimeExports.jsxs(IndentedControlRow,{children:[jsxRuntimeExports.jsx(SubLabel,{children:m[1].name}),jsxRuntimeExports.jsxs(Detail,{children:["0x",C.vendorProductId.toString(16).toUpperCase()]})]},C.path):null}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"Local definitions"}),jsxRuntimeExports.jsxs(Detail,{children:[Object.values(s).length," Definitions"]})]}),Object.values(s).map(([C,m],h)=>jsxRuntimeExports.jsxs(IndentedControlRow,{children:[jsxRuntimeExports.jsx(SubLabel,{children:m.name}),jsxRuntimeExports.jsxs(Detail,{children:["0x",parseInt(C).toString(16).toUpperCase()]})]},h)),jsxRuntimeExports.jsx(ControlRow,{children:jsxRuntimeExports.jsxs("details",{children:[jsxRuntimeExports.jsxs("summary",{children:[jsxRuntimeExports.jsx(Label$1,{children:"Remote definitions"}),jsxRuntimeExports.jsxs(Detail,{children:[Object.values(n).length," Definitions"]})]}),Object.values(n).map(([C,m],h)=>jsxRuntimeExports.jsxs(IndentedControlRow,{children:[jsxRuntimeExports.jsx(SubLabel,{children:m.name}),jsxRuntimeExports.jsxs(Detail,{children:["0x",parseInt(C).toString(16).toUpperCase()]})]},h))]})})]}),jsxRuntimeExports.jsx(TestControls,{})]})})})},MessageDialogContainer=styled.dialog`
  padding: 0;
  border-width: 0;

  background: transparent;
  &::backdrop {
    background: rgba(0, 0, 0, 0.75);
  }

  & > div {
    transition: transform 0.2s ease-out;
    transform: translateY(-20px);
  }

  &[open] > div {
    transform: translateY(0px);
  }
`,Controls=styled.div`
  display: flex;
  justify-content: center;
  align-items: center;
`,MessageDialog=e=>{const t=reactExports.useRef(null),o=reactExports.useCallback(()=>{t.current&&t.current.close(),e.onClose&&e.onClose()},[t.current,e.onClose]);return reactExports.useEffect(()=>(t.current&&(e.isOpen?t.current.showModal():t.current.close()),()=>{o()}),[e.isOpen]),jsxRuntimeExports.jsx(MessageDialogContainer,{ref:t,children:jsxRuntimeExports.jsxs(ModalContainer,{children:[jsxRuntimeExports.jsx(PromptText,{children:e.children}),jsxRuntimeExports.jsx(Controls,{children:jsxRuntimeExports.jsx(AccentButton,{onClick:o,children:"Confirm"})})]})})};let designWarningSeen=Number(localStorage.getItem("designWarningSeen")||0),hideDesignWarning=sessionStorage.getItem("hideDesignWarning")||designWarningSeen>4;const DesignErrorMessage=styled(ErrorMessage)`
  margin: 0;
  font-style: italic;
`,Container$4=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`,DesignPane=styled(Pane$9)`
  display: grid;
  max-width: 100vw;
  grid-template-columns: 100vw;
  grid-template-rows: min-content;
`,UploadIcon=styled.div`
  height: 200px;
  width: 50%;
  cursor: pointer;
  max-width: 560px;
  border-radius: 6px;
  margin: 50px 10px;
  animation-duration: 1.5s;
  animation-name: border-glow;
  animation-iteration-count: infinite;
  animation-direction: alternate;
  animation-timing-function: ease-in-out;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  svg {
    color: transparent;
    stroke-width: 8px;
    animation-duration: 1.5s;
    animation-name: text-glow;
    animation-iteration-count: infinite;
    animation-direction: alternate;
    animation-timing-function: ease-in-out;
    font-size: 100px;
  }
`,makeReaderPromise=e=>new Promise((t,o)=>{const n=new FileReader;n.onload=()=>{if(!n.result)return o();t([e.name,n.result.toString()])},n.onerror=o,n.onabort=o,n.readAsBinaryString(e)}),isVIADefinition=e=>distExports.isVIADefinitionV2(e)||distExports.isVIADefinitionV3(e);function importDefinitions(e,t,o,n){Promise.all(e.map(makeReaderPromise)).then(s=>{let r=[];n([]);const a=s.map(([i,c])=>{if(r.length>0)return null;try{const l=JSON.parse(c.toString());if(t==="v2"?distExports.isKeyboardDefinitionV2(l)||distExports.isVIADefinitionV2(l):distExports.isKeyboardDefinitionV3(l)||distExports.isVIADefinitionV3(l))return t==="v2"?distExports.isVIADefinitionV2(l)?l:distExports.keyboardDefinitionV2ToVIADefinitionV2(l):distExports.isVIADefinitionV3(l)?l:distExports.keyboardDefinitionV3ToVIADefinitionV3(l);r=(t==="v2"?distExports.isKeyboardDefinitionV2.errors||distExports.isVIADefinitionV2.errors||[]:distExports.isKeyboardDefinitionV3.errors||distExports.isVIADefinitionV3.errors||[]).map(u=>`${i} ${u.dataPath?u.dataPath+": ":"Object: "}${u.message}`)}catch(l){l.name?r.push(`${l.name}: ${l.message}`):r.push(`${l}`)}}).filter(isVIADefinition);r.length?n(r):(o(loadCustomDefinitions({definitions:a,version:t})),o(storeCustomDefinitions({definitions:a,version:t})),o(ensureSupportedIds({productIds:a.map(i=>i.vendorProductId),version:t})),o(selectDevice(null)),o(reloadConnectedDevices()))})}function onDrop(e,t,o,n){e.preventDefault();const{dataTransfer:s}=e;if(s!=null&&s.items){const r=Array.from(s.items).filter(a=>a.kind==="file"&&a.type==="application/json").map(a=>a.getAsFile()).filter(a=>a!==null);r.length&&importDefinitions(r,t,o,n)}}const DesignTab=()=>{const e=useDispatch(),t=Object.values(useAppSelector(getCustomDefinitions)),o=useAppSelector(getDesignDefinitionVersion),n=useAppSelector(getSelectedDefinitionIndex),s=useAppSelector(getShowMatrix),[r,a]=reactExports.useState([]),i=reactExports.useMemo(()=>t.filter(_=>_[o]),[t,o]),c=i.map((_,p)=>({label:_[o].name,value:p.toString()})),l=reactExports.useRef(null),d=i[n]&&i[n][o],u=reactExports.useRef();return jsxRuntimeExports.jsxs(DesignPane,{onDragOver:_=>{_.dataTransfer.effectAllowed="copyMove",_.dataTransfer.dropEffect="none",_.preventDefault(),_.stopPropagation()},children:[jsxRuntimeExports.jsx(MessageDialog,{isOpen:!hideDesignWarning,onClose:()=>{sessionStorage.setItem("hideDesignWarning","1"),hideDesignWarning="1",designWarningSeen=designWarningSeen+1,localStorage.setItem("designWarningSeen",`${designWarningSeen}`)},children:"此功能用于开发目的。如果你的键盘法自动被识别，请联系您的键盘制造商或供应商。"}),jsxRuntimeExports.jsx(SinglePaneFlexCell,{ref:l,children:!d&&jsxRuntimeExports.jsx(UploadIcon,{onClick:()=>{u.current&&u.current.click()},onDrop:_=>onDrop(_,o,e,a),onDragOver:_=>{_.dataTransfer.effectAllowed="copyMove",_.dataTransfer.dropEffect="copy",_.preventDefault(),_.stopPropagation()},children:jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faUpload})})}),jsxRuntimeExports.jsxs(Grid,{style:{overflow:"hidden"},children:[jsxRuntimeExports.jsx(MenuCell,{style:{pointerEvents:"all"},children:jsxRuntimeExports.jsx(MenuContainer$5,{children:jsxRuntimeExports.jsx(Row,{$selected:!0,children:jsxRuntimeExports.jsxs(IconContainer,{children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faBook}),jsxRuntimeExports.jsx(MenuTooltip,{children:"配置"})]})})})}),jsxRuntimeExports.jsx(SpanOverflowCell,{children:jsxRuntimeExports.jsxs(Container$4,{children:[jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"加载本地布局配置"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentUploadButton,{multiple:!0,inputRef:u,onLoad:_=>{importDefinitions(Array.from(_),o,e,a)},children:"载入"})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"使用V2版本配置（已弃用）"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{isChecked:o==="v2",onChange:_=>e(updateDesignDefinitionVersion(_?"v2":"v3"))})})]}),d&&jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"当前显示的键盘配置"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSelect,{onChange:_=>{e(updateSelectedOptionKeys([])),_&&e(updateSelectedDefinitionIndex(+_.value))},value:c[n],options:c})})]})}),d&&jsxRuntimeExports.jsx(Layouts,{definition:d,onLayoutChange:_=>{e(updateSelectedOptionKeys(_))}}),d&&jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"显示连接矩阵"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{isChecked:s,onChange:_=>{e(updateShowMatrix(_))}})})]}),r.map(_=>jsxRuntimeExports.jsx(IndentedControlRow,{children:jsxRuntimeExports.jsx(DesignErrorMessage,{children:_})})),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"已有的布局配置"}),jsxRuntimeExports.jsxs(Detail,{children:[Object.values(i).length," 配置"]})]}),i.map(_=>jsxRuntimeExports.jsxs(IndentedControlRow,{children:[jsxRuntimeExports.jsx(SubLabel,{children:_[o].name}),jsxRuntimeExports.jsxs(Detail,{children:[formatNumberAsHex(_[o].vendorProductId,8),jsxRuntimeExports.jsx(IconButtonUnfilledContainer,{onClick:()=>{e(unloadCustomDefinition({id:_[o].vendorProductId,version:o}))},style:{marginLeft:10,borderRadius:4},children:jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faXmark,size:"lg"})})]})]},`${o}-${_[o].vendorProductId}`))]})})]})]})},Container$3=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`,DiagnosticContainer=styled(Container$3)`
  margin-top: 20px;
  padding-top: 20px;
`,SettingsErrorMessage=styled(ErrorMessage)`
  margin: 0;
  font-style: italic;
`,Settings=()=>{const e=useDispatch(),t=useAppSelector(getShowDesignTab),o=useAppSelector(getDisableFastRemap),n=useAppSelector(getThemeMode),s=useAppSelector(getThemeName),r=useAppSelector(getRenderMode),a=useAppSelector(getSelectedConnectedDevice),[i,c]=reactExports.useState(!1),l=Object.keys(THEMES).map(p=>({label:p.replaceAll("_"," "),value:p})),d=l.find(p=>p.value===s),u=webGLIsAvailable?[{label:"2D",value:"2D"},{label:"3D",value:"3D"}]:[{label:"2D",value:"2D"}],_=u.find(p=>p.value===r);return jsxRuntimeExports.jsx(Pane$9,{children:jsxRuntimeExports.jsxs(Grid,{style:{overflow:"hidden"},children:[jsxRuntimeExports.jsx(MenuCell,{style:{pointerEvents:"all",borderTop:"none"},children:jsxRuntimeExports.jsx(MenuContainer$5,{children:jsxRuntimeExports.jsx(Row,{$selected:!0,children:jsxRuntimeExports.jsxs(IconContainer,{children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faToolbox}),jsxRuntimeExports.jsx(MenuTooltip,{children:"通用"})]})})})}),jsxRuntimeExports.jsxs(SpanOverflowCell,{style:{flex:1,borderWidth:0},children:[jsxRuntimeExports.jsxs(Container$3,{children:[jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"显示“设计”选项卡"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{onChange:()=>e(toggleCreatorMode()),isChecked:t})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"快速按键设置"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{onChange:()=>e(toggleFastRemap()),isChecked:!o})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"明亮模式"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{onChange:()=>e(toggleThemeMode()),isChecked:n==="light"})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"主题"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSelect,{defaultValue:d,options:l,onChange:p=>{p&&e(updateThemeName(p.value))}})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"渲染模式"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSelect,{defaultValue:_,options:u,onChange:p=>{p&&e(updateRenderMode(p.value))}})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"显示诊断信息"}),jsxRuntimeExports.jsx(Detail,{children:a?jsxRuntimeExports.jsx(AccentSlider,{onChange:()=>c(!i),isChecked:i}):jsxRuntimeExports.jsx(SettingsErrorMessage,{children:"需要连接JLKB设备"})})]})]}),i&&a?jsxRuntimeExports.jsx(DiagnosticContainer,{children:jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"VIA固件协议"}),jsxRuntimeExports.jsx(Detail,{children:a.protocol})]})}):null]})]})})},name="Tester",lighting="none",layouts={width:22.5,height:6.25,optionKeys:{},keys:[{row:0,col:0,x:0,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"accent"},{row:0,col:1,x:2,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:2,x:3,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:3,x:4,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:4,x:5,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:5,x:6.5,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:6,x:7.5,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:7,x:8.5,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:8,x:9.5,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:9,x:11,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:10,x:12,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:11,x:13,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:12,x:14,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:13,x:15.25,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:14,x:16.25,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:15,x:17.25,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:16,x:18.5,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:17,x:19.5,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:18,x:20.5,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:19,x:21.5,y:0,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:20,x:0,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:21,x:1,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:22,x:2,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:23,x:3,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:24,x:4,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:25,x:5,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:26,x:6,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:27,x:7,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:28,x:8,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:29,x:9,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:30,x:10,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:31,x:11,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:32,x:12,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:33,x:13,y:1.25,r:0,rx:0,ry:0,h:1,w:2,color:"mod"},{row:0,col:34,x:15.25,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:35,x:16.25,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:36,x:17.25,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:37,x:18.5,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:38,x:19.5,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:39,x:20.5,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:40,x:21.5,y:1.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:41,x:0,y:2.25,r:0,rx:0,ry:0,h:1,w:1.5,color:"mod"},{row:0,col:42,x:1.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:43,x:2.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:44,x:3.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:45,x:4.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:46,x:5.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:47,x:6.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:48,x:7.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:49,x:8.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:50,x:9.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:51,x:10.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:52,x:11.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:53,x:12.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:54,x:13.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1.5,color:"alpha"},{row:0,col:55,x:15.25,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:56,x:16.25,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:57,x:17.25,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:58,x:18.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:59,x:19.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:60,x:20.5,y:2.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:61,x:21.5,y:2.25,r:0,rx:0,ry:0,h:2,w:1,color:"mod"},{row:0,col:62,x:0,y:3.25,r:0,rx:0,ry:0,h:1,w:1.75,color:"mod"},{row:0,col:63,x:1.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:64,x:2.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:65,x:3.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:66,x:4.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:67,x:5.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:68,x:6.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:69,x:7.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:70,x:8.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:71,x:9.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:72,x:10.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:73,x:11.75,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:74,x:12.75,y:3.25,r:0,rx:0,ry:0,h:1,w:2.25,color:"accent"},{row:0,col:75,x:18.5,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:76,x:19.5,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:77,x:20.5,y:3.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:78,x:0,y:4.25,r:0,rx:0,ry:0,h:1,w:2.25,color:"mod"},{row:0,col:79,x:2.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:80,x:3.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:81,x:4.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:82,x:5.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:83,x:6.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:84,x:7.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:85,x:8.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:86,x:9.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:87,x:10.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:88,x:11.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:89,x:12.25,y:4.25,r:0,rx:0,ry:0,h:1,w:2.75,color:"mod"},{row:0,col:90,x:16.25,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:91,x:18.5,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:92,x:19.5,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:93,x:20.5,y:4.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"},{row:0,col:94,x:21.5,y:4.25,r:0,rx:0,ry:0,h:2,w:1,color:"accent"},{row:0,col:95,x:0,y:5.25,r:0,rx:0,ry:0,h:1,w:1.25,color:"mod"},{row:0,col:96,x:1.25,y:5.25,r:0,rx:0,ry:0,h:1,w:1.25,color:"mod"},{row:0,col:97,x:2.5,y:5.25,r:0,rx:0,ry:0,h:1,w:1.25,color:"mod"},{row:0,col:98,x:3.75,y:5.25,r:0,rx:0,ry:0,h:1,w:6.25,color:"alpha"},{row:0,col:99,x:10,y:5.25,r:0,rx:0,ry:0,h:1,w:1.25,color:"mod"},{row:0,col:100,x:11.25,y:5.25,r:0,rx:0,ry:0,h:1,w:1.25,color:"mod"},{row:0,col:101,x:12.5,y:5.25,r:0,rx:0,ry:0,h:1,w:1.25,color:"mod"},{row:0,col:102,x:13.75,y:5.25,r:0,rx:0,ry:0,h:1,w:1.25,color:"mod"},{row:0,col:103,x:15.25,y:5.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:104,x:16.25,y:5.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:105,x:17.25,y:5.25,r:0,rx:0,ry:0,h:1,w:1,color:"mod"},{row:0,col:106,x:18.5,y:5.25,r:0,rx:0,ry:0,h:1,w:2,color:"alpha"},{row:0,col:107,x:20.5,y:5.25,r:0,rx:0,ry:0,h:1,w:1,color:"alpha"}]},matrix={rows:1,cols:108},vendorProductId=0,fullKeyboardDefinition={name,lighting,layouts,matrix,vendorProductId},Container$2=styled.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  padding: 0 12px;
`,TestPane=styled(Pane$9)`
  display: flex;
  height: 100%;
  max-width: 100vw;
  flex-direction: column;
`,TestContext=React.createContext([{clearTestKeys:()=>{}},(...e)=>{}]),Test$1=()=>{const e=useDispatch(),t=useAppSelector(getSelectedConnectedDevice),o=useAppSelector(getSelectedDefinition),n=useAppSelector(getSelectedKeyDefinitions),s=useAppSelector(getIsTestMatrixEnabled),r=useAppSelector(getTestKeyboardSoundsSettings),[a]=reactExports.useContext(TestContext),{progress:i}=useProgress(),l=t&&o&&n&&PROTOCOL_GAMMA<=t.protocol,d=s?o:fullKeyboardDefinition;if(!d||typeof d=="string")return null;const u=[{label:"Sine",value:"sine"},{label:"Triangle",value:"triangle"},{label:"Sawtooth",value:"sawtooth"},{label:"Square",value:"square"}],_=u.find(C=>C.value===r.waveform),p=[{label:"Wicki-Hayden",value:TestKeyboardSoundsMode.WickiHayden},{label:"Chromatic",value:TestKeyboardSoundsMode.Chromatic},{label:"Random",value:TestKeyboardSoundsMode.Random}],x=p.find(C=>C.value===r.mode);return i!==100?null:jsxRuntimeExports.jsx(TestPane,{children:jsxRuntimeExports.jsxs(Grid,{children:[jsxRuntimeExports.jsx(MenuCell,{style:{pointerEvents:"all"},children:jsxRuntimeExports.jsx(MenuContainer$5,{children:jsxRuntimeExports.jsx(Row,{$selected:!0,children:jsxRuntimeExports.jsxs(IconContainer,{children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:faCircleQuestion}),jsxRuntimeExports.jsx(MenuTooltip,{children:"按键测试"})]})})})}),jsxRuntimeExports.jsx(SpanOverflowCell,{children:jsxRuntimeExports.jsxs(Container$2,{children:[jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"重置键盘"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentButton,{onClick:a.clearTestKeys,children:"重置"})})]}),l&&o?jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"测试矩阵"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{isChecked:s,onChange:C=>{e(setTestMatrixEnabled(C)),a.clearTestKeys()}})})]}):null,jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"按键声音"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSlider,{isChecked:r.isEnabled,onChange:C=>{e(setTestKeyboardSoundsSettings({isEnabled:C}))}})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"音量"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentRange,{max:100,min:0,defaultValue:r.volume,onChange:C=>{e(setTestKeyboardSoundsSettings({volume:C}))}})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"变调"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentRange,{max:24,min:-24,defaultValue:r.transpose,onChange:C=>{e(setTestKeyboardSoundsSettings({transpose:C}))}})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"波形"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSelect,{isSearchable:!1,defaultValue:_,options:u,onChange:C=>{C&&e(setTestKeyboardSoundsSettings({waveform:C.value}))}})})]}),jsxRuntimeExports.jsxs(ControlRow,{children:[jsxRuntimeExports.jsx(Label$1,{children:"模式"}),jsxRuntimeExports.jsx(Detail,{children:jsxRuntimeExports.jsx(AccentSelect,{isSearchable:!1,defaultValue:x,options:p,onChange:C=>{C&&e(setTestKeyboardSoundsSettings({mode:C.value}))}})})]})]})})]})})},Container$1=styled.div`
  display: flex;
  flex-direction: column;
  padding: 16px;
  user-select: text;
  border-top: 1px solid var(--color_accent);
  &:last-of-type {
    border-bottom: 1px solid var(--color_accent);
  }
`,printId=e=>formatNumberAsHex(e,4),ErrorListContainer=e=>{const{clear:t,save:o,hasErrors:n}=e;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(IconButtonGroupContainer,{style:{margin:"10px 15px"},children:[jsxRuntimeExports.jsxs(IconButtonContainer,{onClick:t,disabled:!n,children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",color:"var(--color_label)",icon:faCancel}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:"Clear"})]}),jsxRuntimeExports.jsxs(IconButtonContainer,{onClick:o,disabled:!n,children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"sm",color:"var(--color_label)",icon:faDownload}),jsxRuntimeExports.jsx(IconButtonTooltip,{children:"Download"})]})]}),e.children]})},AppErrors=({})=>{const e=useAppSelector(getAppErrors),t=useDispatch();return jsxRuntimeExports.jsx(ErrorListContainer,{clear:()=>t(clearAppErrors()),save:()=>saveAppErrors(e),hasErrors:!!e.length,children:e.map(({timestamp:o,deviceInfo:{productId:n,productName:s,vendorId:r},message:a})=>jsxRuntimeExports.jsxs(Container$1,{children:[o,jsxRuntimeExports.jsx("ul",{children:a==null?void 0:a.split(`
`).map(i=>jsxRuntimeExports.jsx("li",{children:i}))}),jsxRuntimeExports.jsxs("ul",{children:[jsxRuntimeExports.jsxs("li",{children:["Device: ",s]}),jsxRuntimeExports.jsxs("li",{children:["Vid: ",printId(r)]}),jsxRuntimeExports.jsxs("li",{children:["Pid: ",printId(n)]})]})]},o))})};async function saveErrors(e,t,o,n){try{const s=await window.showSaveFilePicker({suggestedName:`${o}.csv`}),r=[t.join(", ")],a=e.map(n),i=r.concat(...a).join(`
`),c=new Blob([i],{type:"text/csv"}),l=await s.createWritable();await l.write(c),await l.close()}catch{console.log("User cancelled save errors request")}}const saveAppErrors=async e=>saveErrors(e,["timestamp","productName","vendorId","productId","message"],"VIA-app-errors",({timestamp:t,deviceInfo:{productName:o,vendorId:n,productId:s},message:r})=>`${t}, ${o}, ${printId(n)}, ${printId(s)}, "${r}"`),IconButtonGroupContainer=styled.div`
  border-radius: 2px;
  border: 1px solid var(--border_color_icon);
  display: inline-flex;
  > button:last-child {
    border: none;
  }
`,ErrorPanes=[[1,AppErrors,faComputer,"App"]],Errors=()=>{const[e,t]=reactExports.useState(0),o=(ErrorPanes.find(([n])=>e===n)||ErrorPanes[0])[1];return jsxRuntimeExports.jsx(Pane$9,{children:jsxRuntimeExports.jsxs(Grid,{style:{overflow:"hidden"},children:[jsxRuntimeExports.jsx(MenuCell,{style:{pointerEvents:"all",borderTop:"none"},children:jsxRuntimeExports.jsx(MenuContainer$5,{children:ErrorPanes.map(([n,s,r,a])=>jsxRuntimeExports.jsx(Row,{$selected:e===n,onClick:()=>{t(n)},children:jsxRuntimeExports.jsxs(IconContainer,{children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{icon:r}),jsxRuntimeExports.jsx(MenuTooltip,{children:a})]})},n))})}),jsxRuntimeExports.jsx(SpanOverflowCell,{style:{flex:1,borderWidth:0},children:jsxRuntimeExports.jsx(o,{})})]})})},ErrorLink=()=>{const e=useAppSelector(getAppErrors),[t]=useLocation(),o=t==="/errors";return e.length?jsxRuntimeExports.jsx(Link$1,{to:"/errors",children:jsxRuntimeExports.jsxs(CategoryIconContainer,{$selected:o,children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"xl",icon:ErrorsPaneConfig.icon,color:o?"inherit":"gold"}),jsxRuntimeExports.jsxs(CategoryMenuTooltip,{children:[e.length," error",e.length>1?"s":""]})]})}):null},ErrorsPaneConfig={component:Errors,path:"/errors",icon:faWarning,key:"errors",title:"Errors"},PANES=[{key:"default",component:ConfigurePane,icon:faKeyboard,title:"配置",path:"/"},{key:"test",component:Test$1,icon:faStethoscope,path:"/test",title:"按键检测"},{key:"design",component:DesignTab,icon:faBrush,path:"/design",title:"设计"},{key:"settings",component:Settings,icon:faGear,path:"/settings",title:"设置"},{key:"debug",icon:faBug,component:Debug,path:"/debug",title:"Debug"},ErrorsPaneConfig],VIALogo=e=>jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 525.74 268.41",...e,children:[jsxRuntimeExports.jsx("defs",{children:jsxRuntimeExports.jsx("style",{children:".cls-1{fill:currentColor}"})}),jsxRuntimeExports.jsx("g",{id:"Layer_2","data-name":"Layer 2",children:jsxRuntimeExports.jsx("g",{id:"Layer_2-2","data-name":"Layer 2",children:jsxRuntimeExports.jsx("path",{className:"cls-1",d:"M454.1,249.7V102.5h-27.5v59.9h-15.2v-59.9h-27.5v59.9h-144.9c-1.5-5-3.3-10.1-5.4-15.4-1.2-3-2.6-5.9-3.9-8.9-2.3-5-4.5-9.8-6-14.8,7.8-7.5,18.2-11.2,29.2-15.2,7.9-2.9,16.1-5.8,23.3-10.3,18.3-11.4,16.8-29.1,12.4-46.6-.7-2.8-1.7-5.6-2.6-8.5l-.3-.2h0c-1.2-3.4-2.2-6.6-2.8-9.6-.4-2-.3-4.1-.2-6.2.3-5.1.6-11.4-6.2-16.7-6.1-4.8-14.5-4.7-20.2.3-1.3,1.1-1.9,2-3,2.8-8.9,1.8-24.8,1.8-33.4.7-9.1-1.2-17.2-4.1-25-6.9-17.5-6.3-34-12.2-56.7,1.7-31.6,19.2-53.2,65.9-34.8,99.7,8.9,16.4,26.9,27.2,43.3,26.1,13.7-.8,24.4-9.2,30.1-23.6.1-.3,11.9-30.4,0-38.7-1.6-1.1-6.4-3.4-9.9-.8-3.5,2.5-4.3,8.8-5.2,18.1-.2,2-.4,3.7-.6,4.7-1.6,7.7-5.3,12.4-10.9,13.8-7.1,1.7-16.1-2.4-22.3-10.2-13.6-17.1-9.2-38.3-.7-52.4,11.5-18.9,31-28.9,49.5-25.4,7.3,1.4,14.7,4.7,22.5,8.2,11.2,5,22.8,10.2,35.3,10.2h.3l23.3.4c.7,1.3,1.8,3.4,2.5,5,6.9,15.1,8.1,26.7,3.3,31.8-3.1,3.3-12.2,6.5-18.9,8.8-3.1,1.1-5.9,2.1-8.1,3-13.7,5.8-29.8,14.2-32.5,27.7-1.8,9.5,3,21.3,7.3,31.7,1.3,3.1,2.5,6,3.3,8.5.8,2.4,1.6,4.8,2.2,7.2h-104.2c5.6-3.8,11.7-6.8,18.4-8.7,1.1-.3,2.6-.6,4.3-.9,4.4-.8,7.4-1.4,9.3-2.5,2-1.2,4.3-4.3,4.8-7.2.3-1.8-.2-3.4-1.3-4.7-4-4.6-16.3-3.2-16.9-3.1-36.4,4.3-69.9,42.2-78.4,74.8-.8,3-1.5,7.1-2.2,11.5-1.6,9.4-3.7,22.2-7.7,26.4-1,1-2,1.3-3.4,1.2-5.3-.5-12.7-7.7-15.8-12.5-7.1-10.9-4.8-25-2.6-38.6.6-3.5,1.1-7,1.6-11.1.3-2.8.8-6.3.6-8.8l.2-2.5-3.3-2.9-3.9.7-1,1.6c-8.1,13.1-13.5,28.4-15.1,43.1-1.8,16.2,1.8,29.4,10.6,39.1,10.8,11.9,29.4,18,53.1,17.8,15.6-.6,31.8-.2,47.4,0,9.6.2,19.3.4,29,.4s15.5-.1,23.2-.5c7.7-.4,16.3-1.6,21.1-7.2,2.6-3.1,3.6-7.1,3.1-11.8-.5-4.1-2.1-7.2-4.8-9.3-4.3-3.3-10.3-2.9-15.6-2.2h-.2c1.7-9.7,3.1-18.9-2.2-29.2-5.1-10-21.6-25.7-34.8-20.2-.9.4-3.7,1.5-4.5,4.4-.8,2.9.9,5.4,1.8,6.7,2,2.9,5,4.5,7.8,6.1,2.2,1.2,4.3,2.4,5.6,3.9,2.8,3.2,4.1,8,3.8,13.2-.4,5.7-2.8,10.9-6.4,14-3,2.5-14.5,4.7-29.2,5.6-16.2,1-28.9.7-35.7-.7h-.5c-3-9,1.2-27.6,4.7-37.5,5.9-17,17.6-36.3,34.7-48.2h104.7c6.1,21.8,5.6,42.4-1.6,65.6-1.2,3.9-2.7,7.7-4.3,11.5-1.7,4.3-3.6,8.8-4.9,13.4-4.4,15-.9,17.3.5,18.2,2.4,1.6,8.5,3,8.6,3.1,3.4.8,8.1,1.4,13.1,1.4,8.3,0,17.6-1.7,23.3-6.7,5.2-4.5,6.3-10.3,3.3-17.2-3.9-9.2-11.6-8.3-17.2-7.1.6-2.6,1.2-5.2,1.8-7.7,1.6-7,3.3-14.3,4.3-21.7,2.2-17.4.6-34.1-5.1-52.8h144.8v54.5c0,16.6-3.4,23.5-6.3,26.4-2.9,2.9-7.4,4.6-13,4.6s-8.2-1.5-11.3-4.7c-2.5-2.5-5.5-8.5-5.5-23v-20h-27.5v15.8c0,20.6,4.6,35.6,13.7,44.7s19.1,12.9,31.4,12.9,23.6-4.3,32.2-12.9,13.8-24.2,13.8-44.7v-53.6h15.2v111.3h95.2v-24.2h-67.7Z"})})})]}),ExternalLinkContainer=styled.span`
  position: absolute;
  right: 1em;
  display: flex;
  gap: 1em;
`,ExternalLinks=()=>jsxRuntimeExports.jsxs(ExternalLinkContainer,{children:[jsxRuntimeExports.jsx("a",{href:"https://jlkb.jlkb.top/",target:"_blank",children:jsxRuntimeExports.jsxs(CategoryIconContainer,{children:[jsxRuntimeExports.jsx(VIALogo,{height:"25px",fill:"currentColor"}),jsxRuntimeExports.jsx(CategoryMenuTooltip,{children:"JLKB"})]})}),jsxRuntimeExports.jsx("a",{href:"https://lhfha.x3322.net:8100/",target:"_blank",children:jsxRuntimeExports.jsxs(CategoryIconContainer,{children:[jsxRuntimeExports.jsx(VIALogo,{height:"25px",fill:"currentColor"}),jsxRuntimeExports.jsx(CategoryMenuTooltip,{children:"备用地址"})]})}),jsxRuntimeExports.jsx("a",{href:"https://vial.jlkb.top/",target:"_blank",children:jsxRuntimeExports.jsxs(CategoryIconContainer,{children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"xl",icon:faDiscord}),jsxRuntimeExports.jsx(CategoryMenuTooltip,{children:"Via-JL"})]})}),jsxRuntimeExports.jsx("a",{href:"https://github.com/the-via/app",target:"_blank",children:jsxRuntimeExports.jsxs(CategoryIconContainer,{children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"xl",icon:faGithub}),jsxRuntimeExports.jsx(CategoryMenuTooltip,{children:"Github"})]})})]}),__vite_import_meta_env__={DEV:!1},Container=styled.div`
  width: 100vw;
  height: 25px;
  padding: 12px 0;
  border-bottom: 1px solid var(--border_color_cell);
  display: flex;
  align-items: center;
  justify-content: center;
`,{DEBUG_PROD,DEV}=__vite_import_meta_env__,showDebugPane=DEBUG_PROD==="true"||DEV,GlobalContainer=styled(Container)`
  background: var(--bg_outside-accent);
  column-gap: 20px;
`,UnconnectedGlobalMenu=()=>{const e=useAppSelector(getShowDesignTab),[t]=useLocation(),o=reactExports.useMemo(()=>PANES.filter(n=>n.key!==ErrorsPaneConfig.key).map(n=>n.key==="design"&&!e||n.key==="debug"&&!showDebugPane?null:jsxRuntimeExports.jsx(Link$1,{to:n.path,children:jsxRuntimeExports.jsxs(CategoryIconContainer,{$selected:n.path===t,children:[jsxRuntimeExports.jsx(FontAwesomeIcon,{size:"xl",icon:n.icon}),jsxRuntimeExports.jsx(CategoryMenuTooltip,{children:n.title})]})},n.key)),[t,e]);return jsxRuntimeExports.jsx(React.Fragment,{children:jsxRuntimeExports.jsxs(GlobalContainer,{children:[jsxRuntimeExports.jsx(ErrorLink,{}),o,jsxRuntimeExports.jsx(ExternalLinks,{})]})})},overrideParam=new URL(window.location.href).searchParams.get("override_hid_check");overrideParam!==null&&localStorage.setItem("override_hid_check",overrideParam);const overrideHidCheck=localStorage.getItem("override_hid_check")||"false",OVERRIDE_HID_CHECK=!!JSON.parse(overrideHidCheck),ErrorHome=styled.div`
  background: var(--bg_gradient);
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  height: 100%;
  overflow: hidden;
  height: auto;
  left: 0;
  right: 0;
  bottom: 0;
  padding-top: 24px;
  position: absolute;
  border-top: 1px solid var(--border_color_cell);
`,UsbError=styled.div`
  align-items: center;
  display: flex;
  color: var(--color_label);
  flex-direction: column;
  height: 100%;
  justify-content: center;
  margin: 0 auto;
  max-width: 650px;
  text-align: center;
`,UsbErrorIcon=styled.div`
  font-size: 2rem;
`,UsbErrorHeading=styled.h1`
  margin: 1rem 0 0;
`,UsbErrorWebHIDLink=styled.a`
  text-decoration: underline;
  color: var(--color_label-highlighted);
`,timeoutRepeater=(e,t,o=0)=>()=>setTimeout(()=>{e(),o>0&&timeoutRepeater(e,t,o-1)()},t),Home=e=>{const{hasHIDSupport:t}=e,o=useAppDispatch();useAppSelector(getSelectedKey),useAppSelector(getSelectedDefinition),useAppSelector(getConnectedDevices),useAppSelector(getSelectedLayerIndex),useAppSelector(getSelectedKeyDefinitions),useAppSelector(getDisableFastRemap);const{basicKeyToByte:n}=useAppSelector(getBasicKeyToByte),s=useAppSelector(getSelectedKeyboardAPI),r=timeoutRepeater(()=>{o(reloadConnectedDevices())},500,1),a=reactExports.createRef();return reactExports.useEffect(()=>{if(t)return a.current&&a.current.focus(),startMonitoring(),usbDetect.on("change",r),o(loadSupportedIds()),()=>{usbDetect.off("change",r)}},[]),reactExports.useEffect(()=>{o(updateSelectedKey(null))},[s]),!t&&!OVERRIDE_HID_CHECK?jsxRuntimeExports.jsx(ErrorHome,{ref:a,tabIndex:0,children:jsxRuntimeExports.jsxs(UsbError,{children:[jsxRuntimeExports.jsx(UsbErrorIcon,{children:"❌"}),jsxRuntimeExports.jsx(UsbErrorHeading,{children:"USB Detection Error"}),jsxRuntimeExports.jsxs("p",{children:["Looks like there was a problem getting USB detection working. Right now, we only support"," ",jsxRuntimeExports.jsx(UsbErrorWebHIDLink,{href:"https://caniuse.com/?search=webhid",target:"_blank",children:"browsers that have WebHID enabled"}),", so make sure yours is compatible before trying again."]})]})}):jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:e.children})},cubeySrc="/via-jl/assets/cubey-BnxRIwvg.glb",glbSrc="/via-jl/assets/keyboard_components-DECp5JAr.glb",useSize=e=>{const[t,o]=reactExports.useState();return reactExports.useLayoutEffect(()=>{e.current&&o(e.current.getBoundingClientRect())},[e]),useResizeObserver(e,n=>o(n.contentRect)),t};var DisplayMode=(e=>(e[e.Test=1]="Test",e[e.Configure=2]="Configure",e[e.Design=3]="Design",e[e.ConfigureColors=4]="ConfigureColors",e))(DisplayMode||{}),KeycapState=(e=>(e[e.Pressed=1]="Pressed",e[e.Unpressed=2]="Unpressed",e))(KeycapState||{});const useColorPainter=(e,t)=>{const o=useAppSelector(getSelectedConnectedDevice),n=useAppSelector(getSelectedKeyboardAPI),s=useAppSelector(getSelectedCustomMenuData)||{__perKeyRGB:[]},[r,a]=reactExports.useState([]);reactExports.useEffect(()=>{const c=s.__perKeyRGB??[],d=(e.find(u=>"li"in u)?e.map(u=>u.li??-1):[]).map(u=>{const _=c[u??-1];if(_)return getHSVFrom256(_)});a(d)},[s.__perKeyRGB&&s.__perKeyRGB.length,e]);const i=reactExports.useCallback((c,l)=>{if(c.buttons===1&&n){const d=Math.round(t[0]*255/360),u=Math.round(t[1]*255),_=e[l].li;_!==void 0&&(n.setPerKeyRGBMatrix(_,d,u),n.commitCustomMenu(0),a(p=>(p[l]=t,[...p])))}},[a,t,e,o]);return{keyColors:r,onKeycapPointerDown:i,onKeycapPointerOver:i}},Heart=React.memo(e=>{const t=Math.atan(2/e.caseWidth),o=50/2,n=2,s=1,a=-(-e.caseWidth-s*2-n*2)/Math.cos(t),i=.1*a/22,c=95,l=95*i,d=(a-l)/2,u=reactExports.useMemo(()=>{const p=new Shape;return p.moveTo(i*(25-o),i*(25-c)),p.bezierCurveTo(i*(25-o),i*(25-c),i*(20-o),i*(0-c),i*(0-o),i*(0-c)),p.bezierCurveTo(i*(-30-o),i*(0-c),i*(-30-o),i*(35-c),i*(-30-o),i*(35-c)),p.bezierCurveTo(i*(-30-o),i*(55-c),i*(-10-o),i*(77-c),i*(25-o),i*(95-c)),p.bezierCurveTo(i*(60-o),i*(77-c),i*(80-o),i*(55-c),i*(80-o),i*(35-c)),p.bezierCurveTo(i*(80-o),i*(35-c),i*(80-o),i*(0-c),i*(50-o),i*(0-c)),p.bezierCurveTo(i*(35-o),i*(0-c),i*(25-o),i*(25-c),i*(25-o),i*(25-c)),p},[e.caseWidth,e.caseHeight,e.color]),_={depth:4,bevelEnabled:!0,bevelSegments:10,bevelSize:1,bevelThickness:1};return jsxRuntimeExports.jsxs("mesh",{position:[-a+d,n*2+s*2+e.caseHeight/2,0],scale:1,rotation:[Math.PI/2,t,Math.PI/2],children:[jsxRuntimeExports.jsx("extrudeGeometry",{attach:"geometry",args:[u,_]}),jsxRuntimeExports.jsx("meshPhongMaterial",{color:e.color,transparent:!0,opacity:1})]})},shallowEqual),makeShape2=e=>{const n=10+Math.tan(Math.PI*7.5/180)*e,s=e/2,r=new Shape;let a=2,i=Math.PI/2;return r.moveTo(-n,s),r.absarc(-n-a,s-a,a,i*1+i,i*1,!0),r.absarc(-2,s,a,i*1,i*1-i,!0),r.absarc(-2,-s,a,i*3+i,i*3,!0),r.absarc(-10-a,-s-a,a,i*2+i,i*2,!0),r},Case$1=React.memo(e=>{const t=useAppSelector(getSelectedTheme),o=reactExports.useMemo(()=>t[distExports.KeyColorType.Accent].c,[t]),n="#212020",s=reactExports.useMemo(()=>t[distExports.KeyColorType.Accent].t,[t]),r=e.width*KeycapMetric.keyXPos-KeycapMetric.keyXSpacing,a=KeycapMetric.keyYPos*e.height-KeycapMetric.keyYSpacing,i=4,c=r+i*1,l=r+i*2.5,[d,u]=reactExports.useMemo(()=>[a+i,a+i*2].map(makeShape2),[a]),_=1,p=10,m=10+Math.tan(Math.PI*7.5/180)*(a+i*2);return jsxRuntimeExports.jsxs("group",{scale:1,"position-z":-1*2,"rotation-y":-Math.PI/2,children:[jsxRuntimeExports.jsx(Heart,{caseWidth:m,caseHeight:a,color:s}),jsxRuntimeExports.jsxs("mesh",{position:[-1,0,-l/2],castShadow:!0,children:[jsxRuntimeExports.jsx("extrudeGeometry",{attach:"geometry",args:[u,{depth:l,bevelEnabled:!0,bevelSize:_,bevelThickness:_,bevelSegments:p}]}),jsxRuntimeExports.jsx("meshPhongMaterial",{color:o,shininess:100,reflectivity:1,specular:getDarkenedColor(o,.2)})]}),jsxRuntimeExports.jsxs("mesh",{position:[0,0,-c/2],castShadow:!0,children:[jsxRuntimeExports.jsx("extrudeGeometry",{attach:"geometry",args:[d,{depth:c,bevelEnabled:!0,bevelSize:_/2,bevelThickness:_,bevelSegments:p}]}),jsxRuntimeExports.jsx("meshPhongMaterial",{color:n,shininess:100,reflectivity:1,specular:getDarkenedColor(o,.2)})]})]})});function useSkipFontCheck(){const[e,t]=reactExports.useState(!1),o=reactExports.useCallback(()=>{t(!1)},[]),n=reactExports.useCallback(()=>{t(!0)},[]);return reactExports.useEffect(()=>{document.fonts.load("Fira Sans").then(o,n)},[]),e}function getKeycapSharedProps(e,t,o,n,s,r,a){const{position:i,rotation:c,scale:l,color:d,idx:u,onClick:_,onPointerDown:p,onPointerOver:x}=n.coords[t],C=e.ei!==void 0;return{mode:o.mode,position:i,rotation:c,scale:getScale(e,l),textureWidth:e.w,textureHeight:e.h,textureOffsetX:e.w2?Math.abs(e.w2-e.w):0,color:d,shouldRotate:C,onPointerDown:p,onPointerOver:x,keyState:o.pressedKeys?o.pressedKeys[t]:-1,disabled:!o.selectable,selected:t===s,idx:u,label:r[t],onClick:_,key:n.indices[t],skipFontCheck:a}}const getKeysKeysIndices=e=>(t,o)=>{const n=t.ei!==void 0;return`${e}-${o}-${t.w}-${t.h}-${n}`};function getLabels(e,t,o,n){return e.matrixKeycodes.length?e.keys.map((s,r)=>getLabel(e.matrixKeycodes[r],s.w,t,e.definition,o,n)):[]}function getKeysKeys(e,t,o,n){const{keys:s}=e,{rowMap:r}=getKeyboardRowPartitions(s),a=s.map(distExports.getBoundingBox),[i,c]=[Math.min(...a.map(d=>d.xStart)),Math.min(...a.map(d=>d.yStart))],l=s.map(d=>{const u={...d};return i<0&&(u.x=u.x-i),c<0&&(u.y=u.y-c),u}).map(calculatePointPosition);return{indices:s.map(getKeysKeysIndices(e.definition.vendorProductId)),coords:s.map((d,u)=>{const[_,p]=l[u],x=d.r*(2*Math.PI)/360,C=KeycapMetric.keyXSpacing/KeycapMetric.keyWidth,m=KeycapMetric.keyYSpacing/KeycapMetric.keyHeight,h=(1+C)*(d.w2||d.w)-C,K=d.h*(1+m)-m,y=getMeshName(d,r[getKeyId(d)],!1),g=e.keyColors?u:d.color,R=t[g];return{position:n(_+i,p+c),rotation:[0,0,-x],scale:[h,K,1],color:R,meshKey:y,idx:u,onClick:(b,f)=>{b.stopPropagation(),o(updateSelectedKey(f))},onPointerDown:e.onKeycapPointerDown,onPointerOver:e.onKeycapPointerOver}})}}const getMacroData$1=({macroExpression:e,label:t})=>t&&t.length>15?t:e&&e.length?e:null,paintEncoder=(e,[t,o],n,s)=>{const[i,c]=[512*t,512*o];e.width=i,e.height=c;const l=e.getContext("2d"),d=2.6;if(l){l.fillStyle=n,l.clearRect(0,0,e.width,e.height),l.fillRect(0,0,e.width,e.height),l.fill(),l.fillStyle=s;const u=.4*i/d;l.ellipse(.5*i/d,2.1*c/d,u,u,Math.PI/4,0,2*Math.PI),l.fill()}},paintKeycapLabel$1=(e,t,o,n)=>{const s=e.getContext("2d");if(s==null)return;const r="Fira Sans, Arial Rounded MT, Arial Rounded MT Bold, Arial",a={x:.015,y:.02},i={x:.01,y:-.01},c={x:.01,y:.02};if(s.beginPath(),s.moveTo(t.bl.x*e.width,(1-t.bl.y)*e.height),s.lineTo(t.bl.x*e.width,(1-t.tr.y)*e.height),s.lineTo(t.tr.x*e.width,(1-t.tr.y)*e.height),s.lineTo(t.tr.x*e.width,(1-t.bl.y)*e.height),s.lineTo(t.bl.x*e.width,(1-t.bl.y)*e.height),s.clip(),s.fillStyle=o,n!==void 0){if(n.topLabel&&n.bottomLabel){let l=52,d=.75*l/e.height,u=n.offset[0]*d,_=n.offset[1]*d;s.font=`bold ${l}px ${r}`,s.fillText(n.topLabel,(t.bl.x+a.x)*e.width,(1-(t.tr.y-d-a.y-u))*e.height),s.fillText(n.bottomLabel,(t.bl.x+a.x)*e.width,(1-(t.bl.y+a.y+_))*e.height)}else if(n.centerLabel){let l=37.5*n.size,d=.75*l/e.height,u=(t.tr.y+t.bl.y)/2;return s.font=`bold ${l}px ${r}`,s.fillText(n.label,(t.bl.x+i.x)*e.width,(1-(u-.5*d-i.y))*e.height),s.measureText(n.centerLabel).width>(t.tr.x-(t.bl.x+i.x))*e.width}else if(typeof n.label=="string"){let l=75,d=.75*l/e.height;s.font=`bold ${l}px ${r}`,s.fillText(n.label,(t.bl.x+c.x)*e.width,(1-(t.tr.y-d-c.y))*e.height)}}},calculateTextureRects=(e,t,o,n,s)=>{const r=.3846153846153846,c=.445/19.05*r;let l=Math.min(2.75,o),d=Math.min(2.75,n);(e>1||t>1)&&(l=1,d=1);let u={bl:{x:c,y:c},tr:{x:l*r-c,y:d*r-c}},_={bl:{x:u.bl.x+.07,y:u.bl.y+.08},tr:{x:u.tr.x-.07,y:u.tr.y-.0146}};return s>0&&(_.bl.x+=s*r,_.tr.x+=s*r,u.bl.x+=s*r,u.tr.x+=s*r),{keycapRect:u,faceRect:_}},paintKeycap$1=(e,[t,o],n,s,r,a,i,c)=>{const l=calculateTextureRects(t,o,n,s,c),d=512;e.width=d*t,e.height=d*o;const u=e.getContext("2d");if(u!=null)return u.fillStyle=r,u.fillRect(0,0,e.width,e.height),paintKeycapLabel$1(e,l.faceRect,a,i)},Keycap$1=React.memo(e=>{const{label:t,scale:o,color:n,onClick:s,selected:r,disabled:a,mode:i,rotation:c,keyState:l,shouldRotate:d,keycapGeometry:u,textureOffsetX:_,textureWidth:p,textureHeight:x,onPointerOver:C,onPointerDown:m,idx:h}=e,K=reactExports.useRef(),y=t&&getMacroData$1(t),[g,R]=reactExports.useState(!1),[b,f]=reactExports.useState(!1),M=reactExports.useRef(),D=reactExports.useRef(document.createElement("canvas")),w=React.useCallback(()=>{if(D.current&&n){if(d)paintEncoder(D.current,[o[0],o[1]],n.c,n.t);else{const B=paintKeycap$1(D.current,[o[0],o[1]],p,x,n.c,n.t,t,_);R(!!B)}M.current.needsUpdate=!0}},[D.current,p,t&&t.key,o[0],o[1],n&&n.t,n&&n.c,d]);reactExports.useEffect(w,[t&&t.key,n&&n.c,n&&n.t]);const I=useSpring({config:{duration:800},from:{x:0,y:"#f4a0a0"},loop:r?{reverse:!0}:!1,to:{x:100,y:"#b49999"}});let O=u.boundingBox.max.z;const[S,j]=[O,O+8],A=DisplayMode.Test===i?TestKeyState.KeyDown===l?KeycapState.Pressed:KeycapState.Unpressed:b||r?KeycapState.Unpressed:KeycapState.Pressed,[T,L]=A===KeycapState.Pressed?[S,c[2]]:[j,c[2]+Math.PI*Number(d)],N=l===TestKeyState.KeyUp,k=DisplayMode.Test===i?A===KeycapState.Unpressed?N?"palevioletred":"lightgrey":"pink":(A===KeycapState.Unpressed,"lightgrey"),{z:F,b:G,rotateZ:V,tooltipScale:U}=useSpring({config:{duration:100},z:T,b:k,rotateZ:L,tooltipScale:b?1:0}),[H,$,Y,W]=reactExports.useMemo(()=>{const B=()=>{};return a?[B,B,B,B]:e.mode===DisplayMode.ConfigureColors?[B,P=>{C&&C(P,h)},B,P=>{m&&m(P,h)}]:[P=>s(P,h),P=>{C&&C(P,h),f(!0)},()=>f(!1),P=>{m&&m(P,h)}]},[a,s,m,C,f,h,i]),Q=animated.meshPhongMaterial;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(animated.mesh,{...e,ref:K,"position-z":F,"rotation-z":V,onClick:H,onPointerDown:W,onPointerOver:$,onPointerOut:Y,geometry:u,children:jsxRuntimeExports.jsx(Q,{attach:"material",color:r?I.y:G,children:jsxRuntimeExports.jsx("canvasTexture",{ref:M,attach:"map",image:D.current})})}),(y||g)&&jsxRuntimeExports.jsx(React.Suspense,{fallback:null,children:jsxRuntimeExports.jsx(animated.group,{position:e.position,"position-z":20,scale:U,children:jsxRuntimeExports.jsx(Html,{transform:!0,style:{pointerEvents:"none"},children:jsxRuntimeExports.jsx(KeycapTooltip,{children:y||t&&t.tooltipLabel})})})})]})},shallowEqual),getSRGBArray=e=>e.map(([t,o])=>{const n=getRGB({hue:Math.round(255*t/360),sat:Math.round(255*o)}),s=`#${new Color(n).convertSRGBToLinear().getHexString()}`;return{c:s,t:s}}),getPosition$1=(e,t)=>[KeycapMetric.keyXPos*e/CSSVarObject.keyXPos,-t*KeycapMetric.keyYPos/CSSVarObject.keyYPos,0],KeyGroup$1=e=>{const t=useAppDispatch(),o=useGLTF(glbSrc,!0).scene,n=useAppSelector(getSelectedKey),s=useAppSelector(getSelectedSRGBTheme),r=useAppSelector(getExpressions),a=useSkipFontCheck(),i=e.keyColors?getSRGBArray(e.keyColors):s,{basicKeyToByte:c,byteToKey:l}=useAppSelector(getBasicKeyToByte),d=useAppSelector(y=>y.macros),{keys:u,selectedKey:_}=e,p=_===void 0?n:_,x=reactExports.useMemo(()=>getKeysKeys(e,i,t,getPosition$1),[u,i,e.onKeycapPointerDown,e.onKeycapPointerOver]),C=reactExports.useMemo(()=>getLabels(e,r,c,l),[u,e.matrixKeycodes,d,e.definition]),{width:m,height:h}=calculateKeyboardFrameDimensions(u),K=reactExports.useMemo(()=>e.keys.map((y,g)=>{const{meshKey:R}=x.coords[g],{key:b,...f}=getKeycapSharedProps(y,g,e,x,p,C,a);return y.d?null:jsxRuntimeExports.jsx(Keycap$1,{keycapGeometry:(o.getObjectByName(R)||o.getObjectByName("K-R1-100")).geometry,...f},b)}),[u,p,C,e.pressedKeys,e.selectable,i,e.definition.vendorProductId,a]);return jsxRuntimeExports.jsx("group",{scale:1,position:[(-m*KeycapMetric.keyXPos+KeycapMetric.keyXSpacing)/2,(KeycapMetric.keyYPos*h-KeycapMetric.keyYSpacing)/2,0],children:K})},generateRowColArray=(e,t,o)=>{const n=e.filter(a=>a.ei===void 0&&!a.d),s=n.reduce((a,i)=>(a[i.row][i.col]=calculatePointPosition(i),a),Array(t).fill(0).map(()=>Array(o).fill(0))).map(a=>a.sort((i,c)=>i[0]-c[0])),r=n.reduce((a,i)=>(a[i.col][i.row]=calculatePointPosition(i),a),Array(o).fill(0).map(()=>Array(t).fill(0))).map(a=>a.sort((i,c)=>i[1]-c[1]));return{rowKeys:s,colKeys:r}},MatrixLines$1=({keys:e,rows:t,cols:o,width:n,height:s})=>{const[r,a]=["lightpink","lightgrey"],{rowKeys:i,colKeys:c}=generateRowColArray(e,t,o);return jsxRuntimeExports.jsx("group",{scale:.35,rotation:[Math.PI,0,0],position:[-n*KeycapMetric.keyXPos/2,(s+.4)*KeycapMetric.keyYPos/2,11],children:jsxRuntimeExports.jsxs(Segments,{lineWidth:1,children:[i.flatMap(l=>{const d=l.filter(u=>u);return d.length>=2?d.reduce((u,_,p)=>u.prev===null?{res:[],prev:_}:{res:[...u.res,jsxRuntimeExports.jsx(Segment,{start:[u.prev[0],u.prev[1],0],end:[_[0],_[1],0],color:r},`row-${p}`)],prev:_},{res:[],prev:null}).res:[]}),c.flatMap(l=>{const d=l.filter(u=>u);return d.length>=2?d.reduce((u,_,p)=>u.prev===null?{res:[],prev:_}:{res:[...u.res,jsxRuntimeExports.jsx(Segment,{start:[u.prev[0],u.prev[1],0],end:[_[0],_[1],0],color:a},`col-${p}`)],prev:_},{res:[],prev:null}).res:[]})]})},`${t}-${o}-${n}-${s}`)},KeyboardCanvas$1=e=>{const{containerDimensions:t,shouldHide:o,...n}=e,{width:s,height:r}=reactExports.useMemo(()=>calculateKeyboardFrameDimensions(n.keys),[n.keys]),[a,i]=reactExports.useState(!1),{verticalPostion:c,tilt:l}=useSpring({config:{tension:35,friction:5,mass:.3},verticalPostion:a?1:-3,tilt:a?-.15:0});reactExports.useEffect(()=>{const u=document.querySelector("canvas");u&&(u.addEventListener("mouseenter",()=>{i(!0)}),u.addEventListener("mouseleave",()=>{i(!1)}))},[]);const d=Math.min(Math.min(1,t&&t.width/((CSSVarObject.keyWidth+CSSVarObject.keyXSpacing)*s-CSSVarObject.keyXSpacing+70)),500/((CSSVarObject.keyHeight+CSSVarObject.keyYSpacing)*r-CSSVarObject.keyYSpacing+70))||1;return jsxRuntimeExports.jsx("group",{position:[0,-0,-19],scale:.015*d,visible:!o,children:jsxRuntimeExports.jsx(KeyboardCanvasContent$1,{...n,width:s,height:r,verticalPostion:c,tilt:l})})},KeyboardCanvasContent$1=React.memo(e=>{const{matrixKeycodes:t,keys:o,definition:n,pressedKeys:s,mode:r,showMatrix:a,selectable:i,width:c,height:l,verticalPostion:d,tilt:u}=e;return jsxRuntimeExports.jsx(animated.group,{"position-y":d,"rotation-x":u,children:jsxRuntimeExports.jsxs(PresentationControls,{enabled:e.mode!==DisplayMode.ConfigureColors,global:!0,snap:!0,speed:1,zoom:1,polar:[-Math.PI/10,Math.PI/10],azimuth:[-Math.PI/16,Math.PI/16],config:{mass:1,tension:170,friction:26},children:[jsxRuntimeExports.jsx(Case$1,{width:c,height:l}),jsxRuntimeExports.jsx(KeyGroup$1,{...e,keys:o,mode:r,matrixKeycodes:t,selectable:i,definition:n,pressedKeys:s}),a&&jsxRuntimeExports.jsx(MatrixLines$1,{keys:o,rows:n.matrix.rows,cols:n.matrix.cols,width:c,height:l})]})})},shallowEqual),CaseGroup=styled.div``,OuterCase=styled.div`
  background: ${e=>e.background};
  width: ${e=>e.width}px;
  height: ${e=>e.height}px;
`,InnerCase=styled.div`
  background: ${e=>e.background};
  top: 0;
  left: 0;
  position: absolute;
  width: ${e=>e.width}px;
  height: ${e=>e.height}px;
`,CaseInsideBorder=10,Case=React.memo(e=>{const t=useAppSelector(getSelectedTheme),o=reactExports.useMemo(()=>t[distExports.KeyColorType.Accent].c,[t]),n=e.width*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing,s=CSSVarObject.keyYPos*e.height-CSSVarObject.keyYSpacing,r=CSSVarObject.insideBorder,a=n+r*1,i=n+r*3,[c,l]=[s+r,s+r*3],[d,u,_]=[.15,.25,.2].map(p=>getDarkenedColor(o,p));return jsxRuntimeExports.jsxs(CaseGroup,{children:[jsxRuntimeExports.jsx(OuterCase,{background:o,width:i,height:l,style:{borderRadius:8,boxShadow:"var(--box-shadow-keyboard)"}}),jsxRuntimeExports.jsx(InnerCase,{background:`linear-gradient(200deg,${d} 40%,${u},${_} 80%)`,width:a,height:c,style:{transform:`translate( ${a-n}px,
           ${c-s}px)`,boxShadow:"var(--box-shadow-keyboard)",borderRadius:8}})]})},shallowEqual),KeycapContainer=styled.div`
  position: absolute;
  left: 0;
  top: 0;
  width: 52px;
  height: 54px;
  &:hover {
    z-index: 1;
    & .tooltip {
      transform: scale(1) translateY(0px);
      opacity: 1;
    }
  }
  .tooltip {
    transform: translateY(5px) scale(0.6);
    opacity: 0;
  }
`,TooltipContainer=styled.div`
  position: absolute;
  transform: rotate(${e=>e.$rotate}rad);
  width: 100%;
  height: 100%;
  bottom: 0;
`,TestOverlay=styled.div`
  transition: all 0.2s ease-out;
  position: absolute;
  left: 0;
  top: 0;
  right: 0;
  bottom: 0;
`,CanvasContainerBG=styled.div``,CanvasContainer=styled.div`
  box-shadow: inset -1px -1px 0 rgb(0 0 0 / 20%),
    inset 1px 1px 0 rgb(255 255 255 / 10%);
`,ComboKeycap=e=>{const{normalizedRects:t,clipPath:o,overflowsTexture:n,macroData:s,label:r,canvasRef:a,onClick:i,onPointerDown:c,onPointerOver:l,onPointerOut:d,disabled:u,..._}=e,[p,x]=t;return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsxs(KeycapContainer,{..._,children:[jsxRuntimeExports.jsxs(ComboKeyBoundingContainer,{$selected:e.selected,onClick:i,onPointerDown:c,onPointerOver:l,onPointerOut:d,style:{cursor:u?"initial":"pointer",position:"relative",animation:e.disabled?"initial":e.selected?".75s infinite alternate select-glow":"",transform:`translateX(${-Math.abs(p[0]-x[0])*CSSVarObject.keyXPos/2}px) perspective(100px) translateZ(${e.keycapZ}px)`,width:Math.max(p[2],x[2])*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing,height:Math.max(p[3],x[3])*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing,clipPath:o},children:[jsxRuntimeExports.jsx(ComboKeyRectContainer,{style:{position:"absolute",borderRadius:3,background:getDarkenedColor(e.color.c,.8),transform:`translate(${CSSVarObject.keyXPos*p[0]}px,${CSSVarObject.keyYPos*p[1]}px)`,width:p[2]*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing,height:p[3]*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing}}),jsxRuntimeExports.jsx(ComboKeyRectContainer,{style:{position:"absolute",borderRadius:3,transform:`translate(${CSSVarObject.keyXPos*x[0]}px,${CSSVarObject.keyYPos*x[1]}px)`,background:getDarkenedColor(e.color.c,.8),width:x[2]*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing,height:x[3]*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing}}),jsxRuntimeExports.jsx(ComboKeyBGContainer,{style:{position:"absolute",borderRadius:3,background:getDarkenedColor(e.color.c,.8),transform:`translate(${CSSVarObject.keyXPos*p[0]+1}px,${1+CSSVarObject.keyYPos*p[1]}px)`,width:p[2]*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing-2,height:p[3]*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing-2}}),jsxRuntimeExports.jsx(CanvasContainer,{style:{borderRadius:4,background:e.color.c,position:"absolute",transform:`translate(${CSSVarObject.keyXPos*p[0]+CSSVarObject.faceXPadding[0]}px,${CSSVarObject.faceYPadding[0]+CSSVarObject.keyYPos*p[1]}px)`,width:p[2]*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing-CSSVarObject.faceXPadding[0]-CSSVarObject.faceXPadding[1],height:p[3]*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing-CSSVarObject.faceYPadding[0]-CSSVarObject.faceYPadding[1]}}),jsxRuntimeExports.jsx(CanvasContainer,{style:{borderRadius:4,background:e.color.c,position:"absolute",transform:`translate(${CSSVarObject.keyXPos*x[0]+CSSVarObject.faceXPadding[0]}px,${CSSVarObject.faceYPadding[0]+CSSVarObject.keyYPos*x[1]}px)`,width:x[2]*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing-CSSVarObject.faceXPadding[0]-CSSVarObject.faceXPadding[1],height:x[3]*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing-CSSVarObject.faceYPadding[0]-CSSVarObject.faceYPadding[1]}}),jsxRuntimeExports.jsx(CanvasContainerBG,{style:{borderRadius:4,background:e.color.c,position:"absolute",transform:`translate(${1+CSSVarObject.keyXPos*p[0]+CSSVarObject.faceXPadding[0]}px,${1+CSSVarObject.faceYPadding[0]+CSSVarObject.keyYPos*p[1]}px)`,width:p[2]*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing-CSSVarObject.faceXPadding[0]-CSSVarObject.faceXPadding[1]-2,height:p[3]*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing-CSSVarObject.faceYPadding[0]-CSSVarObject.faceYPadding[1]-2},children:jsxRuntimeExports.jsx("canvas",{ref:a,style:{}})}),DisplayMode.Test===e.mode?jsxRuntimeExports.jsx(TestOverlay,{style:{background:e.keycapColor,opacity:e.keycapOpacity}}):null]}),(e.macroData||e.overflowsTexture)&&jsxRuntimeExports.jsx(TooltipContainer,{$rotate:e.rotation[2],children:jsxRuntimeExports.jsx(Keycap2DTooltip,{children:e.macroData||e.label&&e.label.tooltipLabel})})]})})},ComboKeyBoundingContainer=styled.div`
  box-sizing: border-box;
  transition: transform 0.2s ease-out;
  animation: ${e=>e.$selected?".75s infinite alternate select-glow":"initial"};
  &:hover {
    transform: perspective(100px) translateZ(-5px);
    animation: 0.5s 1 forwards select-glow;
  }
`,ComboKeyRectContainer=styled.div`
  box-sizing: border-box;
  padding: 2px 6px 10px 6px;
  box-shadow: inset -1px -1px 0 rgb(0 0 0 / 20%),
    inset 1px 1px 0 rgb(255 255 255 / 20%);
`,ComboKeyBGContainer=styled.div`
  box-sizing: border-box;
  padding: 3px 7px 10px 6px;
`,EncoderKeyContainer=styled.div`
  position: absolute;
  left: 0;
  top: 0;
  width: 52px;
  opacity: 1;
  height: 52px;
  &:hover {
    z-index: 1;
    animation: 0.75s infinite alternate select-glow;
  }
`,EncoderKeyContent2=styled.div`
  --inner-padding: ${e=>e.$innerPadding}px;
  --size: ${e=>e.$size}px;
  --inner-size: ${e=>e.$size-e.$innerPadding*2}px;
  --half-size: ${e=>(e.$size-e.$innerPadding*2)/2}px;
  --half-size-p1: ${e=>1+(e.$size-e.$innerPadding*2)/2}px;
  --half-size-p05p: ${e=>e.$innerPadding/2+(e.$size-e.$innerPadding*2)/2}px;
  background-color: currentColor;
  padding: var(--inner-padding);
  min-width: var(--size);
  min-height: var(--size);
  clip-path: polygon(
    50% 0%,
    46.93% 3.1%,
    43.47% 0.43%,
    40.83% 3.9%,
    37.06% 1.7%,
    34.89% 5.49%,
    30.87% 3.81%,
    29.21% 7.85%,
    25% 6.7%,
    23.89% 10.92%,
    19.56% 10.33%,
    19.01% 14.66%,
    14.64% 14.64%,
    14.66% 19.01%,
    10.33% 19.56%,
    10.92% 23.89%,
    6.7% 25%,
    7.85% 29.21%,
    3.81% 30.87%,
    5.49% 34.89%,
    1.7% 37.06%,
    3.9% 40.83%,
    0.43% 43.47%,
    3.1% 46.93%,
    0% 50%,
    3.1% 53.07%,
    0.43% 56.53%,
    3.9% 59.17%,
    1.7% 62.94%,
    5.49% 65.11%,
    3.81% 69.13%,
    7.85% 70.79%,
    6.7% 75%,
    10.92% 76.11%,
    10.33% 80.44%,
    14.66% 80.99%,
    14.64% 85.36%,
    19.01% 85.34%,
    19.56% 89.67%,
    23.89% 89.08%,
    25% 93.3%,
    29.21% 92.15%,
    30.87% 96.19%,
    34.89% 94.51%,
    37.06% 98.3%,
    40.83% 96.1%,
    43.47% 99.57%,
    46.93% 96.9%,
    50% 100%,
    53.07% 96.9%,
    56.53% 99.57%,
    59.17% 96.1%,
    62.94% 98.3%,
    65.11% 94.51%,
    69.13% 96.19%,
    70.79% 92.15%,
    75% 93.3%,
    76.11% 89.08%,
    80.44% 89.67%,
    80.99% 85.34%,
    85.36% 85.36%,
    85.34% 80.99%,
    89.67% 80.44%,
    89.08% 76.11%,
    93.3% 75%,
    92.15% 70.79%,
    96.19% 69.13%,
    94.51% 65.11%,
    98.3% 62.94%,
    96.1% 59.17%,
    99.57% 56.53%,
    96.9% 53.07%,
    100% 50%,
    96.9% 46.93%,
    99.57% 43.47%,
    96.1% 40.83%,
    98.3% 37.06%,
    94.51% 34.89%,
    96.19% 30.87%,
    92.15% 29.21%,
    93.3% 25%,
    89.08% 23.89%,
    89.67% 19.56%,
    85.34% 19.01%,
    85.36% 14.64%,
    80.99% 14.66%,
    80.44% 10.33%,
    76.11% 10.92%,
    75% 6.7%,
    70.79% 7.85%,
    69.13% 3.81%,
    65.11% 5.49%,
    62.94% 1.7%,
    59.17% 3.9%,
    56.53% 0.43%,
    53.07% 3.1%
  );

  background-image: radial-gradient(
      currentColor var(--half-size),
      transparent var(--half-size-p1)
    ),
    radial-gradient(
      rgba(255, 255, 255, 0.6) var(--half-size),
      transparent var(--half-size-p1)
    ),
    radial-gradient(
      rgba(0, 0, 0, 0.2) var(--half-size),
      transparent var(--half-size-p05p)
    ),
    radial-gradient(
      rgba(0, 0, 0, 0.2) var(--half-size),
      transparent var(--half-size-p05p)
    );
  background-size: var(--size) var(--size);
  background-position: 0px 0px, -0.5px -0.5px, 0px 0px,
    calc(var(--inner-padding) / 2) calc(var(--inner-padding) / 2);
  background-repeat: repeat;

  transition: transform 0.5s ease-out;
  transform: rotate(0);
  box-sizing: border-box;
  &:hover {
    transform: rotate(450deg);
  }
`,EncoderKey=e=>jsxRuntimeExports.jsx(EncoderKeyContainer,{onClick:e.onClick,style:e.style,children:jsxRuntimeExports.jsx(EncoderKeyContent2,{$size:e.size&&+e.size,$innerPadding:5*e.size/52})}),getMacroData=({macroExpression:e,label:t})=>t&&t.length>15?t:e&&e.length?e:null,paintKeycapLabel=(e,t,o)=>{const n=e.getContext("2d");if(n==null)return;const s=devicePixelRatio,[r,a]=[e.width,e.height];e.width=r*s,e.height=a*s,e.style.width=`${r}px`,e.style.height=`${a}px`,n.scale(s,s);const i="Fira Sans, Arial Rounded MT, Arial Rounded MT Bold, Arial",c={x:4,y:4},l={x:4,y:4},d={x:3},u={x:4,y:4};if(n.beginPath(),n.moveTo(0,0),n.lineTo(e.width,0),n.lineTo(e.width,e.height),n.lineTo(0,e.height),n.lineTo(0,0),n.clip(),n.fillStyle=t,o!==void 0){if(o.topLabel&&o.bottomLabel){let _=16,p=.75*_,x=o.offset[0]*p,C=o.offset[1]*p;n.font=`bold ${_}px ${i}`,n.fillText(o.topLabel,c.x,c.y+x+p),n.fillText(o.bottomLabel,l.x,a-l.y-C)}else if(o.centerLabel){let _=13*o.size,p=.75*_,x=a/2;return n.font=`bold ${_}px ${i}`,n.fillText(o.label,d.x,x+.5*p),n.measureText(o.centerLabel).width>r-d.x}else if(typeof o.label=="string"){let _=22,p=.75*_;n.font=`bold ${_}px ${i}`,n.fillText(o.label,u.x,u.y+p)}}},paintKeycap=(e,t,o,n,s)=>{const[r,a]=[CSSVarObject.keyWidth,CSSVarObject.keyHeight];if(e.width=r*t-CSSVarObject.faceXPadding.reduce((c,l)=>c+l,0),e.height=a*o-CSSVarObject.faceYPadding.reduce((c,l)=>c+l,0),e.getContext("2d")!=null)return paintKeycapLabel(e,n,s)},Keycap=React.memo(e=>{const{label:t,scale:o,color:n,selected:s,disabled:r,mode:a,rotation:i,keyState:c,shouldRotate:l,textureWidth:d,textureHeight:u,skipFontCheck:_,idx:p}=e,x=t&&getMacroData(t),[C,m]=reactExports.useState(!1),[h,K]=reactExports.useState(!1),y=reactExports.useRef(null),g=React.useCallback(()=>{if(y.current&&n&&t&&(document.fonts.check('bold 16px "Fira Sans"',t.label)||_)){const T=paintKeycap(y.current,d,u,n.t,t);m(!!T)}},[y.current,d,t&&t.key,o[0],o[1],n&&n.t,n&&n.c,l]);reactExports.useEffect(g,[t&&t.key,_,n&&n.c,n&&n.t]),reactExports.useEffect(()=>(document.fonts.addEventListener("loadingdone",g),()=>{document.fonts.removeEventListener("loadingdone",g)}),[]);const[R,b]=[-8,0],f=DisplayMode.Test===a?TestKeyState.KeyDown===c?KeycapState.Pressed:KeycapState.Unpressed:h||s?KeycapState.Pressed:KeycapState.Unpressed,[M]=f===KeycapState.Pressed?[R,i[2]]:[b,i[2]+Math.PI*Number(l)],D=c===TestKeyState.KeyUp,w=DisplayMode.Test===a?f===KeycapState.Unpressed?D?"mediumvioletred":"lightgrey":"mediumvioletred":(f===KeycapState.Unpressed,"lightgrey"),I=f===KeycapState.Unpressed?D?.4:0:.6,[O,S,j,A]=reactExports.useMemo(()=>{const T=()=>{};return r?[T,T,T,T]:e.mode===DisplayMode.ConfigureColors?[T,L=>{e.onPointerOver&&e.onPointerOver(L,p)},T,L=>{e.onPointerDown&&e.onPointerDown(L,p)}]:[L=>e.onClick(L,p),L=>{e.onPointerOver&&e.onPointerOver(L,p),K(!0)},()=>K(!1),L=>{e.onPointerDown&&e.onPointerDown(L,p)}]},[r,e.onClick,e.onPointerDown,e.onPointerOver,K,p,a]);return l?jsxRuntimeExports.jsx(EncoderKey,{onClick:O,size:d*CSSVarObject.keyWidth,style:{transform:`translate(${e.position[0]-(CSSVarObject.keyWidth*d-CSSVarObject.keyWidth)/2}px,${d*(CSSVarObject.keyHeight-CSSVarObject.keyWidth)/2+e.position[1]-(CSSVarObject.keyHeight*u-CSSVarObject.keyHeight)/2}px) rotate(${-e.rotation[2]}rad)`,borderRadius:3,color:e.color.c}}):e.clipPath?jsxRuntimeExports.jsx(ComboKeycap,{...e,onClick:O,onPointerDown:A,onPointerOver:S,onPointerOut:j,keycapZ:M,keycapOpacity:I,keycapColor:w,canvasRef:y,macroData:x,overflowsTexture:C,style:{transform:`translate(${CSSVarObject.keyWidth/2+e.position[0]-(CSSVarObject.keyXPos*d-CSSVarObject.keyXSpacing)/2}px,${CSSVarObject.keyHeight/2+e.position[1]-(CSSVarObject.keyYPos*u-CSSVarObject.keyYSpacing)/2}px) rotate(${-e.rotation[2]}rad)`,width:d*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing,height:u*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing}}):jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsxs(KeycapContainer,{onClick:O,onPointerDown:A,onPointerOver:S,onPointerOut:j,style:{transform:`translate(${CSSVarObject.keyWidth/2+e.position[0]-(CSSVarObject.keyXPos*d-CSSVarObject.keyXSpacing)/2}px,${CSSVarObject.keyHeight/2+e.position[1]-(CSSVarObject.keyYPos*u-CSSVarObject.keyYSpacing)/2}px) rotate(${-e.rotation[2]}rad)`,width:d*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing,height:u*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing,cursor:r?"initial":"pointer"},children:[jsxRuntimeExports.jsxs(GlowContainer,{$selected:s,style:{animation:r?"initial":s?".75s infinite alternate select-glow":"",background:getDarkenedColor(e.color.c,.8),transform:`perspective(100px) translateZ(${M}px)`,borderRadius:3,width:d*CSSVarObject.keyXPos-CSSVarObject.keyXSpacing,height:u*CSSVarObject.keyYPos-CSSVarObject.keyYSpacing},children:[DisplayMode.Test===a?jsxRuntimeExports.jsx(TestOverlay,{style:{background:w,opacity:I}}):null,jsxRuntimeExports.jsx(CanvasContainer,{style:{borderRadius:4,background:e.color.c,height:"100%"},children:jsxRuntimeExports.jsx("canvas",{ref:y,style:{}})})]}),(x||C)&&jsxRuntimeExports.jsx(TooltipContainer,{$rotate:i[2],children:jsxRuntimeExports.jsx(Keycap2DTooltip,{children:x||t&&t.tooltipLabel})})]})})},shallowEqual),GlowContainer=styled.div`
  box-sizing: border-box;
  padding: 2px 6px 10px 6px;
  transition: transform 0.2s ease-out;
  box-shadow: inset -1px -1px 0 rgb(0 0 0 / 20%),
    inset 1px 1px 0 rgb(255 255 255 / 20%);
  animation: ${e=>e.$selected?".75s infinite alternate select-glow":"initial"};
  &:hover {
    transform: perspective(100px) translateZ(-5px);
    animation: 0.5s 1 forwards select-glow;
  }
`,KeyGroupContainer=styled.div`
  position: absolute;
  top: ${e=>CaseInsideBorder*1.5}px;
  left: ${e=>CaseInsideBorder*1.5}px;
`,getPosition=(e,t)=>[e-CSSVarObject.keyWidth/2,t-CSSVarObject.keyHeight/2,0],getRGBArray=e=>e.map(([t,o])=>{const n=getRGB({hue:Math.round(255*t/360),sat:Math.round(255*o)}),s=`#${new Color(n).getHexString()}`;return{c:s,t:s}}),KeyGroup=e=>{const t=useAppDispatch(),o=useAppSelector(getSelectedKey),n=useAppSelector(getSelectedTheme),s=useAppSelector(getExpressions),r=useSkipFontCheck(),a=e.keyColors?getRGBArray(e.keyColors):n,{basicKeyToByte:i,byteToKey:c}=useAppSelector(getBasicKeyToByte),l=useAppSelector(K=>K.macros),{keys:d,selectedKey:u}=e,_=u===void 0?o:u,p=reactExports.useMemo(()=>getKeysKeys(e,a,t,getPosition),[d,a,e.onKeycapPointerDown,e.onKeycapPointerOver]),x=reactExports.useMemo(()=>getLabels(e,s,i,c),[d,e.matrixKeycodes,l,e.definition]),{width:C,height:m}=calculateKeyboardFrameDimensions(d),h=reactExports.useMemo(()=>e.keys.map((K,y)=>K.d?null:jsxRuntimeExports.jsx(Keycap,{...getComboKeyProps(K),...getKeycapSharedProps(K,y,e,p,_,x,r)})),[d,_,x,e.pressedKeys,e.selectable,a,e.definition.vendorProductId,r]);return jsxRuntimeExports.jsx(KeyGroupContainer,{height:m,width:C,style:{pointerEvents:e.selectable?"all":"none"},children:h})},Matrix=({rowKeys:e,colKeys:t})=>jsxRuntimeExports.jsxs(SVG,{style:{position:"absolute",top:CSSVarObject.insideBorder,left:CSSVarObject.insideBorder},children:[e.map((o,n)=>jsxRuntimeExports.jsx(RowLine,{points:o.map(s=>(s||[]).join(",")).join(" ")},n)),t.map((o,n)=>jsxRuntimeExports.jsx(ColLine,{points:o.map(s=>(s||[]).join(",")).join(" ")},n))]}),SVG=styled.svg`
  transform: rotateZ(0);
  width: 100%;
  height: 100%;
`,RowLine=styled.polyline`
  stroke: var(--color_accent);
  stroke-width: 3;
  fill-opacity: 0;
  stroke-opacity: 0.4;
  stroke-linecap: round;
`,ColLine=styled.polyline`
  stroke: var(--color_light-grey);
  stroke-width: 3;
  fill-opacity: 0;
  stroke-opacity: 0.4;
  stroke-linecap: round;
`,MatrixLines=({keys:e,rows:t,cols:o,width:n,height:s})=>{const{rowKeys:r,colKeys:a}=generateRowColArray(e,t,o);return jsxRuntimeExports.jsx(Matrix,{rowKeys:r,colKeys:a})},KeyboardCanvas=e=>{const{containerDimensions:t,shouldHide:o,...n}=e,{width:s,height:r}=reactExports.useMemo(()=>calculateKeyboardFrameDimensions(n.keys),[n.keys]),a=t.height,i=35,c=Math.min(Math.min(1,t&&t.width/((CSSVarObject.keyWidth+CSSVarObject.keyXSpacing)*s-CSSVarObject.keyXSpacing+i*2)),a/((CSSVarObject.keyHeight+CSSVarObject.keyYSpacing)*r-CSSVarObject.keyYSpacing+i*2))||1;return jsxRuntimeExports.jsx("div",{style:{transform:`scale(${c}, ${c})`,opacity:o?0:1,position:"absolute",pointerEvents:o?"none":"all"},children:jsxRuntimeExports.jsx(KeyboardCanvasContent,{...n,width:s,height:r})})},KeyboardGroup$2=styled.div`
  position: relative;
`,KeyboardCanvasContent=React.memo(e=>{const{matrixKeycodes:t,keys:o,definition:n,pressedKeys:s,mode:r,showMatrix:a,selectable:i,width:c,height:l}=e;return jsxRuntimeExports.jsxs(KeyboardGroup$2,{children:[jsxRuntimeExports.jsx(Case,{width:c,height:l}),jsxRuntimeExports.jsx(KeyGroup,{...e,keys:o,mode:r,matrixKeycodes:t,selectable:i,definition:n,pressedKeys:s}),a&&jsxRuntimeExports.jsx(MatrixLines,{keys:o,rows:n.matrix.rows,cols:n.matrix.cols,width:c,height:l})]})},shallowEqual),getKeyboardCanvas=e=>e==="2D"?KeyboardCanvas:KeyboardCanvas$1,ConfigureKeyboard=e=>{const{selectable:t,dimensions:o}=e,n=useAppSelector(C=>getSelectedKeymap(C)||[]),s=useAppSelector(getSelectedKeyDefinitions),r=useAppSelector(getSelectedDefinition),a=useAppSelector(getShowKeyPainter),i=useAppSelector(getSelectedPaletteColor),{keyColors:c,onKeycapPointerDown:l,onKeycapPointerOver:d}=useColorPainter(s,i),[u,_]=reactExports.useMemo(()=>c&&s?[s.filter((C,m)=>c[m]&&c[m].length),c.filter(C=>C&&C.length)]:[null,null],[s,c]);if(!r||!o)return null;const p=(u==null?void 0:u.length)&&(_==null?void 0:_.length),x=getKeyboardCanvas(e.nDimension);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(x,{matrixKeycodes:n,keys:s,selectable:!!t,definition:r,containerDimensions:o,mode:DisplayMode.Configure,shouldHide:a}),p?jsxRuntimeExports.jsx(x,{matrixKeycodes:n,keys:u,selectable:a,definition:r,containerDimensions:o,mode:DisplayMode.ConfigureColors,keyColors:_,onKeycapPointerDown:l,onKeycapPointerOver:d,shouldHide:!a}):null]})},EMPTY_ARR$1=[],DesignKeyboard=e=>{const{containerDimensions:t,showMatrix:o,definition:n,selectedOptionKeys:s}=e,{keys:r,optionKeys:a}=n.layouts;if(!t)return null;const i=reactExports.useMemo(()=>a?Object.entries(a).flatMap(([d,u])=>{const _=parseInt(d);return s[_]?u[s[_]]:u[0]}):[],[a,s]),c=reactExports.useMemo(()=>[...r,...i],[r,i]),l=getKeyboardCanvas(e.nDimension);return jsxRuntimeExports.jsx(l,{matrixKeycodes:EMPTY_ARR$1,keys:c,selectable:!1,definition:n,containerDimensions:t,mode:DisplayMode.Design,showMatrix:o})},Design=e=>{const t=Object.values(useAppSelector(getCustomDefinitions)),o=useAppSelector(getDesignDefinitionVersion),n=useAppSelector(getSelectedDefinitionIndex),s=useAppSelector(getDesignSelectedOptionKeys),r=useAppSelector(getShowMatrix),a=reactExports.useMemo(()=>t.filter(c=>c[o]),[t,o]),i=a[n]&&a[n][o];return i&&jsxRuntimeExports.jsx(DesignKeyboard,{containerDimensions:e.dimensions,definition:i,selectedOptionKeys:s,showMatrix:r,nDimension:e.nDimension})},useGlobalKeys=e=>{const t=!e,o=reactExports.useState({}),[n,s]=o;function r(i){i.preventDefault(),!t&&!i.repeat&&n[getIndexByEvent(i)??-1]!==TestKeyState.KeyDown&&s(c=>({...c,[getIndexByEvent(i)]:TestKeyState.KeyDown}))}const a=i=>{i.preventDefault(),!t&&n[getIndexByEvent(i)]!==TestKeyState.KeyUp&&s(c=>({...c,[getIndexByEvent(i)]:TestKeyState.KeyUp}))};return reactExports.useEffect(()=>(e&&(window.addEventListener("keydown",r),window.addEventListener("keyup",a)),()=>{window.removeEventListener("keydown",r),window.removeEventListener("keyup",a)}),[e]),o},invertTestKeyState=e=>e===TestKeyState.KeyDown?TestKeyState.KeyUp:TestKeyState.KeyDown,useMatrixTest=(e,t,o,n)=>{const s=reactExports.useState([]),[,r]=s,a=useDispatch(),i=reactExports.useRef(e);reactExports.useEffect(()=>{let d=[];const u=()=>{i.current=!1},_=async(p,x,C,m)=>{if(e&&p&&C){const{cols:h,rows:K}=C.matrix,y=Math.ceil(h/8),g=Math.floor(28/y);try{let R=[];for(let f=0;f<K;f+=g){const M=Math.min(K*y-R.length,y*g);R.push(...await p.getKeyboardValue(KeyboardValue.SWITCH_MATRIX_STATE,x>=12?[f]:[],M))}if(!R.some((f,M)=>f^(m[M]||0))){await p.timeout(20),i.current&&_(p,x,C,m);return}r(f=>R.reduce((M,D,w)=>{const I=D^(m[w]||0);if(I===0)return M;const O=~~(w/y),S=8*(y-1-w%y);return Array(Math.max(0,Math.min(8,h-S))).fill(0).reduce((j,A,T)=>{const L=h*O+T+S;return j[L]=(I>>T&1)===1?invertTestKeyState(j[L]):j[L],j},M)},Array.isArray(f)&&f.length===K*h?[...f]:Array(K*h).fill(TestKeyState.Initial))),await p.timeout(20),i.current&&_(p,x,C,R)}catch{i.current=!1,a(setTestMatrixEnabled(!1))}}};return e&&t&&o&&n&&(i.current=!0,_(t,o.protocol,n,d)),()=>{u()}},[e,n,t]);const c=d=>{d.preventDefault()},l=d=>{d.preventDefault()};return reactExports.useEffect(()=>(e&&(window.addEventListener("keydown",c),window.addEventListener("keyup",l)),()=>{window.removeEventListener("keydown",c),window.removeEventListener("keyup",l)}),[e]),s},EMPTY_ARR=[],Test=e=>{const t=useAppDispatch(),[o]=useLocation(),n=o==="/test",s=useAppSelector(getSelectedKeyboardAPI),r=useAppSelector(getSelectedConnectedDevice),a=useAppSelector(getSelectedDefinition),i=useAppSelector(getSelectedKeyDefinitions),c=useAppSelector(getIsTestMatrixEnabled),l=useAppSelector(getTestKeyboardSoundsSettings),d=useAppSelector(M=>getSelectedKeymap(M)||[]),[u,_]=useGlobalKeys(!c&&n),[p,x]=useMatrixTest(c&&n,s,r,a),C=reactExports.useCallback(()=>{_(EMPTY_ARR),x(EMPTY_ARR)},[_,x]),m=reactExports.useContext(TestContext);reactExports.useEffect(()=>{m[0].clearTestKeys!==C&&m[1]({clearTestKeys:C})},[m,C]),reactExports.useEffect(()=>{o!=="/test"&&(t(setTestMatrixEnabled(!1)),m[0].clearTestKeys()),o!=="/"&&t(setLayer(0))},[o]);const h=c&&i?i.map(({row:M,col:D})=>a&&p[M*a.matrix.cols+D]):[],K=c?a:fullKeyboardDefinition,y=c?i:fullKeyboardDefinition.layouts.keys;if(!K||typeof K=="string")return null;const g=c?h:u,{partitionedKeys:R}=reactExports.useMemo(()=>getKeyboardRowPartitions(y),[y]),b=c?p:u,f=R.map(M=>M.map(({row:D,col:w})=>b[D*K.matrix.cols+w]));return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(TestKeyboard,{definition:K,keys:y,pressedKeys:g,matrixKeycodes:c?d:matrixKeycodes,containerDimensions:e.dimensions,nDimension:e.nDimension}),f&&l.isEnabled&&jsxRuntimeExports.jsx(TestKeyboardSounds,{pressedKeys:f})]})},TestKeyboard=e=>{const{selectable:t,containerDimensions:o,matrixKeycodes:n,keys:s,pressedKeys:r,definition:a,nDimension:i}=e;if(!o)return null;const c=getKeyboardCanvas(i);return jsxRuntimeExports.jsx(c,{matrixKeycodes:n,keys:s,selectable:!!t,definition:a,pressedKeys:r,containerDimensions:o,mode:DisplayMode.Test})},ZOOM=5.5*.8,Camera=()=>{const{progress:e}=useProgress(),t=useThree(r=>r.camera),[o,n]=[7,7],s=useSpring({config:{duration:800},from:{x:o}});return React.useEffect(()=>{e===100&&(console.debug("lets animate"),s.x.start(n))},[e]),React.useEffect(()=>(console.debug("mounting"),()=>{console.debug("unmounting")}),[]),useFrame(()=>{s.x.isAnimating&&(t.position.setZ(s.x.get()),t.position.setY(.4*Math.pow(s.x.get()-n,1)),t.updateProjectionMatrix()),t.zoom!==ZOOM&&(t.zoom=ZOOM,t.updateProjectionMatrix())}),jsxRuntimeExports.jsx(PerspectiveCamera,{"position-z":o,makeDefault:!0,fov:25})},LoaderCubey=React.memo(({visible:e,theme:t})=>{const o=useGLTF(cubeySrc);console.debug(o,"cubey");const n=reactExports.useRef(),s=e?-.3:10,r=getDarkenedColor(t.accent.c,.8),a={"upper-body":new Color(t.mod.c),"lower-body":new Color(t.mod.t),accent:new Color(r),bowtie:new Color(r)};return o.scene.children.forEach(i=>{const c=i.name.split("_")[0],l=a[c];l&&(i.material.color=l)}),useFrame(({clock:i})=>{e&&(n.current.rotation.z=Math.sin(i.elapsedTime)*(Math.PI/40),n.current.rotation.y=Math.PI+Math.sin(.6*i.elapsedTime)*(Math.PI/16),n.current.position.y=s+.2*Math.sin(i.elapsedTime))}),jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsx("group",{scale:.6,position:[0,s,-19],children:jsxRuntimeExports.jsx(PresentationControls,{enabled:!0,global:!0,snap:!0,speed:1,zoom:1,rotation:[0,0,0],polar:[-Math.PI/3,Math.PI/3],config:{mass:2,tension:200,friction:14},children:jsxRuntimeExports.jsx("group",{ref:n,children:jsxRuntimeExports.jsx("primitive",{object:o.scene})})})})})},shallowEqual),UpdateUVMaps=()=>{const e=useGLTF(glbSrc,!0).scene;return reactExports.useEffect(()=>{Object.values(e.children).forEach(t=>{if(t.isGroup)return;const o=t,n=1/2.6,s=o.geometry,{min:r}=s.boundingBox,a=19.05,i=.445,c=o.geometry.attributes.position;o.geometry.attributes.uv||o.geometry.setAttribute("uv",new BufferAttribute(new Float32Array(c.count*2),2,!1));const l=o.geometry.attributes.uv,d=new Float32Array(l.count*2);for(let u=0;u<o.geometry.attributes.uv.count;u++)d[2*u]=n*(c.array[u*3]-r.x+i)/a,d[2*u+1]=n*(c.array[u*3+1]-r.y+i)/a;l.copyArray(d),s.center(),l.needsUpdate=!0})},[e]),null};useGLTF.preload(cubeySrc,!0,!0);useGLTF.preload(glbSrc,!0,!0);const KeyboardBG$1=React.memo(e=>{const{onClick:t,visible:o,color:n}=e;return jsxRuntimeExports.jsxs("mesh",{receiveShadow:!0,position:[0,-5.75,0],rotation:[-Math.PI/2+Math.PI/14,0,0],onClick:t,visible:o,children:[jsxRuntimeExports.jsx("planeGeometry",{args:[100,100]}),jsxRuntimeExports.jsx("meshStandardMaterial",{color:n})]})},shallowEqual),CanvasRouter$1=()=>jsxRuntimeExports.jsx(reactExports.Suspense,{fallback:null,children:jsxRuntimeExports.jsx(LazyRouter,{})}),LazyRouter=React.lazy(async()=>(await document.fonts.load("bold 16px Fira Sans").finally(),{default:NonSuspenseCanvasRouter})),NonSuspenseCanvasRouter=()=>{const[e]=useLocation(),t=reactExports.useRef(document.body),o=reactExports.useRef(null),n=useAppSelector(getLoadProgress),{progress:s}=useProgress(),r=useAppDispatch(),a=useSize(t),i=Object.values(useAppSelector(getCustomDefinitions)),c=useAppSelector(getSelectedDefinition),l=useAppSelector(getDesignDefinitionVersion),d=useAppSelector(getSelectedTheme),u=reactExports.useMemo(()=>d[distExports.KeyColorType.Accent].c,[d]),_=e==="/"&&(!c||n!==1);useGLTF(glbSrc,!0,!0);const p=reactExports.useMemo(()=>i.filter(R=>R[l]),[i,l]),x=e==="/design"&&!p.length,C=e==="/"&&(!c||(n+s/100)/2!==1),m=reactExports.useCallback(()=>{r(updateSelectedKey(null))},[r]),h="hid"in navigator||OVERRIDE_HID_CHECK,K=!h||["/settings","/errors"].includes(e)||x||C,y=useAppSelector(getConfigureKeyboardIsSelectable),g=_;return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsx("div",{style:{height:500,width:"100%",top:0,transform:K?g?a?`translateY(${-300+a.height/2}px)`:"":"translateY(-500px)":"",position:K&&!g?"absolute":"relative",overflow:"visible",zIndex:0,visibility:K&&!g?"hidden":"visible"},ref:o,children:jsxRuntimeExports.jsxs(Canvas,{flat:!0,shadows:!0,style:{overflow:"visible"},children:[jsxRuntimeExports.jsx(UpdateUVMaps,{}),jsxRuntimeExports.jsx(Lights,{}),jsxRuntimeExports.jsx(KeyboardBG$1,{onClick:m,color:u,visible:!g}),jsxRuntimeExports.jsx(OrbitControls,{enabled:!1}),jsxRuntimeExports.jsx(Camera,{}),jsxRuntimeExports.jsx(LoaderCubey,{theme:d,visible:g&&!c}),jsxRuntimeExports.jsx(Html,{center:!0,position:[0,g?c?0:-1:10,-19],children:h?c?jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsx("div",{style:{textAlign:"center",color:"var(--color_accent)",fontSize:60},children:jsxRuntimeExports.jsx(FontAwesomeIcon,{spinPulse:!0,icon:faSpinner})})}):jsxRuntimeExports.jsxs(AccentButtonLarge,{onClick:()=>r(reloadConnectedDevices()),style:{width:"max-content"},children:["Authorize device",jsxRuntimeExports.jsx(FontAwesomeIcon,{style:{marginLeft:"10px"},icon:faUnlock})]}):null}),jsxRuntimeExports.jsx(KeyboardGroup$1,{containerRef:o,configureKeyboardIsSelectable:y,loadProgress:n})]})})})},Lights=React.memo(()=>{const r=reactExports.useRef(null);reactExports.useEffect(()=>{r.current&&(r.current.shadow.mapSize.width=2048,r.current.shadow.mapSize.height=2048)},[r.current]);const a=React.useMemo(()=>{const i=new Object3D;return i.position.set(0,0,-19),i.updateMatrixWorld(),i},[]);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("ambientLight",{intensity:.8}),jsxRuntimeExports.jsx(SpotLight,{ref:r,distance:15,position:[0,12,-17],angle:Math.PI/5,attenuation:5,target:a,intensity:10,castShadow:!0,anglePower:5}),jsxRuntimeExports.jsx("pointLight",{position:[2,.25,-16],intensity:20}),jsxRuntimeExports.jsx("pointLight",{position:[-2,.25,-16],intensity:20})]})},shallowEqual),getRouteX$1=e=>{switch(e){case"/debug":return-60;case"/design":return-40;case"/test":return-20;case"/":return 0;default:return-60}},KeyboardGroup$1=React.memo(e=>{const{loadProgress:t,configureKeyboardIsSelectable:o}=e,[n]=useLocation(),s=getRouteX$1(n),r=useSpring({config:config.stiff,x:s}),a=useSize(e.containerRef);return jsxRuntimeExports.jsx(animated.group,{"position-x":r.x,children:jsxRuntimeExports.jsx(Keyboards$1,{configureKeyboardIsSelectable:o,loadProgress:t,dimensions:a})})},shallowEqual),Keyboards$1=React.memo(e=>{const{loadProgress:t,dimensions:o,configureKeyboardIsSelectable:n}=e,s=-getRouteX$1("/test"),r=-getRouteX$1("/design"),a=-getRouteX$1("/debug");return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("group",{visible:t===1,children:jsxRuntimeExports.jsx(ConfigureKeyboard,{dimensions:o,selectable:n,nDimension:"3D"})}),jsxRuntimeExports.jsx("group",{"position-x":s,children:jsxRuntimeExports.jsx(Test,{dimensions:o,nDimension:"3D"})}),jsxRuntimeExports.jsx("group",{"position-x":r,children:jsxRuntimeExports.jsx(Design,{dimensions:o,nDimension:"3D"})}),jsxRuntimeExports.jsx("group",{"position-x":a})]})},shallowEqual),KeyboardBG=styled.div`
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  background: ${e=>`linear-gradient(30deg, rgba(150,150,150,1) 10%,${getDarkenedColor(e.$color)} 50%, rgba(150,150,150,1) 90%)`};
  opacity: ${e=>e.$visible?1:0};
`,KeyboardRouteGroup=styled.div`
  position: absolute;
  left: 0;
  transform: translateX(${e=>e.$position*100}vw);
  height: 100%;
  width: 100vw;
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
`,CanvasRouter=()=>{const[e]=useLocation(),t=reactExports.useRef(document.body),o=reactExports.useRef(null),n=useAppSelector(getLoadProgress),{progress:s}=useProgress(),r=useAppDispatch(),a=useSize(o),i=useSize(t),c=Object.values(useAppSelector(getCustomDefinitions)),l=useAppSelector(getSelectedDefinition),d=useAppSelector(getDesignDefinitionVersion),u=useAppSelector(getSelectedTheme),_=reactExports.useMemo(()=>u[distExports.KeyColorType.Accent].c,[u]),p=e==="/"&&(!l||n!==1),x=reactExports.useMemo(()=>c.filter(b=>b[d]),[c,d]),C=e==="/design"&&!x.length,m=e==="/"&&(!l||(n+s/100)/2!==1),h=reactExports.useCallback(()=>{r(updateSelectedKey(null))},[r]),y=!("hid"in navigator||OVERRIDE_HID_CHECK)||["/settings","/errors"].includes(e)||C||m,g=useAppSelector(getConfigureKeyboardIsSelectable),R=p;return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsx("div",{style:{height:500,width:"100%",top:0,transform:y?R?i?`translateY(${-300+i.height/2}px)`:"":"translateY(-500px)":"",position:y&&!R?"absolute":"relative",overflow:"visible",zIndex:2,visibility:y&&!R?"hidden":"visible"},onClick:b=>{b.target.nodeName!=="CANVAS"&&r(clearSelectedKey())},ref:o,children:y?null:jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(KeyboardBG,{onClick:h,$color:_,$visible:!R}),jsxRuntimeExports.jsx(KeyboardGroup,{containerDimensions:a,configureKeyboardIsSelectable:g,loadProgress:n})]})})})},getRouteX=e=>{switch(e){case"/debug":return-300;case"/design":return-200;case"/test":return-100;case"/":return 0;default:return-300}},KeyboardGroupContainer=styled.div`
  z-index: 2;
  display: block;
  white-space: nowrap;
  height: 100%;
  background: linear-gradient(90deg, red, blue);
  width: max-content;
  position: absolute;
  top: 0;
  left: 0;
`,KeyboardGroup=React.memo(e=>{const{loadProgress:t,configureKeyboardIsSelectable:o,containerDimensions:n}=e,[s]=useLocation(),r=reactExports.useRef(null),a=getRouteX(s),i={transition:"transform 0.25s ease-in-out",transform:`translate(${a}vw, 0px)`},c=reactExports.useCallback(()=>{r.current&&(r.current.style.transition=i.transition)},[r.current]),l=reactExports.useCallback(()=>{r.current&&(r.current.style.transition="")},[r.current]);return reactExports.useEffect(()=>(r.current&&(r.current.addEventListener("transitionend",l),r.current.style.transform=i.transform),()=>{var d;r.current&&((d=r.current)==null||d.removeEventListener("transitionend",l))}),[]),reactExports.useEffect(()=>{r.current&&r.current.style.transform!==i.transform&&(c(),r.current.style.transform=i.transform)},[a]),jsxRuntimeExports.jsx(KeyboardGroupContainer,{ref:r,children:jsxRuntimeExports.jsx(Keyboards,{configureKeyboardIsSelectable:o,loadProgress:t,dimensions:n})})},shallowEqual),Keyboards=React.memo(e=>{const{dimensions:t,configureKeyboardIsSelectable:o}=e;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(KeyboardRouteGroup,{$position:0,children:jsxRuntimeExports.jsx(ConfigureKeyboard,{dimensions:t,selectable:o,nDimension:"2D"})}),jsxRuntimeExports.jsx(KeyboardRouteGroup,{$position:1,children:jsxRuntimeExports.jsx(Test,{dimensions:t,nDimension:"2D"})}),jsxRuntimeExports.jsx(KeyboardRouteGroup,{$position:2,children:jsxRuntimeExports.jsx(Design,{dimensions:t,nDimension:"2D"})}),jsxRuntimeExports.jsx(KeyboardRouteGroup,{$position:3})]})},shallowEqual),GlobalStyle=createGlobalStyle`
  *:focus {
    outline: none;
  }
`,Routes=()=>{const e="hid"in navigator||OVERRIDE_HID_CHECK,t=useAppSelector(getRenderMode),o=reactExports.useMemo(()=>PANES.map(r=>jsxRuntimeExports.jsx(Route,{component:r.component,path:r.path},r.key)),[]),n=t==="2D"?CanvasRouter:CanvasRouter$1,s=reactExports.useState({clearTestKeys:()=>{}});return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsxs(TestContext.Provider,{value:s,children:[jsxRuntimeExports.jsx(GlobalStyle,{}),e&&jsxRuntimeExports.jsx(UnconnectedGlobalMenu,{}),jsxRuntimeExports.jsx(n,{}),jsxRuntimeExports.jsx(Home,{hasHIDSupport:e,children:o})]})})},Root=()=>jsxRuntimeExports.jsx(Provider_default,{store,children:jsxRuntimeExports.jsx(Routes,{})}),elem=document.getElementById("root");elem&&(clientExports.createRoot(elem).render(jsxRuntimeExports.jsx(Root,{})),document.documentElement.dataset.themeMode=getThemeModeFromStore(),updateCSSVariables(getThemeNameFromStore()));
